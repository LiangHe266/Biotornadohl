PACS.CtxWraper=function(a,b){this.ctx=a;this.update(b)};PACS.CtxWraper.prototype.update=function(a){this.dwInfo=a;delete this.convert;this.init()};PACS.CtxWraper.prototype.init=function(){if(this.convert){return}var i=this.dwInfo;var l=this.ctx;var f,c,b,a;f=i.transform.A;c=i.transform.B;b=i.transform.C;a=i.transform.D;f*=i.scale;c*=i.scale;b*=i.scale;a*=i.scale;var e=i.ox;var d=i.oy;var k=i.sw/2;var g=i.sh/2;var h=k*i.scale;var j=g*i.scale;this.r=[0,0];this.convert=function(o,s,q){o=o-k;s=s-g;var p=f*o+b*s+e;var r=c*o+a*s+d;if(q){q[0]=p+h;q[1]=r+j;return q}else{return[p+h,r+j]}}};PACS.CtxWraper.prototype.convert0=function(a,d){this.ctx.moveTo();a=a-this.xc;d=d-this.yc;var b=this.a*a+this.c*d+this.ox;var c=this.b*a+this.d*d+this.oy;return[b+this.xcs,c+this.ycs]};PACS.CtxWraper.prototype.getContext=function(){return this.ctx};PACS.CtxWraper.prototype.moveTo=function(a,c){var b=this.r;this.convert(a,c,b);this.ctx.moveTo(b[0],b[1])};PACS.CtxWraper.prototype.lineTo=function(a,c){var b=this.r;this.convert(a,c,b);this.ctx.lineTo(b[0],b[1])};PACS.CtxWraper.prototype.drawMLine=function(b,j,a,h,g,f,k){var r=this.ctx;var q=this.convert(b,j);var o=this.convert(a,h);r.moveTo(q[0],q[1]);r.lineTo(o[0],o[1]);var s=(o[0]-q[0]);var p=(o[1]-q[1]);if(s!=0||p!=0){var c=Math.sqrt(s*s+p*p);var e=(3*p/c);var d=(3*s/c);r.moveTo(q[0]+e,q[1]-d);r.lineTo(q[0]-e,q[1]+d);r.moveTo(o[0]-e,o[1]+d);r.lineTo(o[0]+e,o[1]-d);var l=(q[0]+o[0])/2;var i=(q[1]+o[1])/2;r.moveTo(l+e,i-d);r.lineTo(l-e,i+d)}s=(a-b);p=(h-j);s*=g;p*=f;var c=Math.sqrt(s*s+p*p);r.fillText(Math.round(c)+k,o[0]+5,o[1]+5)};PACS.CtxWraper.prototype.rect=function(d,j,e,c){var i=this.convert(d,j);var h=this.convert(d+e,j);var g=this.convert(d+e,j+c);var f=this.convert(d,j+c);this.ctx.moveTo(i[0],i[1]);this.ctx.lineTo(h[0],h[1]);this.ctx.lineTo(g[0],g[1]);this.ctx.lineTo(f[0],f[1]);this.ctx.lineTo(i[0],i[1])};PACS.CtxWraper.prototype.drawEllipse=function(l,h,j,i){var c=this.r;this.convert(l,h,c);l=c[0];h=c[1];j*=this.dwInfo.scale;i*=this.dwInfo.scale;switch(this.dwInfo.rotate){case 90:case 270:var g=j;j=i;i=g;break}var f=0.5522848;var e=j*f;var d=i*f;var o=this.ctx;o.moveTo(l-j,h);o.bezierCurveTo(l-j,h-d,l-e,h-i,l,h-i);o.bezierCurveTo(l+e,h-i,l+j,h-d,l+j,h);o.bezierCurveTo(l+j,h+d,l+e,h+i,l,h+i);o.bezierCurveTo(l-e,h+i,l-j,h+d,l-j,h)};PACS.CtxWraper.prototype.bezierCurveTo=function(d,f,e,c){this.ctx.bezierCurveTo(d,f,e,c,m,n)};PACS.CtxWraper.prototype.beginPath=function(){this.ctx.beginPath()};PACS.CtxWraper.prototype.closePath=function(){this.ctx.closePath()};PACS.CtxWraper.prototype.stroke=function(){this.ctx.stroke()};PACS.CtxWraper.prototype.fillText=function(e,a,f,c,b){var d=this.convert(a,f);this.ctx.fillText(e,d[0]+c,d[1]+b)};