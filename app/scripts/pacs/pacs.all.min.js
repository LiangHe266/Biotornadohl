var Cache=Cache||{};Cache.Common=function(c,b,a){if(!(this instanceof Cache.Common)){return new Cache.Common(c,a)}this.compare=c;this.create=b;this.max=a;this.cache=new Array(a)};Cache.Common.prototype.put=function(d){var b=this.cache;var a=b.length;for(var c=0;c<a;c++){if(!b[c]){b[c]=d;return}}if(b.length<this.max){b[b.length]=d}else{delete b[0];b[0]=d}};Cache.Common.prototype.get=function(f,e){var b=this.cache;var a=b.length;var d;for(var c=0;c<a;c++){d=b[c];if(d&&(!this.compare||this.compare(d,f,e))){b[c]=null;return d}}if(this.create){return this.create(f,e)}return null};var arrayCmp=function(a,c,b){return(a.length==c)};var Uint8ArrayCache=new Cache.Common(arrayCmp,function(b,a){return new Uint8Array(b)},5);var Uint8ClampedArrayCache=new Cache.Common(arrayCmp,function(b,a){return new Uint8ClampedArray(b)},5);var ImageDataCache=new Cache.Common(function(c,a,b){return(c.width==a&&c.height==b)},null,20);ImageDataCache.getex=function(b,a,c){var d=this.get(a,c);if(!d){d=b.createImageData(a,c)}return d};PACS.CtxWraper=function(a,b){this.ctx=a;this.update(b)};PACS.CtxWraper.prototype.update=function(a){this.dwInfo=a;delete this.convert;this.init()};PACS.CtxWraper.prototype.init=function(){if(this.convert){return}var i=this.dwInfo;var l=this.ctx;var f,c,b,a;f=i.transform.A;c=i.transform.B;b=i.transform.C;a=i.transform.D;f*=i.scale;c*=i.scale;b*=i.scale;a*=i.scale;var e=i.ox;var d=i.oy;var k=i.sw/2;var g=i.sh/2;var h=k*i.scale;var j=g*i.scale;this.r=[0,0];this.convert=function(o,s,q){o=o-k;s=s-g;var p=f*o+b*s+e;var r=c*o+a*s+d;if(q){q[0]=p+h;q[1]=r+j;return q}else{return[p+h,r+j]}}};PACS.CtxWraper.prototype.convert0=function(a,d){this.ctx.moveTo();a=a-this.xc;d=d-this.yc;var b=this.a*a+this.c*d+this.ox;var c=this.b*a+this.d*d+this.oy;return[b+this.xcs,c+this.ycs]};PACS.CtxWraper.prototype.getContext=function(){return this.ctx};PACS.CtxWraper.prototype.moveTo=function(a,c){var b=this.r;this.convert(a,c,b);this.ctx.moveTo(b[0],b[1])};PACS.CtxWraper.prototype.lineTo=function(a,c){var b=this.r;this.convert(a,c,b);this.ctx.lineTo(b[0],b[1])};PACS.CtxWraper.prototype.drawMLine=function(b,j,a,h,g,f,k){var r=this.ctx;var q=this.convert(b,j);var o=this.convert(a,h);r.moveTo(q[0],q[1]);r.lineTo(o[0],o[1]);var s=(o[0]-q[0]);var p=(o[1]-q[1]);if(s!=0||p!=0){var c=Math.sqrt(s*s+p*p);var e=(3*p/c);var d=(3*s/c);r.moveTo(q[0]+e,q[1]-d);r.lineTo(q[0]-e,q[1]+d);r.moveTo(o[0]-e,o[1]+d);r.lineTo(o[0]+e,o[1]-d);var l=(q[0]+o[0])/2;var i=(q[1]+o[1])/2;r.moveTo(l+e,i-d);r.lineTo(l-e,i+d)}s=(a-b);p=(h-j);s*=g;p*=f;var c=Math.sqrt(s*s+p*p);r.fillText(Math.round(c)+k,o[0]+5,o[1]+5)};PACS.CtxWraper.prototype.rect=function(d,j,e,c){var i=this.convert(d,j);var h=this.convert(d+e,j);var g=this.convert(d+e,j+c);var f=this.convert(d,j+c);this.ctx.moveTo(i[0],i[1]);this.ctx.lineTo(h[0],h[1]);this.ctx.lineTo(g[0],g[1]);this.ctx.lineTo(f[0],f[1]);this.ctx.lineTo(i[0],i[1])};PACS.CtxWraper.prototype.drawEllipse=function(l,h,j,i){var c=this.r;this.convert(l,h,c);l=c[0];h=c[1];j*=this.dwInfo.scale;i*=this.dwInfo.scale;switch(this.dwInfo.rotate){case 90:case 270:var g=j;j=i;i=g;break}var f=0.5522848;var e=j*f;var d=i*f;var o=this.ctx;o.moveTo(l-j,h);o.bezierCurveTo(l-j,h-d,l-e,h-i,l,h-i);o.bezierCurveTo(l+e,h-i,l+j,h-d,l+j,h);o.bezierCurveTo(l+j,h+d,l+e,h+i,l,h+i);o.bezierCurveTo(l-e,h+i,l-j,h+d,l-j,h)};PACS.CtxWraper.prototype.bezierCurveTo=function(d,f,e,c){this.ctx.bezierCurveTo(d,f,e,c,m,n)};PACS.CtxWraper.prototype.beginPath=function(){this.ctx.beginPath()};PACS.CtxWraper.prototype.closePath=function(){this.ctx.closePath()};PACS.CtxWraper.prototype.stroke=function(){this.ctx.stroke()};PACS.CtxWraper.prototype.fillText=function(e,a,f,c,b){var d=this.convert(a,f);this.ctx.fillText(e,d[0]+c,d[1]+b)};PACS.MaxLinePoints=100;PACS.MaxPencilPoints=100;PACS.DrawObject=function(e,b,a,c){if(!(this instanceof PACS.DrawObject)){return new PACS.DrawObject(e,b,a,c)}this.imageData=e;this.mousedown(b,a,c)};PACS.DrawObject.prototype.mousedown=function(b,a,e){d("mousedown x:"+a+" y:"+e);if(this.done){this.trysel(a,e);return}if(this.type){if(this.tryend(a,e,true)){this.lastInitTime=(new Date()).getTime();return}}this.type=b;this.done=false;this.moved=false;this.selected=false;this.selectPoint=-1;this.lastInitTime=(new Date()).getTime();switch(b){case MeterTool.LINE:case SelectTool.RECT:case SelectTool.CIRCLE:case MarkTool.ARROW:case MarkTool.CIRCLE:case MarkTool.RECT:this.points=[a,e,a,e];break;case MeterTool.ANGLE:this.points=[a,e,a,e,0,0];break;case MeterTool.COBB_ANGLE:this.points=[a,e,a,e,0,0,0,0];break;case SelectTool.POLYGON:case MarkTool.FOLD_LINE:case MarkTool.PENCIL:this.points=new Array(PACS.MaxPencilPoints*2+2);this.points[0]=a;this.points[1]=e;this.curPoints=this.points;break;case MarkTool.TEXT:var c=prompt("请输入文字内容","");if(c){this.text=c}else{this.text=null}this.points=[a,e,a,e];break;dedault:return}this.pNum=1;return};PACS.DrawObject.prototype.mousemove=function(a,f){this.moved=true;if(this.done){var e=this.selectPoint;if(this.selected&&e>=0){this.points[e*2]=a;this.points[e*2+1]=f}return}switch(this.type){case MeterTool.LINE:case SelectTool.RECT:case SelectTool.CIRCLE:case MarkTool.ARROW:case MarkTool.CIRCLE:case MarkTool.RECT:this.points[2]=a;this.points[3]=f;break;case MeterTool.ANGLE:if(1==this.pNum){this.points[2]=a;this.points[3]=f}else{if(2==this.pNum){this.points[4]=a;this.points[5]=f}}break;case MeterTool.COBB_ANGLE:if(1==this.pNum){this.points[2]=a;this.points[3]=f}else{if(2==this.pNum){this.points[4]=a;this.points[5]=f}else{if(3==this.pNum){this.points[6]=a;this.points[7]=f}}}break;case SelectTool.POLYGON:case MarkTool.FOLD_LINE:if(this.pNum<PACS.MaxLinePoints-1){this.points[this.pNum*2]=a;this.points[this.pNum*2+1]=f}break;case MarkTool.PENCIL:if(this.pNum<PACS.MaxPencilPoints){this.curPoints[this.pNum*2]=a;this.curPoints[this.pNum*2+1]=f;this.pNum++}else{var c=PACS.MaxPencilPoints*2;var b=new Array(c+1);this.curPoints[c]=b;this.curPoints=b;this.curPoints[0]=a;this.curPoints[1]=f;this.pNum=1}break;case MarkTool.TEXT:this.points[2]=a;this.points[3]=f;break;dedault:break}return};PACS.DrawObject.prototype.mouseup=function(a,b){d("mouseup x:"+a+" y:"+b);this.moved=false;if(this.selected){this.selected=false;return}if(this.lastDistance(a,b)<4&&this.deltaInitTime()<200){switch(this.type){case MarkTool.PENCIL:break;default:return}}this.tryend(a,b,false)};PACS.DrawObject.prototype.end=function(a,b){d("end x:"+a+" y:"+b);if(this.type!=MarkTool.PENCIL){this.points[this.pNum*2]=a;this.points[this.pNum*2+1]=b;this.pNum+=1}this.done=true;this.selected=false};PACS.DrawObject.prototype.trysel=function(g,e){var j,f;var b=this.pNum;var c=-1;var h=10000;var k;switch(this.type){case SelectTool.POLYGON:case MarkTool.FOLD_LINE:return false;case MarkTool.TEXT:return false;case MarkTool.PENCIL:default:return false}for(var a=0;a<b;a++){k=distance(this.points[a*2],this.points[a*2+1],g,e);if(k<10){if(k<h){h=k;c=a}}}d("select minIdx:"+c);if(c>=0){this.selected=true;this.selectPoint=c;return true}return false};PACS.DrawObject.prototype.tryend=function(a,f,e){switch(this.type){case MeterTool.LINE:case SelectTool.RECT:case SelectTool.CIRCLE:case MarkTool.ARROW:case MarkTool.CIRCLE:case MarkTool.RECT:if(this.pNum==1&&this.lastDistance(a,f)>2){this.end(a,f);return true}break;case MeterTool.ANGLE:if(this.pNum==1){this.points[2]=a;this.points[3]=f;this.points[4]=a;this.points[5]=f;this.pNum=2;return true}else{if(this.pNum==2){this.end(a,f);return true}}break;case MeterTool.COBB_ANGLE:if(this.pNum==1){this.points[2]=a;this.points[3]=f;this.pNum=2;return true}else{if(this.pNum==2){this.points[4]=a;this.points[5]=f;this.points[6]=a;this.points[7]=f;this.pNum=3;return true}else{if(this.pNum==3){this.end(a,f);return true}}}break;case SelectTool.POLYGON:case MarkTool.FOLD_LINE:if(!e){break}var c=this.lastDistance(a,f);if(this.lastInitTime){var b=this.deltaInitTime();d("init delta time : "+b+" distance:"+c);if(c<4){this.end(a,f);return true}}if(this.pNum<PACS.MaxLinePoints-1){this.points[this.pNum*2]=a;this.points[this.pNum*2+1]=f;this.pNum+=1}else{this.points[this.pNum*2-2]=a;this.points[this.pNum*2-1]=f;this.points[this.pNum*2+0]=a;this.points[this.pNum*2+1]=f}return true;case MarkTool.PENCIL:if(e){break}this.end(a,f);return true;case MarkTool.TEXT:this.end(a,f);return true;default:break}return false};PACS.DrawObject.prototype.deltaInitTime=function(a,b){if(this.lastInitTime){return((new Date()).getTime()-this.lastInitTime)}return 0};PACS.DrawObject.prototype.isValid=function(){if(!this.type){return false}switch(this.type){case MarkTool.TEXT:return null!=this.text;default:break}return true};PACS.DrawObject.prototype.lastDistance=function(a,c){if(!this.pNum){return 0}var b=distance(this.points[this.pNum*2-2],this.points[this.pNum*2-1],a,c);d("lastDistance : "+this.points[this.pNum*2-2]+","+this.points[this.pNum*2-1]+" ,"+a+","+c+" dis:"+b);return b};PACS.DrawObject.prototype.draw=function(r){var t=this.points;switch(this.type){case MeterTool.LINE:var o=this.imageData.image;var f=false;var g,e;if(o.columnPixelSpacing&&o.rowPixelSpacing){g=o.columnPixelSpacing;e=o.rowPixelSpacing}else{g=1;e=1;f=true}r.drawMLine(t[0],t[1],t[2],t[3],g,e,(f?"pixel":"mm"));break;case MeterTool.ANGLE:r.moveTo(t[2],t[3]);r.lineTo(t[0],t[1]);if(this.pNum>=2){r.lineTo(t[4],t[5]);var b=calcAngle(t[0],t[1],t[2],t[3]);var a=calcAngle(t[0],t[1],t[4],t[5]);var b=parseInt(Math.abs(a-b)*100);if(b>18000){b=36000-b}a=(36000-b)/100;b/=100;r.fillText("@"+(b)+"("+a+")",t[0],t[1],0,-5)}break;case MeterTool.COBB_ANGLE:r.moveTo(t[2],t[3]);r.lineTo(t[0],t[1]);if(this.pNum>2){r.moveTo(t[4],t[5]);r.lineTo(t[6],t[7]);var b=calcAngle(t[0],t[1],t[2],t[3]);var a=calcAngle(t[4],t[5],t[6],t[7]);b=parseInt(Math.abs(a-b)*100);if(isNaN(b)){b=0}if(b>18000){b=36000-b}a=(36000-b)/100;b/=100;r.fillText("@"+(b)+"("+a+")",t[0],t[1],0,-5)}break;case SelectTool.RECT:var m=(t[2]-t[0]);var l=(t[3]-t[1]);r.rect(t[0],t[1],m,l);break;case SelectTool.CIRCLE:var m=(t[2]-t[0])/2;var l=(t[3]-t[1])/2;r.drawEllipse(t[0]+m,t[1]+l,m,l);break;case SelectTool.POLYGON:var h=this.pNum*2;r.moveTo(t[0],t[1]);var u=2;for(;u<h;u+=2){r.lineTo(t[u],t[u+1])}if(this.done){r.lineTo(t[0],t[1])}else{r.lineTo(t[u],t[u+1])}break;case MarkTool.ARROW:r.moveTo(t[0],t[1]);r.lineTo(t[2],t[3]);var m=(t[2]-t[0]);var l=(t[3]-t[1]);if(m!=0||l!=0){var p=Math.sqrt(m*m+l*l);if(p>4){var w=(4*l/p);var v=(4*m/p);var s=(10*m/p);var q=(10*l/p);r.moveTo(t[0]+w+s,t[1]-v+q);r.lineTo(t[0],t[1]);r.lineTo(t[0]-w+s,t[1]+v+q)}}break;case MarkTool.TEXT:r.fillText(this.text,t[2],t[3],0,0);break;case MarkTool.CIRCLE:var m=(t[2]-t[0])/2;var l=(t[3]-t[1])/2;r.drawEllipse(t[0]+m,t[1]+l,m,l);break;case MarkTool.RECT:var m=(t[2]-t[0]);var l=(t[3]-t[1]);r.rect(t[0],t[1],m,l);break;case MarkTool.FOLD_LINE:var h=this.pNum*2;r.moveTo(t[0],t[1]);for(var u=2;u<h;u+=2){r.lineTo(t[u],t[u+1])}if(this.done){r.lineTo(t[0],t[1])}else{r.lineTo(t[u],t[u+1])}break;case MarkTool.PENCIL:var c=t.length;var u=2;var k,j;var n=false;r.moveTo(t[0],t[1]);while(true){for(;u<c;u+=2){k=t[u];j=t[u+1];if(undefined==k||undefined==j){n=true;break}r.lineTo(k,j)}t=t[PACS.MaxPencilPoints*2];if(!t){break}else{u=0}}break}};PACS.Filter=function(c,d,a,f,b,e,g){if(!(this instanceof PACS.Filter)){return new PACS.Filter(c,d,a,f,b,e,g)}if(!e){this.init2(c,d,a,f)}else{this.init(c,d,a,f,b,e,g)}};PACS.Filter.prototype.init=function(c,d,a,f,b,e,g){this.name=c;this.morphologicalFilter=false;this.width=d;this.height=a;this.divisor=g;this.data=e;this.setXOrigin(f);this.setYOrigin(b);this.divideData()};PACS.Filter.prototype.init2=function(b,c,a,d){this.init(b,c,a,parseInt(c/2),parseInt(a/2),d,1)};PACS.Filter.prototype.setYOrigin=function(a){if(a>=this.height||a<0){this.yOrigin=parseInt((this.height+1)/2);return false}this.yOrigin=a;return true};PACS.Filter.prototype.setXOrigin=function(a){if(a>=this.width||a<0){this.xOrigin=parseInt((this.width+1)/2);return false}this.xOrigin=a;return true};PACS.Filter.prototype.divideData=function(){if(!this.data){return}var c=this.divisor;if(c==0){c=1}if(c==1){return}var b=this.data;for(var a=0;a<b.length;a++){b[a]/=c}return};PACS.Filter.prototype.process=function(e,q,g){var t=Uint8ClampedArrayCache.get(q*g);var l,a;var f,d,p,o;var c,s,r,k;var n;var m=this.data;var b;for(f=0;f<g;f++){l=f*q;if(f<this.yOrigin){t[l]=0;continue}for(d=0;d<q;d++){if(d<this.xOrigin){t[l+d]=0;continue}c=d-this.xOrigin;s=f-this.yOrigin;if(c<0){c=0}if(s<0){s=0}r=c+this.width;k=s+this.height;if(r>=q){r=q-1}if(k>=g){k=g-1}n=0;b=0;for(o=s;o<k;o++){a=o*q;for(p=c;p<r;p++){n+=e[a+p]*m[b++]}}t[l+d]=n}}return t};function gaussianKernelSig(a,m,l){var h=6*m;var g=6*l;if(h%2==0){h++}if(g%2==0){g++}var k=new Array(h*g);var d=0;if(m==0){m=0.00001}if(l==0){l=0.00001}for(var e=0;e<g;e++){var b=e-(g-1)/2;for(var f=0;f<h;f++){var c=f-(h-1)/2;k[e*h+f]=Math.exp(-0.5*((c*c)/(m*m)+(b*b)/(l*l)));d+=k[e*h+f]}}for(var f=0;f<k.length;f++){k[f]/=d}return new PACS.Filter(a,h,g,k)}function gaussianKernel(b,a,e){if(a%2==0){a++}if(e%2==0){e++}var d=(a-1)/6;var c=(e-1)/6;return gaussianKernelSig(b,d,c)}function gaussianKernel2(a,b){var k=new Array(b*b);var l=(b-1)/6;var e=0;for(var g=0;g<b;g++){var c=g-(b-1)/2;for(var f=0;f<b;f++){var d=f-(b-1)/2;var h=Math.sqrt(c*c+d*d);k[f*b+g]=(-h/(l*l))*Math.exp((-h*h)/(2*l*l));e+=k[f*b+g]}}for(g=0;g<k.length;g++){k[g]/=e}return PACS.Filter(a,b,b,k)}var FilterNone=PACS.Filter("None",0,0,null);var FilterMean=PACS.Filter("Mean",3,3,1,1,[1,1,1,1,1,1,1,1,1],9);var FilterBlur=PACS.Filter("Blur",3,3,1,1,[0,1,0,1,4,1,0,1,0],8);var FilterBlurMore=PACS.Filter("Blur More",3,3,1,1,[1,2,1,2,2,2,1,2,1],14);var FilterSharpen=PACS.Filter("Sharpen",3,3,1,1,[0,-1,0,-1,8,-1,0,-1,0],4);var FilterSharpen=PACS.Filter("Sharpen",3,3,1,1,[-1,-1,-1,-1,12,-1,-1,-1,-1],4);var FilterSharpenMore=PACS.Filter("Sharpen More",3,3,1,1,[-2,-2,-2,-2,20,-2,-2,-2,-2],4);var FilterSharpenMore2=PACS.Filter("Sharpen More 2",3,3,1,1,[-8,-8,-8,-8,70,-8,-8,-8,-8],4);var FilterDefocus=PACS.Filter("Defocus",3,3,[1,1,1,1,-7,1,1,1,1]);var FilterEdge1=PACS.Filter("Edge 1",3,3,[0,-1,0,-1,4,-1,0,-1,0]);var FilterEdge2=PACS.Filter("Edge 2",3,3,[-1,-1,-1,-1,8,-1,-1,-1,-1]);var FilterStrongEdge=PACS.Filter("Strong Edge",5,5,[-2,-2,-2,-2,-2,-2,-3,-3,-3,-2,-2,-3,53,-3,-2,-2,-3,-3,-3,-2,-2,-2,-2,-2,-2]);var FilterOutline=PACS.Filter("Outline",5,5,[1,1,1,1,1,1,0,0,0,1,1,0,-16,0,1,1,0,0,0,1,1,1,1,1,1]);var FilterEmboss=PACS.Filter("Emboss",3,3,[-5,0,0,0,1,0,0,0,5]);PACS.Filters=[FilterMean,FilterBlur,FilterBlurMore,FilterSharpen,FilterSharpenMore,FilterSharpenMore2,FilterDefocus,FilterEdge1,FilterEdge2,FilterStrongEdge,FilterOutline,FilterEmboss,gaussianKernel("Gaussian (3x3)",3,3),gaussianKernel("Gaussian (5x5)",5,5),gaussianKernel("Gaussian (7x7)",7,7),gaussianKernel("Gaussian (9x9)",9,9),gaussianKernel2("Gaussian 2 (3x3)",3),gaussianKernel2("Gaussian 2 (5x5)",5),gaussianKernel2("Gaussian 2 (7x7)",7)];var times=0;PACS.VR=function(e,b){if(!this instanceof PACS.VR){return new PACS.VR(e)}if(!Detector.webgl){return}if(!e){return}var a=e.images;if(!a||!a.length){return}var c=a[0].width;var f=a[0].height;var g=a.length;if(c!=512||f!=512){return}if(g<10){return}if(g>256){g=256}this.xSize=c;this.ySize=f;this.zSize=g;this.series=e;this.images=a;this.inited=true;this.steps=256};PACS.VR.AlphaTbl=[{stop:0,value:0},{stop:254,value:255},{stop:255,value:255}];PACS.VR.AlphaTbl1=[{stop:0,value:255},{stop:1,value:255},{stop:255,value:255}];PACS.VR.prototype.createTransTex0=function(){var e=document.createElement("canvas");e.height=16;e.width=256;var c=e.getContext("2d");var b=c.createLinearGradient(0,0,e.width-1,e.height-1);b.addColorStop(0.1,"#00FA58");b.addColorStop(0.7,"#CC6600");b.addColorStop(1,"#F2F200");c.fillStyle=b;c.fillRect(0,0,e.width-1,e.height-1);var a=new THREE.Texture(e);a.wrapS=a.wrapT=THREE.ClampToEdgeWrapping;a.needsUpdate=true;return a};PACS.VR.prototype.createTransTex=function(p){var c,m,q,s;var l,h,o,k;var t=p.bytes;var f=new Uint8Array(256*16*4);var n=PACS.VR.AlphaTbl;for(var l=0;l<256;l++){c=t[l][0];m=t[l][1];q=t[l][2];k=(c+m+q)/3;s=getLinearValue(n,k);s=Math.round(s);d("i:"+l+"  r:"+c+" g:"+m+" b:"+q+" a:"+s);for(h=0;h<16;h++){o=h*256*4+l*4;f[o+0]=c;f[o+1]=m;f[o+2]=q;f[o+3]=s}}var e=new THREE.DataTexture(f,256,16,THREE.RGBAFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.NearestFilter,THREE.NearestFilter);e.wrapS=e.wrapT=THREE.ClampToEdgeWrapping;e.needsUpdate=true;return e};PACS.VR.prototype.createTransTex2=function(p){var c,m,q,s;var l,h,o,k;var u=p.bytes;var f=new Uint8Array(16*16*4);var n=PACS.VR.AlphaTbl;for(var l=0;l<16;l++){var t=l*10+100;if(t>255){t=255}c=t;m=t;q=t;s=255;d("i:"+l+"  r:"+c+" g:"+m+" b:"+q+" a:"+s);for(h=0;h<16;h++){o=h*16*4+l*4;f[o+0]=c;f[o+1]=m;f[o+2]=q;f[o+3]=s}}var e=new THREE.DataTexture(f,16,16,THREE.RGBAFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.NearestFilter,THREE.NearestFilter);e.wrapS=e.wrapT=THREE.ClampToEdgeWrapping;e.needsUpdate=true;return e};PACS.VR.prototype.createTransTex3=function(p){var c,m,q,s;var l,h,o,k;var u=p.bytes;var f=new Uint8Array(16*16);var n=PACS.VR.AlphaTbl;for(var l=0;l<16;l++){var t=l*10+100;if(t>255){t=255}if(l<5){t=0}else{t=255}c=t;m=t;q=t;s=255;d("i:"+l+"  r:"+c+" g:"+m+" b:"+q+" a:"+s);for(h=0;h<16;h++){o=h*16+l;f[o+0]=c}}var e=new THREE.DataTexture(f,16,16,THREE.AlphaFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.NearestFilter,THREE.NearestFilter);e.wrapS=e.wrapT=THREE.ClampToEdgeWrapping;e.needsUpdate=true;return e};PACS.VR.prototype.initData=function(c){var l=this.series.images;var n=this.xSize;var m=this.ySize;var k=this.zSize;var p=n*m*k;var h;var f;var j=0;if(!this.data){h=new Uint8Array(n*m*256)}else{h=this.data}if(!c){c={ww:400,wc:40}}var a=n*16;var o=(m-1)*16*n;var e=0;if(k<256){e=parseInt((256-k)/2);j=parseInt(e/16)*16*n*m;j+=(e%16)*n}var b=new Date().getTime();for(var g=0;g<=k;g++){if(k==g){f=l[k-1]}else{f=l[g]}if(null==f){d("image is NULL")}f.getGrayData(c,h,j,a);j+=n;e++;if(e%16==0){j+=o}}this.data=h;console.log("init data takes "+(new Date().getTime()-b)+"ms")};PACS.VR.prototype.initData0=function(b){var j=this.series.images;var l=this.xSize;var k=this.ySize;var h=this.zSize;var m=l*k*h;var f;var c;var g=0;if(!this.data){f=new Uint8Array(l*k*256)}else{f=this.data}if(!b){b={ww:400,wc:40}}if(h<256){g+=(256-h)/2*l*k}var a=new Date().getTime();for(var e=0;e<h;e++,g+=l*k){c=j[e];c.getGrayData(b,f,g)}this.data=f;console.log("init data takes "+(new Date().getTime()-a)+"ms")};PACS.VR.prototype.initWebGl=function(l,e,a){var l;var z,E,t;var D;var C=[];var g;var q;var u=$(l);var r=u.width()-8;var o=u.height()-8;var k=this.xSize;var j=this.ySize;var F;if(1){this.initData(e);F=this.data}else{var n=k*j*256;F=new Uint8Array(n);var v;for(var v=0;v<n;v++){F[v]=255}}var h=new THREE.DataTexture(F,k*16,j*16,THREE.AlphaFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.NearestFilter,THREE.NearestFilter);h.needsUpdate=true;h.generateMipmaps=false;if(!a){a=PACS.CreateDefaultLut()}var c=this.createTransTex(a);var p=new THREE.Vector2(r,o);var B=new THREE.WebGLRenderTarget(p.x,p.y,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,wrapS:THREE.ClampToEdgeWrapping,wrapT:THREE.ClampToEdgeWrapping,format:THREE.RGBFormat,type:THREE.FloatType,generateMipmaps:false});var f=new THREE.ShaderMaterial({vertexShader:document.getElementById("vertexShaderFirstPass").textContent,fragmentShader:document.getElementById("fragmentShaderFirstPass").textContent,side:THREE.BackSide});q=new THREE.ShaderMaterial({vertexShader:document.getElementById("vertexShaderSecondPass").textContent,fragmentShader:document.getElementById("fragmentShaderSecondPass").textContent,side:THREE.FrontSide,uniforms:{tex:{type:"t",value:B},cubeTex:{type:"t",value:h},transferTex:{type:"t",value:c},steps0:{type:"1f",value:768},alphaCorrection0:{type:"1f",value:0.2},stacks:{type:"1f",value:16},layers:{type:"1f",value:256},temp:{type:"1f",value:1}}});z=new THREE.Scene();E=new THREE.Scene();var A=new THREE.BoxGeometry(1,1,1);A.doubleSided=true;var G=new THREE.Mesh(A,f);var b=new THREE.Mesh(A,q);z.add(G);E.add(b);t=new THREE.WebGLRenderer();t.domElement.className="vrcanvas";l.appendChild(t.domElement);var w=new THREE.PerspectiveCamera(40,r/o,0.01,10000000);w.position.z=3;var m=new THREE.TrackballControls(w,t.domElement);m.target.set(0,0,0);m.rotateSpeed=10;m.zoomSpeed=1.2;m.panSpeed=0.8;m.noZoom=false;m.noPan=true;m.staticMoving=true;m.dynamicDampingFactor=0.15;m.keys=[65,83,68];this.stop=false;this.camera=w;this.renderer=t;this.controls=m;this.sceneFirstPass=z;this.sceneSecondPass=E;this.materialFirstPass=f;this.materialSecondPass=q;this.meshFirstPass=G;this.meshSecondPass=b;this.boxGeometry=A;this.rtTexture=B;this.cubeTex=h;this.transTex=c;this.container=l;this._setSize(r,o);this.animate()};PACS.VR.prototype.render=function(){this.renderer.render(this.sceneFirstPass,this.camera,this.rtTexture,true);this.renderer.render(this.sceneSecondPass,this.camera)};PACS.VR.prototype.animate=function(){var b=this;var c=function(){if(!b.stop){b.animate()}};var a=function(){requestAnimationFrame(c)};this.controls.update();this.render();setTimeout(a,100)};PACS.VR.prototype._setSize=function(a,b){this.camera.aspect=a/b;this.camera.updateProjectionMatrix();this.renderer.setSize(a,b)};PACS.VR.prototype.setSize=function(a,b){this._setSize(a+2,b+2)};PACS.VR.prototype.setLut=function(b){var a=this.createTransTex(b);if(this.transTex){this.transTex.dispose()}this.materialSecondPass.uniforms.transferTex.value=a;this.transTex=a};PACS.VR.prototype.setWwc=function(a){this.initData(a);this.cubeTex.needsUpdate=true};PACS.VR.prototype._destroy=function(){this.container.removeChild(this.renderer.domElement);this.controls.dispose();this.cubeTex.dispose();this.rtTexture.dispose();this.materialSecondPass.dispose();this.materialFirstPass.dispose();this.boxGeometry.dispose();this.transTex.dispose();delete this.camera;delete this.sceneFirstPass;delete this.sceneSecondPass;delete this.meshFirstPass;delete this.meshSecondPass;delete this.renderer;this.controls.mousedownCb=null;this.camera=null;this.renderer=null;this.controls=null;this.sceneFirstPass=null;this.sceneSecondPass=null;this.materialSecondPass=null;this.rtTexture=null;this.cubeTex=null;this.transTex=null;this.materialFirstPass=null;this.meshFirstPass=null;this.meshSecondPass=null;this.boxGeometry=null};PACS.VR.prototype.destroy=function(){this.stop=true;var a=this;setTimeout(function(){a._destroy()},200)};PACS.VR.prototype.setClickCb=function(a){this.controls.mousedownCb=a};PACS.Image=function(){};PACS.Image.DefaultWwc=function(){var a={wc:40,ww:400};return a};PACS.Image.prototype.init=function(){if(!this instanceof PACS.Image){d("PACS.Image init")}if(!this.imageInfo||!this.dataSet){this.wwc=PACS.Image.DefaultWwc();return}var b=this.imageInfo;this.minPixelValue=b.minPixelValue;this.maxPixelValue=b.maxPixelValue;this.RescaleSlope=b.slope;this.RescaleIntercept=b.intercept;this.windowCenter=b.windowCenter;this.windowWidth=b.windowWidth;this.Rows=b.rows;this.Columns=b.columns;this.height=b.height;this.width=b.width;this.color=b.color;this.columnPixelSpacing=b.columnPixelSpacing;this.rowPixelSpacing=b.rowPixelSpacing;this.invert=b.invert;this.sizeInBytes=b.sizeInBytes;this.data=b.getPixelData();var a=this.dataSet;this.PhotometricInterpretation=a.string("x00280004");this.SliceThickness=a.floatString("x00180050");this.SliceLocation=a.floatString("x00201041");this.InstanceNumber=a.uint16("x00200013");this.PatientOrientation=a.string("x00200020");this.PatientPosition=a.string("x00185100");this.ImagePositionPatient=a.string("x00200032");this.ImageOrientationPatient=a.string("x00200037");this.AcquisitionDate=a.string("x00080022");this.AcquisitionTime=a.string("x00080032");this.AccessionNumber=a.string("x00080050");this.Modality=a.string("x00080060");this.PatientID=a.string("x00100020");this.PatientBirthDate=a.string("x00100030");this.NumberOfFrames=a.string("x00280008");this.FrameIncrementPointer=a.string("x00280009");this.MediaStorageSOPClassUID=a.string("x00020002");delete this.dataSet.byteArray;delete this.imageInfo;this.wwc=this.getWwc();switch(this.PhotometricInterpretation){case"MONOCHROME1":this.coefPhotInt=-1;default:this.coefPhotInt=1}};PACS.Image.prototype.initPlaneMatrix=function(){if(!this.planeValid){return}if(this.planeMatrix){return}var j=this.vectorX;var i=this.vectorY;var h=this.vectorZ;var e=this.d000;var l=j.clone();var f=new THREE.Matrix4();var g=new THREE.Matrix4();var b=new THREE.Matrix4();var a=new THREE.Matrix4();var p=new THREE.Matrix4();var o=new THREE.Matrix4();b.makeTranslation(-e.x,-e.y,-e.z);f.multiplyR(b);var k=Math.asin(l.y/(hypLen(l.x,l.y)));if(l.x<0){k=Math.PI-k}a.makeRotationZ(-k);g.multiplyR(a);f.multiplyR(a);l.applyMatrix4(a);var m=Math.asin(l.z/(hypLen(l.x,l.z)));if(l.x<0){m=Math.PI-m}p.makeRotationY(-m);g.multiplyR(p);f.multiplyR(p);var c=i.clone();c.applyMatrix4(g);var n=Math.asin(c.z/(hypLen(c.y,c.z)));if(c.y<0){n=Math.PI-n}o.makeRotationX(-n);f.multiplyR(o);g.multiplyR(o);this.planeMatrix=f;this.rotateMatrix=g};PACS.Image.prototype.initPlane=function(){if(this.planeInited){return this.planeValid}this.planeInited=true;var h=this.ImagePositionPatient;var m=h.split("\\");if(m.length!=3){this.planeValid=false;return false}var a=parseFloat(m[0]);var o=parseFloat(m[1]);var c=parseFloat(m[2]);var g=new THREE.Vector3(a,o,c);var f=this.ImageOrientationPatient;var k=f.split("\\");if(k.length!=6){this.planeValid=false;return false}for(var b=0;b<6;b++){k[b]=parseFloat(k[b])}var n=(new THREE.Vector3(k[0],k[1],k[2])).normalize();var l=(new THREE.Vector3(k[3],k[4],k[5])).normalize();var j=(new THREE.Vector3()).cross(n,l).normalize();var e=(new THREE.Plane()).setFromNormalAndCoplanarPoint(j,g);this.d000=g;this.vectorX=n;this.vectorY=l;this.vectorZ=j;this.plane=e;this.planeValid=true;this.initPlaneMatrix();return true};PACS.Image.prototype.x2p=function(a){return a/this.columnPixelSpacing};PACS.Image.prototype.y2p=function(a){return a/this.rowPixelSpacing};PACS.Image.prototype.p2x=function(a){return a*this.columnPixelSpacing};PACS.Image.prototype.p2y=function(a){return a*this.rowPixelSpacing};PACS.Image.prototype.getPixelSpacing=function(b){if(!this.initPlane()||!b.initPlane()){return 1}var c=b.d000.clone().sub(this.d000);var a=c.clone().normalize();a.sub(this.vectorZ);return{spacing:c.length(),vectorDis:a.length()}};PACS.Image.prototype.getCrossPoints=function(f){if(!f||!this.initPlane()||!f.initPlane()){return null}var c=this.plane.intersectPlane(f.plane);var o=c.origin.applyMatrix4(this.planeMatrix);var k=c.direction.applyMatrix4(this.rotateMatrix);if(isNaN(o.z)||Math.abs(o.z)>0.04){return null}if(isNaN(k.z)||Math.abs(k.z)>0.04){return null}if(Math.abs(k.x)+Math.abs(k.y)<0.4){return null}var b=o.x;var n=o.y;var i=k.x;var g=k.y;var m=this.width;var e=this.height;if(!this.tempPoints){this.tempPoints=[0,0,0,0]}var p=this.tempPoints;if(Math.abs(i)<0.00001){var a=this.x2p(b);if(a<0||a>m){return null}var j=e;p[0]=a;p[1]=0;p[2]=a;p[3]=j;return p}if(Math.abs(g)<0.00001){var j=this.y2p(n);if(j<0||j>e){return null}var a=m;p[0]=0;p[1]=j;p[2]=a;p[3]=j;return p}var l=0;var a,j;a=0;j=(a-b)/i*g+n;if(j>=0&&j<=e){p[l++]=this.x2p(a);p[l++]=this.y2p(j)}a=this.p2x(m);j=(a-b)/i*g+n;if(j>=0&&j<=e){p[l++]=this.x2p(a);p[l++]=this.y2p(j)}j=0;a=(j-n)/g*i+b;if(a>=0&&a<=m){p[l++]=this.x2p(a);p[l++]=this.y2p(j)}j=this.p2y(e);a=(j-n)/g*i+b;if(a>=0&&a<=m){p[l++]=this.x2p(a);p[l++]=this.y2p(j)}if(l>=4){return p}return null};PACS.Image.prototype.getSameVector=function(c){if(!this.initPlane()||!c.initPlane()){return null}var b=this.vectorX.distanceTo(c.vectorZ);if(b<0.7||b>1.7){return"x"}var a=this.vectorY.distanceTo(c.vectorZ);if(a<0.7||a>1.7){return"y"}return null};PACS.Image.prototype.mprInit=function(b,c,e,a){if(!this instanceof PACS.Image){d("PACS.Image mprInit")}this.wwc=this.getWwc();if(a<0.1||a>1.9){}else{return}if(!b.initPlane()){this.planeValid=false;this.planeInited=true;return}this.d000=b.d000.clone();revertZ=a>1;if(c){this.vectorX=b.vectorY;this.vectorY=b.vectorZ.clone();if(revertZ){this.vectorY.scale(-1)}this.vectorZ=this.vectorX.clone().cross(this.vectorY);this.d000.add(b.vectorX.clone().scale(e*b.columnPixelSpacing))}else{this.vectorX=b.vectorX;this.vectorY=b.vectorZ.clone();if(revertZ){this.vectorY.scale(-1)}this.vectorZ=this.vectorX.clone().cross(this.vectorY);this.d000.add(b.vectorY.clone().scale(e*b.rowPixelSpacing))}this.plane=(new THREE.Plane()).setFromNormalAndCoplanarPoint(this.vectorZ,this.d000);this.planeValid=true;this.planeInited=true;this.initPlaneMatrix()};PACS.Image.prototype.__init=function(){if(this.inited){return}var j=this.width;var e=this.height;var l=j*e;var g=0;var a=0;var f=0;var k;var c=this.data;if(!c){return}for(var b=0;b<l;b++){k=c[b];if(k==63488){continue}f+=k;if(k<a){a=k}if(k>g){g=k}}this.minVar=a;this.maxVar=g;this.totalVar=f;this.inited=true};PACS.Image.prototype.getImageData=function(e,l,G){var m=this.width;var x=this.height;var F=this.data;var p=m*x;var z=e.createImageData(m,x);var u=z.data;if(undefined==l||undefined==G){var f=this.getWwc();l=f.wc;G=f.ww}var D=255;var q=this.coefPhotInt;var B=q*D/G;var A=D*(0.5-q*l/G);var c;var k=this.RescaleSlope;var o=this.RescaleIntercept;if(undefined!=k&&undefined!=o){B=B*k;A=B*o+A}if(this.color){var n,y,C,E;p*=4;for(var t=0;t<p;t+=4){n=F[t];y=F[t+1];C=F[t+2];E=F[t+3];n=B*n+A;y=B*y+A;C=B*C+A;u[t]=n;u[t+1]=y;u[t+2]=C;u[t+3]=E}}else{for(var t=0,s=0;t<p;t++,s+=4){v=F[t];v=B*v+A;u[s]=v;u[s+1]=v;u[s+2]=v;u[s+3]=255}}return z};PACS.Image.prototype.getValue=function(a,f){var e=this.data;if(!e){return"N/A"}var b=this.width;var c=f*b+a;if(c<0||c>=e.length){return"N/A"}return e[c]};PACS.Image.prototype.drawThumb=function(i){initCanvas(i);var e=i.getContext("2d");var a=this.getImageData(e);if(!a){return}var m=this.width;var k=this.height;var j=i.width;var b=i.height;var o=getScale(m,k,j,b);var g=parseInt(o*m);var l=parseInt(o*k);var f,c;f=(j-g)/2;c=(b-l)/2;var n=getTempCanvas();n.width=m;n.height=k;n.getContext("2d").putImageData(a,0,0);e.save();e.translate(f,c);e.scale(o,o);e.drawImage(n,0,0);e.restore()};PACS.Image.prototype.copyBasic=function(a){this.PatientName=a.PatientName;this.PatientBirthDate=a.PatientBirthDate;this.PatientID=a.PatientID;this.PatientSex=a.PatientSex;this.StudyInstanceUID=a.StudyInstanceUID;this.InstanceNumber=a.InstanceNumber;this.Modality=a.Modality;this.height=a.height;this.width=a.width;this.AcquisitionDate=a.AcquisitionDate;this.AcquisitionTime=a.AcquisitionTime;this.ContrastBolusAgent=a.ContrastBolusAgent;this.SliceThickness=a.SliceThickness;this.SliceLocation=a.SliceLocation;this.PhotometricInterpretation=a.PhotometricInterpretation;this.Columns=a.Columns;this.Rows=a.Rows;this.windowCenter=a.windowCenter;this.windowWidth=a.windowWidth;this.RescaleSlope=a.RescaleSlope;this.RescaleIntercept=a.RescaleIntercept;this.coefPhotInt=a.coefPhotInt;this.columnPixelSpacing=a.columnPixelSpacing;this.rowPixelSpacing=a.rowPixelSpacing};PACS.Image.prototype.getGrayData=function(b,c,n,o){var f=this.width;var t=this.height;var A=this.data;var m=f*t;var z=255;var p=this.coefPhotInt;var x=p*z/b.ww;var u=z*(0.5-p*b.wc/b.ww);var a;var g;var e=this.RescaleSlope;var l=this.RescaleIntercept;if(undefined!=e&&undefined!=l){x=x*e;u=x*l+u}var s,r,q;var y;for(s=0,q=0;s<t;s++){y=n+s*o;for(r=0;r<f;r++,q++){g=A[q];g=x*g+u;if(g<2){g=0}else{if(g>=255){g=255}else{}}c[y+r]=g}}return c};PACS.Image.prototype.getGrayData0=function(f,n,o,b){var r=this.width;var m=this.height;var l=this.data;var t=r*m;var j=255;var e=this.coefPhotInt;var c=e*j/f.ww;var a=j*(0.5-e*f.wc/f.ww);var p;var s;var g=this.RescaleSlope;var q=this.RescaleIntercept;if(undefined!=g&&undefined!=q){c=c*g;a=c*q+a}for(var k=0;k<t;k++){s=l[k];s=c*s+a;if(s<10){s=0}else{n[o+k]=s}}return n};PACS.Image.prototype.getWwc=function(a){var b=PACS.Image.DefaultWwc();if(!this.windowCenter){b.wc=41}else{if(this.windowCenter.length>0){b.wc=this.windowCenter[0]}else{b.wc=this.windowCenter}}if(!this.windowWidth){b.ww=410}else{if(this.windowWidth.length>0){b.ww=this.windowWidth[0]}else{b.ww=this.windowWidth}}return b};function extendPacsImage(b){var a=new PACS.Image();$.extend(b,a);b.init();return b};PACS.ImageData=function(b,a){if(!(this instanceof PACS.ImageData)){return new PACS.ImageData(b,a)}this.image=b;this.inverse=false;this.context=a;this.drawObjects=[];this.lastDrawObject=null;this.resetWwc()};PACS.ImageData.prototype.resetWwc=function(){var a=this.image.getWwc();return this.wwc=a};PACS.ImageData.prototype.reset=function(){this.resetWwc();this.drawObjects=[];this.lastDrawObject=null;this.lut=null;this.filter=null;this.inverse=false};PACS.ImageData.prototype.clearData=function(){if(this.imageData){ImageDataCache.put(this.imageData);this.imageData=null}};PACS.ImageData.prototype.invert=function(){if(!this.imageData){return}var f=this.imageData.data;var a=this.imageData.width;var e=this.imageData.height;var d=a*e*4;var b;for(var c=0;c<d;c+=4){b=f[c];b=255-b;f[c]=255-f[c];f[c+1]=255-f[c+1];f[c+2]=255-f[c+2]}this.inverse=!this.inverse};PACS.ImageData.prototype.initImageData=function(){var q=this.image;var l=q.width;var z=q.height;if(!this.imageData){this.imageData=ImageDataCache.getex(this.context,l,z)}var G=q.data;var p=l*z;var y=this.imageData.data;var E=255;var s=q.coefPhotInt;var C=s*E/this.wwc.ww;var B=E*(0.5-s*this.wwc.wc/this.wwc.ww);var m;var e=this.inverse;var k=q.RescaleSlope;var o=q.RescaleIntercept;if(undefined!=k&&undefined!=o){C=C*k;B=C*o+B}if(this.filter){var u=Uint8ClampedArrayCache.get(p,0);for(var x=0;x<p;x++){m=G[x];m=C*m+B;u[x]=m}G=this.filter.process(u,l,z);Uint8ClampedArrayCache.put(u);var d=this.lut;if(d){var f=d.bytes;var c;for(var x=0,t=0;x<p;x++,t+=4){m=G[x];if(e){m=255-m}c=f[m];y[t]=c[0];y[t+1]=c[1];y[t+2]=c[2];y[t+3]=255}}else{for(var x=0,t=0;x<p;x++,t+=4){m=G[x];if(e){m=255-m}y[t]=m;y[t+1]=m;y[t+2]=m;y[t+3]=255}}Uint8ClampedArrayCache.put(G)}else{if(q.color){p*=4;var n,A,D,F;for(var x=0;x<p;x+=4){n=G[x];A=G[x+1];D=G[x+2];F=G[x+3];n=C*n+B;A=C*A+B;D=C*D+B;y[x]=n;y[x+1]=A;y[x+2]=D;y[x+3]=F}}else{var d=this.lut;if(d){var f=d.bytes;var c;for(var x=0,t=0;x<p;x++,t+=4){m=G[x];m=C*m+B;if(m<0){m=0}else{if(m>255){m=255}else{m=parseInt(m)}}if(e){m=255-m}c=f[m];y[t]=c[0];y[t+1]=c[1];y[t+2]=c[2];y[t+3]=255}}else{for(var x=0,t=0;x<p;x++,t+=4){m=G[x];m=C*m+B;if(m<0){m=0}else{if(m>255){m=255}else{m=parseInt(m)}}if(e){m=255-m}y[t]=m;y[t+1]=m;y[t+2]=m;y[t+3]=255}}}}};PACS.ImageData.prototype.mousecaptrued=function(){var a=this.lastDrawObject;return(a&&!a.done)};PACS.ImageData.prototype.mousedown=function(c,a,e){var d=this.lastDrawObject;this.lastX=a;this.lastY=e;if(d&&!d.done){d.mousedown(c,a,e)}else{var b=new PACS.DrawObject(this,c,a,e);if(b.isValid()){this.drawObjects[this.drawObjects.length]=b;this.lastDrawObject=b}}return true};PACS.ImageData.prototype.mousemove=function(a,c){var b=this.lastDrawObject;this.lastX=a;this.lastY=c;if(b&&!b.done){b.mousemove(a,c);return true}return false};PACS.ImageData.prototype.mouseup=function(a,c){var b=this.lastDrawObject;if(b&&!b.done){if(undefined==a){a=this.lastX;c=this.lastY}b.mouseup(a,c);if(b.done){this.lastDrawObject=null}else{}return true}return false};PACS.ImageData.prototype.cancelDrawing=function(){var a=this.lastDrawObject;if(a&&!a.done){this.lastDrawObject=null;this.drawObjects.length=this.drawObjects.length-1;return true}return false};PACS.ImageData.prototype.draw0=function(a,d){a.putImageData(this.imageData,0,0);var e=this.drawObjects;var c=e.length;if(c){a.lineCap="round";a.lineJoin="round";a.lineWidth=1;a.strokeStyle="#F00";a.font="Bold 16px Arial";a.fillStyle="#F00";a.beginPath();for(var b=0;b<c;b++){if(e[b]){e[b].draw(a)}}a.stroke();for(var b=0;b<c;b++){if(e[b]){e[b].drawText(a,d)}}}};PACS.ImageData.prototype.draw=function(a,b){a.putImageData(this.imageData,0,0)};PACS.ImageData.prototype.drawObjs=function(e){var d=this.drawObjects;var c=d.length;if(c){var a=e.getContext();a.lineCap="round";a.lineJoin="round";a.lineWidth=1;a.strokeStyle="#F00";a.font="Bold 16px Arial";a.fillStyle="#F00";a.beginPath();e.init();for(var b=0;b<c;b++){if(d[b]){d[b].draw(e)}}a.stroke()}};PACS.ImagePlayer=function(a){if(!(this instanceof PACS.ImagePlayer)){return new PACS.ImagePlayer(a)}this.view=a;this.interval=100;this.setfps(PACS.ImagePlayer.FPS)};PACS.ImagePlayer.FPS=10;PACS.ImagePlayer.prototype.setfps=function(a){a=parseInt(a);if(a<1||a>100){return}this.interval=1000/a};PACS.ImagePlayer.prototype.getfps=function(a){var a=Math.round(1000/this.interval);return a};PACS.ImagePlayer.prototype.next=function(){this.view.next()};PACS.ImagePlayer.prototype.play=function(){if(this.playing){return true}if(!this.view||!this.view.series){msgBox("未加载序列");return false}if(!this.view.series.images.length){msgBox("无图片");return false}if(this.view.series.images.length==1){msgBox("只有一张图片");return false}var c=this;var a={flag:1};var b=function(){if(!a.flag){return}var d=(new Date()).getTime();c.next();d=(new Date()).getTime()-d;if(d+5>=c.interval){d=5}else{d=c.interval-d}setTimeout(b,d)};this.playing=a;setTimeout(b,this.interval);return true};PACS.ImagePlayer.prototype.stop=function(){if(!this.playing){return}this.playing.flag=false;delete this.playing};var LutCardiac={name:"Cardiac",bytes:[[73,193,3],[72,195,12],[70,197,20],[69,198,29],[68,200,37],[66,202,46],[65,204,54],[63,206,63],[62,208,71],[61,209,80],[59,211,88],[58,213,97],[57,215,105],[55,217,114],[54,218,122],[52,220,131],[51,222,139],[48,222,146],[45,222,154],[41,222,161],[38,222,168],[35,222,175],[32,222,183],[29,222,190],[26,222,197],[22,222,204],[19,222,212],[16,222,219],[13,222,226],[10,222,233],[6,222,241],[3,222,248],[0,222,255],[0,216,255],[0,211,255],[0,205,255],[0,200,255],[0,194,255],[0,188,255],[0,183,255],[0,177,255],[0,171,255],[0,166,255],[0,160,255],[0,155,255],[0,149,255],[0,143,255],[0,138,255],[0,132,255],[0,128,255],[0,125,255],[0,121,255],[0,118,255],[0,114,255],[0,110,255],[0,107,255],[0,103,255],[0,99,255],[0,96,255],[0,92,255],[0,89,255],[0,85,255],[0,81,255],[0,78,255],[0,74,255],[1,70,255],[2,67,255],[3,63,255],[4,60,255],[5,56,255],[6,52,255],[7,49,255],[8,45,255],[9,41,255],[10,38,255],[11,34,255],[12,31,255],[13,27,255],[14,23,255],[15,20,255],[16,16,255],[16,15,253],[17,14,252],[17,13,250],[17,12,249],[17,11,247],[18,10,246],[18,9,244],[18,8,243],[18,7,241],[19,6,239],[19,5,238],[19,4,236],[19,3,235],[20,2,233],[20,1,232],[20,0,230],[21,0,229],[22,0,227],[22,0,226],[23,0,224],[24,0,223],[25,0,221],[25,0,220],[26,0,218],[27,0,217],[28,0,215],[28,0,214],[29,0,212],[30,0,211],[31,0,209],[31,0,208],[32,0,206],[36,0,203],[39,0,201],[43,0,198],[47,0,196],[50,0,193],[54,0,191],[57,0,188],[61,0,186],[65,0,183],[68,0,180],[72,0,178],[76,0,175],[79,0,173],[83,0,170],[86,0,168],[90,0,165],[95,0,163],[99,0,161],[104,0,159],[109,0,157],[113,0,155],[118,0,153],[123,0,151],[128,0,149],[132,0,146],[137,0,144],[142,0,142],[146,0,140],[151,0,138],[156,0,136],[160,0,134],[165,0,132],[169,0,127],[172,0,123],[176,0,118],[179,0,113],[183,0,109],[186,0,104],[190,0,99],[194,0,95],[197,0,90],[201,0,85],[204,0,80],[208,0,76],[211,0,71],[215,0,66],[218,0,62],[222,0,57],[224,2,53],[226,4,50],[228,6,46],[230,8,43],[232,10,39],[234,12,36],[236,14,32],[239,17,29],[241,19,25],[243,21,21],[245,23,18],[247,25,14],[249,27,11],[251,29,7],[253,31,4],[255,33,0],[255,37,0],[255,41,0],[255,45,0],[255,50,0],[255,54,0],[255,58,0],[255,62,0],[255,66,0],[255,70,0],[255,74,0],[255,78,0],[255,83,0],[255,87,0],[255,91,0],[255,95,0],[255,99,0],[255,103,0],[255,107,0],[255,111,0],[255,116,0],[255,120,0],[255,124,0],[255,128,0],[255,132,0],[255,136,0],[255,140,0],[255,144,0],[255,149,0],[255,153,0],[255,157,0],[255,161,0],[255,165,0],[255,170,0],[255,174,0],[255,179,0],[255,184,0],[255,188,0],[255,193,0],[255,197,0],[255,202,0],[255,207,0],[255,211,0],[255,216,0],[255,221,0],[255,225,0],[255,230,0],[255,234,0],[255,239,0],[250,238,1],[245,237,2],[240,236,2],[236,235,3],[231,234,4],[226,233,5],[221,232,5],[216,231,6],[211,229,7],[206,228,8],[201,227,8],[197,226,9],[192,225,10],[187,224,11],[182,223,11],[177,222,12],[171,220,11],[164,218,11],[158,217,10],[151,215,10],[145,213,9],[138,211,9],[132,209,8],[125,208,8],[119,206,7],[112,204,6],[106,202,6],[99,200,5],[93,198,5],[86,197,4],[73,193,3]]};var LutFire={name:"Fire",bytes:[[0,0,31],[0,0,34],[0,0,38],[0,0,42],[0,0,46],[0,0,49],[0,0,53],[0,0,57],[0,0,61],[0,0,65],[0,0,69],[0,0,74],[0,0,78],[0,0,82],[0,0,87],[0,0,91],[1,0,96],[4,0,100],[7,0,104],[10,0,108],[13,0,113],[16,0,117],[19,0,121],[22,0,125],[25,0,130],[28,0,134],[31,0,138],[34,0,143],[37,0,147],[40,0,151],[43,0,156],[46,0,160],[49,0,165],[52,0,168],[55,0,171],[58,0,175],[61,0,178],[64,0,181],[67,0,185],[70,0,188],[73,0,192],[76,0,195],[79,0,199],[82,0,202],[85,0,206],[88,0,209],[91,0,213],[94,0,216],[98,0,220],[101,0,220],[104,0,221],[107,0,222],[110,0,223],[113,0,224],[116,0,225],[119,0,226],[122,0,227],[125,0,224],[128,0,222],[131,0,220],[134,0,218],[137,0,216],[140,0,214],[143,0,212],[146,0,210],[148,0,206],[150,0,202],[152,0,199],[154,0,195],[156,0,191],[158,0,188],[160,0,184],[162,0,181],[163,0,177],[164,0,173],[166,0,169],[167,0,166],[168,0,162],[170,0,158],[171,0,154],[173,0,151],[174,0,147],[175,0,143],[177,0,140],[178,0,136],[179,0,132],[181,0,129],[182,0,125],[184,0,122],[185,0,118],[186,0,114],[188,0,111],[189,0,107],[190,0,103],[192,0,100],[193,0,96],[195,0,93],[196,1,89],[198,3,85],[199,5,82],[201,7,78],[202,8,74],[204,10,71],[205,12,67],[207,14,64],[208,16,60],[209,19,56],[210,21,53],[212,24,49],[213,27,45],[214,29,42],[215,32,38],[217,35,35],[218,37,31],[220,40,27],[221,43,23],[223,46,20],[224,48,16],[226,51,12],[227,54,8],[229,57,5],[230,59,4],[231,62,3],[233,65,3],[234,68,2],[235,70,1],[237,73,1],[238,76,0],[240,79,0],[241,81,0],[243,84,0],[244,87,0],[246,90,0],[247,92,0],[249,95,0],[250,98,0],[252,101,0],[252,103,0],[252,105,0],[253,107,0],[253,109,0],[253,111,0],[254,113,0],[254,115,0],[255,117,0],[255,119,0],[255,121,0],[255,123,0],[255,125,0],[255,127,0],[255,129,0],[255,131,0],[255,133,0],[255,134,0],[255,136,0],[255,138,0],[255,140,0],[255,141,0],[255,143,0],[255,145,0],[255,147,0],[255,148,0],[255,150,0],[255,152,0],[255,154,0],[255,155,0],[255,157,0],[255,159,0],[255,161,0],[255,162,0],[255,164,0],[255,166,0],[255,168,0],[255,169,0],[255,171,0],[255,173,0],[255,175,0],[255,176,0],[255,178,0],[255,180,0],[255,182,0],[255,184,0],[255,186,0],[255,188,0],[255,190,0],[255,191,0],[255,193,0],[255,195,0],[255,197,0],[255,199,0],[255,201,0],[255,203,0],[255,205,0],[255,206,0],[255,208,0],[255,210,0],[255,212,0],[255,213,0],[255,215,0],[255,217,0],[255,219,0],[255,220,0],[255,222,0],[255,224,0],[255,226,0],[255,228,0],[255,230,0],[255,232,0],[255,234,0],[255,235,4],[255,237,8],[255,239,13],[255,241,17],[255,242,21],[255,244,26],[255,246,30],[255,248,35],[255,248,42],[255,249,50],[255,250,58],[255,251,66],[255,252,74],[255,253,82],[255,254,90],[255,255,98],[255,255,105],[255,255,113],[255,255,121],[255,255,129],[255,255,136],[255,255,144],[255,255,152],[255,255,160],[255,255,167],[255,255,175],[255,255,183],[255,255,191],[255,255,199],[255,255,207],[255,255,215],[255,255,223],[255,255,227],[255,255,231],[255,255,235],[255,255,239],[255,255,243],[255,255,247],[255,255,251],[255,255,255],[255,255,255],[255,255,255],[255,255,255],[255,255,255],[255,255,255],[255,255,255],[255,255,255]]};var LutFlow={name:"Flow",bytes:[[32,200,255],[32,197,255],[32,194,255],[32,191,255],[31,188,255],[31,185,255],[31,182,255],[31,179,255],[31,176,255],[30,173,255],[30,170,255],[30,167,255],[30,164,255],[30,161,255],[29,158,255],[29,155,255],[29,152,255],[29,149,255],[29,146,255],[28,143,255],[28,140,255],[28,137,255],[28,134,255],[28,131,255],[27,128,255],[27,125,255],[27,122,255],[27,119,255],[27,116,255],[26,113,255],[26,110,255],[26,107,255],[26,104,255],[26,101,255],[25,98,255],[25,95,255],[25,92,255],[25,89,255],[25,86,255],[24,83,255],[24,80,255],[24,77,255],[24,74,255],[24,71,255],[23,68,255],[23,65,255],[23,62,255],[23,59,255],[23,56,255],[22,53,255],[22,50,255],[22,47,255],[22,44,255],[22,41,255],[21,38,255],[21,35,255],[21,32,255],[21,29,255],[21,26,255],[20,23,255],[20,20,255],[20,20,255],[20,20,251],[19,19,247],[19,19,244],[19,19,240],[19,19,236],[18,18,232],[18,18,228],[18,18,225],[17,17,221],[17,17,217],[17,17,213],[16,16,209],[16,16,206],[16,16,202],[16,16,198],[15,15,194],[15,15,190],[15,15,186],[14,14,183],[14,14,179],[14,14,175],[13,13,171],[13,13,167],[13,13,164],[13,13,160],[12,12,156],[12,12,152],[12,12,148],[11,11,145],[11,11,141],[11,11,137],[10,10,133],[10,10,129],[10,10,126],[10,10,122],[9,9,118],[9,9,114],[9,9,110],[8,8,107],[8,8,103],[8,8,99],[7,7,95],[7,7,91],[7,7,88],[7,7,84],[6,6,80],[6,6,76],[6,6,72],[5,5,69],[5,5,65],[5,5,61],[4,4,57],[4,4,53],[4,4,49],[4,4,46],[3,3,42],[3,3,38],[3,3,34],[2,2,30],[2,2,27],[2,2,23],[1,1,19],[1,1,15],[1,1,11],[1,1,8],[0,0,4],[0,0,0],[0,0,0],[4,0,0],[8,0,0],[12,0,0],[16,0,0],[20,0,0],[24,0,0],[28,0,0],[32,0,0],[36,0,0],[40,0,0],[45,0,0],[49,0,0],[53,0,0],[57,0,0],[61,0,0],[65,1,0],[69,1,0],[73,1,0],[77,1,0],[81,1,0],[85,1,0],[89,1,0],[93,1,0],[97,1,0],[101,1,0],[105,1,0],[109,1,0],[113,1,0],[117,1,0],[121,1,0],[125,1,0],[130,1,0],[134,1,0],[138,1,0],[142,1,0],[146,1,0],[150,1,0],[154,1,0],[158,1,0],[162,1,0],[166,1,0],[170,1,0],[174,1,0],[178,1,0],[182,1,0],[186,1,0],[190,1,0],[194,2,0],[198,2,0],[202,2,0],[206,2,0],[210,2,0],[215,2,0],[219,2,0],[223,2,0],[227,2,0],[231,2,0],[235,2,0],[239,2,0],[243,2,0],[247,2,0],[251,2,0],[255,2,0],[255,6,0],[255,10,0],[255,14,0],[255,18,0],[255,22,0],[255,26,0],[255,30,0],[255,34,0],[255,38,0],[255,42,0],[255,46,0],[255,50,0],[255,54,0],[255,58,0],[255,62,0],[255,66,0],[255,70,0],[255,74,0],[255,78,0],[255,82,0],[255,86,0],[255,90,0],[255,94,0],[255,98,0],[255,102,0],[255,106,0],[255,110,0],[255,114,0],[255,118,0],[255,122,0],[255,126,0],[255,130,8],[255,134,16],[255,138,24],[255,142,32],[255,146,40],[255,150,48],[255,154,56],[255,158,64],[255,162,72],[255,166,80],[255,170,88],[255,174,96],[255,178,104],[255,182,112],[255,186,120],[255,190,128],[255,194,136],[255,198,144],[255,202,152],[255,206,160],[255,210,168],[255,214,176],[255,218,184],[255,222,192],[255,226,200],[255,230,208],[255,234,216],[255,238,224],[255,242,232],[255,246,240],[255,250,248],[255,255,255]]};var LutGEColor={name:"GEColor",bytes:[[0,0,0],[0,2,1],[0,4,3],[0,6,5],[0,8,7],[0,10,9],[0,12,11],[0,14,13],[0,16,15],[0,18,17],[0,20,19],[0,22,21],[0,24,23],[0,26,25],[0,28,27],[0,30,29],[0,32,31],[0,34,33],[0,36,35],[0,38,37],[0,40,39],[0,42,41],[0,44,43],[0,46,45],[0,48,47],[0,50,49],[0,52,51],[0,54,53],[0,56,55],[0,58,57],[0,60,59],[0,62,61],[0,65,63],[0,67,65],[0,69,67],[0,71,69],[0,73,71],[0,75,73],[0,77,75],[0,79,77],[0,81,79],[0,83,81],[0,85,83],[0,87,85],[0,89,87],[0,91,89],[0,93,91],[0,95,93],[0,97,95],[0,99,97],[0,101,99],[0,103,101],[0,105,103],[0,107,105],[0,109,107],[0,111,109],[0,113,111],[0,115,113],[0,117,115],[0,119,117],[0,121,119],[0,123,121],[0,125,123],[0,128,125],[1,126,127],[3,124,129],[5,122,131],[7,120,133],[9,118,135],[11,116,137],[13,114,139],[15,112,141],[17,110,143],[19,108,145],[21,106,147],[23,104,149],[25,102,151],[27,100,153],[29,98,155],[31,96,157],[33,94,159],[35,92,161],[37,90,163],[39,88,165],[41,86,167],[43,84,169],[45,82,171],[47,80,173],[49,78,175],[51,76,177],[53,74,179],[55,72,181],[57,70,183],[59,68,185],[61,66,187],[63,64,189],[65,63,191],[67,61,193],[69,59,195],[71,57,197],[73,55,199],[75,53,201],[77,51,203],[79,49,205],[81,47,207],[83,45,209],[85,43,211],[86,41,213],[88,39,215],[90,37,217],[92,35,219],[94,33,221],[96,31,223],[98,29,225],[100,27,227],[102,25,229],[104,23,231],[106,21,233],[108,19,235],[110,17,237],[112,15,239],[114,13,241],[116,11,243],[118,9,245],[120,7,247],[122,5,249],[124,3,251],[126,1,253],[128,0,255],[130,2,252],[132,4,248],[134,6,244],[136,8,240],[138,10,236],[140,12,232],[142,14,228],[144,16,224],[146,18,220],[148,20,216],[150,22,212],[152,24,208],[154,26,204],[156,28,200],[158,30,196],[160,32,192],[162,34,188],[164,36,184],[166,38,180],[168,40,176],[170,42,172],[171,44,168],[173,46,164],[175,48,160],[177,50,156],[179,52,152],[181,54,148],[183,56,144],[185,58,140],[187,60,136],[189,62,132],[191,64,128],[193,66,124],[195,68,120],[197,70,116],[199,72,112],[201,74,108],[203,76,104],[205,78,100],[207,80,96],[209,82,92],[211,84,88],[213,86,84],[215,88,80],[217,90,76],[219,92,72],[221,94,68],[223,96,64],[225,98,60],[227,100,56],[229,102,52],[231,104,48],[233,106,44],[235,108,40],[237,110,36],[239,112,32],[241,114,28],[243,116,24],[245,118,20],[247,120,16],[249,122,12],[251,124,8],[253,126,4],[255,128,0],[255,130,4],[255,132,8],[255,134,12],[255,136,16],[255,138,20],[255,140,24],[255,142,28],[255,144,32],[255,146,36],[255,148,40],[255,150,44],[255,152,48],[255,154,52],[255,156,56],[255,158,60],[255,160,64],[255,162,68],[255,164,72],[255,166,76],[255,168,80],[255,170,85],[255,172,89],[255,174,93],[255,176,97],[255,178,101],[255,180,105],[255,182,109],[255,184,113],[255,186,117],[255,188,121],[255,190,125],[255,192,129],[255,194,133],[255,196,137],[255,198,141],[255,200,145],[255,202,149],[255,204,153],[255,206,157],[255,208,161],[255,210,165],[255,212,170],[255,214,174],[255,216,178],[255,218,182],[255,220,186],[255,222,190],[255,224,194],[255,226,198],[255,228,202],[255,230,206],[255,232,210],[255,234,214],[255,236,218],[255,238,222],[255,240,226],[255,242,230],[255,244,234],[255,246,238],[255,248,242],[255,250,246],[255,252,250],[255,255,255]]};var LutGrayRainbow={name:"GrayRainbow",bytes:[[0,0,0],[1,1,1],[2,2,2],[3,3,3],[4,4,4],[5,5,5],[6,6,6],[7,7,7],[8,8,8],[9,9,9],[10,10,10],[11,11,11],[12,12,12],[13,13,13],[14,14,14],[15,15,15],[175,0,255],[17,17,17],[18,18,18],[19,19,19],[20,20,20],[21,21,21],[22,22,22],[23,23,23],[24,24,24],[25,25,25],[26,26,26],[27,27,27],[28,28,28],[29,29,29],[30,30,30],[31,31,31],[95,0,255],[33,33,33],[34,34,34],[35,35,35],[36,36,36],[37,37,37],[38,38,38],[39,39,39],[40,40,40],[41,41,41],[42,42,42],[43,43,43],[44,44,44],[45,45,45],[46,46,46],[47,47,47],[15,0,255],[49,49,49],[50,50,50],[51,51,51],[52,52,52],[53,53,53],[54,54,54],[55,55,55],[56,56,56],[57,57,57],[58,58,58],[59,59,59],[60,60,60],[61,61,61],[62,62,62],[63,63,63],[0,65,255],[65,65,65],[66,66,66],[67,67,67],[68,68,68],[69,69,69],[70,70,70],[71,71,71],[72,72,72],[73,73,73],[74,74,74],[75,75,75],[76,76,76],[77,77,77],[78,78,78],[79,79,79],[0,145,255],[81,81,81],[82,82,82],[83,83,83],[84,84,84],[85,85,85],[86,86,86],[87,87,87],[88,88,88],[89,89,89],[90,90,90],[91,91,91],[92,92,92],[93,93,93],[94,94,94],[95,95,95],[0,225,255],[97,97,97],[98,98,98],[99,99,99],[100,100,100],[101,101,101],[102,102,102],[103,103,103],[104,104,104],[105,105,105],[106,106,106],[107,107,107],[108,108,108],[109,109,109],[110,110,110],[111,111,111],[0,255,205],[113,113,113],[114,114,114],[115,115,115],[116,116,116],[117,117,117],[118,118,118],[119,119,119],[120,120,120],[121,121,121],[122,122,122],[123,123,123],[124,124,124],[125,125,125],[126,126,126],[127,127,127],[0,255,125],[129,129,129],[130,130,130],[131,131,131],[132,132,132],[133,133,133],[134,134,134],[135,135,135],[136,136,136],[137,137,137],[138,138,138],[139,139,139],[140,140,140],[141,141,141],[142,142,142],[143,143,143],[0,255,45],[145,145,145],[146,146,146],[147,147,147],[148,148,148],[149,149,149],[150,150,150],[151,151,151],[152,152,152],[153,153,153],[154,154,154],[155,155,155],[156,156,156],[157,157,157],[158,158,158],[159,159,159],[35,255,0],[161,161,161],[162,162,162],[163,163,163],[164,164,164],[165,165,165],[166,166,166],[167,167,167],[168,168,168],[169,169,169],[170,170,170],[171,171,171],[172,172,172],[173,173,173],[174,174,174],[175,175,175],[115,255,0],[177,177,177],[178,178,178],[179,179,179],[180,180,180],[181,181,181],[182,182,182],[183,183,183],[184,184,184],[185,185,185],[186,186,186],[187,187,187],[188,188,188],[189,189,189],[190,190,190],[191,191,191],[195,255,0],[193,193,193],[194,194,194],[195,195,195],[196,196,196],[197,197,197],[198,198,198],[199,199,199],[200,200,200],[201,201,201],[202,202,202],[203,203,203],[204,204,204],[205,205,205],[206,206,206],[207,207,207],[255,235,0],[209,209,209],[210,210,210],[211,211,211],[212,212,212],[213,213,213],[214,214,214],[215,215,215],[216,216,216],[217,217,217],[218,218,218],[219,219,219],[220,220,220],[221,221,221],[222,222,222],[223,223,223],[255,155,0],[225,225,225],[226,226,226],[227,227,227],[228,228,228],[229,229,229],[230,230,230],[231,231,231],[232,232,232],[233,233,233],[234,234,234],[235,235,235],[236,236,236],[237,237,237],[238,238,238],[239,239,239],[255,75,0],[241,241,241],[242,242,242],[243,243,243],[244,244,244],[245,245,245],[246,246,246],[247,247,247],[248,248,248],[249,249,249],[250,250,250],[251,251,251],[252,252,252],[253,253,253],[254,254,254],[255,255,255]]};var LutHotGreen={name:"HotGreen",bytes:[[0,0,0],[0,1,0],[0,3,0],[0,4,0],[0,6,0],[0,7,0],[0,9,0],[0,10,0],[0,12,0],[0,13,0],[0,15,0],[0,16,0],[0,18,0],[0,19,0],[0,21,0],[0,22,0],[0,24,0],[0,25,0],[0,27,0],[0,28,0],[0,30,0],[0,31,0],[0,33,0],[0,34,0],[0,36,0],[0,37,0],[0,39,0],[0,40,0],[0,42,0],[0,43,0],[0,45,0],[0,46,0],[0,48,0],[0,49,0],[0,51,0],[0,52,0],[0,54,0],[0,55,0],[0,57,0],[0,58,0],[0,60,0],[0,61,0],[0,63,0],[0,64,0],[0,66,0],[0,67,0],[0,69,0],[0,70,0],[0,72,0],[0,73,0],[0,75,0],[0,76,0],[0,78,0],[0,79,0],[0,81,0],[0,82,0],[0,84,0],[0,85,0],[0,87,0],[0,88,0],[0,90,0],[0,91,0],[0,93,0],[0,94,0],[0,96,0],[0,97,0],[0,99,0],[0,100,0],[0,102,0],[0,103,0],[0,105,0],[0,106,0],[0,108,0],[0,109,0],[0,111,0],[0,112,0],[0,114,0],[0,115,0],[0,117,0],[0,118,0],[0,120,0],[0,121,0],[0,123,0],[0,124,0],[0,126,0],[0,127,0],[0,129,0],[0,130,0],[0,132,0],[0,133,0],[0,135,0],[0,136,0],[0,138,0],[0,139,0],[0,141,0],[0,142,0],[0,144,0],[0,145,0],[0,147,0],[0,148,0],[0,150,0],[0,151,0],[0,153,0],[0,154,0],[0,156,0],[0,157,0],[0,159,0],[0,160,0],[0,162,0],[0,163,0],[0,165,0],[0,166,0],[0,168,0],[1,169,0],[3,171,0],[5,172,0],[7,174,0],[8,175,0],[10,177,0],[12,178,0],[14,180,0],[16,181,0],[17,183,0],[19,184,0],[21,186,0],[23,187,0],[24,189,0],[26,190,0],[28,192,0],[30,193,0],[32,195,0],[33,196,0],[35,198,0],[37,199,0],[39,201,0],[40,202,0],[42,204,0],[44,205,0],[46,207,0],[48,208,0],[49,210,0],[51,211,0],[53,213,0],[55,214,0],[56,216,0],[58,217,0],[60,219,0],[62,220,0],[64,222,0],[65,223,0],[67,225,0],[69,226,0],[71,228,0],[72,229,0],[74,231,0],[76,232,0],[78,234,0],[80,235,0],[81,237,0],[83,238,0],[85,240,0],[87,241,0],[88,243,0],[90,244,0],[92,246,0],[94,247,0],[96,249,0],[97,250,0],[99,252,0],[101,253,0],[103,255,0],[104,255,0],[106,255,0],[108,255,0],[110,255,0],[112,255,0],[113,255,0],[115,255,0],[117,255,0],[119,255,0],[120,255,0],[122,255,3],[124,255,6],[126,255,10],[128,255,13],[129,255,16],[131,255,20],[133,255,23],[135,255,26],[136,255,30],[138,255,33],[140,255,37],[142,255,40],[144,255,43],[145,255,47],[147,255,50],[149,255,53],[151,255,57],[152,255,60],[154,255,64],[156,255,67],[158,255,70],[160,255,74],[161,255,77],[163,255,80],[165,255,84],[167,255,87],[168,255,90],[170,255,94],[172,255,97],[174,255,101],[176,255,104],[177,255,107],[179,255,111],[181,255,114],[183,255,117],[184,255,121],[186,255,124],[188,255,128],[190,255,131],[192,255,134],[193,255,138],[195,255,141],[197,255,144],[199,255,148],[200,255,151],[202,255,154],[204,255,158],[206,255,161],[208,255,165],[209,255,168],[211,255,171],[213,255,175],[215,255,178],[216,255,181],[218,255,185],[220,255,188],[222,255,192],[224,255,195],[225,255,198],[227,255,202],[229,255,205],[231,255,208],[232,255,212],[234,255,215],[236,255,218],[238,255,222],[240,255,225],[241,255,229],[243,255,232],[245,255,235],[247,255,239],[248,255,242],[250,255,245],[252,255,249],[254,255,252]]};var LutHotIron={name:"HotIron",bytes:[[0,0,0],[2,0,0],[4,0,0],[6,0,0],[8,0,0],[10,0,0],[12,0,0],[14,0,0],[16,0,0],[18,0,0],[20,0,0],[22,0,0],[24,0,0],[26,0,0],[28,0,0],[30,0,0],[32,0,0],[34,0,0],[36,0,0],[38,0,0],[40,0,0],[42,0,0],[44,0,0],[46,0,0],[48,0,0],[50,0,0],[52,0,0],[54,0,0],[56,0,0],[58,0,0],[60,0,0],[62,0,0],[64,0,0],[66,0,0],[68,0,0],[70,0,0],[72,0,0],[74,0,0],[76,0,0],[78,0,0],[80,0,0],[82,0,0],[84,0,0],[86,0,0],[88,0,0],[90,0,0],[92,0,0],[94,0,0],[96,0,0],[98,0,0],[100,0,0],[102,0,0],[104,0,0],[106,0,0],[108,0,0],[110,0,0],[112,0,0],[114,0,0],[116,0,0],[118,0,0],[120,0,0],[122,0,0],[124,0,0],[126,0,0],[128,0,0],[130,0,0],[132,0,0],[134,0,0],[136,0,0],[138,0,0],[140,0,0],[142,0,0],[144,0,0],[146,0,0],[148,0,0],[150,0,0],[152,0,0],[154,0,0],[156,0,0],[158,0,0],[160,0,0],[162,0,0],[164,0,0],[166,0,0],[168,0,0],[170,0,0],[172,0,0],[174,0,0],[176,0,0],[178,0,0],[180,0,0],[182,0,0],[184,0,0],[186,0,0],[188,0,0],[190,0,0],[192,0,0],[194,0,0],[196,0,0],[198,0,0],[200,0,0],[202,0,0],[204,0,0],[206,0,0],[208,0,0],[210,0,0],[212,0,0],[214,0,0],[216,0,0],[218,0,0],[220,0,0],[222,0,0],[224,0,0],[226,0,0],[228,0,0],[230,0,0],[232,0,0],[234,0,0],[236,0,0],[238,0,0],[240,0,0],[242,0,0],[244,0,0],[246,0,0],[248,0,0],[250,0,0],[252,0,0],[254,0,0],[255,0,0],[255,2,0],[255,4,0],[255,6,0],[255,8,0],[255,10,0],[255,12,0],[255,14,0],[255,16,0],[255,18,0],[255,20,0],[255,22,0],[255,24,0],[255,26,0],[255,28,0],[255,30,0],[255,32,0],[255,34,0],[255,36,0],[255,38,0],[255,40,0],[255,42,0],[255,44,0],[255,46,0],[255,48,0],[255,50,0],[255,52,0],[255,54,0],[255,56,0],[255,58,0],[255,60,0],[255,62,0],[255,64,0],[255,66,0],[255,68,0],[255,70,0],[255,72,0],[255,74,0],[255,76,0],[255,78,0],[255,80,0],[255,82,0],[255,84,0],[255,86,0],[255,88,0],[255,90,0],[255,92,0],[255,94,0],[255,96,0],[255,98,0],[255,100,0],[255,102,0],[255,104,0],[255,106,0],[255,108,0],[255,110,0],[255,112,0],[255,114,0],[255,116,0],[255,118,0],[255,120,0],[255,122,0],[255,124,0],[255,126,0],[255,128,4],[255,130,8],[255,132,12],[255,134,16],[255,136,20],[255,138,24],[255,140,28],[255,142,32],[255,144,36],[255,146,40],[255,148,44],[255,150,48],[255,152,52],[255,154,56],[255,156,60],[255,158,64],[255,160,68],[255,162,72],[255,164,76],[255,166,80],[255,168,84],[255,170,88],[255,172,92],[255,174,96],[255,176,100],[255,178,104],[255,180,108],[255,182,112],[255,184,116],[255,186,120],[255,188,124],[255,190,128],[255,192,132],[255,194,136],[255,196,140],[255,198,144],[255,200,148],[255,202,152],[255,204,156],[255,206,160],[255,208,164],[255,210,168],[255,212,172],[255,214,176],[255,216,180],[255,218,184],[255,220,188],[255,222,192],[255,224,196],[255,226,200],[255,228,204],[255,230,208],[255,232,212],[255,234,216],[255,236,220],[255,238,224],[255,240,228],[255,242,232],[255,244,236],[255,246,240],[255,248,244],[255,250,248],[255,252,252],[255,255,255]]};var LutHotMetal={name:"HotMetal",bytes:[[0,0,0],[1,0,0],[2,0,0],[4,0,0],[5,0,0],[7,0,0],[8,0,0],[9,0,0],[11,0,0],[12,0,0],[14,0,0],[15,0,0],[16,0,0],[18,0,0],[19,0,0],[21,0,0],[22,0,0],[23,0,0],[25,0,0],[26,0,0],[28,0,0],[29,0,0],[30,0,0],[32,0,0],[33,0,0],[35,0,0],[36,0,0],[37,0,0],[39,0,0],[40,0,0],[42,0,0],[43,0,0],[44,0,0],[46,0,0],[47,0,0],[49,0,0],[50,0,0],[51,0,0],[53,0,0],[54,0,0],[56,0,0],[57,0,0],[58,0,0],[60,0,0],[61,0,0],[63,0,0],[64,0,0],[65,0,0],[67,0,0],[68,0,0],[70,0,0],[71,0,0],[72,0,0],[74,0,0],[75,0,0],[77,0,0],[78,0,0],[79,0,0],[81,0,0],[82,0,0],[84,0,0],[85,0,0],[86,0,0],[88,0,0],[89,0,0],[91,0,0],[92,0,0],[93,0,0],[95,0,0],[96,0,0],[98,0,0],[99,0,0],[100,0,0],[102,0,0],[103,0,0],[105,0,0],[106,0,0],[107,0,0],[109,0,0],[110,0,0],[112,0,0],[113,0,0],[114,0,0],[116,0,0],[117,0,0],[119,0,0],[120,0,0],[121,0,0],[123,0,0],[124,0,0],[126,0,0],[127,0,0],[128,0,0],[130,0,0],[131,0,0],[133,0,0],[134,0,0],[135,0,0],[137,0,0],[138,0,0],[140,0,0],[141,0,0],[142,0,0],[144,0,0],[145,0,0],[147,0,0],[148,0,0],[149,0,0],[151,0,0],[152,0,0],[154,0,0],[155,0,0],[156,0,0],[158,0,0],[159,0,0],[161,0,0],[162,0,0],[163,0,0],[165,0,0],[166,0,0],[168,0,0],[169,0,0],[170,0,0],[172,0,0],[173,0,0],[175,0,0],[176,0,0],[177,0,0],[179,0,0],[180,2,0],[182,5,0],[183,8,0],[184,11,0],[186,14,0],[187,16,0],[189,19,0],[190,22,0],[191,25,0],[193,28,0],[194,30,0],[196,33,0],[197,36,0],[198,39,0],[200,42,0],[201,44,0],[203,47,0],[204,50,0],[205,53,0],[207,56,0],[208,58,0],[210,61,0],[211,64,0],[212,67,0],[214,70,0],[215,72,0],[217,75,0],[218,78,0],[219,81,0],[221,84,0],[222,86,0],[224,89,0],[225,92,0],[226,95,0],[228,98,0],[229,100,0],[231,103,0],[232,106,0],[233,109,0],[235,112,0],[236,114,0],[238,117,0],[239,120,0],[240,123,0],[242,126,0],[243,128,0],[245,131,0],[246,134,0],[247,137,0],[249,140,0],[250,142,0],[252,145,0],[253,148,0],[255,151,0],[255,154,0],[255,156,0],[255,159,0],[255,162,0],[255,165,0],[255,168,0],[255,170,0],[255,173,0],[255,176,0],[255,179,0],[255,182,3],[255,184,7],[255,187,11],[255,190,15],[255,193,19],[255,196,23],[255,198,27],[255,201,31],[255,204,35],[255,207,39],[255,210,43],[255,212,47],[255,215,51],[255,218,55],[255,221,59],[255,224,63],[255,226,67],[255,229,71],[255,232,75],[255,235,79],[255,238,83],[255,240,87],[255,243,91],[255,246,95],[255,249,99],[255,252,103],[255,255,107],[255,255,111],[255,255,115],[255,255,119],[255,255,123],[255,255,127],[255,255,131],[255,255,135],[255,255,139],[255,255,143],[255,255,147],[255,255,151],[255,255,155],[255,255,159],[255,255,163],[255,255,167],[255,255,171],[255,255,175],[255,255,179],[255,255,183],[255,255,187],[255,255,191],[255,255,195],[255,255,199],[255,255,203],[255,255,207],[255,255,211],[255,255,215],[255,255,219],[255,255,223],[255,255,227],[255,255,231],[255,255,235],[255,255,239],[255,255,243],[255,255,247],[255,255,251]]};var LutHue1={name:"Hue1",bytes:[[0,0,3],[0,0,3],[1,1,13],[2,2,17],[3,3,23],[4,4,30],[5,5,37],[6,6,44],[7,7,50],[8,8,57],[9,9,63],[13,13,70],[11,11,76],[12,12,82],[13,13,89],[14,14,95],[15,15,101],[16,16,107],[17,17,114],[18,18,120],[19,19,126],[20,20,132],[21,21,138],[22,22,144],[23,23,149],[24,24,155],[25,25,161],[26,26,167],[27,27,172],[28,28,178],[29,29,184],[30,30,189],[31,31,195],[32,32,200],[33,33,205],[34,34,211],[35,35,216],[36,36,221],[37,37,227],[38,38,232],[39,39,237],[40,40,242],[41,41,247],[42,42,252],[43,43,255],[44,44,255],[45,45,255],[46,46,255],[47,47,255],[48,48,255],[49,49,255],[50,50,255],[51,51,255],[52,52,255],[53,53,255],[54,54,255],[55,55,255],[56,56,255],[57,57,255],[58,58,255],[59,59,255],[60,60,255],[61,61,255],[62,62,255],[63,63,255],[64,64,255],[64,64,255],[65,65,255],[66,66,255],[67,67,255],[68,68,255],[69,69,255],[70,70,255],[71,71,255],[72,72,255],[73,73,255],[74,74,255],[75,75,255],[76,76,255],[77,77,255],[78,78,255],[79,79,255],[80,80,255],[81,81,255],[82,82,255],[83,83,255],[84,84,255],[87,87,255],[92,92,255],[97,97,255],[102,102,255],[107,107,255],[111,111,255],[116,116,255],[121,121,255],[125,125,255],[130,130,255],[134,134,255],[139,139,255],[143,143,255],[147,147,255],[152,152,255],[156,156,255],[160,160,255],[164,164,255],[168,168,255],[172,172,255],[176,176,255],[180,180,255],[184,184,255],[188,188,255],[192,192,255],[196,196,255],[199,199,255],[203,203,255],[207,207,255],[210,210,255],[214,214,255],[217,217,255],[221,221,255],[224,224,255],[228,228,255],[231,231,255],[234,234,255],[238,238,255],[241,241,255],[244,244,255],[247,247,255],[250,250,255],[253,253,255],[255,255,253],[255,255,250],[255,255,247],[255,255,244],[255,255,242],[255,255,239],[255,255,236],[255,255,234],[255,255,231],[255,255,229],[255,255,226],[255,255,224],[255,255,221],[255,255,219],[255,255,217],[255,255,214],[255,255,212],[255,255,210],[255,255,208],[255,255,206],[255,255,204],[255,255,202],[255,255,200],[255,255,198],[255,255,196],[255,255,194],[255,255,192],[255,255,191],[255,255,189],[255,255,187],[255,255,186],[255,255,184],[255,255,183],[255,255,181],[255,255,180],[255,255,179],[255,255,177],[255,255,176],[255,255,175],[255,255,174],[255,255,173],[255,255,172],[255,255,171],[255,255,171],[255,255,172],[255,255,173],[255,255,174],[255,255,175],[255,255,176],[255,255,177],[255,255,178],[255,255,179],[255,255,180],[255,255,181],[255,255,182],[255,255,183],[255,255,184],[255,255,185],[255,255,186],[255,255,187],[255,255,188],[255,255,189],[255,255,190],[255,255,191],[255,255,191],[255,255,192],[255,255,193],[255,255,194],[255,255,195],[255,255,196],[255,255,197],[255,255,198],[255,255,199],[255,255,200],[255,255,201],[255,255,202],[255,255,203],[255,255,204],[255,255,205],[255,255,206],[255,255,207],[255,255,208],[255,255,209],[255,255,210],[255,255,211],[255,255,212],[254,254,213],[253,253,214],[252,252,215],[251,251,216],[251,251,217],[250,250,218],[249,249,219],[249,249,220],[248,248,221],[247,247,222],[247,247,223],[246,246,224],[246,246,225],[246,246,226],[245,245,227],[245,245,228],[245,245,229],[245,245,230],[244,244,231],[244,244,232],[244,244,233],[244,244,234],[244,244,235],[244,244,236],[245,245,237],[245,245,238],[245,245,239],[245,245,240],[246,246,241],[246,246,242],[246,246,243],[247,247,244],[247,247,245],[248,248,246],[249,249,247],[249,249,248],[250,250,249],[251,251,250],[251,251,251],[251,251,251]]};var LutHue2={name:"Hue2",bytes:[[255,253,253],[255,253,253],[255,252,252],[255,251,251],[255,250,250],[255,249,249],[255,248,248],[255,247,248],[255,246,247],[255,245,247],[255,244,246],[255,243,246],[255,242,245],[255,241,245],[255,240,244],[255,239,244],[255,238,244],[255,237,244],[255,236,243],[255,235,243],[255,234,243],[255,233,243],[255,232,243],[255,231,243],[255,230,243],[255,229,243],[255,228,244],[255,227,244],[255,226,244],[255,225,244],[255,224,245],[255,223,245],[255,222,246],[255,221,246],[255,220,247],[255,219,247],[255,218,248],[255,217,249],[255,216,250],[255,215,250],[255,214,251],[255,213,252],[255,212,253],[255,211,254],[254,210,255],[253,209,255],[252,208,255],[251,207,255],[249,206,255],[248,205,255],[247,204,255],[246,203,255],[244,202,255],[243,201,255],[241,200,255],[240,199,255],[238,198,255],[237,197,255],[235,196,255],[233,195,255],[231,194,255],[230,193,255],[228,192,255],[226,191,255],[224,190,255],[222,189,255],[220,188,255],[218,187,255],[216,186,255],[213,185,255],[211,184,255],[209,183,255],[207,182,255],[204,181,255],[202,180,255],[199,179,255],[197,178,255],[194,177,255],[192,176,255],[189,175,255],[187,174,255],[184,173,255],[181,172,255],[178,171,255],[175,170,255],[172,169,255],[170,169,255],[168,169,255],[167,170,255],[166,171,255],[165,172,255],[164,173,255],[163,174,255],[162,176,255],[161,177,255],[160,178,255],[159,180,255],[158,181,255],[157,183,255],[156,184,255],[155,186,255],[154,188,255],[153,189,255],[152,191,255],[151,193,255],[150,195,255],[149,197,255],[148,199,255],[147,201,255],[146,203,255],[145,205,255],[144,207,255],[143,209,255],[142,211,255],[141,214,255],[140,216,255],[139,218,255],[138,221,255],[137,223,255],[136,226,255],[135,228,255],[134,231,255],[133,233,255],[132,236,255],[131,239,255],[130,241,255],[129,244,255],[128,247,255],[127,250,255],[126,253,255],[125,255,253],[124,255,250],[123,255,247],[122,255,244],[121,255,241],[120,255,237],[119,255,234],[118,255,231],[117,255,227],[116,255,224],[115,255,220],[114,255,217],[113,255,213],[112,255,210],[111,255,206],[110,255,203],[109,255,199],[108,255,195],[107,255,191],[106,255,187],[105,255,183],[104,255,179],[103,255,175],[102,255,171],[101,255,167],[100,255,163],[99,255,159],[98,255,155],[97,255,150],[96,255,146],[95,255,142],[94,255,137],[93,255,133],[92,255,128],[91,255,124],[90,255,119],[89,255,114],[88,255,110],[87,255,105],[86,255,100],[85,255,95],[85,255,90],[84,255,86],[84,255,83],[88,255,82],[91,255,81],[94,255,80],[97,255,79],[100,255,78],[103,255,77],[107,255,76],[110,255,75],[114,255,74],[117,255,73],[121,255,72],[124,255,71],[128,255,70],[131,255,69],[135,255,68],[139,255,67],[143,255,66],[146,255,65],[150,255,64],[154,255,63],[158,255,62],[162,255,61],[166,255,60],[170,255,59],[174,255,58],[179,255,57],[183,255,56],[187,255,55],[191,255,54],[196,255,53],[200,255,52],[205,255,51],[209,255,50],[214,255,49],[218,255,48],[223,255,47],[228,255,46],[233,255,45],[237,255,44],[242,255,43],[247,255,42],[252,255,41],[255,252,40],[255,247,39],[255,242,38],[255,237,37],[255,232,36],[255,226,35],[255,221,34],[255,216,33],[255,211,32],[255,205,31],[255,200,30],[255,194,29],[255,189,28],[255,183,27],[255,178,26],[255,172,25],[255,166,24],[255,160,23],[255,155,22],[255,149,21],[255,143,20],[255,137,19],[255,131,18],[255,125,17],[255,119,16],[255,113,15],[255,107,14],[255,100,13],[255,94,12],[255,88,11],[255,81,13],[255,75,9],[255,69,8],[255,62,7],[255,56,6],[255,49,5],[255,42,4],[255,36,3],[255,29,2],[255,29,2]]};var LutIce={name:"Ice",bytes:[[0,156,140],[0,157,140],[0,158,141],[0,159,142],[0,160,143],[0,161,144],[0,162,145],[0,163,146],[0,165,147],[0,166,148],[0,167,149],[0,169,151],[0,170,152],[0,171,153],[0,173,155],[0,174,156],[0,176,158],[0,177,159],[0,178,160],[0,179,161],[0,180,162],[0,181,163],[0,182,164],[0,183,165],[0,184,166],[0,184,166],[0,185,167],[0,186,167],[0,187,168],[0,187,168],[0,188,169],[0,189,169],[0,190,170],[0,190,170],[0,191,171],[0,192,172],[0,193,173],[0,193,173],[0,194,174],[0,195,175],[0,196,176],[2,195,180],[4,195,184],[7,194,188],[9,194,192],[11,194,196],[14,193,200],[16,193,204],[19,193,209],[20,191,210],[21,190,211],[22,189,213],[24,188,214],[25,187,215],[26,186,217],[27,185,218],[29,184,220],[31,182,221],[34,180,223],[36,179,225],[39,177,227],[42,175,228],[44,174,230],[47,172,232],[50,171,234],[49,169,232],[49,168,231],[49,167,230],[49,166,229],[48,165,228],[48,164,227],[48,163,226],[48,162,225],[51,160,226],[55,158,227],[59,156,229],[63,154,230],[67,152,231],[71,150,233],[75,148,234],[79,146,236],[83,143,237],[87,140,238],[91,138,239],[95,135,241],[99,132,242],[103,130,243],[107,127,244],[112,125,246],[114,122,246],[117,120,247],[120,118,247],[123,116,248],[125,113,248],[128,111,249],[131,109,249],[134,107,250],[137,105,250],[140,103,250],[143,101,250],[146,100,250],[149,98,250],[152,96,250],[155,94,250],[158,93,251],[161,91,250],[165,90,250],[168,88,250],[172,87,250],[175,85,250],[179,84,250],[182,82,250],[186,81,250],[187,81,250],[189,82,250],[191,83,250],[193,84,250],[195,84,250],[197,85,250],[199,86,250],[201,87,250],[203,87,249],[205,88,248],[207,88,248],[209,89,247],[211,90,246],[213,90,246],[215,91,245],[217,92,245],[218,92,243],[220,93,241],[221,93,239],[223,94,237],[224,95,235],[226,95,233],[227,96,231],[229,97,230],[230,96,230],[232,96,230],[233,96,230],[235,96,230],[237,95,230],[238,95,230],[240,95,230],[242,95,230],[243,94,229],[244,94,228],[245,94,227],[246,94,226],[247,93,225],[248,93,224],[249,93,223],[250,93,222],[250,93,219],[250,93,217],[250,93,214],[250,93,212],[250,93,209],[250,93,207],[250,93,204],[250,93,202],[250,92,199],[250,92,196],[250,91,193],[250,91,191],[250,91,188],[250,90,185],[250,90,182],[250,90,180],[250,89,177],[250,88,175],[250,88,173],[250,87,171],[250,86,169],[250,86,167],[250,85,165],[250,85,163],[250,83,160],[250,81,157],[250,79,155],[250,77,152],[250,75,149],[250,73,147],[250,71,144],[251,69,142],[250,68,139],[250,67,137],[250,67,134],[250,66,132],[250,65,130],[250,65,127],[250,64,125],[250,64,123],[250,62,121],[250,61,120],[250,60,119],[250,59,118],[250,57,117],[250,56,116],[250,55,115],[250,54,114],[250,53,113],[250,52,112],[250,51,111],[250,50,110],[250,49,109],[250,48,108],[250,47,107],[250,47,106],[250,45,104],[250,44,103],[250,42,101],[250,41,100],[250,39,98],[250,38,97],[250,36,95],[250,35,94],[250,33,92],[250,31,91],[250,29,90],[250,27,89],[250,25,87],[250,23,86],[250,21,85],[251,19,84],[251,16,81],[251,14,79],[251,11,76],[251,9,74],[251,7,71],[251,4,69],[251,2,66],[251,0,64],[250,0,59],[249,1,54],[248,1,49],[247,2,45],[246,2,40],[245,3,35],[244,3,30],[243,4,26],[241,3,26],[239,3,26],[238,2,26],[236,2,26],[234,1,26],[233,1,26],[231,0,26],[230,0,27],[230,0,27],[230,0,27],[230,0,27],[230,0,27],[230,0,27],[230,0,27],[230,0,27]]};var LutIred={name:"Ired",bytes:[[255,255,255],[255,254,254],[255,253,253],[255,252,252],[255,251,251],[255,250,250],[255,249,249],[255,248,248],[255,247,247],[255,246,246],[255,245,245],[255,244,244],[255,243,243],[255,242,242],[255,241,241],[255,240,240],[255,239,239],[255,238,238],[255,237,237],[255,236,236],[255,235,235],[255,234,234],[255,233,233],[255,232,232],[255,231,231],[255,230,230],[255,229,229],[255,228,228],[255,227,227],[255,226,226],[255,225,225],[255,224,224],[255,223,223],[255,222,222],[255,221,221],[255,220,220],[255,219,219],[255,218,218],[255,217,217],[255,216,216],[255,215,215],[255,214,214],[255,213,213],[255,212,212],[255,211,211],[255,210,210],[255,209,209],[255,208,208],[255,207,207],[255,206,206],[255,205,205],[255,204,204],[255,203,203],[255,202,202],[255,201,201],[255,200,200],[255,199,199],[255,198,198],[255,197,197],[255,196,196],[255,195,195],[255,194,194],[255,193,193],[255,192,192],[255,191,191],[255,190,190],[255,189,189],[255,188,188],[255,187,187],[255,186,186],[255,185,185],[255,184,184],[255,183,183],[255,182,182],[255,181,181],[255,180,180],[255,179,179],[255,178,178],[255,177,177],[255,176,176],[255,175,175],[255,174,174],[255,173,173],[255,172,172],[255,171,171],[255,170,170],[255,169,169],[255,168,168],[255,167,167],[255,166,166],[255,165,165],[255,164,164],[255,163,163],[255,162,162],[255,161,161],[255,160,160],[255,159,159],[255,158,158],[255,157,157],[255,156,156],[255,155,155],[255,154,154],[255,153,153],[255,152,152],[255,151,151],[255,150,150],[255,149,149],[255,148,148],[255,147,147],[255,146,146],[255,145,145],[255,144,144],[255,143,143],[255,142,142],[255,141,141],[255,140,140],[255,139,139],[255,138,138],[255,137,137],[255,136,136],[255,135,135],[255,134,134],[255,133,133],[255,132,132],[255,131,131],[255,130,130],[255,129,129],[255,128,128],[255,127,127],[255,126,126],[255,125,125],[255,124,124],[255,123,123],[255,122,122],[255,121,121],[255,120,120],[255,119,119],[255,118,118],[255,117,117],[255,116,116],[255,115,115],[255,114,114],[255,113,113],[255,112,112],[255,111,111],[255,110,110],[255,109,109],[255,108,108],[255,107,107],[255,106,106],[255,105,105],[255,104,104],[255,103,103],[255,102,102],[255,101,101],[255,100,100],[255,99,99],[255,98,98],[255,97,97],[255,96,96],[255,95,95],[255,94,94],[255,93,93],[255,92,92],[255,91,91],[255,90,90],[255,89,89],[255,88,88],[255,87,87],[255,86,86],[255,85,85],[255,84,84],[255,83,83],[255,82,82],[255,81,81],[255,80,80],[255,79,79],[255,78,78],[255,77,77],[255,76,76],[255,75,75],[255,74,74],[255,73,73],[255,72,72],[255,71,71],[255,70,70],[255,69,69],[255,68,68],[255,67,67],[255,66,66],[255,65,65],[255,64,64],[255,63,63],[255,62,62],[255,61,61],[255,60,60],[255,59,59],[255,58,58],[255,57,57],[255,56,56],[255,55,55],[255,54,54],[255,53,53],[255,52,52],[255,51,51],[255,50,50],[255,49,49],[255,48,48],[255,47,47],[255,46,46],[255,45,45],[255,44,44],[255,43,43],[255,42,42],[255,41,41],[255,40,40],[255,39,39],[255,38,38],[255,37,37],[255,36,36],[255,35,35],[255,34,34],[255,33,33],[255,32,32],[255,31,31],[255,30,30],[255,29,29],[255,28,28],[255,27,27],[255,26,26],[255,25,25],[255,24,24],[255,23,23],[255,22,22],[255,21,21],[255,20,20],[255,19,19],[255,18,18],[255,17,17],[255,16,16],[255,15,15],[255,14,14],[255,13,13],[255,12,12],[255,11,11],[255,10,10],[255,9,9],[255,8,8],[255,7,7],[255,6,6],[255,5,5],[255,4,4],[255,3,3],[255,2,2],[255,1,1],[255,1,1]]};var LutNIH={name:"NIH",bytes:[[0,0,0],[5,0,11],[11,0,22],[17,0,34],[22,0,45],[28,0,56],[34,0,68],[39,0,79],[45,0,90],[51,0,102],[56,0,113],[62,0,124],[68,0,136],[73,0,147],[79,0,158],[85,0,170],[79,0,164],[74,0,159],[69,0,154],[63,0,148],[58,0,143],[53,0,138],[47,0,132],[42,0,127],[37,0,122],[31,0,116],[26,0,111],[21,0,106],[15,0,100],[10,0,95],[5,0,90],[0,0,85],[0,0,90],[0,0,95],[0,0,100],[0,0,106],[0,0,111],[0,0,116],[0,0,122],[0,0,127],[0,0,132],[0,0,138],[0,0,143],[0,0,148],[0,0,154],[0,0,159],[0,0,164],[0,0,170],[0,0,175],[0,0,180],[0,0,185],[0,0,191],[0,0,196],[0,0,201],[0,0,207],[0,0,212],[0,0,217],[0,0,223],[0,0,228],[0,0,233],[0,0,239],[0,0,244],[0,0,249],[0,0,255],[0,5,255],[0,10,255],[0,15,255],[0,21,255],[0,26,255],[0,31,255],[0,37,255],[0,42,255],[0,47,255],[0,53,255],[0,58,255],[0,63,255],[0,69,255],[0,74,255],[0,79,255],[0,85,255],[0,90,249],[0,95,244],[0,100,239],[0,106,233],[0,111,228],[0,116,223],[0,122,217],[0,127,212],[0,132,207],[0,138,201],[0,143,196],[0,148,191],[0,154,185],[0,159,180],[0,164,175],[0,170,170],[0,175,170],[0,180,170],[0,185,170],[0,191,170],[0,196,170],[0,201,170],[0,207,170],[0,212,170],[0,217,170],[0,223,170],[0,228,170],[0,233,170],[0,239,170],[0,244,170],[0,249,170],[0,255,170],[0,255,159],[0,255,148],[0,255,138],[0,255,127],[0,255,116],[0,255,106],[0,255,95],[0,255,85],[0,255,74],[0,255,63],[0,255,53],[0,255,42],[0,255,31],[0,255,21],[0,255,10],[0,255,0],[5,255,5],[10,255,10],[15,255,15],[21,255,21],[26,255,26],[31,255,31],[37,255,37],[42,255,42],[47,255,47],[53,255,53],[58,255,58],[63,255,63],[69,255,69],[74,255,74],[79,255,79],[85,255,85],[95,255,79],[106,255,74],[116,255,69],[127,255,63],[138,255,58],[148,255,53],[159,255,47],[170,255,42],[180,255,37],[191,255,31],[201,255,26],[212,255,21],[223,255,15],[233,255,10],[244,255,5],[255,255,0],[255,249,0],[255,244,0],[255,239,0],[255,233,0],[255,228,0],[255,223,0],[255,217,0],[255,212,0],[255,207,0],[255,201,0],[255,196,0],[255,191,0],[255,185,0],[255,180,0],[255,175,0],[255,170,0],[255,164,0],[255,159,0],[255,154,0],[255,148,0],[255,143,0],[255,138,0],[255,132,0],[255,127,0],[255,122,0],[255,116,0],[255,111,0],[255,106,0],[255,100,0],[255,95,0],[255,90,0],[255,85,0],[255,81,0],[255,78,0],[255,75,0],[255,71,0],[255,68,0],[255,65,0],[255,62,0],[255,58,0],[255,55,0],[255,52,0],[255,49,0],[255,45,0],[255,42,0],[255,39,0],[255,35,0],[255,32,0],[255,29,0],[255,26,0],[255,22,0],[255,19,0],[255,16,0],[255,13,0],[255,9,0],[255,6,0],[255,3,0],[255,0,0],[252,0,0],[250,0,0],[248,0,0],[246,0,0],[243,0,0],[241,0,0],[239,0,0],[237,0,0],[234,0,0],[232,0,0],[230,0,0],[228,0,0],[225,0,0],[223,0,0],[221,0,0],[219,0,0],[216,0,0],[214,0,0],[212,0,0],[210,0,0],[208,0,0],[205,0,0],[203,0,0],[201,0,0],[199,0,0],[196,0,0],[194,0,0],[192,0,0],[190,0,0],[187,0,0],[185,0,0],[183,0,0],[181,0,0],[178,0,0],[176,0,0],[174,0,0],[255,255,255],[255,255,255]]};var LutRainbow1={name:"Rainbow1",bytes:[[0,0,0],[0,0,9],[0,0,17],[0,0,25],[0,0,33],[0,0,42],[0,0,50],[0,0,58],[0,0,66],[0,0,75],[0,0,83],[0,0,91],[0,0,99],[0,0,107],[0,0,116],[0,0,124],[0,0,132],[0,0,140],[0,0,149],[0,0,157],[0,0,165],[0,0,173],[0,0,181],[0,0,190],[0,0,198],[0,0,206],[0,0,214],[0,0,223],[0,0,231],[0,0,239],[0,0,247],[0,0,255],[0,5,250],[0,10,245],[0,16,239],[0,21,234],[0,27,228],[0,32,223],[0,37,218],[0,43,212],[0,48,207],[0,54,201],[0,59,196],[0,65,190],[0,70,185],[0,75,180],[0,81,174],[0,86,169],[0,92,163],[0,97,158],[0,103,152],[0,108,147],[0,113,142],[0,119,136],[0,124,131],[0,130,125],[0,135,120],[0,141,114],[0,146,109],[0,151,104],[0,157,98],[0,162,93],[0,168,87],[0,173,82],[0,179,76],[0,184,71],[0,189,66],[0,195,60],[0,200,55],[0,206,49],[0,211,44],[0,217,38],[0,222,33],[0,227,28],[0,233,22],[0,238,17],[0,244,11],[0,249,6],[0,255,0],[8,255,0],[15,255,0],[22,255,0],[29,255,0],[36,255,0],[43,255,0],[50,255,0],[57,255,0],[64,255,0],[71,255,0],[78,255,0],[85,255,0],[93,255,0],[100,255,0],[107,255,0],[114,255,0],[121,255,0],[128,255,0],[135,255,0],[142,255,0],[149,255,0],[156,255,0],[163,255,0],[170,255,0],[178,255,0],[185,255,0],[192,255,0],[199,255,0],[206,255,0],[213,255,0],[220,255,0],[227,255,0],[234,255,0],[241,255,0],[248,255,0],[255,255,0],[255,250,0],[255,245,0],[255,240,0],[255,235,0],[255,230,0],[255,225,0],[255,220,0],[255,215,0],[255,210,0],[255,204,0],[255,199,0],[255,194,0],[255,189,0],[255,184,0],[255,179,0],[255,174,0],[255,169,0],[255,164,0],[255,159,0],[255,153,0],[255,148,0],[255,143,0],[255,138,0],[255,133,0],[255,128,0],[255,123,0],[255,118,0],[255,113,0],[255,108,0],[255,102,0],[255,97,0],[255,92,0],[255,87,0],[255,82,0],[255,77,0],[255,72,0],[255,67,0],[255,62,0],[255,57,0],[255,51,0],[255,46,0],[255,41,0],[255,36,0],[255,31,0],[255,26,0],[255,21,0],[255,16,0],[255,11,0],[255,6,0],[255,0,0],[254,3,0],[254,5,0],[254,8,0],[254,10,0],[254,13,0],[254,15,0],[254,17,0],[254,20,0],[254,22,0],[254,25,0],[254,27,0],[254,30,0],[253,32,0],[253,34,0],[253,37,0],[253,39,0],[253,42,0],[253,44,0],[253,47,0],[253,49,0],[253,51,0],[253,54,0],[253,56,0],[253,59,0],[252,61,0],[252,64,0],[252,66,0],[252,68,0],[252,71,0],[252,73,0],[252,76,0],[252,78,0],[252,81,0],[252,83,0],[252,85,0],[252,88,0],[251,90,0],[251,93,0],[251,95,0],[251,98,0],[251,100,0],[251,102,0],[251,105,0],[251,107,0],[251,110,0],[251,112,0],[251,115,0],[251,117,0],[251,119,0],[251,122,6],[251,125,12],[251,128,18],[251,131,24],[251,135,30],[251,138,36],[251,141,42],[251,144,48],[251,148,54],[251,151,60],[252,154,66],[252,157,72],[252,161,78],[252,164,85],[252,167,91],[252,170,97],[252,174,103],[252,177,109],[252,180,115],[252,183,121],[253,187,127],[253,190,133],[253,193,139],[253,196,145],[253,199,151],[253,203,157],[253,206,163],[253,209,170],[253,212,176],[253,216,182],[253,219,188],[254,222,194],[254,225,200],[254,229,206],[254,232,212],[254,235,218],[254,238,224],[254,242,230],[254,245,236],[254,248,242],[254,251,248],[255,255,255]]};var LutRainbow2={name:"Rainbow2",bytes:[[0,0,0],[4,0,3],[9,0,7],[13,0,10],[18,0,14],[22,0,19],[27,0,23],[31,0,28],[36,0,32],[40,0,38],[45,0,43],[50,0,48],[54,0,53],[58,0,59],[61,0,63],[64,0,68],[68,0,72],[69,0,77],[72,0,81],[74,0,86],[77,0,91],[79,0,95],[80,0,100],[82,0,104],[83,0,109],[85,0,113],[84,0,118],[86,0,122],[87,0,127],[88,0,132],[86,0,136],[87,0,141],[87,0,145],[87,0,150],[85,0,154],[84,0,159],[84,0,163],[84,0,168],[83,0,173],[79,0,177],[78,0,182],[77,0,186],[76,0,191],[71,0,195],[70,0,200],[68,0,204],[66,0,209],[60,0,214],[58,0,218],[55,0,223],[53,0,227],[46,0,232],[43,0,236],[40,0,241],[36,0,245],[33,0,250],[25,0,255],[21,0,255],[16,0,255],[12,0,255],[4,0,255],[0,0,255],[0,4,255],[0,8,255],[0,16,255],[0,21,255],[0,25,255],[0,29,255],[0,38,255],[0,42,255],[0,46,255],[0,51,255],[0,55,255],[0,63,255],[0,67,255],[0,72,255],[0,76,255],[0,84,255],[0,89,255],[0,93,255],[0,97,255],[0,106,255],[0,110,255],[0,114,255],[0,119,255],[0,127,255],[0,131,255],[0,135,255],[0,140,255],[0,144,255],[0,152,255],[0,157,255],[0,161,255],[0,165,255],[0,174,255],[0,178,255],[0,182,255],[0,187,255],[0,195,255],[0,199,255],[0,203,255],[0,208,255],[0,216,255],[0,220,255],[0,225,255],[0,229,255],[0,233,255],[0,242,255],[0,246,255],[0,250,255],[0,255,255],[0,255,246],[0,255,242],[0,255,238],[0,255,233],[0,255,225],[0,255,220],[0,255,216],[0,255,212],[0,255,203],[0,255,199],[0,255,195],[0,255,191],[0,255,187],[0,255,178],[0,255,174],[0,255,170],[0,255,165],[0,255,157],[0,255,152],[0,255,148],[0,255,144],[0,255,135],[0,255,131],[0,255,127],[0,255,123],[0,255,114],[0,255,110],[0,255,106],[0,255,102],[0,255,97],[0,255,89],[0,255,84],[0,255,80],[0,255,76],[0,255,67],[0,255,63],[0,255,59],[0,255,55],[0,255,46],[0,255,42],[0,255,38],[0,255,34],[0,255,25],[0,255,21],[0,255,16],[0,255,12],[0,255,8],[0,255,0],[4,255,0],[8,255,0],[12,255,0],[21,255,0],[25,255,0],[29,255,0],[33,255,0],[42,255,0],[46,255,0],[51,255,0],[55,255,0],[63,255,0],[67,255,0],[72,255,0],[76,255,0],[80,255,0],[89,255,0],[93,255,0],[97,255,0],[101,255,0],[110,255,0],[114,255,0],[119,255,0],[123,255,0],[131,255,0],[135,255,0],[140,255,0],[144,255,0],[153,255,0],[157,255,0],[161,255,0],[165,255,0],[169,255,0],[178,255,0],[182,255,0],[187,255,0],[191,255,0],[199,255,0],[203,255,0],[208,255,0],[212,255,0],[221,255,0],[225,255,0],[229,255,0],[233,255,0],[242,255,0],[246,255,0],[250,255,0],[255,255,0],[255,250,0],[255,242,0],[255,238,0],[255,233,0],[255,229,0],[255,221,0],[255,216,0],[255,212,0],[255,208,0],[255,199,0],[255,195,0],[255,191,0],[255,187,0],[255,178,0],[255,174,0],[255,170,0],[255,165,0],[255,161,0],[255,153,0],[255,148,0],[255,144,0],[255,140,0],[255,131,0],[255,127,0],[255,123,0],[255,119,0],[255,110,0],[255,106,0],[255,102,0],[255,97,0],[255,89,0],[255,85,0],[255,80,0],[255,76,0],[255,72,0],[255,63,0],[255,59,0],[255,55,0],[255,51,0],[255,42,0],[255,38,0],[255,34,0],[255,29,0],[255,21,0],[255,17,0],[255,12,0],[255,8,0],[255,0,0]]};var LutRainbow3={name:"Rainbow3",bytes:[[124,0,255],[124,0,255],[120,0,254],[115,0,255],[111,0,254],[106,0,255],[102,0,254],[97,0,255],[93,0,254],[88,0,255],[84,0,254],[79,0,255],[75,0,254],[70,0,255],[66,0,254],[61,0,255],[57,0,254],[52,0,255],[48,0,254],[43,0,255],[39,0,254],[34,0,255],[30,0,254],[25,0,255],[21,0,254],[16,0,255],[12,0,254],[7,0,255],[3,0,254],[0,2,255],[0,6,254],[0,11,255],[0,15,254],[0,20,255],[0,24,254],[0,29,255],[0,33,254],[0,38,255],[0,42,254],[0,47,255],[0,51,254],[0,56,255],[0,60,254],[0,65,255],[0,69,254],[0,74,255],[0,78,254],[0,83,255],[0,87,254],[0,92,255],[0,96,254],[0,101,255],[0,105,254],[0,110,255],[0,114,254],[0,119,255],[0,122,254],[0,128,255],[0,131,254],[0,137,255],[0,140,254],[0,146,255],[0,149,254],[0,155,255],[0,158,254],[0,164,255],[0,167,254],[0,173,255],[0,176,254],[0,182,255],[0,185,254],[0,191,255],[0,194,254],[0,200,255],[0,203,254],[0,209,255],[0,212,254],[0,218,255],[0,221,254],[0,227,255],[0,230,254],[0,236,255],[0,240,254],[0,245,255],[0,249,254],[0,254,255],[0,254,250],[0,255,247],[0,254,241],[0,255,238],[0,254,232],[0,255,229],[0,254,223],[0,255,220],[0,254,214],[0,255,211],[0,254,205],[0,255,202],[0,254,196],[0,255,193],[0,254,187],[0,255,184],[0,254,178],[0,255,175],[0,254,169],[0,255,166],[0,254,160],[0,255,157],[0,254,151],[0,255,148],[0,254,142],[0,255,139],[0,254,133],[0,255,130],[0,254,125],[0,255,121],[0,254,116],[0,255,112],[0,254,107],[0,255,103],[0,254,98],[0,255,94],[0,254,89],[0,255,85],[0,254,80],[0,255,76],[0,254,71],[0,255,67],[0,254,62],[0,255,58],[0,254,53],[0,255,49],[0,254,44],[0,255,40],[0,254,35],[0,255,31],[0,254,26],[0,255,22],[0,254,17],[0,255,13],[0,254,8],[0,255,4],[1,254,0],[5,255,0],[13,254,0],[14,255,0],[19,254,0],[23,255,0],[28,254,0],[32,255,0],[37,254,0],[41,255,0],[46,254,0],[50,255,0],[55,254,0],[59,255,0],[64,254,0],[68,255,0],[73,254,0],[77,255,0],[82,254,0],[86,255,0],[91,254,0],[95,255,0],[100,254,0],[104,255,0],[109,254,0],[113,255,0],[118,254,0],[123,255,0],[126,254,0],[132,255,0],[135,254,0],[141,255,0],[144,254,0],[150,255,0],[153,254,0],[159,255,0],[162,254,0],[168,255,0],[171,254,0],[177,255,0],[180,254,0],[186,255,0],[189,254,0],[195,255,0],[198,254,0],[204,255,0],[207,254,0],[213,255,0],[216,254,0],[222,255,0],[225,254,0],[231,255,0],[234,254,0],[240,255,0],[243,254,0],[249,255,0],[252,254,0],[255,252,0],[254,247,0],[255,243,0],[254,238,0],[255,234,0],[254,229,0],[255,225,0],[254,220,0],[255,216,0],[254,211,0],[255,207,0],[254,202,0],[255,198,0],[254,193,0],[255,189,0],[254,184,0],[255,180,0],[254,175,0],[255,171,0],[254,166,0],[255,162,0],[254,157,0],[255,153,0],[254,148,0],[255,144,0],[254,139,0],[255,135,0],[254,131,0],[255,126,0],[254,122,0],[255,117,0],[254,113,0],[255,108,0],[254,104,0],[255,99,0],[254,95,0],[255,90,0],[254,86,0],[255,81,0],[254,77,0],[255,72,0],[254,68,0],[255,63,0],[254,59,0],[255,54,0],[254,50,0],[255,45,0],[254,41,0],[255,36,0],[254,32,0],[255,27,0],[254,23,0],[255,18,0],[254,14,0],[255,9,0],[255,5,0],[255,5,0]]};var LutRainbow4={name:"Rainbow4",bytes:[[0,0,0],[2,0,4],[4,0,8],[6,0,12],[8,0,16],[10,0,20],[12,0,24],[14,0,28],[16,0,32],[18,0,36],[20,0,40],[22,0,44],[24,0,48],[26,0,52],[28,0,56],[30,0,60],[32,0,64],[34,0,68],[36,0,72],[38,0,76],[40,0,80],[42,0,84],[44,0,88],[46,0,92],[48,0,96],[50,0,100],[52,0,104],[54,0,108],[56,0,112],[58,0,116],[60,0,120],[62,0,124],[64,0,128],[62,0,132],[60,0,136],[58,0,140],[56,0,144],[54,0,148],[52,0,152],[50,0,156],[48,0,160],[46,0,164],[44,0,168],[42,0,172],[40,0,176],[38,0,180],[36,0,184],[34,0,188],[32,0,192],[30,0,196],[28,0,200],[26,0,204],[24,0,208],[22,0,212],[20,0,216],[18,0,220],[16,0,224],[14,0,228],[12,0,232],[10,0,236],[8,0,240],[6,0,244],[4,0,248],[2,0,252],[0,0,255],[0,8,247],[0,16,239],[0,24,231],[0,32,223],[0,40,215],[0,48,207],[0,56,199],[0,64,191],[0,72,183],[0,80,175],[0,88,167],[0,96,159],[0,104,151],[0,112,143],[0,120,135],[0,128,127],[0,136,119],[0,144,111],[0,152,103],[0,160,95],[0,168,87],[0,176,79],[0,184,71],[0,192,63],[0,200,55],[0,208,47],[0,216,39],[0,224,31],[0,232,23],[0,240,15],[0,248,7],[0,255,0],[4,255,0],[8,255,0],[12,255,0],[16,255,0],[20,255,0],[24,255,0],[28,255,0],[32,255,0],[36,255,0],[40,255,0],[44,255,0],[48,255,0],[52,255,0],[56,255,0],[60,255,0],[64,255,0],[68,255,0],[72,255,0],[76,255,0],[80,255,0],[84,255,0],[88,255,0],[92,255,0],[96,255,0],[100,255,0],[104,255,0],[108,255,0],[112,255,0],[116,255,0],[120,255,0],[124,255,0],[128,255,0],[132,255,0],[136,255,0],[140,255,0],[144,255,0],[148,255,0],[152,255,0],[156,255,0],[160,255,0],[164,255,0],[168,255,0],[172,255,0],[176,255,0],[180,255,0],[184,255,0],[188,255,0],[192,255,0],[196,255,0],[200,255,0],[204,255,0],[208,255,0],[212,255,0],[216,255,0],[220,255,0],[224,255,0],[228,255,0],[232,255,0],[236,255,0],[240,255,0],[244,255,0],[248,255,0],[252,255,0],[255,255,0],[255,253,0],[255,251,0],[255,249,0],[255,247,0],[255,245,0],[255,243,0],[255,241,0],[255,239,0],[255,237,0],[255,235,0],[255,233,0],[255,231,0],[255,229,0],[255,227,0],[255,225,0],[255,223,0],[255,221,0],[255,219,0],[255,217,0],[255,215,0],[255,213,0],[255,211,0],[255,209,0],[255,207,0],[255,205,0],[255,203,0],[255,201,0],[255,199,0],[255,197,0],[255,195,0],[255,193,0],[255,192,0],[255,189,0],[255,186,0],[255,183,0],[255,180,0],[255,177,0],[255,174,0],[255,171,0],[255,168,0],[255,165,0],[255,162,0],[255,159,0],[255,156,0],[255,153,0],[255,150,0],[255,147,0],[255,144,0],[255,141,0],[255,138,0],[255,135,0],[255,132,0],[255,129,0],[255,126,0],[255,123,0],[255,120,0],[255,117,0],[255,114,0],[255,111,0],[255,108,0],[255,105,0],[255,102,0],[255,99,0],[255,96,0],[255,93,0],[255,90,0],[255,87,0],[255,84,0],[255,81,0],[255,78,0],[255,75,0],[255,72,0],[255,69,0],[255,66,0],[255,63,0],[255,60,0],[255,57,0],[255,54,0],[255,51,0],[255,48,0],[255,45,0],[255,42,0],[255,39,0],[255,36,0],[255,33,0],[255,30,0],[255,27,0],[255,24,0],[255,21,0],[255,18,0],[255,15,0],[255,12,0],[255,9,0],[255,6,0],[255,3,0]]};var LutRainbow5={name:"Rainbow5",bytes:[[0,0,0],[12,0,0],[25,0,0],[38,0,0],[51,0,0],[63,0,0],[76,0,0],[89,0,0],[102,0,0],[114,0,0],[127,0,0],[140,0,0],[153,0,0],[165,0,0],[178,0,0],[191,0,0],[204,0,0],[216,0,0],[229,0,0],[242,0,0],[255,0,0],[255,8,0],[255,15,0],[255,22,0],[255,30,0],[255,37,0],[255,44,0],[255,51,0],[255,59,0],[255,66,0],[255,73,0],[255,81,0],[255,88,0],[255,95,0],[255,102,0],[255,110,0],[255,117,0],[255,124,0],[255,132,0],[255,139,0],[255,146,0],[255,153,0],[255,161,0],[255,168,0],[255,175,0],[255,183,0],[255,190,0],[255,197,0],[255,204,0],[255,212,0],[255,219,0],[255,226,0],[255,234,0],[255,241,0],[255,248,0],[255,255,0],[251,255,0],[246,255,0],[242,255,0],[237,255,0],[232,255,0],[228,255,0],[223,255,0],[218,255,0],[214,255,0],[209,255,0],[204,255,0],[200,255,0],[195,255,0],[191,255,0],[186,255,0],[181,255,0],[177,255,0],[172,255,0],[167,255,0],[163,255,0],[158,255,0],[153,255,0],[149,255,0],[144,255,0],[140,255,0],[135,255,0],[130,255,0],[126,255,0],[121,255,0],[116,255,0],[112,255,0],[107,255,0],[102,255,0],[98,255,0],[93,255,0],[89,255,0],[84,255,0],[79,255,0],[75,255,0],[70,255,0],[65,255,0],[61,255,0],[56,255,0],[51,255,0],[47,255,0],[42,255,0],[38,255,0],[33,255,0],[28,255,0],[24,255,0],[19,255,0],[14,255,0],[10,255,0],[5,255,0],[0,255,0],[0,255,5],[0,255,10],[0,255,14],[0,255,19],[0,255,24],[0,255,28],[0,255,33],[0,255,38],[0,255,42],[0,255,47],[0,255,51],[0,255,56],[0,255,61],[0,255,65],[0,255,70],[0,255,75],[0,255,79],[0,255,84],[0,255,89],[0,255,93],[0,255,98],[0,255,102],[0,255,107],[0,255,112],[0,255,116],[0,255,121],[0,255,126],[0,255,130],[0,255,135],[0,255,140],[0,255,144],[0,255,149],[0,255,153],[0,255,158],[0,255,163],[0,255,167],[0,255,172],[0,255,177],[0,255,181],[0,255,186],[0,255,191],[0,255,195],[0,255,200],[0,255,204],[0,255,209],[0,255,214],[0,255,218],[0,255,223],[0,255,228],[0,255,232],[0,255,237],[0,255,242],[0,255,246],[0,255,251],[0,255,255],[0,251,255],[0,246,255],[0,242,255],[0,237,255],[0,232,255],[0,228,255],[0,223,255],[0,218,255],[0,214,255],[0,209,255],[0,204,255],[0,200,255],[0,195,255],[0,191,255],[0,186,255],[0,181,255],[0,177,255],[0,172,255],[0,167,255],[0,163,255],[0,158,255],[0,153,255],[0,149,255],[0,144,255],[0,140,255],[0,135,255],[0,130,255],[0,126,255],[0,121,255],[0,116,255],[0,112,255],[0,107,255],[0,102,255],[0,98,255],[0,93,255],[0,89,255],[0,84,255],[0,79,255],[0,75,255],[0,70,255],[0,65,255],[0,61,255],[0,56,255],[0,51,255],[0,47,255],[0,42,255],[0,38,255],[0,33,255],[0,28,255],[0,24,255],[0,19,255],[0,14,255],[0,10,255],[0,5,255],[0,0,255],[8,0,255],[17,0,255],[26,0,255],[35,0,255],[44,0,255],[53,0,255],[62,0,255],[71,0,255],[80,0,255],[89,0,255],[98,0,255],[107,0,255],[116,0,255],[125,0,255],[134,0,255],[143,0,255],[152,0,255],[161,0,255],[170,0,255],[179,0,255],[188,0,255],[197,0,255],[202,20,255],[206,40,255],[211,59,255],[215,79,255],[220,99,255],[224,118,255],[229,138,255],[233,157,255],[238,177,255],[242,197,255],[247,216,255],[251,236,255],[255,255,255]]};var LutRatio={name:"Ratio",bytes:[[0,0,255],[1,1,255],[3,3,255],[5,5,255],[7,7,255],[9,9,255],[11,11,255],[13,13,255],[15,15,255],[17,17,255],[19,19,255],[21,21,255],[23,23,255],[25,25,255],[27,27,255],[29,29,255],[31,31,255],[33,33,255],[35,35,255],[37,37,255],[39,39,255],[41,41,255],[43,43,255],[45,45,255],[47,47,255],[49,49,255],[51,51,255],[53,53,255],[55,55,255],[57,57,255],[59,59,255],[61,61,255],[63,63,255],[65,65,255],[67,67,255],[69,69,255],[71,71,255],[73,73,255],[75,75,255],[77,77,255],[79,79,255],[81,81,255],[83,83,255],[85,85,255],[87,87,255],[89,89,255],[91,91,255],[93,93,255],[95,95,255],[97,97,255],[99,99,255],[101,101,255],[103,103,255],[105,105,255],[107,107,255],[109,109,255],[111,111,255],[113,113,255],[115,115,255],[117,117,255],[119,119,255],[121,121,255],[123,123,255],[125,125,255],[127,127,255],[129,129,255],[131,131,255],[133,133,255],[135,135,255],[137,137,255],[139,139,255],[141,141,255],[143,143,255],[145,145,255],[147,147,255],[149,149,255],[151,151,255],[153,153,255],[155,155,255],[157,157,255],[159,159,255],[161,161,255],[163,163,255],[165,165,255],[167,167,255],[169,169,255],[171,171,255],[173,173,255],[175,175,255],[177,177,255],[179,179,255],[181,181,255],[183,183,255],[185,185,255],[187,187,255],[189,189,255],[191,191,255],[193,193,255],[195,195,255],[197,197,255],[199,199,255],[201,201,255],[203,203,255],[205,205,255],[207,207,255],[209,209,255],[211,211,255],[213,213,255],[215,215,255],[217,217,255],[219,219,255],[221,221,255],[223,223,255],[225,225,255],[227,227,255],[229,229,255],[231,231,255],[233,233,255],[235,235,255],[237,237,255],[239,239,255],[241,241,255],[243,243,255],[245,245,255],[247,247,255],[249,249,255],[251,251,255],[253,253,255],[255,254,254],[255,252,252],[255,250,250],[255,248,248],[255,246,246],[255,244,244],[255,242,242],[255,240,240],[255,238,238],[255,236,236],[255,234,234],[255,232,232],[255,230,230],[255,228,228],[255,226,226],[255,224,224],[255,222,222],[255,220,220],[255,218,218],[255,216,216],[255,214,214],[255,212,212],[255,210,210],[255,208,208],[255,206,206],[255,204,204],[255,202,202],[255,200,200],[255,198,198],[255,196,196],[255,194,194],[255,192,192],[255,190,190],[255,188,188],[255,186,186],[255,184,184],[255,182,182],[255,180,180],[255,178,178],[255,176,176],[255,174,174],[255,172,172],[255,170,170],[255,168,168],[255,166,166],[255,164,164],[255,162,162],[255,160,160],[255,158,158],[255,156,156],[255,154,154],[255,152,152],[255,150,150],[255,148,148],[255,146,146],[255,144,144],[255,142,142],[255,140,140],[255,138,138],[255,136,136],[255,134,134],[255,132,132],[255,130,130],[255,128,128],[255,126,126],[255,124,124],[255,122,122],[255,120,120],[255,118,118],[255,116,116],[255,114,114],[255,112,112],[255,110,110],[255,108,108],[255,106,106],[255,104,104],[255,102,102],[255,100,100],[255,98,98],[255,96,96],[255,94,94],[255,92,92],[255,90,90],[255,88,88],[255,86,86],[255,84,84],[255,82,82],[255,80,80],[255,78,78],[255,76,76],[255,74,74],[255,72,72],[255,70,70],[255,68,68],[255,66,66],[255,64,64],[255,62,62],[255,60,60],[255,58,58],[255,56,56],[255,54,54],[255,52,52],[255,50,50],[255,48,48],[255,46,46],[255,44,44],[255,42,42],[255,40,40],[255,38,38],[255,36,36],[255,34,34],[255,32,32],[255,30,30],[255,28,28],[255,26,26],[255,24,24],[255,22,22],[255,20,20],[255,18,18],[255,16,16],[255,14,14],[255,12,12],[255,10,10],[255,8,8],[255,6,6],[255,4,4],[255,2,2],[255,0,0]]};var LutSpectrum={name:"Spectrum",bytes:[[255,0,255],[250,0,255],[245,0,255],[240,0,255],[235,0,255],[230,0,255],[225,0,255],[220,0,255],[215,0,255],[210,0,255],[205,0,255],[200,0,255],[195,0,255],[190,0,255],[185,0,255],[180,0,255],[175,0,255],[170,0,255],[165,0,255],[160,0,255],[155,0,255],[150,0,255],[145,0,255],[140,0,255],[135,0,255],[130,0,255],[125,0,255],[120,0,255],[115,0,255],[110,0,255],[105,0,255],[100,0,255],[95,0,255],[90,0,255],[85,0,255],[80,0,255],[75,0,255],[70,0,255],[65,0,255],[60,0,255],[55,0,255],[50,0,255],[45,0,255],[40,0,255],[35,0,255],[30,0,255],[25,0,255],[20,0,255],[15,0,255],[10,0,255],[5,0,255],[0,0,255],[0,5,255],[0,10,255],[0,15,255],[0,20,255],[0,25,255],[0,30,255],[0,35,255],[0,40,255],[0,45,255],[0,50,255],[0,55,255],[0,60,255],[0,65,255],[0,70,255],[0,75,255],[0,80,255],[0,85,255],[0,90,255],[0,95,255],[0,100,255],[0,105,255],[0,110,255],[0,115,255],[0,120,255],[0,125,255],[0,130,255],[0,135,255],[0,140,255],[0,145,255],[0,150,255],[0,155,255],[0,160,255],[0,165,255],[0,170,255],[0,175,255],[0,180,255],[0,185,255],[0,190,255],[0,195,255],[0,200,255],[0,205,255],[0,210,255],[0,215,255],[0,220,255],[0,225,255],[0,230,255],[0,235,255],[0,240,255],[0,245,255],[0,251,255],[0,255,255],[0,255,250],[0,255,245],[0,255,240],[0,255,235],[0,255,230],[0,255,225],[0,255,220],[0,255,215],[0,255,210],[0,255,205],[0,255,200],[0,255,195],[0,255,190],[0,255,185],[0,255,180],[0,255,175],[0,255,170],[0,255,165],[0,255,160],[0,255,155],[0,255,150],[0,255,145],[0,255,140],[0,255,135],[0,255,130],[0,255,125],[0,255,120],[0,255,115],[0,255,110],[0,255,105],[0,255,100],[0,255,95],[0,255,90],[0,255,85],[0,255,80],[0,255,75],[0,255,70],[0,255,65],[0,255,60],[0,255,55],[0,255,50],[0,255,45],[0,255,40],[0,255,35],[0,255,30],[0,255,25],[0,255,20],[0,255,15],[0,255,10],[0,255,5],[0,255,0],[5,255,0],[10,255,0],[15,255,0],[20,255,0],[25,255,0],[30,255,0],[35,255,0],[40,255,0],[45,255,0],[50,255,0],[55,255,0],[60,255,0],[65,255,0],[70,255,0],[75,255,0],[80,255,0],[85,255,0],[90,255,0],[95,255,0],[100,255,0],[105,255,0],[110,255,0],[115,255,0],[120,255,0],[125,255,0],[130,255,0],[135,255,0],[140,255,0],[145,255,0],[150,255,0],[155,255,0],[160,255,0],[165,255,0],[170,255,0],[175,255,0],[180,255,0],[185,255,0],[190,255,0],[195,255,0],[200,255,0],[205,255,0],[210,255,0],[215,255,0],[220,255,0],[225,255,0],[230,255,0],[235,255,0],[240,255,0],[245,255,0],[250,255,0],[255,255,0],[255,250,0],[255,245,0],[255,240,0],[255,235,0],[255,230,0],[255,225,0],[255,220,0],[255,215,0],[255,210,0],[255,205,0],[255,200,0],[255,195,0],[255,190,0],[255,185,0],[255,180,0],[255,175,0],[255,170,0],[255,165,0],[255,160,0],[255,155,0],[255,150,0],[255,145,0],[255,140,0],[255,135,0],[255,130,0],[255,125,0],[255,120,0],[255,115,0],[255,110,0],[255,105,0],[255,100,0],[255,95,0],[255,90,0],[255,85,0],[255,80,0],[255,75,0],[255,70,0],[255,65,0],[255,60,0],[255,55,0],[255,50,0],[255,45,0],[255,40,0],[255,35,0],[255,30,0],[255,25,0],[255,20,0],[255,15,0],[255,10,0],[255,5,0],[255,0,0]]};var LutStern={name:"Stern",bytes:[[0,0,0],[18,1,1],[36,2,3],[54,3,5],[72,4,7],[90,5,9],[108,6,11],[127,7,13],[145,8,15],[163,9,17],[181,10,19],[199,11,21],[217,12,23],[235,13,25],[254,14,27],[249,15,29],[244,16,31],[239,17,33],[234,18,35],[229,19,37],[223,20,39],[218,21,41],[213,22,43],[208,23,45],[203,24,47],[197,25,49],[192,26,51],[187,27,53],[182,28,55],[177,29,57],[172,30,59],[166,31,61],[161,32,63],[156,33,65],[151,34,67],[146,35,69],[140,36,71],[135,37,73],[130,38,75],[125,39,77],[120,40,79],[115,41,81],[109,42,83],[104,43,85],[99,44,87],[94,45,89],[89,46,91],[83,47,93],[78,48,95],[73,49,97],[68,50,99],[63,51,101],[58,52,103],[52,53,105],[47,54,107],[42,55,109],[37,56,111],[32,57,113],[26,58,115],[21,59,117],[16,60,119],[11,61,121],[6,62,123],[0,63,125],[64,64,127],[65,65,129],[66,66,131],[67,67,133],[68,68,135],[69,69,137],[70,70,139],[71,71,141],[72,72,143],[73,73,145],[74,74,147],[75,75,149],[76,76,151],[77,77,153],[78,78,155],[79,79,157],[80,80,159],[81,81,161],[82,82,163],[83,83,165],[84,84,167],[85,85,169],[86,86,171],[87,87,173],[88,88,175],[89,89,177],[90,90,179],[91,91,181],[92,92,183],[93,93,185],[94,94,187],[95,95,189],[96,96,191],[97,97,193],[98,98,195],[99,99,197],[100,100,199],[101,101,201],[102,102,203],[103,103,205],[104,104,207],[105,105,209],[106,106,211],[107,107,213],[108,108,215],[109,109,217],[110,110,219],[111,111,221],[112,112,223],[113,113,225],[114,114,227],[115,115,229],[116,116,231],[117,117,233],[118,118,235],[119,119,237],[120,120,239],[121,121,241],[122,122,243],[123,123,245],[124,124,247],[125,125,249],[126,126,251],[127,127,253],[128,128,255],[129,129,251],[130,130,247],[131,131,243],[132,132,238],[133,133,234],[134,134,230],[135,135,226],[136,136,221],[137,137,217],[138,138,213],[139,139,209],[140,140,204],[141,141,200],[142,142,196],[143,143,192],[144,144,187],[145,145,183],[146,146,179],[147,147,175],[148,148,170],[149,149,166],[150,150,162],[151,151,158],[152,152,153],[153,153,149],[154,154,145],[155,155,141],[156,156,136],[157,157,132],[158,158,128],[159,159,124],[160,160,119],[161,161,115],[162,162,111],[163,163,107],[164,164,102],[165,165,98],[166,166,94],[167,167,90],[168,168,85],[169,169,81],[170,170,77],[171,171,73],[172,172,68],[173,173,64],[174,174,60],[175,175,56],[176,176,51],[177,177,47],[178,178,43],[179,179,39],[180,180,34],[181,181,30],[182,182,26],[183,183,22],[184,184,17],[185,185,13],[186,186,9],[187,187,5],[188,188,0],[189,189,3],[190,190,7],[191,191,11],[192,192,15],[193,193,19],[194,194,22],[195,195,26],[196,196,30],[197,197,34],[198,198,38],[199,199,41],[200,200,45],[201,201,49],[202,202,53],[203,203,57],[204,204,60],[205,205,64],[206,206,68],[207,207,72],[208,208,76],[209,209,79],[210,210,83],[211,211,87],[212,212,91],[213,213,95],[214,214,98],[215,215,102],[216,216,106],[217,217,110],[218,218,114],[219,219,117],[220,220,121],[221,221,125],[222,222,129],[223,223,133],[224,224,137],[225,225,140],[226,226,144],[227,227,148],[228,228,152],[229,229,156],[230,230,159],[231,231,163],[232,232,167],[233,233,171],[234,234,175],[235,235,178],[236,236,182],[237,237,186],[238,238,190],[239,239,194],[240,240,197],[241,241,201],[242,242,205],[243,243,209],[244,244,213],[245,245,216],[246,246,220],[247,247,224],[248,248,228],[249,249,232],[250,250,235],[251,251,239],[252,252,243],[253,253,247],[254,254,251],[255,255,255]]};var LutUcla={name:"Ucla",bytes:[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[85,0,102],[85,0,102],[85,0,102],[85,0,102],[119,0,136],[119,0,136],[119,0,136],[119,0,136],[119,0,136],[119,0,136],[119,0,136],[119,0,136],[136,0,136],[136,0,136],[136,0,136],[136,0,136],[136,0,153],[136,0,153],[136,0,153],[136,0,153],[136,0,153],[136,0,153],[136,0,153],[136,0,153],[102,0,153],[102,0,153],[102,0,153],[102,0,153],[68,0,153],[68,0,153],[68,0,153],[68,0,153],[68,0,153],[68,0,153],[68,0,153],[68,0,153],[0,0,170],[0,0,170],[0,0,170],[0,0,170],[0,0,187],[0,0,187],[0,0,187],[0,0,187],[0,0,204],[0,0,204],[0,0,204],[0,0,204],[0,0,204],[0,0,204],[0,0,204],[0,0,204],[0,0,221],[0,0,221],[0,0,221],[0,0,221],[0,51,221],[0,51,221],[0,51,221],[0,51,221],[0,51,221],[0,51,221],[0,51,221],[0,51,221],[0,85,221],[0,85,221],[0,85,221],[0,85,221],[0,119,221],[0,119,221],[0,119,221],[0,119,221],[0,119,221],[0,119,221],[0,119,221],[0,119,221],[0,136,221],[0,136,221],[0,136,221],[0,136,221],[0,153,221],[0,153,221],[0,153,221],[0,153,221],[0,153,187],[0,153,187],[0,153,187],[0,153,187],[0,153,187],[0,153,187],[0,153,187],[0,153,187],[0,170,170],[0,170,170],[0,170,170],[0,170,170],[0,170,153],[0,170,153],[0,170,153],[0,170,153],[0,170,153],[0,170,153],[0,170,153],[0,170,153],[0,170,136],[0,170,136],[0,170,136],[0,170,136],[0,170,119],[0,170,119],[0,170,119],[0,170,119],[0,170,119],[0,170,119],[0,170,119],[0,170,119],[0,170,85],[0,170,85],[0,170,85],[0,170,85],[0,170,71],[0,170,71],[0,170,71],[0,170,71],[0,185,0],[0,185,0],[0,185,0],[0,185,0],[0,185,0],[0,185,0],[0,185,0],[0,185,0],[0,204,0],[0,204,0],[0,204,0],[0,204,0],[0,221,0],[0,221,0],[0,221,0],[0,221,0],[0,221,0],[0,221,0],[0,221,0],[0,221,0],[0,238,0],[0,238,0],[0,238,0],[0,238,0],[0,255,0],[0,255,0],[0,255,0],[0,255,0],[0,255,0],[0,255,0],[0,255,0],[0,255,0],[102,255,0],[102,255,0],[102,255,0],[102,255,0],[187,255,0],[187,255,0],[187,255,0],[187,255,0],[204,238,0],[204,238,0],[204,238,0],[204,238,0],[204,238,0],[204,238,0],[204,238,0],[204,238,0],[238,221,0],[238,221,0],[238,221,0],[238,221,0],[238,204,0],[238,204,0],[238,204,0],[238,204,0],[238,204,0],[238,204,0],[238,204,0],[238,204,0],[255,187,0],[255,187,0],[255,187,0],[255,187,0],[255,170,0],[255,170,0],[255,170,0],[255,170,0],[255,170,0],[255,170,0],[255,170,0],[255,170,0],[255,153,0],[255,153,0],[255,153,0],[255,153,0],[255,119,0],[255,119,0],[255,119,0],[255,119,0],[255,85,0],[255,85,0],[255,85,0],[255,85,0],[255,85,0],[255,85,0],[255,85,0],[255,85,0],[255,51,0],[255,51,0],[255,51,0],[255,51,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[238,0,0],[238,0,0],[238,0,0],[238,0,0],[221,0,0],[221,0,0],[221,0,0],[221,0,0],[221,0,0],[221,0,0],[221,0,0],[221,0,0],[204,0,0],[204,0,0],[204,0,0],[204,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0]]};var LutVRBones={name:"VRBones",bytes:[[0,0,0],[1,1,0],[3,2,0],[5,3,0],[7,4,1],[8,6,1],[10,7,1],[12,8,2],[14,9,2],[15,11,2],[17,12,2],[19,13,3],[21,14,3],[22,16,3],[24,17,4],[26,18,4],[28,19,4],[29,20,4],[31,22,5],[33,23,5],[35,24,5],[37,25,6],[38,27,6],[40,28,6],[42,29,6],[44,30,7],[45,32,7],[47,33,7],[49,34,8],[51,35,8],[52,37,8],[54,38,9],[56,39,9],[58,40,9],[59,41,9],[61,43,10],[63,44,10],[65,45,10],[67,46,11],[68,48,11],[70,49,11],[72,50,11],[74,51,12],[75,53,12],[77,54,12],[79,55,13],[81,56,13],[82,57,13],[84,59,13],[86,60,14],[88,61,14],[89,62,14],[91,64,15],[93,65,15],[95,66,15],[96,67,16],[98,69,16],[100,70,16],[102,71,16],[104,72,17],[105,74,17],[107,75,17],[109,76,18],[111,77,18],[112,78,18],[114,80,18],[116,81,19],[118,82,19],[119,83,19],[121,85,20],[123,86,20],[125,87,20],[126,88,20],[128,90,21],[130,91,21],[132,92,21],[134,93,22],[135,94,22],[137,96,22],[139,97,23],[141,98,23],[142,99,23],[144,101,23],[146,102,24],[148,103,24],[149,104,24],[151,106,25],[153,107,25],[155,108,25],[156,109,25],[158,111,26],[160,112,26],[162,113,26],[164,114,27],[165,115,27],[167,117,27],[169,118,27],[171,119,28],[172,120,28],[174,122,28],[176,123,29],[178,124,29],[179,125,29],[181,127,29],[183,128,30],[185,129,30],[186,130,30],[188,131,31],[190,133,31],[192,134,31],[193,135,32],[195,136,32],[197,138,32],[199,139,32],[201,140,33],[202,141,33],[204,143,33],[206,144,34],[208,145,34],[209,146,34],[211,148,34],[213,149,35],[215,150,35],[216,151,35],[217,152,36],[217,153,36],[218,153,36],[218,154,36],[219,154,36],[219,155,37],[220,156,37],[220,156,37],[221,157,37],[221,158,37],[222,158,38],[222,159,38],[223,160,38],[223,160,38],[224,161,39],[224,162,39],[225,162,39],[225,163,39],[226,164,39],[226,164,40],[227,165,40],[227,166,40],[228,166,40],[228,167,40],[229,168,41],[229,168,41],[230,169,41],[230,170,41],[231,170,42],[231,171,42],[232,172,42],[232,172,42],[233,173,42],[233,174,43],[234,174,43],[234,175,43],[235,175,43],[235,176,44],[236,177,44],[236,177,44],[237,178,44],[237,179,44],[238,179,45],[238,180,45],[239,181,45],[239,181,45],[240,182,45],[240,183,46],[241,183,46],[241,184,46],[242,185,46],[242,185,47],[243,186,47],[243,187,47],[244,187,47],[244,188,47],[245,189,48],[245,189,48],[246,190,48],[246,191,48],[247,191,48],[247,192,49],[248,193,49],[248,193,49],[249,194,49],[249,195,50],[250,195,50],[250,196,50],[251,196,50],[251,197,50],[252,198,51],[252,198,51],[253,199,51],[253,200,51],[254,200,51],[254,201,52],[255,202,52],[255,203,52],[255,204,53],[255,205,53],[255,206,53],[255,207,54],[255,208,54],[255,209,54],[255,210,55],[255,211,55],[255,213,55],[255,214,56],[255,215,56],[255,216,56],[255,217,56],[255,218,57],[255,219,57],[255,220,57],[255,221,58],[255,222,58],[255,223,58],[255,224,59],[255,226,59],[255,227,59],[255,228,60],[255,229,60],[255,230,60],[255,231,61],[255,232,61],[255,233,61],[255,234,62],[255,235,62],[255,236,62],[255,237,63],[255,239,63],[255,240,63],[255,241,64],[255,242,64],[255,243,64],[255,244,65],[255,245,65],[255,246,65],[255,247,66],[255,248,66],[255,249,66],[255,250,67],[255,251,84],[255,251,101],[255,252,118],[255,252,135],[255,252,152],[255,253,169],[255,253,186],[255,253,203],[255,254,220],[255,254,237]]};var LutVRMusclesBones={name:"VRMuscles-Bones",bytes:[[0,0,0],[2,0,0],[5,0,0],[8,0,0],[10,0,1],[13,1,1],[16,1,1],[18,1,2],[21,1,2],[24,2,2],[26,2,2],[29,2,3],[32,2,3],[34,3,3],[37,3,4],[40,3,4],[42,3,4],[45,3,5],[48,4,5],[51,4,5],[53,4,5],[56,4,6],[59,5,6],[61,5,6],[64,5,7],[67,5,7],[69,6,7],[72,6,7],[75,6,8],[77,6,8],[80,6,8],[83,7,9],[85,7,9],[88,7,9],[91,7,10],[93,8,10],[96,8,10],[99,8,10],[102,8,11],[104,9,11],[107,9,11],[110,9,12],[112,9,12],[115,9,12],[118,10,12],[120,10,13],[123,10,13],[126,10,13],[128,11,14],[131,11,14],[134,11,14],[136,11,15],[139,12,15],[142,12,15],[144,12,15],[147,12,16],[150,12,16],[153,13,16],[155,13,17],[158,13,17],[161,13,17],[163,14,17],[166,14,18],[169,14,18],[171,14,18],[174,15,19],[177,15,19],[179,15,19],[182,15,20],[185,15,20],[187,16,20],[190,16,20],[193,16,21],[195,16,21],[198,17,21],[201,17,22],[204,17,22],[206,17,22],[209,18,22],[212,18,23],[214,18,23],[217,18,23],[220,18,24],[222,19,24],[225,19,24],[228,19,25],[230,19,25],[233,20,25],[236,20,25],[238,20,26],[241,20,26],[244,21,26],[246,21,27],[249,21,27],[252,21,27],[255,21,27],[255,24,27],[255,27,27],[255,30,26],[255,33,26],[255,36,26],[255,39,25],[255,42,25],[255,45,25],[255,48,24],[255,51,24],[255,54,24],[255,57,23],[255,60,23],[255,63,22],[255,66,22],[255,69,22],[255,72,21],[255,75,21],[255,78,21],[255,81,20],[255,84,20],[255,87,20],[255,90,19],[255,93,19],[255,96,19],[255,99,18],[255,102,18],[255,105,18],[255,108,17],[255,111,17],[255,114,16],[255,117,16],[255,120,16],[255,123,15],[255,126,15],[255,129,15],[255,131,14],[255,134,14],[255,137,14],[255,140,13],[255,143,13],[255,146,13],[255,149,12],[255,152,12],[255,155,11],[255,158,11],[255,161,11],[255,164,10],[255,167,10],[255,170,10],[255,173,9],[255,176,9],[255,177,10],[255,179,10],[255,180,11],[255,181,11],[255,182,12],[255,183,12],[255,185,13],[255,186,13],[255,187,14],[255,188,15],[255,189,15],[255,191,16],[255,192,16],[255,193,17],[255,194,17],[255,195,18],[255,197,18],[255,198,19],[255,199,19],[255,200,20],[255,201,21],[255,203,21],[255,204,22],[255,205,22],[255,206,23],[255,207,23],[255,209,24],[255,210,24],[255,211,25],[255,212,26],[255,213,26],[255,215,27],[255,216,27],[255,217,28],[255,218,28],[255,220,29],[255,221,29],[255,222,30],[255,223,31],[255,224,31],[255,226,32],[255,227,32],[255,228,33],[255,229,33],[255,230,34],[255,232,34],[255,233,35],[255,234,36],[255,235,36],[255,236,37],[255,238,37],[255,239,38],[255,240,38],[255,241,39],[255,241,43],[255,242,47],[255,242,51],[255,242,55],[255,242,58],[255,243,62],[255,243,66],[255,243,70],[255,243,74],[255,244,78],[255,244,82],[255,244,86],[255,244,90],[255,245,94],[255,245,98],[255,245,102],[255,245,105],[255,246,109],[255,246,113],[255,246,117],[255,246,121],[255,247,125],[255,247,129],[255,247,133],[255,247,137],[255,248,141],[255,248,145],[255,248,149],[255,248,153],[255,248,156],[255,249,160],[255,249,164],[255,249,168],[255,249,172],[255,250,176],[255,250,180],[255,250,184],[255,250,188],[255,251,192],[255,251,196],[255,251,200],[255,251,204],[255,252,207],[255,252,211],[255,252,215],[255,252,219],[255,253,223],[255,253,227],[255,253,231],[255,253,235],[255,254,239],[255,254,243],[255,254,247],[255,254,251]]};var LutVRRedVessels={name:"VRRedVessels",bytes:[[0,0,0],[1,0,0],[2,0,0],[3,0,0],[5,0,0],[6,0,0],[7,0,0],[9,0,0],[10,0,0],[11,0,0],[12,0,0],[14,0,0],[15,0,0],[16,0,0],[18,0,0],[19,0,0],[20,0,0],[21,0,0],[23,0,0],[24,0,0],[25,0,0],[27,0,0],[28,0,0],[29,0,0],[30,0,0],[32,0,0],[33,0,0],[34,0,0],[36,0,0],[37,0,0],[38,0,0],[39,0,0],[41,0,0],[42,0,0],[43,0,0],[45,0,0],[46,0,0],[47,0,0],[49,0,0],[50,0,0],[51,0,0],[52,0,0],[54,0,0],[55,0,0],[56,0,0],[58,0,0],[59,0,0],[60,0,0],[61,0,0],[63,0,0],[64,0,0],[65,0,0],[67,0,0],[68,0,0],[69,0,0],[70,0,0],[72,0,0],[73,0,0],[74,0,0],[76,0,0],[77,0,0],[78,0,0],[79,0,0],[81,0,0],[82,0,0],[83,0,0],[85,0,0],[86,0,0],[87,0,0],[88,0,0],[90,0,0],[91,0,0],[92,0,0],[94,0,0],[95,0,0],[96,0,0],[98,0,0],[99,0,0],[100,0,0],[101,0,0],[103,0,0],[104,0,0],[105,0,0],[107,0,0],[108,0,0],[109,0,0],[110,0,0],[112,0,0],[113,0,0],[114,0,0],[116,0,0],[117,0,0],[118,0,0],[119,0,0],[121,0,0],[122,0,0],[123,0,0],[125,0,0],[126,0,0],[127,0,0],[128,0,0],[130,0,0],[131,0,0],[132,0,0],[134,0,0],[135,0,0],[136,0,0],[137,0,0],[139,0,0],[140,0,0],[141,0,0],[143,0,0],[144,0,0],[145,0,0],[147,0,0],[148,0,0],[149,0,0],[150,0,0],[152,0,0],[153,0,0],[154,0,0],[156,0,0],[157,0,0],[158,0,0],[159,0,0],[161,0,0],[162,0,0],[163,0,0],[165,0,0],[166,0,0],[167,0,0],[168,0,0],[170,0,0],[171,0,0],[172,0,0],[174,0,0],[175,0,0],[176,0,0],[177,0,0],[179,0,0],[180,0,0],[181,0,0],[183,0,0],[184,0,0],[185,0,0],[186,0,0],[188,0,0],[189,0,0],[190,0,0],[192,0,0],[193,0,0],[194,0,0],[196,0,0],[197,0,0],[198,1,1],[199,3,2],[200,5,3],[201,6,4],[202,8,5],[203,10,6],[204,11,7],[206,13,8],[207,15,9],[208,16,10],[209,18,11],[210,20,12],[211,21,13],[212,23,14],[213,25,15],[214,26,16],[215,28,17],[216,30,18],[217,32,19],[219,33,20],[220,35,21],[221,37,22],[222,38,23],[223,40,24],[224,42,25],[225,43,26],[226,45,27],[227,47,28],[228,48,29],[229,50,30],[231,52,31],[232,53,32],[233,55,33],[234,57,34],[235,59,35],[236,60,36],[237,62,37],[238,64,38],[239,65,39],[240,67,40],[241,69,41],[243,70,42],[244,72,43],[245,74,44],[246,75,45],[247,77,46],[248,79,47],[249,80,48],[250,82,49],[251,84,50],[252,86,51],[253,87,52],[255,89,53],[255,91,55],[255,93,57],[255,95,59],[255,97,61],[255,99,64],[255,101,66],[255,103,68],[255,105,70],[255,107,72],[255,109,75],[255,111,77],[255,113,79],[255,115,81],[255,117,84],[255,119,86],[255,121,88],[255,124,90],[255,126,92],[255,128,95],[255,130,97],[255,132,99],[255,134,101],[255,136,103],[255,138,106],[255,140,108],[255,142,110],[255,144,112],[255,146,114],[255,148,117],[255,150,119],[255,152,121],[255,154,123],[255,156,126],[255,158,128],[255,164,136],[255,170,144],[255,176,152],[255,182,159],[255,188,167],[255,194,175],[255,200,183],[255,206,191],[255,212,199],[255,218,207],[255,224,215],[255,230,223],[255,236,231],[255,242,239],[255,248,247]]};PACS.Luts=[LutCardiac,LutFire,LutFlow,LutGEColor,LutGrayRainbow,LutHotGreen,LutHotIron,LutHotMetal,LutHue1,LutHue2,LutIce,LutIred,LutNIH,LutRainbow1,LutRainbow2,LutRainbow3,LutRainbow4,LutRainbow5,LutRatio,LutSpectrum,LutStern,LutUcla,LutVRBones,LutVRMusclesBones,LutVRRedVessels];PACS.CreateDefaultLut=function(){var a=new Array(256);for(var b=0;b<256;b++){a[b]=[b,b,b]}var c={name:"default",bytes:a};return c};var AXIS_X=1;var AXIS_Y=2;var AXIS_Z=3;PACS.MPR=function(a){if(!this instanceof PACS.MPR){return new PACS.MPR()}this.seriesZ=a;a.mpr=this;a.mprAxis=AXIS_Z;seriesX=new PACS.Series();seriesX.mpr=this;seriesX.mprAxis=AXIS_X;seriesX.copyBasic(a);seriesX.SeriesDescription+="[MPR]";seriesX.mprAxisZ=a;this.seriesX=seriesX;seriesY=new PACS.Series();seriesY.mpr=this;seriesY.mprAxis=AXIS_Y;seriesY.copyBasic(a);seriesY.SeriesDescription+="[MPR]";seriesY.mprAxisZ=a;this.seriesY=seriesY;this.x=this.y=this.z=0};PACS.MPRCheck=function(b){var a=b.images;if(!a.length){return"No images for MPR!"}if(a[a.length-1].loadState!=2){return"Not all images are loaded!"}var c=a[0];if(c.Modality!="CT"){return"Not CT images"}return true};PACS.MPR.prototype.destroy=function(){this.onEvent("de");this.seriesX.destroy();this.seriesY.destroy();delete this.seriesX;delete this.seriesY;delete this.seriesZ.mpr;delete this.seriesZ.mprAxis;this.seriesZ=null};PACS.MPR.prototype.initAxis=function(c,b,a){this.sizeX=c;this.sizeY=b;this.sizeZ=a;this.z=0;this.x=0;this.y=0};PACS.MPR.prototype.getX=function(){return this.x};PACS.MPR.prototype.getY=function(){return this.y};PACS.MPR.prototype.getZ=function(){return this.z};PACS.MPR.prototype.onLoadDone=function(){this.x=parseInt(this.sizeX/2);this.y=parseInt(this.sizeY/2);this.z=parseInt(this.sizeZ/2);this.onEvent("cpi",this.x,this.y,this.z)};PACS.MPR.prototype.onEvent=function(a,d,c,b){this.lastEvent=a;this.seriesZ.onMprEvent(a,d,c,b);this.seriesX.onMprEvent(a,d,c,b);this.seriesY.onMprEvent(a,d,c,b)};PACS.MPR.prototype.getLastEvent=function(){return this.lastEvent};PACS.MPR.prototype.setAxisIdx=function(b,a,c){if(b==AXIS_Z){this.z=a}else{if(b==AXIS_X){this.x=a}else{if(b==AXIS_Y){this.y=a}}}if(c){this.onEvent(b,a)}};PACS.MPR.prototype.setAxises=function(a,c,b){this.x=a;this.y=c;this.z=b;this.onEvent("cp",a,c,b)};PACS.MPR.prototype.createImages=function(d){var c=this.seriesZ;var h=this.seriesX;var f=this.seriesY;var q=c.images;var b=q.length;if(!b){d(false);return false}var u=q[0];var g=u.width;var e=u.height;this.initAxis(g,e,b);var l,k,j,m,o,v,s,a;var n=parseFloat(u.SliceThickness);var i=q[0].getPixelSpacing(q[1]);var p=Math.abs(i.spacing);var r=i.vectorDis;h.images=new Array(g);for(l=0;l<g;l++){o=new PACS.Image();o.copyBasic(u);o.dataSet={};o.InstanceNumber=l+1;o.Rows=o.height=b;o.Columns=o.width=e;o.ContrastBolusAgent+="[MPR]";o.SliceThickness=u.columnPixelSpacing;o.SliceLocation=l*n;o.columnPixelSpacing=u.rowPixelSpacing;o.rowPixelSpacing=p;s=new Int16Array(b*e);for(j=0;j<b;j++){v=q[j];a=v.data;for(k=0;k<e;k++){s[j*e+k]=v.data[k*g+l]}}o.data=s;o.mprInit(u,true,l,r);h.images[l]=o;h.onImageloaded(l,o);h.loadIdx=l+1}f.images=new Array(e);for(k=0;k<e;k++){o=new PACS.Image();o.copyBasic(u);o.dataSet={};o.InstanceNumber=k+1;o.Rows=o.height=b;o.Columns=o.width=g;o.ContrastBolusAgent+="[MPR]";o.SliceThickness=u.rowPixelSpacing;o.SliceLocation=k*n;o.columnPixelSpacing=u.columnPixelSpacing;o.rowPixelSpacing=p;s=new Int16Array(b*g);for(j=0;j<b;j++){v=q[j];a=v.data;for(l=0;l<g;l++){s[j*g+l]=v.data[k*g+l]}}o.data=s;o.mprInit(u,false,k,r);f.images[k]=o;f.onImageloaded(k,o);f.loadIdx=k+1}this.onLoadDone();d(true);return true};PACS.Series=function(){if(!this instanceof PACS.Series){return new PACS.Series()}this.views=[]};PACS.Series.prototype.addView=function(a){this.views[this.views.length]=a};PACS.Series.prototype.removeView=function(a){removeObject(this.views,a)};PACS.Series.prototype.onImageloaded=function(c,e){var a=this.views.length;for(var d=0;d<a;d++){var b=this.views[d];if(b&&b.onImageLoaded){b.onImageLoaded(this,c,e)}}};PACS.Series.prototype.drawThumb=function(a){if(!this.images||!this.images.length){return}var b=this.images[this.images.length/2];b.drawThumb(a)};PACS.Series.prototype.copyBasic=function(a){this.InstitutionName=a.InstitutionName;this.SeriesDescription=a.SeriesDescription;this.SeriesNumber=a.SeriesNumber};PACS.Series.prototype.onMprEvent=function(d,g,f,e){var a=this.views.length;for(var c=a-1;c>=0;c--){var b=this.views[c];if(b&&b.onMprEvent){b.onMprEvent(d,g,f,e)}}};PACS.Series.prototype.getMprImgIdx=function(){if(this.mpr){if(this.mprAxis==AXIS_Z){return this.mpr.getZ()}else{if(this.mprAxis==AXIS_X){return this.mpr.getX()}else{if(this.mprAxis==AXIS_Y){return this.mpr.getY()}}}}return 0};PACS.Series.prototype.setImgIdx=function(a,b){if(this.mpr){this.mpr.setAxisIdx(this.mprAxis,a,b)}};PACS.Series.prototype.getImgIdx=function(){if(this.mpr){if(this.mprAxis==AXIS_Z){return this.mpr.getZ()}else{if(this.mprAxis==AXIS_X){return this.mpr.getX()}else{if(this.mprAxis==AXIS_Y){return this.mpr.getY()}}}}return 0};PACS.Series.prototype.setImgPoint=function(d,c){if(this.mpr){if(this.mprAxis==AXIS_Z){this.mpr.setAxises(d,c,this.mpr.getZ())}else{if(this.mprAxis==AXIS_X){this.mpr.setAxises(this.mpr.getX(),d,c)}else{if(this.mprAxis==AXIS_Y){this.mpr.setAxises(d,this.mpr.getY(),c)}}}}};PACS.Series.prototype.getImgPoint=function(){if(this.mpr){if(this.mprAxis==AXIS_Z){return[this.mpr.getX(),this.mpr.getY()]}else{if(this.mprAxis==AXIS_X){return[this.mpr.getY(),this.mpr.getZ()]}else{if(this.mprAxis==AXIS_Y){return[this.mpr.getX(),this.mpr.getZ()]}}}}return null};PACS.Series.prototype.isMprMode=function(){return !!this.mpr};PACS.Series.prototype.destroy=function(){delete this.images;delete this.mprAxis;if(this.destroyCallback){this.destroyCallback()}};PACS.Series.prototype.setDestroyCallback=function(a){this.destroyCallback=a};PACS.Series.prototype.isVrMode=function(){return !!this.vr};PACS.Series.prototype.isSubMprSeries=function(a){return(this.mprAxisZ&&this.mprAxisZ==a)};function extendPacsSeries(b){var a=new PACS.Series();$.extend(b,a);return a};var LayoutTool={L_3_1:301,L_3_2:302,L_3_3:303,L_3_4:304};var ActionTool={NONE:0,SCOLL:1,ZOOM:2,MOVE:3,WL:4,CT:5,MPR:6,VR:7,MAGR:8};var MeterTool={LINE:11,ANGLE:12,COBB_ANGLE:13};var SelectTool={RECT:21,CIRCLE:22,POLYGON:23};var MarkTool={ARROW:31,TEXT:32,CIRCLE:33,RECT:34,FOLD_LINE:35,PENCIL:36};var RotateTool={H:41,V:42,CW:43,CCW:44};var ResetTool={ALL:51,ORIGINAL_SIZE:52,AUTO_SIZE:53,CT_WL:54,LUT:55,FILTER:56,MARK_TEST:57,ROTATE:58,MPR:59,VR:60};var OtherTool={INVERT:61,LINK:62,LOCATE:63};var pacsOprMenus={edit:{name:"Edit",icon:"edit"},cut:{name:"Cut",icon:"cut"},copy:{name:"Copy",icon:"copy"},paste:{name:"Paste",icon:"paste"},"delete":{name:"Delete",icon:"delete"},sep1:"---------",quit:{name:"Quit",icon:"paste"}};PACS.Tool=function(){if(!this instanceof PACS.Tool){return new PACS.Tool()}this.tool=ActionTool.SCOLL;this.linked=false;this.locate=false;this.showInfo=true;this.showRuler=true;this.MPR=false};function scaleto(a,c,b,e){if(a/c>b/e){rw=b;rh=parseInt(e*b/a)}else{rw=parseInt(b*e/c);rh=e}return{w:rw,h:rh}}function getScale(a,c,b,e){if(a/c>b/e){return b/a}else{return e/c}}function deleteItem(e,b){if(!e||b<0||b>e.length){return}var a=e[b];for(var c=b;c<e.length-1;c++){e[c]=e[c+1]}e.length=e.length-1;return a}function calcScale(l,f){var k=l.width;var g=l.height;var a=f.width;var i=f.height;var m=getScale(k,g,a,i);var e=parseInt(m*k);var j=parseInt(m*g);var c,b;c=(a-e)/2;b=(i-j)/2;return{ox:c,oy:b,sw:k,sh:g,dw:a,dh:i,scale:m}}function calcScale2(j,f,a,g){var k=getScale(j,f,a,g);var c=parseInt(k*j);var i=parseInt(k*f);var e,b;e=parseInt((a-c)/2);b=parseInt((g-i)/2);return{ox:e,oy:b,scale:k}}function initCanvas(b){var e=$(b);var a=$(b).width();var c=$(b).height();b.width=a;b.height=c}function clearContext(b,a,c){b.fillStyle="#000";b.fillRect(0,0,a,c)}function setCanvasSize(c,a,b){var c=$(canvas);var a=$(canvas).width();var b=$(canvas).height()}function removeByIdx(c,a){if(a>=c.length){return}for(var b=a;b<c.length;b++){c[b]=c[b+1]}c.length=c.length-1}function removeObject(f,c){for(var e=0;e<f.length;e++){var a=f[e];if(a==c){for(var b=e;b<f.length;b++){f[b]=f[b+1]}this.length=this.length-1}}}function scaleImageData(b,a,h){var i=b.createImageData(a.width*h,a.height*h);var f=b.createImageData(h,1).data;for(var m=0;m<a.height;m++){for(var g=0;g<a.width;g++){var c=a.data.subarray((m*a.width+g)*4,(m*a.width+g)*4+4);for(var k=0;k<h;k++){f.set(c,k*4)}for(var j=0;j<h;j++){var l=m*h+j;var e=g*h;i.data.set(f,(l*i.width+e)*4)}}}return i}function getSplit(e,b,a){var c=e.split(b);if(a>=0&&a<c.length){return c[a]}return""}function getSplitR(e,b,a){var c=e.split(b);if(a>=0&&a<c.length){return c[c.length-1-a]}return""}function getProperSpan(a){var b;var f=a;var e=0;var c=0;if(f<=0){return 0}while(f<0){f=f*10;e--;if(e<-5){return 0}}while(f>0){b=f/10;if(parseInt(b)==0){b=parseInt(f%10);switch(b){case 9:case 8:case 7:case 6:case 5:c=5;break;case 4:case 3:case 2:c=2;break;case 1:c=1;break;case 0:default:c=0;break}break}else{f=b;e++}}if(!c){return 0}while(0!=e){if(e>0){e--;c*=10}else{e++;c/=10}}return c}var _pacsTempCanvas=null;function getTempCanvas(){if(!_pacsTempCanvas){_pacsTempCanvas=document.createElement("canvas")}return _pacsTempCanvas}function getDefaultWL(){return{window:400,level:40}}function distance(e,g,c,f){var b=(e-c);var a=(g-f);return Math.sqrt(b*b+a*a)}function drawEllipse(h,e,l,g,c){var j=0.5522848,i=g*j,f=c*j;h.moveTo(e-g,l);h.bezierCurveTo(e-g,l-f,e-i,l-c,e,l-c);h.bezierCurveTo(e+i,l-c,e+g,l-f,e+g,l);h.bezierCurveTo(e+g,l+f,e+i,l+c,e,l+c);h.bezierCurveTo(e-i,l+c,e-g,l+f,e-g,l)}function calcAngle(f,h,e,g){var c=e-f;var a=h-g;var b=a/Math.sqrt(c*c+a*a);var i=Math.abs(Math.asin(b));i=i/Math.PI*180;if(c>=0){if(a<0){i=360-i}}else{if(a<0){i=180+i}else{i=180-i}}return i}function centerDrawInfo(g,a,e,b,f){var c=g.scale;g.ox=a/2-b*c/2;g.oy=e/2-f*c/2}function adjustDrawInfo(o,c,q,k,b,h){try{var p=k/c;var j=b/q;var g=h.width;var r=h.height;var n=k/g;var m=k/r;var a=o.scale;var t=t;var i=o.ox+g*t/2;var f=o.oy+r*t/2;i*=p;f*=j;p*=t;j*=t;if(p>n){d("too width");if(k>=c){p=Math.Max(n,t)}}if(j>m){d("too height");if(b>=q){j=Math.Max(m,t)}}t=Math.min(p,j);if(t<0.01){t=0.01}else{if(t>100){t=100}}i-=g*t/2;f-=r*t/2;d("scale :"+t+" cx:"+i+" cy:"+f);o.scale=t;o.ox=i;o.oy=f}catch(l){}finally{}}function createDrawInfo(c,a){if(!c||!a){return null}var b=calcScale(c,a);b.rotate=0;b.flipX=1;b.flipY=1;return b}function rotatePoint(a,c,b){if(b.flipX){a=-a}if(b.flipY){c=-c}switch(b.rotate){case 0:break;case 90:a=c;c=-a;break;case 180:a=-c;c=-a;break;case 270:a=-c;c=a;break}return[a,c]}function createLinearData(c){var g=c.length;var e,b;var l,k;var m;var a;var h;var f;var o;var n=new Array(c[g-1].stop);for(e=0;e<g-1;e++){l=c[e];k=c[e+1];m=k.stop-l.stop;a=k.value-l.value;h=l.stop;o=l.value;f=k.stop;for(b=h;b<=f;b++){n[b]=o+a*(b-h)/m}}return n}function getLinearValue(c,f){var g=c.length;var e;var m;var a;var k;var o;var l,h;var b=f;var n;if(!g){return 0}for(e=0;e<g-1;e++){l=c[e];h=c[e+1];if(b>=l.stop&&b<=h.stop){m=h.stop-l.stop;a=h.value-l.value;k=l.stop;o=l.value;n=o+a*(b-k)/m;return n}}if(b<c[0].stop){n=c[0].value;d("use first index:"+b+" value:"+n);return n}if(b>c[g-1].stop){n=c[g-1].value;d("use last index:"+b+" value:"+n);return c[g-1].value}d("getLinearValue ==> why ?");return 0}var __JSON_PROTECTION_PREFIX=/^\)\]\}',?\n/;var __JSON_START=/^\s*(\[|\{[^\{])/;var __JSON_END=/[\}\]]\s*$/;function obj2Json(a){return JSON.stringify(a)}function json2Obj(b){var a=b;if(typeof b==="string"){b=b.replace(__JSON_PROTECTION_PREFIX,"");if(__JSON_START.test(b)&&__JSON_END.test(b)){a=JSON.parse(b)}}return a}function httpGetArrayBuffer(b,f){var a=this;b=window.baseUrl+b;var c=new XMLHttpRequest();c.open("GET",b,true);c.responseType="arraybuffer";c.setRequestHeader("Authorization",getAuthToken());var e=new Date().getTime(this);c.onload=function(k){if(this.status==200){var h=new Date().getTime();var j=h-e;var g=this.response.byteLength;f(this.response);var i=g*8/(j*1000)}else{d("get stream failed")}};c.onerror=function(g){d("Error loading");f(null)};c.onprogress=function(h){if(h.lengthComputable){var g=Math.floor(100*h.loaded/h.total)}};c.send(null)}function httpGetJsonObj(b,f){var a=this;b=window.baseUrl+b;var c=new XMLHttpRequest();c.open("GET",b,true);c.setRequestHeader("Authorization",getAuthToken());var e=new Date().getTime(this);c.onload=function(g){if(this.status==200){f(json2Obj(this.response))}else{d("get string failed")}};c.onerror=function(g){d("Error loading");f(null)};c.onprogress=function(g){if(g.lengthComputable){}};c.send(null)}function dd(a){console.log(a)}function transXY(f,j,g,e,i,h){return[g*f+i*j,e*f+h*j]}function multiplyVec(b,e,g,a,c,f){return[]}function isSameOrientation(c,f,h,b,e,g){var a=c*b+f*e+h*g;if(a>0.7||a<0.7){return true}return false}function computeNormalVector(a){var b=[0,0,0];b[0]=a[1]*a[5]-a[2]*a[4];b[1]=a[2]*a[3]-a[0]*a[5];b[2]=a[0]*a[4]-a[1]*a[3];return b}function msgBox(b,c){if(!c){c="center"}if($.zui){var a=new $.zui.Messager(b,{placement:c});a.show()}else{alert(b)}}function hypLen(a,b){return Math.sqrt(a*a+b*b)}function hypLen3(a,c,b){return Math.sqrt(a*a+c*c+b*b)}function getImageOrientationOposite(a){switch(a){case"L":return"R";case"R":return"L";case"P":return"A";case"A":return"P";case"H":return"F";case"F":return"H"}return" "}var THREE=(function(b){if(b===undefined){b={}}var a=false;b.initXYZ=function(){if(a){return}b.X=new b.Vector3(1,0,0);b.Y=new b.Vector3(0,1,0);b.Z=new b.Vector3(0,0,1);a=true};return b}(THREE));function testThree4(){THREE.initXYZ();var n=new THREE.Vector3(1,1,1);var j=new THREE.Vector3(1,-1,1);var c,k,f;j=j.cross(n);c=n.x;k=n.y;f=n.z;var h=Math.asin(k/(hypLen(c,k)));var l=Math.asin(f/(hypLen3(c,k,f)));d("hypLen ========================= ");d("hypLen(x0, y0)      : "+hypLen(c,k));d("hypLen3(x0, y0, z0) : "+hypLen3(c,k,f));d("Matrix4 ========================= 0");d(n);var b=new THREE.Matrix4();var a=new THREE.Matrix4();var p=new THREE.Matrix4();var o=new THREE.Matrix4();b.makeRotationZ(-h);a.makeRotationY(l);o.makeTranslation(-100,-100,-100);d("Matrix4 ========================= 1.1");var i=n.clone();var e=j.clone();i.applyMatrix4(b);e.applyMatrix4(b);d(i);d(e);d("Matrix4 ========================= 1.2");i.applyMatrix4(a);e.applyMatrix4(a);d(i);d(e);var m=Math.asin(f/(hypLen(e.y,e.z)));p.makeRotationX(m);d("Matrix4 ========================= 1.3");i.applyMatrix4(p);e.applyMatrix4(p);d(i);d(e);d("Matrix4 ========================= 1.4");i.applyMatrix4(o);e.applyMatrix4(o);d(i);d(e);d("Matrix4 ========================= MMM");var g=new THREE.Matrix4();var i=n.clone();var e=j.clone();g.multiplyR(b);g.multiplyR(a);g.multiplyR(p);g.multiplyR(o);i.applyMatrix4(g);e.applyMatrix4(g);d(i);d(e)}function testThree3(){THREE.initXYZ();var l=new THREE.Vector3(1,1,1);var i=new THREE.Vector3(1,-1,1);var c,j,f;i=i.cross(l).normalize();c=l.x;j=l.y;f=l.z;var m=Math.asin(j/(hypLen(c,j)));var k=Math.asin(f/(hypLen3(c,j,f)));d("hypLen ========================= ");d("hypLen(x0, y0)      : "+hypLen(c,j));d("hypLen3(x0, y0, z0) : "+hypLen3(c,j,f));d("Matrix4 ========================= 0");d(l);var b=new THREE.Matrix4();var a=new THREE.Matrix4();var n=new THREE.Matrix4();b.makeRotationZ(-m);a.makeRotationY(k);n.makeRotationZ(THREE.Math.degToRad(30));d("Matrix4 ========================= 1.1");var h=l.clone();var e=i.clone();h.applyMatrix4(b);e.applyMatrix4(b);d(h);d("Matrix4 ========================= 1.2");h.applyMatrix4(a);e.applyMatrix4(a);d(h);d("Matrix4 ========================= 1.3");h.applyMatrix4(n);e.applyMatrix4(n);d(h);d("Matrix4 ========================= 2");var g=new THREE.Matrix4();var h=l.clone();var e=i.clone();g.multiplyR(b);g.multiplyR(a);g.multiplyR(n);h.applyMatrix4(g);e.applyMatrix4(g);d(h);d("Matrix4 ========================= 3");var g=new THREE.Matrix4();var h=l.clone();var e=i.clone();g.multiply(n);g.multiply(a);g.multiply(b);h.applyMatrix4(g);e.applyMatrix4(g);d(h);d("Matrix4 ========================= 4");var g=new THREE.Matrix4();var h=l.clone();var e=i.clone();g.multiply(n);g.multiply(a);g.multiply(b);g.getInverse(g);h.applyMatrix4(g);e.applyMatrix4(g);d(h)}function testThree2(){THREE.initXYZ();var t=new THREE.Vector3(1,1,1);var r=new THREE.Vector3(1,-1,1);var w,e,o;r=r.cross(t).normalize();w=t.x;e=t.y;o=t.z;var j=Math.asin(e/(hypLen(w,e)));var h=Math.asin(o/(hypLen3(w,e,o)));d("hypLen ========================= ");d("hypLen(x0, y0)      : "+hypLen(w,e));d("hypLen3(x0, y0, z0) : "+hypLen3(w,e,o));d("Matrix4 ========================= 0");d(t);d(r);var l=new THREE.Matrix4();var b=new THREE.Matrix4();var f=new THREE.Matrix4();var i=new THREE.Quaternion();i.setFromAxisAngle(THREE.Z,j);f.makeRotationFromQuaternion(i);l.multiply(f);d("Matrix4 ========================= 1");var m=t.clone();var u=r.clone();m.applyMatrix4(f);d(m);u.applyMatrix4(f);d(u);d("Matrix4 ========================= 1.1");var v=t.clone();var n=r.clone();v.applyMatrix4(l);d(v);n.applyMatrix4(l);d(n);var i=new THREE.Quaternion();var b=new THREE.Matrix4();i.setFromAxisAngle(THREE.Y,-h);b.makeRotationFromQuaternion(i);l.multiply(b);d("Matrix4 ========================= 2");var k=m.clone();var s=u.clone();k.applyMatrix4(b);d(k);s.applyMatrix4(b);d(s);d("Matrix4 ========================= 2.1");var a=t.clone();var q=r.clone();a.applyMatrix4(l);d(a);q.applyMatrix4(l);d(q);d("Matrix4 ========================= 2.2");var a=t.clone();var q=r.clone();var l=new THREE.Matrix4();l.multiply(f);l.multiply(b);a.applyMatrix4(l);d(a);q.applyMatrix4(l);d(q);d("Matrix4 ========================= 3");var p=new THREE.Matrix4();p.multiply(b);p.multiply(f);var g=new THREE.Matrix4();g.multiply(f);g.multiply(b);var c=new THREE.Vector3(1,1,1);c.applyMatrix4(f);c.applyMatrix4(b);d(c);var c=new THREE.Vector3(1,1,1);c.applyMatrix4(p);d(c);var c=new THREE.Vector3(1,1,1);c.applyMatrix4(g);d(c)}function testThree(){var h=new THREE.Vector3(0,0,0);var f=new THREE.Vector3(1,0,0);var e=new THREE.Vector3(0,1,0);var c=new THREE.Vector3(0,0,1);var a=new THREE.Vector3(1,1,1);var k=new THREE.Vector3();var j=new THREE.Plane();var i=new THREE.Plane();var b=new THREE.Matrix4();k.copy(f);j.setFromNormalAndCoplanarPoint(f,h);i.setFromNormalAndCoplanarPoint(e,h);d("=========================");d("X    : ");d(f);d("Y    : ");d(e);d("Z    : ");d(c);d("P1   : ");d(a);d("V1   : ");d(k);d("PL1  : ");d(j);d("pl2  : ");d(i);var g=j.intersectPlane(i);d("intersect  : ");d(g);var a=new THREE.Vector3(1,1,1);a.applyAxisAngle(f,THREE.degToRad(45));d("P1==>X   : ");d(a);var a=new THREE.Vector3(1,1,1);a.applyAxisAngle(e,THREE.degToRad(45));d("P1==>Y   : ");d(a);var a=new THREE.Vector3(1,1,1);a.applyAxisAngle(c,THREE.degToRad(45));d("P1==>Z   : ");d(a)};PACS.View=function(a,b){if(!(this instanceof PACS.View)){return new PACS.View(a,b)}this.listeners=b;this.canvasId=a+"-c";this.viewId=a;var c=this;setTimeout(function(){c.init()},10)};PACS.View.prototype.init=function(){if(!this.canvasId){return}this.canvas=document.getElementById(this.canvasId);this.context=this.canvas.getContext("2d");this.$canvas=$(this.canvas);this.shown=true;this.floatRight=false;this.selected=false;this.imgShown=false;this.tools=this.listeners.getTools();this.imageIndex=0;this.canvas.$PacsView=this;this.$canvas.$PacsView=this;this.drawCanvas=document.createElement("canvas");this.createCtxMenu();var b=document.getElementById(this.viewId);b.$PacsView=this;var c=$("#"+this.viewId+"");this.$wraper=c;this.$infolt=c.find(".image-info-lt>a");this.$infort=c.find(".image-info-rt>a");this.$infolb=c.find(".image-info-lb>a");this.$inforb=c.find(".image-info-rb>a");this.$slider=c.find(".image-info-lb>input");this.$slider.change(this.onSliderChanged);this.slider=this.$slider[0];this.slider.$PacsView=this;var a=this;this._mousedown=function(f){a.mousedown(f)};this._mousemove=function(f){a.mousemove(f)};this._mouseup=function(f){a.mouseup(f)};this._mouseout=function(f){a.mouseout(f)};this._mousewheel=function(f){a.mousewheel(f)};this.$canvas.on("mousedown",this._mousedown);this.$canvas.on("mousewheel",this._mousewheel)};PACS.View.prototype.isSelected=function(a){return this.selected?true:false};PACS.View.prototype.onClickCtxAction=function(b,a){};PACS.View.prototype.onClickCtxSeries=function(f,c){if(!this.length||!this[0].$PacsView){return}var a=this[0].$PacsView;if(a.listeners&&a.listeners.getSeries){var b=a.listeners.getSeries(f);if(b){a.setSeries(b)}}};PACS.View.prototype.createCtxMenu=function(){return;var e=this.canvas.id;if(this.ctxMenuInit){$("#"+e).contextMenu("destroy")}if(this.series){$.contextMenu({selector:"#"+e,callback:this.onClickCtxAction,items:pacsOprMenus});this.ctxMenuInit=2}else{if(this.listeners&&this.listeners.getSeries){var b=this.listeners.getSeries();if(b&&b.length>0){var c={};for(var a in b){c[a]={name:b[a].SeriesDescription,icon:"edit"}}$.contextMenu({selector:"#"+e,callback:this.onClickCtxSeries,items:c});this.ctxMenuInit=1}}}};PACS.View.prototype.deselectViews=function(b){var a=$("div.selected");a.each(function(){if(this.$PacsView){this.$PacsView.setSelected(false)}})};PACS.View.prototype._setSelected=function(a){if(!this.ctxMenuInit){this.createCtxMenu()}if(a){this.deselectViews();this.$wraper.addClass("selected")}else{this.$wraper.removeClass("selected")}this.selected=a;if(this.listeners&&this.listeners.onSelected){this.listeners.onSelected(this,a)}};PACS.View.prototype.setSelected=function(a){if(a==this.selected){return}this._setSelected(a)};PACS.View.prototype.enablemouse=function(a){$(document).on("mousemove",this._mousemove);$(document).on("mouseup",this._mouseup)};PACS.View.prototype.disablemouse=function(a){$(document).off("mousemove",this._mousemove);$(document).off("mouseup",this._mouseup)};PACS.View.prototype.mousedown=function(h){this.mbtn=h.button;this.mdown=true;if(!this.selected){this.setSelected(true)}if(!this.imageData){if(this.getTools()!=ActionTool.SCOLL){return}}if(this.mbtn==0){switch(this.getTools()){case ActionTool.NONE:case ActionTool.SCOLL:case ActionTool.WL:case ActionTool.MOVE:case ActionTool.ZOOM:case ActionTool.MPR:case ActionTool.CT:case ActionTool.VR:this.mox=h.clientX;this.moy=h.clientY;this.initmox=h.clientX;this.initmoy=h.clientY;this.mdown=true;this.mmove=false;if(ActionTool.NONE==this.getTools()){if(this.isMprMode()&&!this.tools.lop){this.setMprPoint(h.offsetX,h.offsetY)}}else{if(ActionTool.ZOOM==this.getTools()){if(this.drawInfo){this.initofsx=h.offsetX;this.initofsy=h.offsetY}}else{if(ActionTool.CT==this.getTools()){var i=this.drawInfo;var g=this.drawCanvas.width;var a=this.drawCanvas.height;var b=this.axescvt(h.offsetX,h.offsetY);var f=Math.round(b[0]);var c=Math.round(b[1]);if(f<0||f>=this.image.width||c<0||c>=this.image.height){this.showCtValue("No Value - Outside image")}else{var j=this.image.getValue(f,c);this.showCtValue(j+"HU&nbsp;("+f+","+c+")")}}}}break;default:var k=this.axescvt(h.offsetX,h.offsetY);if(this.imageData.mousedown(this.getTools(),k[0],k[1])){this.redraw(false)}break}this.enablemouse();return}this.mox=h.clientX;this.moy=h.clientY;this.initmox=h.clientX;this.initmoy=h.clientY;this.mdown=true;this.mmove=false;this.enablemouse();return};PACS.View.prototype.mouseup=function(b,a){if(a){if(b.target=this.canvas){}}if(0==this.mbtn){if(this.imageData&&this.imageData.mousecaptrued()){if(this.imageData.mouseup()){this.redraw(false)}this.mdown=false;this.mbtn=-1}}this.mdown=false;this.mbtn=-1;if(!this.imageData||!this.imageData.mousecaptrued()){this.disablemouse()}};PACS.View.prototype.mousemove=function(i){i.preventDefault();if(!this.imageData){if(this.getTools()!=ActionTool.SCOLL){return}}else{if(this.imageData.mousecaptrued()){if(i.target==this.canvas){var o=this.axescvt(i.offsetX,i.offsetY);if(this.imageData.mousemove(o[0],o[1])){this.redraw(false)}}return}}if(!this.mdown){return}if(this.mbtn==0){switch(this.getTools()){case ActionTool.SCOLL:if(i.clientY-this.moy>20){this.moy=i.clientY;this.nextImage()}else{if(i.clientY-this.moy<-20){this.moy=i.clientY;this.prevImage()}}break;case ActionTool.WL:if(Math.abs(i.clientY-this.moy)+Math.abs(i.clientX-this.mox)<3){break}this.imageData.wwc.wc-=(i.clientY-this.moy);if(this.imageData.wwc.wc<this.imageData.min){this.imageData.wwc.wc=this.imageData.min}else{if(this.imageData.wwc.wc>this.imageData.max){this.imageData.wwc.wc=this.imageData.max}}this.imageData.wwc.ww+=(i.clientX-this.mox);if(this.imageData.wwc.ww<1){this.imageData.wwc.ww=1}else{if(this.imageData.wwc.ww>(this.imageData.max-this.imageData.min)){this.imageData.wwc.ww=(this.imageData.max-this.imageData.min)}}this.mox=i.clientX;this.moy=i.clientY;this.wlInfo=this.imageData.wwc;this.updateWLInfo();this.redraw(true);break;case ActionTool.MOVE:if(!this.drawInfo){break}this.drawInfo.ox+=(i.clientX-this.mox);this.drawInfo.oy+=(i.clientY-this.moy);this.mox=i.clientX;this.moy=i.clientY;this.updateDwWraper();this.draw();break;case ActionTool.ZOOM:if(!this.drawInfo){break}var c=this.drawInfo.scale;this.drawInfo.scale+=(i.clientY-this.moy)/200*(1+c);if(this.drawInfo.scale*this.imageData.imageData.height<this.canvas.height/20){this.drawInfo.scale=this.canvas.height/20/this.imageData.imageData.height}else{if(this.drawInfo.scale*this.imageData.imageData.height>this.canvas.height*20){this.drawInfo.scale=this.canvas.height*20/this.imageData.imageData.height}}var m=this.initofsx-this.drawInfo.ox;var k=this.initofsy-this.drawInfo.oy;var q=m/c*this.drawInfo.scale;var n=k/c*this.drawInfo.scale;this.drawInfo.ox-=q-m;this.drawInfo.oy-=n-k;this.moy=i.clientY;this.updateDwWraper();this.draw();this.updateZoomInfo();break;case ActionTool.CT:if(i.target!=this.canvas){break}var j=this.drawInfo;var h=this.drawCanvas.width;var a=this.drawCanvas.height;var b=this.axescvt(i.offsetX,i.offsetY);var g=Math.round(b[0]);var f=Math.round(b[1]);if(g<0||g>=this.image.width||f<0||f>=this.image.height){this.showCtValue("No Value - Outside image")}else{var l=this.image.getValue(g,f);this.showCtValue(l+"HU&nbsp;("+g+","+f+")")}break;case ActionTool.NONE:case ActionTool.MPR:case ActionTool.VR:if(this.isMprMode()){if(i.target==this.canvas&&!this.tools.lop){this.setMprPoint(i.offsetX,i.offsetY)}}else{if(this.isVrMode()){}}break;default:break}return}if(this.mbtn==1){if(!this.drawInfo){return}var c=this.drawInfo.scale;this.drawInfo.scale+=(i.clientY-this.moy)/200*(1+c);if(this.drawInfo.scale*this.imageData.imageData.height<this.canvas.height/20){this.drawInfo.scale=this.canvas.height/20/this.imageData.imageData.height}else{if(this.drawInfo.scale*this.imageData.imageData.height>this.canvas.height*20){this.drawInfo.scale=this.canvas.height*20/this.imageData.imageData.height}}var q=(this.drawInfo.scale-c)*this.imageData.imageData.width;var n=(this.drawInfo.scale-c)*this.imageData.imageData.height;this.drawInfo.ox-=q/2;this.drawInfo.oy-=n/2;this.moy=i.clientY;this.draw();this.updateZoomInfo();return}if(this.mbtn==2){if(Math.abs(i.clientY-this.moy)+Math.abs(i.clientX-this.mox)<3){return}this.imageData.wwc.wc-=(i.clientY-this.moy);if(this.imageData.wwc.wc<this.imageData.min){this.imageData.wwc.wc=this.imageData.min}else{if(this.imageData.wwc.wc>this.imageData.max){this.imageData.wwc.wc=this.imageData.max}}this.imageData.wwc.ww+=(i.clientX-this.mox);if(this.imageData.wwc.ww<1){this.imageData.wwc.ww=1}else{if(this.imageData.wwc.ww>(this.imageData.max-this.imageData.min)){this.imageData.wwc.ww=(this.imageData.max-this.imageData.min)}}this.mox=i.clientX;this.moy=i.clientY;this.wlInfo=this.imageData.wwc;this.updateWLInfo();this.redraw(true);return}};PACS.View.prototype.mouseout=function(a){console.log("mouseout @ "+this.canvasId+" offset ox : "+a.clientX+" oy : "+a.clientY);if(!this.mdown){return}switch(this.tools){case ActionTool.CT:this.showCtValue("No Value - Outside image");default:return}};PACS.View.prototype.setMprPoint=function(a,c){var b=this.axescvt(a,c);this.series.setImgPoint(Math.round(b[0]),Math.round(b[1]))};PACS.View.prototype.isMprMode=function(){return this.series&&this.series.isMprMode()};PACS.View.prototype.isVrMode=function(){return this.vr};PACS.View.prototype.syncLinked=function(a){this.changeImage(a,true)};PACS.View.prototype.changeImage=function(f,e,c){if(!this.series||!this.series.images){return}var b=!c;var a=this.imageIndex+f;if(a<0){if(b){a=this.series.images.length-1}else{a=0}}else{if(a>=this.series.images.length){if(b){a=0}else{a=this.series.images.length-1}}}if(this.imageIndex==a&&!e){return}if(this.isMprMode()){if(!e){if(this.tools.linked){if(this.listeners.syncLinked){this.listeners.syncLinked(this,f)}}if(this.tools.lop){this.series.setImgIdx(a,false)}else{this.series.setImgIdx(a,true);return}}}else{if(!e&&this.tools.linked){if(this.listeners.syncLinked){this.listeners.syncLinked(this,f)}}}if(e&&this.isMprMode()){this.series.setImgIdx(a,false)}this.setImageIdx(a)};PACS.View.prototype.prevImage=function(){this.changeImage(-1)};PACS.View.prototype.nextImage=function(){this.changeImage(1)};PACS.View.prototype.mousewheel=function(f,g){if(!this.selected){return}if(!this.series){return}if(1){if(f.originalEvent.deltaY>0){this.nextImage()}else{this.prevImage()}return}switch(this.getTools()){case ActionTool.SCOLL:if(f.originalEvent.deltaY>0){this.setImageIdx(this.imageIndex+1)}else{this.setImageIdx(this.imageIndex-1)}break;case ActionTool.WL:if(!this.imageData){break}if(f.originalEvent.deltaY>0){if(this.imageData.wwc.wc>this.imageData.min){this.imageData.wwc.wc-=50}}else{if(this.imageData.wwc.wc<this.imageData.max){this.imageData.wwc.wc+=50}}this.wlInfo=this.imageData.wwc;this.updateWLInfo();this.redraw(true);break;case ActionTool.ZOOM:if(!this.drawInfo){break}var c=this.drawInfo.scale;if(f.originalEvent.deltaY>0){this.drawInfo.scale+=0.1*(1+c)}else{this.drawInfo.scale-=0.1*(1+c)}if(this.drawInfo.scale*this.imageData.imageData.height<this.canvas.height/20){this.drawInfo.scale=this.canvas.height/20/this.imageData.imageData.height}else{if(this.drawInfo.scale*this.imageData.imageData.height>this.canvas.height*20){this.drawInfo.scale=this.canvas.height*20/this.imageData.imageData.height}}var b=(this.drawInfo.scale-c)*this.imageData.imageData.width;var a=(this.drawInfo.scale-c)*this.imageData.imageData.height;this.drawInfo.ox-=b/2;this.drawInfo.oy-=a/2;this.moy=f.clientY;this.updateDwWraper();this.draw();this.updateZoomInfo();break}};PACS.View.prototype.onSliderChanged=function(b){if(!(this instanceof PACS.View)){if(this.$PacsView){this.$PacsView.onSliderChanged(b)}return}var a=b.target.value;if(a!=this.imageIndex){this.changeImage(a-this.imageIndex)}};PACS.View.prototype.show=function(a){if(this.shown&&this.floatRight==a){return}this.shown=true;this.$canvas.removeClass("hide");if(this.floatRight!=a){this.floatRight=a;if(a){this.$wraper.css("float","right")}else{this.$wraper.css("float","true")}}else{}};PACS.View.prototype.isShown=function(a){return this.shown};PACS.View.prototype.setSize=function(c,a){if(!this.shown){return}var b=this.canvas.width;var e=this.canvas.height;this.$canvas.width(c);this.$canvas.height(a);this.canvas.width=c;this.canvas.height=a;if(this.isVrMode()){this.vr.setSize(c,a);return}if(this.drawInfo){$.extend(this.drawInfo,calcScale(this.image,this.canvas));this.updateDwWraper()}this.draw();this.updateZoomInfo()};PACS.View.prototype.hide=function(){if(!this.shown){return}if(this.series){}this.shown=false;this.$canvas.addClass("hide")};PACS.View.prototype.onImageLoaded=function(b,a,c){if(this.isMprMode()){}if(this.imageIndex==a){d("onLoadImage "+a+" cur:"+this.imageIndex);this.setImageIdx(a)}};PACS.View.prototype.getImageDataCache=function(a){if(this.imageDataCache){return this.imageDataCache[a]}return null};PACS.View.prototype.setImageDataCache=function(a,b){if(!this.imageDataCache){this.imageDataCache=new Array(this.series.images.length)}b.clearData();this.imageDataCache[a]=b};PACS.View.prototype.setSeries=function(b){if(b==this.series){return}this.playImage(false);if(this.series){this.series.removeView(this);this.resetDwinfo();delete this.imageData;delete this.imageDataCache;this.imageData=null;this.imageDataCache=null;this.image=null}this.series=b;if(b){b.addView(this);var a=0;if(b.isMprMode()){a=b.getImgIdx()}this.setImageIdx(a)}else{this.drawBgd();this.updateInfo()}var c=this;if(this.ctxMenuInit!=2){}if(this.selected){this._setSelected(true)}};PACS.View.prototype.updateZoomInfo=function(){if(this.image&&this.tools.showInfo){this.$infolb[2].innerHTML="Zoom:&nbsp;"+this.getZoom()+"%"}else{this.$infolb[2].innerHTML=""}};PACS.View.prototype.updateWLInfo=function(){if(this.image&&this.tools.showInfo){this.$infolb[3].innerHTML="Window/Level:&nbsp;"+this.imageData.wwc.ww+"/"+this.imageData.wwc.wc}else{this.$infolb[3].innerHTML=""}};PACS.View.prototype.showCtValue=function(a){if(a){this.$infolb[0].innerHTML="Pixel:&nbsp;"+a}else{this.$infolb[0].innerHTML=""}};PACS.View.prototype.updateInfo=function(){var b=this.image;var a=this.series;if(!b||!this.tools.showInfo||this.isVrMode()){this.$infolt.text("");this.$infort.text("");this.$infolb.text("");this.$inforb.text("");this.slider.style.visibility="hidden"}else{this.$infolt[0].innerHTML=b.PatientName;this.$infolt[1].innerHTML=b.PatientBirthDate;this.$infolt[2].innerHTML="ID:&nbsp;"+b.PatientID;if(b.PatientSex=="F"){this.$infolt[3].innerHTML="SEX:&nbsp;Female"}else{if(b.PatientSex=="M"){this.$infolt[3].innerHTML="SEX:&nbsp;Male"}else{this.$infolt[3].innerHTML="SEX:&nbsp;Other"}}this.$infolt[4].innerHTML=calcAgeByBdate(b.PatientBirthDate)+" Years";this.$infort[0].innerHTML=a.InstitutionName;this.$infort[1].innerHTML="Study ID:&nbsp;"+getSplitR(b.StudyInstanceUID,".",0);if(b.dataSet){this.$infort[2].innerHTML="Ac. Nb.:&nbsp;"+b.AccessionNumber;this.$infort[3].innerHTML="Acq.:&nbsp;"+b.AcquisitionDate;this.$infort[4].innerHTML="Acq.:&nbsp;"+b.AcquisitionTime}else{this.$infort[2].innerHTML="";this.$infort[3].innerHTML="";this.$infort[4].innerHTML=""}this.$infolb[0].innerHTML="";this.$infolb[1].innerHTML="Frame:&nbsp;["+b.InstanceNumber+"]&nbsp;"+(this.imageIndex+1)+"/"+a.images.length;this.$infolb[2].innerHTML="Zoom:&nbsp;"+this.getZoom()+"%";if(this.imageData){this.$infolb[3].innerHTML="Window/Level:&nbsp;"+this.imageData.wwc.ww+"/"+this.imageData.wwc.wc}else{this.$infolb[3].innerHTML=""}if(b.dataSet){this.$infolb[4].innerHTML=b.Modality+"&nbsp;("+b.Columns+"*"+b.Rows+")"}else{this.$infolb[4].innerHTML=""}this.slider.max=a.images.length-1;this.slider.min=0;this.slider.value=this.imageIndex;this.slider.style.visibility="visible";if(b.Modality=="CT"){this.$inforb[0].innerHTML="Series No: "+a.SeriesNumber;this.$inforb[2].innerHTML=this.series.SeriesDescription;if(b.dataSet){this.$inforb[1].innerHTML=b.ContrastBolusAgent;this.$inforb[3].innerHTML="Thickness: "+b.SliceThickness+"mm";this.$inforb[4].innerHTML="Location: "+b.SliceLocation+"mm"}else{this.$inforb[1].innerHTML="";this.$inforb[3].innerHTML="";this.$inforb[4].innerHTML=""}}else{this.$inforb[0].innerHTML="";this.$inforb[1].innerHTML="";this.$inforb[2].innerHTML="";this.$inforb[3].innerHTML="Series No: "+a.SeriesNumber;this.$inforb[4].innerHTML=this.series.SeriesDescription}}};PACS.View.prototype.setImage=function(a,c){if(!c.dataSet){this.image=c;this.imageData=null;this.draw();this.updateInfo();return true}if(this.image&&c){if(this.image.width!=c.width||this.image.height!=c.height){this.drawInfo=null}}this.image=c;var b=this.getImageDataCache(a);if(!b){b=new PACS.ImageData(c,this.context)}if(!this.wlInfo){this.wlInfo=b.resetWwc()}b.wwc=this.wlInfo;b.lut=this.lut;b.filter=this.filter;this.imageData=b;this.drawCanvas.width=c.width;this.drawCanvas.height=c.height;this.drawContext=this.drawCanvas.getContext("2d");this.redraw(true);this.updateInfo();if(this.selected&&this.tools.lop){this.listeners.refreshViews(this,false)}return true};PACS.View.prototype.initDrawInfo=function(){if(this.isVrMode()){}this.drawInfo=createDrawInfo(this.image,this.canvas);this.resetDwTrans();this.updateDwWraper()};PACS.View.prototype.resetDwTrans=function(f,e,h,g){if(!this.drawInfo){return}this.drawInfo.transform={A:1,B:0,C:0,D:1,A1:1,B1:0,C1:0,D1:1}};PACS.View.prototype.addDwTrans=function(n,m,l,k){if(!this.drawInfo){return}var o=this.drawInfo.transform;var i=o.A*n+o.B*l;var h=o.A*m+o.B*k;var g=o.C*n+o.D*l;var e=o.C*m+o.D*k;o.A=i;o.B=h;o.C=g;o.D=e;var j=1/(i*e-h*g);o.A1=j*e;o.B1=-j*h;o.C1=-j*g;o.D1=j*i;if(this.doContext){this.doContext.update(this.drawInfo)}};PACS.View.prototype.memDraw=function(){if(this.isVrMode()){this.initDrawInfo();this.series.vr.draw(this.drawContext,this.wlInfo);return}if(this.isMprMode()){var a=this.series.getMprImgIdx();if(a<0||a>=this.series.images.length){clearContext(this.drawContext,this.drawCanvas.width,this.drawCanvas.height);return}}this.imageData.draw(this.drawContext,this.drawInfo)};PACS.View.prototype.vrDraw=function(){if(!this.vrInit){var a=this;this.vrInit=true;this.drawBgd();this.updateInfo();this.vr.initWebGl(this.$wraper[0],this.wlInfo,this.lut);this.vr.setClickCb(function(){a.setSelected(true)})}};PACS.View.prototype.redraw=function(a){if(this.isVrMode()){this.vrDraw();return}if(!this.imageData){return}if(a){this.imageData.initImageData()}if(!this.drawInfo){this.initDrawInfo()}this.memDraw();this.draw()};PACS.View.prototype.drawRuler=function(){var r=this.context;var o=this.image;var f;var b;var c=false;if(o.columnPixelSpacing&&o.rowPixelSpacing){f=o.columnPixelSpacing;b=o.rowPixelSpacing}else{f=1;b=1;c=true}var l=this.canvas.width;var t=this.canvas.height;var a=f*l/this.drawInfo.scale;var x=b*t/this.drawInfo.scale;if(t<400){x*=(t+100)/500}if(l<400){a*=(l+100)/500}var v=getProperSpan(Math.min(a*5/10,o.width*f*2));var u=getProperSpan(Math.min(x*5/10,o.height*b*2));if(!v||!u){return}r.lineCap="round";r.lineWidth=1;r.strokeStyle="#F00";r.font="Bold 16px Arial";r.fillStyle="#F00";r.beginPath();var p=10;var g=16;var e=10;var n=12;var m=10;var j=7;var q;var k=v*this.drawInfo.scale/f;r.moveTo(Math.round(l/2-k/2),t-p);r.lineTo(Math.round(l/2+k/2),t-p);if(!c){if(v<=50){e=20}}for(var s=0;s<=e;s++){r.moveTo(Math.round(l/2-k/2+(k/e*s)),t-p);if(s==0||s==e){q=n}else{if(s%5==0){q=m}else{q=j}}r.lineTo(Math.round(l/2-k/2+(k/e*s)),t-p-q)}if(v>10&&!c){r.fillText((v/10)+"cm",Math.round(l/2+k/2+g/2),t-p)}else{r.fillText((v)+(c?"pixel":"mm"),Math.round(l/2+k/2+g/2),t-p)}if(!c){if(u<=50){e=20}}k=u*this.drawInfo.scale/b;r.moveTo(p,Math.round(t/2-k/2));r.lineTo(p,Math.round(t/2+k/2));for(var s=0;s<=e;s++){if(s==0||s==e){q=n}else{if(s%5==0){q=m}else{q=j}}r.moveTo(p,Math.round(t/2-k/2+(k/e*s)));r.lineTo(p+q,Math.round(t/2-k/2+(k/e*s)))}if(u>10&&!c){r.fillText((u/10)+"cm",p,Math.round(t/2-k/2-g+5))}else{r.fillText((u)+(c?"pixel":"mm"),p,Math.round(t/2-k/2-g+5))}r.stroke()};PACS.View.prototype.drawCvtLine=function(c,f,b,e,g,a){var i=g(c,f);var h=g(b,e);a.moveTo(i[0],i[1]);a.lineTo(h[0],h[1])};PACS.View.prototype.drawMprLines=function(){var r=this.context;var e=this.image;var o=e.width;var g=e.height;var r=this.context;var l=this.series.mpr;var b=this.series.mprAxis;var i=this.doContext.convert;var m,j;r.lineCap="round";r.lineWidth=1;switch(l.getLastEvent()){case"cpi":case"cp":var f,c,a;if(b==AXIS_X){f="#F00";c="#0F0";a="#00F"}else{if(b==AXIS_Y){f="#F00";c="#00F";a="#0F0"}else{f="#0F0";c="#00F";a="#F00"}}r.strokeStyle=a;r.beginPath();var q=i(0,0);var p=i(o,0);var n=i(o,g);var k=i(0,g);r.moveTo(q[0],q[1]);r.lineTo(p[0],p[1]);r.lineTo(n[0],n[1]);r.lineTo(k[0],k[1]);r.lineTo(q[0],q[1]);r.stroke();var s=this.series.getImgPoint();r.strokeStyle=f;r.beginPath();this.drawCvtLine(0,s[1],o,s[1],i,r);r.stroke();r.strokeStyle=c;r.beginPath();this.drawCvtLine(s[0],0,s[0],g,i,r);r.stroke();break;case AXIS_X:switch(b){case AXIS_X:break;case AXIS_Y:case AXIS_Z:r.strokeStyle="#FF0";r.beginPath();this.drawCvtLine(0,0,0,g,i,r);this.drawCvtLine(o,0,o,g,i,r);r.stroke();m=l.getX();r.strokeStyle="#00F";r.beginPath();this.drawCvtLine(m,0,m,g,i,r);r.stroke();break}break;case AXIS_Y:switch(b){case AXIS_X:r.strokeStyle="#FF0";r.beginPath();this.drawCvtLine(0,0,0,g,i,r);this.drawCvtLine(o,0,o,g,i,r);r.stroke();m=l.getY();r.strokeStyle="#00F";r.beginPath();this.drawCvtLine(m,0,m,g,i,r);r.stroke();break;case AXIS_Z:r.strokeStyle="#FF0";r.beginPath();this.drawCvtLine(0,0,o,0,i,r);this.drawCvtLine(0,g,o,g,i,r);r.stroke();j=l.getY();r.strokeStyle="#00F";r.beginPath();this.drawCvtLine(0,j,o,j,i,r);r.stroke();break}break;case AXIS_Z:switch(b){case AXIS_X:case AXIS_Y:r.strokeStyle="#FF0";r.beginPath();this.drawCvtLine(0,0,o,0,i,r);this.drawCvtLine(0,g,o,g,i,r);r.stroke();j=l.getZ();r.strokeStyle="#00F";r.beginPath();this.drawCvtLine(0,j,o,j,i,r);r.stroke();break;case AXIS_Z:break}break}};PACS.View.prototype.drawLopLines=function(){var i=this.listeners.getSelView();if(!i||i==this){return}var a=this.image;var b=i.image;var g=a.getCrossPoints(b);if(!g){return}var c=this.doContext.convert;var j=this.context;j.lineCap="round";j.lineWidth=1;j.strokeStyle="#FF0";j.beginPath();var h=c(g[0],g[1]);var f=c(g[2],g[3]);j.moveTo(h[0],h[1]);j.lineTo(f[0],f[1]);var e=a.getSameVector(b);switch(e){case"x":h=c(0,0);f=c(0,a.height);j.moveTo(h[0],h[1]);j.lineTo(f[0],f[1]);h=c(a.width,0);f=c(a.width,a.height);j.moveTo(h[0],h[1]);j.lineTo(f[0],f[1]);break;case"y":h=c(0,0);f=c(a.width,0);j.moveTo(h[0],h[1]);j.lineTo(f[0],f[1]);h=c(0,a.height);f=c(a.width,a.height);j.moveTo(h[0],h[1]);j.lineTo(f[0],f[1]);break}j.stroke()};PACS.View.prototype.drawObjs=function(){var b=this.drawInfo;var a=this.context;if(!this.doContext){this.doContext=new PACS.CtxWraper(a,b)}this.imageData.drawObjs(this.doContext)};PACS.View.prototype.draw=function(){var i=this.image;if(!i){this.drawBgd();return}if(!this.imageData){this.drawLoading();return}if(!this.drawInfo){this.initDrawInfo()}var g=this.drawInfo;var b=this.context;b.fillStyle="#000";b.fillRect(0,0,this.canvas.width,this.canvas.height);var a=this.drawCanvas.width;var f=this.drawCanvas.height;var c=this.drawCanvas.width*g.scale;var h=this.drawCanvas.height*g.scale;b.save();b.translate(g.ox+c/2,g.oy+h/2);var e=g.transform;b.transform(e.A1,e.C1,e.B1,e.D1,0,0);b.scale(g.scale,g.scale);b.drawImage(this.drawCanvas,-a/2,-f/2);b.restore();this.drawObjs(b,g);if(this.tools.showRuler&&!this.isVrMode()){this.drawRuler()}if(this.tools.lop){this.drawLopLines()}else{if(this.isMprMode()){this.drawMprLines()}}};PACS.View.prototype.drawLoading=function(){var a=this.context;a.fillStyle="#000";a.fillRect(0,0,this.canvas.width,this.canvas.height);a.lineCap="round";a.lineWidth=1;a.strokeStyle="#FFF";a.font="Bold 25px Arial";a.fillStyle="#FFF";a.fillText("loading",this.canvas.width/2-50,this.canvas.height/2-12)};PACS.View.prototype.drawBgd=function(){var a=this.context;a.fillStyle="#000";a.fillRect(0,0,this.canvas.width,this.canvas.height)};PACS.View.prototype.updateDwWraper=function(){if(this.doContext&&this.drawInfo){this.doContext.update(this.drawInfo)}};PACS.View.prototype.setImageIdx=function(a){if(!this.series||!this.series.images||a<0||a>=this.series.images.length){return false}if(this.imageData&&undefined!=this.imageIndex){this.setImageDataCache(this.imageIndex,this.imageData)}this.imageIndex=a;this.setImage(a,this.series.images[a]);return true};PACS.View.prototype.getZoom=function(){if(!this.imageData){return"100"}if(!this.drawInfo){return"0"}return Math.floor(this.drawInfo.scale*100)};PACS.View.prototype.invert=function(){if(this.imageData){this.imageData.invert();this.redraw(false)}};PACS.View.prototype.rotate=function(h){if(this.imageData){this.drawInfo.rotate=(this.drawInfo.rotate+h+360)%360;h=h*Math.PI/180;var f=Math.round(Math.cos(h));var e=Math.round(Math.sin(h));var i=Math.round(-Math.sin(h));var g=Math.round(Math.cos(h));this.addDwTrans(f,e,i,g);this.redraw(false)}};PACS.View.prototype.setWwc=function(a){if(this.isVrMode()){if(this.vrInit){this.vr.setWwc(a)}return}if(!a){this.resetWwc();return}this.wlInfo={ww:a.ww,wc:a.wc};if(this.imageData){this.imageData.wwc=this.wlInfo;this.updateWLInfo();this.redraw(true)}};PACS.View.prototype.setLut=function(a){this.lut=a;if(this.isVrMode()){if(this.vrInit){this.vr.setLut(a)}return}if(this.imageData){this.imageData.lut=this.lut;this.redraw(true)}};PACS.View.prototype.setFilter=function(a){this.filter=a;if(this.imageData){this.imageData.filter=this.filter;this.redraw(true)}};PACS.View.prototype.flip=function(a){if(this.imageData){if(a){this.addDwTrans(-1,0,0,1)}else{this.addDwTrans(1,0,0,-1)}this.redraw(false)}};PACS.View.prototype.axescvt=function(b,h){var e=this.drawInfo;var b=(b-e.ox)/e.scale;var h=(h-e.oy)/e.scale;var c=e.transform;var a=e.sw/2;var g=e.sh/2;switch(e.rotate){case 0:break;case 90:break;case 180:break;case 270:break;default:break}var f=transXY(b-a,h-g,c.A1,c.B1,c.C1,c.D1);f[0]+=a;f[1]+=g;return f};PACS.View.prototype.resetDwinfo=function(){this.drawInfo=null;this.wlInfo=null;this.lut=null;this.filter=null};PACS.View.prototype.cancelDrawing=function(){var a=this.imageData;if(a){if(a.cancelDrawing()){this.redraw(false)}}};PACS.View.prototype.reset=function(b){if(!this.image||!this.drawInfo){return}var c=this.imageData;this.updateDwWraper();switch(b){case ResetTool.ALL:this.resetDwinfo();this.initDrawInfo();if(this.imageData){if(0){this.series.mpr.destroy()}else{this.wlInfo=this.imageData.resetWwc();this.imageData.reset();this.redraw(true)}}return;case ResetTool.ORIGINAL_SIZE:this.drawInfo.scale=1;centerDrawInfo(this.drawInfo,this.canvas.width,this.canvas.height,this.image.width,this.image.height);this.updateDwWraper();break;case ResetTool.AUTO_SIZE:this.initDrawInfo();break;case ResetTool.CT_WL:this.resetWwc();break;case ResetTool.LUT:this.lut=null;break;case ResetTool.FILTER:this.filter=null;break;case ResetTool.MARK_TEST:if(c){c.drawObjects=[];c.lastDrawObject=null}break;case ResetTool.ROTATE:this.resetDwTrans();if(c){c.inverse=false}break;case ResetTool.MPR:if(this.isMprMode()){this.series.mpr.destroy()}return;case ResetTool.VR:if(this.isVrMode()){this.vr.destroy();delete this.vr;this.vr=null;this.vrInit=false;var a=this.series;this.setSeries(null);this.setSeries(a)}break;default:break}if(!c){return}c.wwc=this.wlInfo;c.lut=this.lut;c.filter=this.filter;this.redraw(true)};PACS.View.prototype.resetWwc=function(){if(this.imageData){this.wlInfo=this.imageData.resetWwc();this.updateWLInfo();this.redraw(true)}};PACS.View.prototype.zoomIn=function(e){var c=this.drawInfo.scale;this.drawInfo.scale*=e;if(this.drawInfo.scale<0.2&&this.drawInfo.scale*this.imageData.imageData.height<this.canvas.height/20){this.drawInfo.scale=this.canvas.height/20/this.imageData.imageData.height}else{if(this.drawInfo.scale>5&&this.drawInfo.scale*this.imageData.imageData.height>this.canvas.height*20){this.drawInfo.scale=this.canvas.height*20/this.imageData.imageData.height}}var b=(this.drawInfo.scale-c)*this.imageData.imageData.width;var a=(this.drawInfo.scale-c)*this.imageData.imageData.height;this.drawInfo.ox-=b/2;this.drawInfo.oy-=a/2;this.updateDwWraper()};PACS.View.prototype.onMprEvent=function(c,g,f,e){switch(c){case"cpi":this.initDrawInfo();this.zoomIn(0.7);case"cp":if(this.series.mprAxis==AXIS_X){this.changeImage(g-this.imageIndex,true,true)}else{if(this.series.mprAxis==AXIS_Y){this.changeImage(f-this.imageIndex,true,true)}else{if(this.series.mprAxis==AXIS_Z){this.changeImage(e-this.imageIndex,true,true)}}}break;case AXIS_X:case AXIS_Y:case AXIS_Z:if(this.series.mprAxis==c){this.changeImage(g-this.imageIndex,true)}else{this.draw()}break;case"de":var b=this.series;var a=b.mpr;this.setSeries(null);if(b==a.seriesZ){this.setSeries(b)}break;default:break}};PACS.View.prototype.startVR=function(a){if(!a){if(this.VR){delete this.VR;this.VR=null;this.redraw(false)}return}if(this.VR){return}this.VR=PACS.VR(this.series);this.redraw(false)};PACS.View.prototype.getTools=function(a){if(this.VR){return ActionTool.VR}return this.tools.tool};PACS.View.prototype.getImageModality=function(){if(this.image){this.image.Modality}return""};PACS.View.prototype.isCTImage=function(){return(this.getImageModality()==="CT")};PACS.View.prototype.playImage=function(a){if(a){if(!this.imagePlayer){this.imagePlayer=new PACS.ImagePlayer(this)}if(this.imagePlayer.playing){return}this.imagePlayer.play()}else{if(this.imagePlayer){this.imagePlayer.stop()}else{return}}if(this.listeners.onPlaying){this.listeners.onPlaying(a)}};PACS.View.prototype.isPlayingImage=function(){return this.imagePlayer&&this.imagePlayer.playing};PACS.View.prototype.getImagePlayer=function(){return this.imagePlayer};PACS.View.prototype.next=function(){if(!this.series||!this.series.images){return}var a=this.imageIndex+1;a%=this.series.images.length;this.changeImage(1,false)};