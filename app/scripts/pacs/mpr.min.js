var AXIS_X=1;var AXIS_Y=2;var AXIS_Z=3;PACS.MPR=function(a){if(!this instanceof PACS.MPR){return new PACS.MPR()}this.seriesZ=a;a.mpr=this;a.mprAxis=AXIS_Z;seriesX=new PACS.Series();seriesX.mpr=this;seriesX.mprAxis=AXIS_X;seriesX.copyBasic(a);seriesX.SeriesDescription+="[MPR]";seriesX.mprAxisZ=a;this.seriesX=seriesX;seriesY=new PACS.Series();seriesY.mpr=this;seriesY.mprAxis=AXIS_Y;seriesY.copyBasic(a);seriesY.SeriesDescription+="[MPR]";seriesY.mprAxisZ=a;this.seriesY=seriesY;this.x=this.y=this.z=0};PACS.MPRCheck=function(b){var a=b.images;if(!a.length){return"No images for MPR!"}if(a[a.length-1].loadState!=2){return"Not all images are loaded!"}var c=a[0];if(c.Modality!="CT"){return"Not CT images"}return true};PACS.MPR.prototype.destroy=function(){this.onEvent("de");this.seriesX.destroy();this.seriesY.destroy();delete this.seriesX;delete this.seriesY;delete this.seriesZ.mpr;delete this.seriesZ.mprAxis;this.seriesZ=null};PACS.MPR.prototype.initAxis=function(c,b,a){this.sizeX=c;this.sizeY=b;this.sizeZ=a;this.z=0;this.x=0;this.y=0};PACS.MPR.prototype.getX=function(){return this.x};PACS.MPR.prototype.getY=function(){return this.y};PACS.MPR.prototype.getZ=function(){return this.z};PACS.MPR.prototype.onLoadDone=function(){this.x=parseInt(this.sizeX/2);this.y=parseInt(this.sizeY/2);this.z=parseInt(this.sizeZ/2);this.onEvent("cpi",this.x,this.y,this.z)};PACS.MPR.prototype.onEvent=function(a,d,c,b){this.lastEvent=a;this.seriesZ.onMprEvent(a,d,c,b);this.seriesX.onMprEvent(a,d,c,b);this.seriesY.onMprEvent(a,d,c,b)};PACS.MPR.prototype.getLastEvent=function(){return this.lastEvent};PACS.MPR.prototype.setAxisIdx=function(b,a,c){if(b==AXIS_Z){this.z=a}else{if(b==AXIS_X){this.x=a}else{if(b==AXIS_Y){this.y=a}}}if(c){this.onEvent(b,a)}};PACS.MPR.prototype.setAxises=function(a,c,b){this.x=a;this.y=c;this.z=b;this.onEvent("cp",a,c,b)};PACS.MPR.prototype.createImages=function(p){var a=this.seriesZ;var c=this.seriesX;var b=this.seriesY;var g=a.images;var h=g.length;if(!h){p(false);return false}var d=g[0];var l=d.width;var j=d.height;this.initAxis(l,j,h);var o,k,i,q,n,f,e,m;c.images=new Array(l);for(o=0;o<l;o++){n=new PACS.Image();n.copyBasic(d);n.dataSet={};n.InstanceNumber=o+1;n.Rows=n.height=h;n.Columns=n.width=j;n.ContrastBolusAgent+="[MPR]";n.SliceThickness=d.columnPixelSpacing;n.SliceLocation=o*parseInt(d.SliceThickness);n.columnPixelSpacing=d.SliceThickness;n.rowPixelSpacing=d.rowPixelSpacing;e=new Int16Array(h*j);for(i=0;i<h;i++){f=g[i];m=f.data;for(k=0;k<j;k++){e[i*j+k]=f.data[k*l+o]}}n.data=e;n.mprInit();c.images[o]=n;c.onImageloaded(o,n);c.loadIdx=o+1}b.images=new Array(j);for(k=0;k<j;k++){n=new PACS.Image();n.copyBasic(d);n.dataSet={};n.InstanceNumber=k+1;n.Rows=n.height=h;n.Columns=n.width=l;n.ContrastBolusAgent+="[MPR]";n.SliceThickness=d.rowPixelSpacing;n.SliceLocation=k*parseInt(d.SliceThickness);n.columnPixelSpacing=d.columnPixelSpacing;n.rowPixelSpacing=d.SliceThickness;e=new Int16Array(h*l);for(i=0;i<h;i++){f=g[i];m=f.data;for(o=0;o<l;o++){e[i*l+o]=f.data[k*l+o]}}n.data=e;n.mprInit();b.images[k]=n;b.onImageloaded(k,n);b.loadIdx=k+1}this.onLoadDone();p(true);return true};