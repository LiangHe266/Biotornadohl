/*! cornerstone - v0.8.1 - 2015-06-16 | (c) 2014 Chris Hafey | https://github.com/chafey/cornerstone */
;if(typeof cornerstone==="undefined"){cornerstone={internal:{},rendering:{}}}(function(b){function a(e){if(e===undefined){throw"disable: element element must not be undefined"}var c=b.getEnabledElements();for(var d=0;d<c.length;d++){if(c[d].element===e){var f={element:e};$(e).trigger("CornerstoneElementDisabled",f);c[d].element.removeChild(c[d].canvas);c.splice(d,1);return}}}b.disable=a}(cornerstone));(function(c,b){function a(g,e,h){if(g===undefined){throw"displayImage: parameter element cannot be undefined"}if(e===undefined){throw"displayImage: parameter image cannot be undefined"}var j=b.getEnabledElement(g);j.image=e;if(j.viewport===undefined){j.viewport=b.internal.getDefaultViewport(j.canvas,e)}if(h){for(var f in h){if(h[f]!==null){j.viewport[f]=h[f]}}}var d=new Date();var k;if(j.lastImageTimeStamp!==undefined){var i=d.getTime()-j.lastImageTimeStamp;k=(1000/i).toFixed()}else{}j.lastImageTimeStamp=d.getTime();var l={viewport:j.viewport,element:j.element,image:j.image,enabledElement:j,frameRate:k};c(j.element).trigger("CornerstoneNewImage",l);b.updateImage(g)}b.displayImage=a}($,cornerstone));(function(c,b){function a(e){var d=b.getEnabledElement(e);if(d.image===undefined){throw"draw: image has not been loaded yet"}b.drawImage(d)}b.draw=a}($,cornerstone));(function(c,b){function a(){var d=b.getEnabledElements();for(var f=0;f<d.length;f++){var e=d[f];if(e.invalid===true){b.drawImage(e)}}}b.drawInvalidated=a}($,cornerstone));(function(b){function a(d){if(d===undefined){throw"enable: parameter element cannot be undefined"}var c=document.createElement("canvas");d.appendChild(c);var e={element:d,canvas:c,image:undefined,invalid:false,data:{}};b.addEnabledElement(e);b.resize(d,true);return d}b.enable=a}(cornerstone));(function(b){function a(f,e){var d=b.getEnabledElement(f);if(d.data.hasOwnProperty(e)===false){d.data[e]={}}return d.data[e]}function c(f,e){var d=b.getEnabledElement(f);delete d.data[e]}b.getElementData=a;b.removeElementData=c}(cornerstone));(function(e){var c=[];function b(h){if(h===undefined){throw"getEnabledElement: parameter element must not be undefined"}for(var g=0;g<c.length;g++){if(c[g].element==h){return c[g]}}throw"element not enabled"}function d(g){if(g===undefined){throw"getEnabledElement: enabledElement element must not be undefined"}c.push(g)}function f(h){var g=[];c.forEach(function(i){if(i.image&&i.image.imageId===h){g.push(i)}});return g}function a(){return c}e.getEnabledElement=b;e.addEnabledElement=d;e.getEnabledElementsByImageId=f;e.getEnabledElements=a}(cornerstone));(function(b){function a(e){var d=b.getEnabledElement(e);var c=b.internal.getDefaultViewport(d.canvas,d.image);d.viewport.scale=c.scale;d.viewport.translation.x=c.translation.x;d.viewport.translation.y=c.translation.y;d.viewport.rotation=c.rotation;d.viewport.hflip=c.hflip;d.viewport.vflip=c.vflip;b.updateImage(e)}b.fitToWindow=a}(cornerstone));(function(c,b){function a(f,g){var e=b.getEnabledElement(f);var d=b.internal.getDefaultViewport(e.canvas,g);return d}b.getDefaultViewportForImage=a}($,cornerstone));(function(c,b){function a(e){var d=b.getEnabledElement(e);return d.image}b.getImage=a}($,cornerstone));(function(a){function b(f,j,i,e,l){var c=a.getStoredPixels(f,j,i,e,l);var g=a.getEnabledElement(f);var h=g.image.slope;var k=g.image.intercept;var d=c.map(function(m){return m*h+k});return d}a.getPixels=b}(cornerstone));(function(b){function a(g,k,j,d,l){if(g===undefined){throw"getStoredPixels: parameter element must not be undefined"}k=Math.round(k);j=Math.round(j);var h=b.getEnabledElement(g);var c=[];var i=0;var m=h.image.getPixelData();for(var n=0;n<l;n++){for(var f=0;f<d;f++){var e=((n+j)*h.image.columns)+(f+k);c[i++]=m[e]}}return c}b.getStoredPixels=a}(cornerstone));(function(b){function a(e){var d=b.getEnabledElement(e);var c=d.viewport;if(c===undefined){return undefined}return{scale:c.scale,translation:{x:c.translation.x,y:c.translation.y},voi:{windowWidth:c.voi.windowWidth,windowCenter:c.voi.windowCenter},invert:c.invert,pixelReplication:c.pixelReplication,rotation:c.rotation,hflip:c.hflip,vflip:c.vflip}}b.getViewport=a}(cornerstone));(function(b){var g={};var k=[];var a=1024*1024*1024;var f=0;function d(m){if(m===undefined){throw"setMaximumSizeBytes: parameter numBytes must not be undefined"}if(m.toFixed===undefined){throw"setMaximumSizeBytes: parameter numBytes must be a number"}a=m;h()}function h(){if(f<=a){return}function n(p,o){if(p.timeStamp>o.timeStamp){return -1}if(p.timeStamp<o.timeStamp){return 1}return 0}k.sort(n);while(f>a){var m=k[k.length-1];f-=m.sizeInBytes;delete g[m.imageId];m.imagePromise.reject();k.pop()}}function j(n,m){if(n===undefined){throw"getImagePromise: imageId must not be undefined"}if(m===undefined){throw"getImagePromise: imagePromise must not be undefined"}if(g.hasOwnProperty(n)===true){throw"putImagePromise: imageId already in cache"}var o={loaded:false,imageId:n,imagePromise:m,timeStamp:new Date(),sizeInBytes:0};g[n]=o;k.push(o);m.then(function(p){o.loaded=true;if(p.sizeInBytes===undefined){throw"putImagePromise: image does not have sizeInBytes property or"}if(p.sizeInBytes.toFixed===undefined){throw"putImagePromise: image.sizeInBytes is not a number"}o.sizeInBytes=p.sizeInBytes;f+=o.sizeInBytes;h()})}function l(m){if(m===undefined){throw"getImagePromise: imageId must not be undefined"}var n=g[m];if(n===undefined){return undefined}n.timeStamp=new Date();return n.imagePromise}function e(m){if(m===undefined){throw"removeImagePromise: imageId must not be undefined"}var n=g[m];if(n===undefined){throw"removeImagePromise: imageId must not be undefined"}k.splice(k.indexOf(n),1);f-=n.sizeInBytes;delete g[m];return n.imagePromise}function c(){return{maximumSizeInBytes:a,cacheSizeInBytes:f,numberOfImagesCached:k.length}}function i(){while(k.length>0){var m=k.pop();delete g[m.imageId];m.imagePromise.reject()}f=0}b.imageCache={putImagePromise:j,getImagePromise:l,removeImagePromise:e,setMaximumSizeBytes:d,getCacheInfo:c,purgeCache:i}}(cornerstone));(function(d,b){var i={};var e;function f(n){var l=n.indexOf(":");var k=n.substring(0,l);var j=i[k];var m;if(j===undefined||j===null){if(e!==undefined){m=e(n);return m}else{return undefined}}m=j(n);m.then(function(o){d(b).trigger("CornerstoneImageLoaded",{image:o})});return m}function a(k){if(k===undefined){throw"loadImage: parameter imageId must not be undefined"}var j=b.imageCache.getImagePromise(k);if(j!==undefined){return j}j=f(k);if(j===undefined){throw"loadImage: no image loader for imageId"}return j}function h(k){if(k===undefined){throw"loadAndCacheImage: parameter imageId must not be undefined"}var j=b.imageCache.getImagePromise(k);if(j!==undefined){return j}j=f(k);if(j===undefined){throw"loadAndCacheImage: no image loader for imageId"}b.imageCache.putImagePromise(k,j);return j}function g(k,j){i[k]=j}function c(j){var k=e;e=j;return k}b.loadImage=a;b.loadAndCacheImage=h;b.registerImageLoader=g;b.registerUnknownImageLoader=c}($,cornerstone));(function(a){function b(d,h){var c=new a.internal.Transform();c.translate(d.canvas.width/2,d.canvas.height/2);var g=d.viewport.rotation;if(g!==0){c.rotate(g*Math.PI/180)}var f=d.viewport.scale;var e=d.viewport.scale;if(d.image.rowPixelSpacing<d.image.columnPixelSpacing){f=f*(d.image.columnPixelSpacing/d.image.rowPixelSpacing)}else{if(d.image.columnPixelSpacing<d.image.rowPixelSpacing){e=e*(d.image.rowPixelSpacing/d.image.columnPixelSpacing)}}c.scale(f,e);if(g!==0){c.rotate(-g*Math.PI/180)}c.translate(d.viewport.translation.x,d.viewport.translation.y);if(g!==0){c.rotate(g*Math.PI/180)}if(h!==undefined){c.scale(h,h)}if(d.viewport.hflip){c.scale(-1,1)}if(d.viewport.vflip){c.scale(1,-1)}c.translate(-d.image.width/2,-d.image.height/2);return c}a.internal.calculateTransform=b}(cornerstone));(function(c,b){function a(f,i){var j=new Date();f.image.render(f,i);var e=f.canvas.getContext("2d");var d=new Date();var h=d-j;var g={viewport:f.viewport,element:f.element,image:f.image,enabledElement:f,canvasContext:e,renderTimeInMs:h};c(f.element).trigger("CornerstoneImageRendered",g);f.invalid=false}b.internal.drawImage=a;b.drawImage=a}($,cornerstone));(function(a){function b(i,e,d,c){if(i.lut===undefined){i.lut=new Int16Array(i.maxPixelValue-Math.min(i.minPixelValue,0)+1)}var o=i.lut;var r=i.maxPixelValue;var p=i.minPixelValue;var n=i.slope;var q=i.intercept;var m=e;var l=d;var k;var h;var g;var f;var j=0;if(p<0){j=p}if(c===true){for(f=i.minPixelValue;f<=r;f++){k=f*n+q;h=(((k-(l))/(m)+0.5)*255);g=Math.min(Math.max(h,0),255);o[f+(-j)]=Math.round(255-g)}}else{for(f=i.minPixelValue;f<=r;f++){k=f*n+q;h=(((k-(l))/(m)+0.5)*255);g=Math.min(Math.max(h,0),255);o[f+(-j)]=Math.round(g)}}}a.internal.generateLut=b;a.generateLut=b}(cornerstone));(function(b){function a(e,f){if(e===undefined){throw"getDefaultViewport: parameter canvas must not be undefined"}if(f===undefined){throw"getDefaultViewport: parameter image must not be undefined"}var c={scale:1,translation:{x:0,y:0},voi:{windowWidth:f.windowWidth,windowCenter:f.windowCenter},invert:f.invert,pixelReplication:false,rotation:0,hflip:false,vflip:false};var g=e.height/f.rows;var d=e.width/f.columns;if(d<g){c.scale=d}else{c.scale=g}return c}b.internal.getDefaultViewport=a;b.getDefaultViewport=a}(cornerstone));(function(b){function a(d){var c=b.internal.calculateTransform(d);return c}b.internal.getTransform=a}(cornerstone));(function(b,a){a.drawImage=a.internal.drawImage;a.generateLut=a.internal.generateLut;a.storedPixelDataToCanvasImageData=a.internal.storedPixelDataToCanvasImageData;a.storedColorPixelDataToCanvasImageData=a.internal.storedColorPixelDataToCanvasImageData}($,cornerstone));(function(a){function b(f,k,g){var l=f.minPixelValue;var h=0;var i=0;var c=f.width*f.height*4;var j=f.getPixelData();var e=k;var d=g;if(l<0){while(i<c){d[h++]=e[j[i++]+(-l)];d[h++]=e[j[i++]+(-l)];d[h]=e[j[i]+(-l)];i+=2;h+=2}}else{while(i<c){d[h++]=e[j[i++]];d[h++]=e[j[i++]];d[h]=e[j[i]];i+=2;h+=2}}}a.internal.storedColorPixelDataToCanvasImageData=b;a.storedColorPixelDataToCanvasImageData=b}(cornerstone));(function(b){function a(e,i,f){var m=e.getPixelData();var j=e.minPixelValue;var g=3;var h=0;var k=m.length;var l=m;var d=i;var c=f;if(j<0){while(h<k){c[g]=d[l[h++]+(-j)];g+=4}}else{while(h<k){c[g]=d[l[h++]];g+=4}}}b.internal.storedPixelDataToCanvasImageData=a;b.storedPixelDataToCanvasImageData=a}(cornerstone));(function(b){function a(){this.reset()}a.prototype.reset=function(){this.m=[1,0,0,1,0,0]};a.prototype.clone=function(){var c=new a();c.m[0]=this.m[0];c.m[1]=this.m[1];c.m[2]=this.m[2];c.m[3]=this.m[3];c.m[4]=this.m[4];c.m[5]=this.m[5];return c};a.prototype.multiply=function(e){var g=this.m[0]*e.m[0]+this.m[2]*e.m[1];var f=this.m[1]*e.m[0]+this.m[3]*e.m[1];var i=this.m[0]*e.m[2]+this.m[2]*e.m[3];var h=this.m[1]*e.m[2]+this.m[3]*e.m[3];var d=this.m[0]*e.m[4]+this.m[2]*e.m[5]+this.m[4];var c=this.m[1]*e.m[4]+this.m[3]*e.m[5]+this.m[5];this.m[0]=g;this.m[1]=f;this.m[2]=i;this.m[3]=h;this.m[4]=d;this.m[5]=c};a.prototype.invert=function(){var i=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]);var h=this.m[3]*i;var g=-this.m[1]*i;var f=-this.m[2]*i;var e=this.m[0]*i;var c=i*(this.m[2]*this.m[5]-this.m[3]*this.m[4]);var j=i*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=h;this.m[1]=g;this.m[2]=f;this.m[3]=e;this.m[4]=c;this.m[5]=j};a.prototype.rotate=function(d){var j=Math.cos(d);var e=Math.sin(d);var g=this.m[0]*j+this.m[2]*e;var f=this.m[1]*j+this.m[3]*e;var i=this.m[0]*-e+this.m[2]*j;var h=this.m[1]*-e+this.m[3]*j;this.m[0]=g;this.m[1]=f;this.m[2]=i;this.m[3]=h};a.prototype.translate=function(c,d){this.m[4]+=this.m[0]*c+this.m[2]*d;this.m[5]+=this.m[1]*c+this.m[3]*d};a.prototype.scale=function(d,c){this.m[0]*=d;this.m[1]*=d;this.m[2]*=c;this.m[3]*=c};a.prototype.transformPoint=function(e,d){var c=e;var f=d;e=c*this.m[0]+f*this.m[2]+this.m[4];d=c*this.m[1]+f*this.m[3]+this.m[5];return{x:e,y:d}};b.internal.Transform=a}(cornerstone));(function(a){function b(d){var c=a.getEnabledElement(d);c.invalid=true;var e={element:d};$(c.element).trigger("CornerstoneInvalidated",e)}a.invalidate=b}(cornerstone));(function(b){function a(d){var c=b.getEnabledElementsByImageId(d);c.forEach(function(e){b.drawImage(e,true)})}b.invalidateImageId=a}(cornerstone));(function(a){function b(i,h,g){var k=a.getEnabledElement(i);if(k.image===undefined){throw"image has not been loaded yet"}var f=k.image;var j=i.getBoundingClientRect();var d=h-j.left-window.pageXOffset;var c=g-j.top-window.pageYOffset;var l={x:d,y:c};var e=a.internal.getTransform(k);e.invert();return e.transformPoint(l.x,l.y)}a.pageToPixel=b}(cornerstone));(function(a){function b(e,f){var d=a.getEnabledElement(e);var c=a.internal.getTransform(d);return c.transformPoint(f.x,f.y)}a.pixelToCanvas=b}(cornerstone));(function(c){var d=document.createElement("canvas");var h;var i;var k;var a={};function j(l){d.width=l.width;d.height=l.height;h=d.getContext("2d");h.fillStyle="white";h.fillRect(0,0,d.width,d.height);i=h.getImageData(0,0,l.width,l.height)}function e(m,l){if(m.lut!==undefined&&m.lut.windowCenter===l.voi.windowCenter&&m.lut.windowWidth===l.voi.windowWidth&&m.lut.invert===l.invert){return m.lut}c.generateLut(m,l.voi.windowWidth,l.voi.windowCenter,l.invert);m.lut.windowWidth=l.voi.windowWidth;m.lut.windowCenter=l.voi.windowCenter;m.lut.invert=l.invert;return m.lut}function b(l,m){if(m.imageId!==k||a.windowCenter!==l.viewport.voi.windowCenter||a.windowWidth!==l.viewport.voi.windowWidth||a.invert!==l.viewport.invert||a.rotation!==l.viewport.rotation||a.hflip!==l.viewport.hflip||a.vflip!==l.viewport.vflip){return true}return false}function g(l,n,m){if(l.viewport.voi.windowWidth===l.image.windowWidth&&l.viewport.voi.windowCenter===l.image.windowCenter&&l.viewport.invert===false){return n.getCanvas()}else{if(b(l,n)===false&&m!==true){return d}if(d.width!==n.width||d.height!=n.height){j(n)}var o=e(n,l.viewport);c.storedColorPixelDataToCanvasImageData(n,o,i.data);h.putImageData(i,0,0);return d}}function f(n,p){if(n===undefined){throw"drawImage: enabledElement parameter must not be undefined"}var o=n.image;if(o===undefined){throw"drawImage: image must be loaded before it can be drawn"}var m=n.canvas.getContext("2d");m.setTransform(1,0,0,1,0,0);m.fillStyle="black";m.fillRect(0,0,n.canvas.width,n.canvas.height);if(n.viewport.pixelReplication===true){m.imageSmoothingEnabled=false;m.mozImageSmoothingEnabled=false}else{m.imageSmoothingEnabled=true;m.mozImageSmoothingEnabled=true}m.save();c.setToPixelCoordinateSystem(n,m);var l=g(n,o,p);m.drawImage(l,0,0,o.width,o.height,0,0,o.width,o.height);m.restore();k=o.imageId;a.windowCenter=n.viewport.voi.windowCenter;a.windowWidth=n.viewport.voi.windowWidth;a.invert=n.viewport.invert;a.rotation=n.viewport.rotation;a.hflip=n.viewport.hflip;a.vflip=n.viewport.vflip}c.rendering.colorImage=f;c.renderColorImage=f}(cornerstone));(function(c){var k=document.createElement("canvas");var j;var d;var i;var a={};function f(l){k.width=l.width;k.height=l.height;j=k.getContext("2d");j.fillStyle="white";j.fillRect(0,0,k.width,k.height);d=j.getImageData(0,0,l.width,l.height)}function e(n,l,m){if(n.lut!==undefined&&n.lut.windowCenter===l.voi.windowCenter&&n.lut.windowWidth===l.voi.windowWidth&&n.lut.invert===l.invert&&m!==true){return n.lut}c.generateLut(n,l.voi.windowWidth,l.voi.windowCenter,l.invert);n.lut.windowWidth=l.voi.windowWidth;n.lut.windowCenter=l.voi.windowCenter;n.lut.invert=l.invert;return n.lut}function b(l,m){if(m.imageId!==i||a.windowCenter!==l.viewport.voi.windowCenter||a.windowWidth!==l.viewport.voi.windowWidth||a.invert!==l.viewport.invert||a.rotation!==l.viewport.rotation||a.hflip!==l.viewport.hflip||a.vflip!==l.viewport.vflip){return true}return false}function g(m,o,n){if(b(m,o)===false&&n!==true){return k}if(k.width!==o.width||k.height!=o.height){f(o)}var l=e(o,m.viewport,n);c.storedPixelDataToCanvasImageData(o,l,d.data);j.putImageData(d,0,0);return k}function h(n,p){if(n===undefined){throw"drawImage: enabledElement parameter must not be undefined"}var o=n.image;if(o===undefined){throw"drawImage: image must be loaded before it can be drawn"}var m=n.canvas.getContext("2d");m.setTransform(1,0,0,1,0,0);m.fillStyle="black";m.fillRect(0,0,n.canvas.width,n.canvas.height);if(n.viewport.pixelReplication===true){m.imageSmoothingEnabled=false;m.mozImageSmoothingEnabled=false}else{m.imageSmoothingEnabled=true;m.mozImageSmoothingEnabled=true}c.setToPixelCoordinateSystem(n,m);var l=g(n,o,p);m.drawImage(l,0,0,o.width,o.height,0,0,o.width,o.height);i=o.imageId;a.windowCenter=n.viewport.voi.windowCenter;a.windowWidth=n.viewport.voi.windowWidth;a.invert=n.viewport.invert;a.rotation=n.viewport.rotation;a.hflip=n.viewport.hflip;a.vflip=n.viewport.vflip}c.rendering.grayscaleImage=h;c.renderGrayscaleImage=h}(cornerstone));(function(b){function a(d,f){if(d===undefined){throw"drawImage: enabledElement parameter must not be undefined"}var e=d.image;if(e===undefined){throw"drawImage: image must be loaded before it can be drawn"}var c=d.canvas.getContext("2d");c.setTransform(1,0,0,1,0,0);c.fillStyle="black";c.fillRect(0,0,d.canvas.width,d.canvas.height);if(d.viewport.pixelReplication===true){c.imageSmoothingEnabled=false;c.mozImageSmoothingEnabled=false}else{c.imageSmoothingEnabled=true;c.mozImageSmoothingEnabled=true}b.setToPixelCoordinateSystem(d,c);if(d.viewport.voi.windowWidth===d.image.windowWidth&&d.viewport.voi.windowCenter===d.image.windowCenter&&d.viewport.invert===false){c.drawImage(e.getImage(),0,0,e.width,e.height,0,0,e.width,e.height)}else{b.renderColorImage(d,f)}}b.rendering.webImage=a;b.renderWebImage=a}(cornerstone));(function(b){function c(e,d){d.width=e.clientWidth;d.height=e.clientHeight;d.style.width=e.clientWidth+"px";d.style.height=e.clientHeight+"px"}function a(e,f){var d=b.getEnabledElement(e);c(e,d.canvas);if(d.image===undefined){return}if(f===true){b.fitToWindow(e)}else{b.updateImage(e)}}b.resize=a}(cornerstone));(function(b){function a(e,d,f){if(e===undefined){throw"setToPixelCoordinateSystem: parameter enabledElement must not be undefined"}if(d===undefined){throw"setToPixelCoordinateSystem: parameter context must not be undefined"}var c=b.internal.calculateTransform(e,f);d.setTransform(c.m[0],c.m[1],c.m[2],c.m[3],c.m[4],c.m[5],c.m[6])}b.setToPixelCoordinateSystem=a}(cornerstone));(function(b){function a(e,c){var d=b.getEnabledElement(e);d.viewport.scale=c.scale;d.viewport.translation.x=c.translation.x;d.viewport.translation.y=c.translation.y;d.viewport.voi.windowWidth=c.voi.windowWidth;d.viewport.voi.windowCenter=c.voi.windowCenter;d.viewport.invert=c.invert;d.viewport.pixelReplication=c.pixelReplication;d.viewport.rotation=c.rotation;d.viewport.hflip=c.hflip;d.viewport.vflip=c.vflip;if(d.viewport.voi.windowWidth<1){d.viewport.voi.windowWidth=1}if(d.viewport.scale<0.0001){d.viewport.scale=0.25}if(d.viewport.rotation===360||d.viewport.rotation===-360){d.viewport.rotation=0}b.updateImage(e)}b.setViewport=a}(cornerstone));(function(b){function a(d,e){var c=b.getEnabledElement(d);if(c.image===undefined){throw"updateImage: image has not been loaded yet"}b.drawImage(c,e)}b.updateImage=a}(cornerstone));