/*! cornerstone-file-image-loader - v0.5.1 - 2015-04-04 | (c) 2014 Chris Hafey | https://github.com/chafey/cornerstoneFileImageLoader */
;var cornerstoneFileImageLoader=(function(f,e,a){if(a===undefined){a={}}function b(h){if(h==="RGB"||h==="PALETTE COLOR"||h==="YBR_FULL"||h==="YBR_FULL_422"||h==="YBR_PARTIAL_422"||h==="YBR_PARTIAL_420"||h==="YBR_RCT"){return true}else{return false}}function d(k,j,l){if(l===undefined){l=0}var i=k.string("x00280004");var h=b(i);if(h===false){return cornerstoneWADOImageLoader.makeGrayscaleImage(j,k,k.byteArray,i,l)}else{return cornerstoneWADOImageLoader.makeColorImage(j,k,k.byteArray,i,l)}}var c={};function g(l){var r=f.Deferred();var h=l;h=h.substring(12);var i=h.indexOf("frame=");var j;if(i!==-1){var n=h.substr(i+6);j=parseInt(n);h=h.substr(0,i-1)}if(j!==undefined&&c.hasOwnProperty(h)){var p=c[h];var q=d(p,l,j);q.then(function(s){r.resolve(s)},function(){r.reject()});return r}var k=parseInt(h);var m=a.getFile(k);if(m===undefined){r.reject("unknown file index "+h);return r}var o=new FileReader();o.onload=function(w){var t=w.target.result;var s=new Uint8Array(t);var v=dicomParser.parseDicom(s);if(j!==undefined){c[h]=v}var u=d(v,l,j);u.then(function(x){r.resolve(x)},function(){r.reject()})};o.readAsArrayBuffer(m);return r}e.registerImageLoader("dicomfile",g);return a}($,cornerstone,cornerstoneFileImageLoader));var cornerstoneFileImageLoader=(function(a){if(a===undefined){a={}}var c=[];function d(f){var g=c.push(f);return g-1}function e(f){return c[f]}function b(){c=[]}a.addFile=d;a.getFile=e;a.purge=b;return a}(cornerstoneFileImageLoader));/*! cornerstone - v0.8.1 - 2015-06-16 | (c) 2014 Chris Hafey | https://github.com/chafey/cornerstone */
;if(typeof cornerstone==="undefined"){cornerstone={internal:{},rendering:{}}}(function(b){function a(e){if(e===undefined){throw"disable: element element must not be undefined"}var c=b.getEnabledElements();for(var d=0;d<c.length;d++){if(c[d].element===e){var f={element:e};$(e).trigger("CornerstoneElementDisabled",f);c[d].element.removeChild(c[d].canvas);c.splice(d,1);return}}}b.disable=a}(cornerstone));(function(c,b){function a(g,e,h){if(g===undefined){throw"displayImage: parameter element cannot be undefined"}if(e===undefined){throw"displayImage: parameter image cannot be undefined"}var j=b.getEnabledElement(g);j.image=e;if(j.viewport===undefined){j.viewport=b.internal.getDefaultViewport(j.canvas,e)}if(h){for(var f in h){if(h[f]!==null){j.viewport[f]=h[f]}}}var d=new Date();var k;if(j.lastImageTimeStamp!==undefined){var i=d.getTime()-j.lastImageTimeStamp;k=(1000/i).toFixed()}else{}j.lastImageTimeStamp=d.getTime();var l={viewport:j.viewport,element:j.element,image:j.image,enabledElement:j,frameRate:k};c(j.element).trigger("CornerstoneNewImage",l);b.updateImage(g)}b.displayImage=a}($,cornerstone));(function(c,b){function a(e){var d=b.getEnabledElement(e);if(d.image===undefined){throw"draw: image has not been loaded yet"}b.drawImage(d)}b.draw=a}($,cornerstone));(function(c,b){function a(){var d=b.getEnabledElements();for(var f=0;f<d.length;f++){var e=d[f];if(e.invalid===true){b.drawImage(e)}}}b.drawInvalidated=a}($,cornerstone));(function(b){function a(d){if(d===undefined){throw"enable: parameter element cannot be undefined"}var c=document.createElement("canvas");d.appendChild(c);var e={element:d,canvas:c,image:undefined,invalid:false,data:{}};b.addEnabledElement(e);b.resize(d,true);return d}b.enable=a}(cornerstone));(function(b){function a(f,e){var d=b.getEnabledElement(f);if(d.data.hasOwnProperty(e)===false){d.data[e]={}}return d.data[e]}function c(f,e){var d=b.getEnabledElement(f);delete d.data[e]}b.getElementData=a;b.removeElementData=c}(cornerstone));(function(e){var c=[];function b(h){if(h===undefined){throw"getEnabledElement: parameter element must not be undefined"}for(var g=0;g<c.length;g++){if(c[g].element==h){return c[g]}}throw"element not enabled"}function d(g){if(g===undefined){throw"getEnabledElement: enabledElement element must not be undefined"}c.push(g)}function f(h){var g=[];c.forEach(function(i){if(i.image&&i.image.imageId===h){g.push(i)}});return g}function a(){return c}e.getEnabledElement=b;e.addEnabledElement=d;e.getEnabledElementsByImageId=f;e.getEnabledElements=a}(cornerstone));(function(b){function a(e){var d=b.getEnabledElement(e);var c=b.internal.getDefaultViewport(d.canvas,d.image);d.viewport.scale=c.scale;d.viewport.translation.x=c.translation.x;d.viewport.translation.y=c.translation.y;d.viewport.rotation=c.rotation;d.viewport.hflip=c.hflip;d.viewport.vflip=c.vflip;b.updateImage(e)}b.fitToWindow=a}(cornerstone));(function(c,b){function a(f,g){var e=b.getEnabledElement(f);var d=b.internal.getDefaultViewport(e.canvas,g);return d}b.getDefaultViewportForImage=a}($,cornerstone));(function(c,b){function a(e){var d=b.getEnabledElement(e);return d.image}b.getImage=a}($,cornerstone));(function(a){function b(f,j,i,e,l){var c=a.getStoredPixels(f,j,i,e,l);var g=a.getEnabledElement(f);var h=g.image.slope;var k=g.image.intercept;var d=c.map(function(m){return m*h+k});return d}a.getPixels=b}(cornerstone));(function(b){function a(g,k,j,d,l){if(g===undefined){throw"getStoredPixels: parameter element must not be undefined"}k=Math.round(k);j=Math.round(j);var h=b.getEnabledElement(g);var c=[];var i=0;var m=h.image.getPixelData();for(var n=0;n<l;n++){for(var f=0;f<d;f++){var e=((n+j)*h.image.columns)+(f+k);c[i++]=m[e]}}return c}b.getStoredPixels=a}(cornerstone));(function(b){function a(e){var d=b.getEnabledElement(e);var c=d.viewport;if(c===undefined){return undefined}return{scale:c.scale,translation:{x:c.translation.x,y:c.translation.y},voi:{windowWidth:c.voi.windowWidth,windowCenter:c.voi.windowCenter},invert:c.invert,pixelReplication:c.pixelReplication,rotation:c.rotation,hflip:c.hflip,vflip:c.vflip}}b.getViewport=a}(cornerstone));(function(b){var g={};var k=[];var a=1024*1024*1024;var f=0;function d(m){if(m===undefined){throw"setMaximumSizeBytes: parameter numBytes must not be undefined"}if(m.toFixed===undefined){throw"setMaximumSizeBytes: parameter numBytes must be a number"}a=m;h()}function h(){if(f<=a){return}function n(p,o){if(p.timeStamp>o.timeStamp){return -1}if(p.timeStamp<o.timeStamp){return 1}return 0}k.sort(n);while(f>a){var m=k[k.length-1];f-=m.sizeInBytes;delete g[m.imageId];m.imagePromise.reject();k.pop()}}function j(n,m){if(n===undefined){throw"getImagePromise: imageId must not be undefined"}if(m===undefined){throw"getImagePromise: imagePromise must not be undefined"}if(g.hasOwnProperty(n)===true){throw"putImagePromise: imageId already in cache"}var o={loaded:false,imageId:n,imagePromise:m,timeStamp:new Date(),sizeInBytes:0};g[n]=o;k.push(o);m.then(function(p){o.loaded=true;if(p.sizeInBytes===undefined){throw"putImagePromise: image does not have sizeInBytes property or"}if(p.sizeInBytes.toFixed===undefined){throw"putImagePromise: image.sizeInBytes is not a number"}o.sizeInBytes=p.sizeInBytes;f+=o.sizeInBytes;h()})}function l(m){if(m===undefined){throw"getImagePromise: imageId must not be undefined"}var n=g[m];if(n===undefined){return undefined}n.timeStamp=new Date();return n.imagePromise}function e(m){if(m===undefined){throw"removeImagePromise: imageId must not be undefined"}var n=g[m];if(n===undefined){throw"removeImagePromise: imageId must not be undefined"}k.splice(k.indexOf(n),1);f-=n.sizeInBytes;delete g[m];return n.imagePromise}function c(){return{maximumSizeInBytes:a,cacheSizeInBytes:f,numberOfImagesCached:k.length}}function i(){while(k.length>0){var m=k.pop();delete g[m.imageId];m.imagePromise.reject()}f=0}b.imageCache={putImagePromise:j,getImagePromise:l,removeImagePromise:e,setMaximumSizeBytes:d,getCacheInfo:c,purgeCache:i}}(cornerstone));(function(d,b){var i={};var e;function f(n){var l=n.indexOf(":");var k=n.substring(0,l);var j=i[k];var m;if(j===undefined||j===null){if(e!==undefined){m=e(n);return m}else{return undefined}}m=j(n);m.then(function(o){d(b).trigger("CornerstoneImageLoaded",{image:o})});return m}function a(k){if(k===undefined){throw"loadImage: parameter imageId must not be undefined"}var j=b.imageCache.getImagePromise(k);if(j!==undefined){return j}j=f(k);if(j===undefined){throw"loadImage: no image loader for imageId"}return j}function h(k){if(k===undefined){throw"loadAndCacheImage: parameter imageId must not be undefined"}var j=b.imageCache.getImagePromise(k);if(j!==undefined){return j}j=f(k);if(j===undefined){throw"loadAndCacheImage: no image loader for imageId"}b.imageCache.putImagePromise(k,j);return j}function g(k,j){i[k]=j}function c(j){var k=e;e=j;return k}b.loadImage=a;b.loadAndCacheImage=h;b.registerImageLoader=g;b.registerUnknownImageLoader=c}($,cornerstone));(function(a){function b(d,h){var c=new a.internal.Transform();c.translate(d.canvas.width/2,d.canvas.height/2);var g=d.viewport.rotation;if(g!==0){c.rotate(g*Math.PI/180)}var f=d.viewport.scale;var e=d.viewport.scale;if(d.image.rowPixelSpacing<d.image.columnPixelSpacing){f=f*(d.image.columnPixelSpacing/d.image.rowPixelSpacing)}else{if(d.image.columnPixelSpacing<d.image.rowPixelSpacing){e=e*(d.image.rowPixelSpacing/d.image.columnPixelSpacing)}}c.scale(f,e);if(g!==0){c.rotate(-g*Math.PI/180)}c.translate(d.viewport.translation.x,d.viewport.translation.y);if(g!==0){c.rotate(g*Math.PI/180)}if(h!==undefined){c.scale(h,h)}if(d.viewport.hflip){c.scale(-1,1)}if(d.viewport.vflip){c.scale(1,-1)}c.translate(-d.image.width/2,-d.image.height/2);return c}a.internal.calculateTransform=b}(cornerstone));(function(c,b){function a(f,i){var j=new Date();f.image.render(f,i);var e=f.canvas.getContext("2d");var d=new Date();var h=d-j;var g={viewport:f.viewport,element:f.element,image:f.image,enabledElement:f,canvasContext:e,renderTimeInMs:h};c(f.element).trigger("CornerstoneImageRendered",g);f.invalid=false}b.internal.drawImage=a;b.drawImage=a}($,cornerstone));(function(a){function b(i,e,d,c){if(i.lut===undefined){i.lut=new Int16Array(i.maxPixelValue-Math.min(i.minPixelValue,0)+1)}var o=i.lut;var r=i.maxPixelValue;var p=i.minPixelValue;var n=i.slope;var q=i.intercept;var m=e;var l=d;var k;var h;var g;var f;var j=0;if(p<0){j=p}if(c===true){for(f=i.minPixelValue;f<=r;f++){k=f*n+q;h=(((k-(l))/(m)+0.5)*255);g=Math.min(Math.max(h,0),255);o[f+(-j)]=Math.round(255-g)}}else{for(f=i.minPixelValue;f<=r;f++){k=f*n+q;h=(((k-(l))/(m)+0.5)*255);g=Math.min(Math.max(h,0),255);o[f+(-j)]=Math.round(g)}}}a.internal.generateLut=b;a.generateLut=b}(cornerstone));(function(b){function a(e,f){if(e===undefined){throw"getDefaultViewport: parameter canvas must not be undefined"}if(f===undefined){throw"getDefaultViewport: parameter image must not be undefined"}var c={scale:1,translation:{x:0,y:0},voi:{windowWidth:f.windowWidth,windowCenter:f.windowCenter},invert:f.invert,pixelReplication:false,rotation:0,hflip:false,vflip:false};var g=e.height/f.rows;var d=e.width/f.columns;if(d<g){c.scale=d}else{c.scale=g}return c}b.internal.getDefaultViewport=a;b.getDefaultViewport=a}(cornerstone));(function(b){function a(d){var c=b.internal.calculateTransform(d);return c}b.internal.getTransform=a}(cornerstone));(function(b,a){a.drawImage=a.internal.drawImage;a.generateLut=a.internal.generateLut;a.storedPixelDataToCanvasImageData=a.internal.storedPixelDataToCanvasImageData;a.storedColorPixelDataToCanvasImageData=a.internal.storedColorPixelDataToCanvasImageData}($,cornerstone));(function(a){function b(f,k,g){var l=f.minPixelValue;var h=0;var i=0;var c=f.width*f.height*4;var j=f.getPixelData();var e=k;var d=g;if(l<0){while(i<c){d[h++]=e[j[i++]+(-l)];d[h++]=e[j[i++]+(-l)];d[h]=e[j[i]+(-l)];i+=2;h+=2}}else{while(i<c){d[h++]=e[j[i++]];d[h++]=e[j[i++]];d[h]=e[j[i]];i+=2;h+=2}}}a.internal.storedColorPixelDataToCanvasImageData=b;a.storedColorPixelDataToCanvasImageData=b}(cornerstone));(function(b){function a(e,i,f){var m=e.getPixelData();var j=e.minPixelValue;var g=3;var h=0;var k=m.length;var l=m;var d=i;var c=f;if(j<0){while(h<k){c[g]=d[l[h++]+(-j)];g+=4}}else{while(h<k){c[g]=d[l[h++]];g+=4}}}b.internal.storedPixelDataToCanvasImageData=a;b.storedPixelDataToCanvasImageData=a}(cornerstone));(function(b){function a(){this.reset()}a.prototype.reset=function(){this.m=[1,0,0,1,0,0]};a.prototype.clone=function(){var c=new a();c.m[0]=this.m[0];c.m[1]=this.m[1];c.m[2]=this.m[2];c.m[3]=this.m[3];c.m[4]=this.m[4];c.m[5]=this.m[5];return c};a.prototype.multiply=function(e){var g=this.m[0]*e.m[0]+this.m[2]*e.m[1];var f=this.m[1]*e.m[0]+this.m[3]*e.m[1];var i=this.m[0]*e.m[2]+this.m[2]*e.m[3];var h=this.m[1]*e.m[2]+this.m[3]*e.m[3];var d=this.m[0]*e.m[4]+this.m[2]*e.m[5]+this.m[4];var c=this.m[1]*e.m[4]+this.m[3]*e.m[5]+this.m[5];this.m[0]=g;this.m[1]=f;this.m[2]=i;this.m[3]=h;this.m[4]=d;this.m[5]=c};a.prototype.invert=function(){var i=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]);var h=this.m[3]*i;var g=-this.m[1]*i;var f=-this.m[2]*i;var e=this.m[0]*i;var c=i*(this.m[2]*this.m[5]-this.m[3]*this.m[4]);var j=i*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=h;this.m[1]=g;this.m[2]=f;this.m[3]=e;this.m[4]=c;this.m[5]=j};a.prototype.rotate=function(d){var j=Math.cos(d);var e=Math.sin(d);var g=this.m[0]*j+this.m[2]*e;var f=this.m[1]*j+this.m[3]*e;var i=this.m[0]*-e+this.m[2]*j;var h=this.m[1]*-e+this.m[3]*j;this.m[0]=g;this.m[1]=f;this.m[2]=i;this.m[3]=h};a.prototype.translate=function(c,d){this.m[4]+=this.m[0]*c+this.m[2]*d;this.m[5]+=this.m[1]*c+this.m[3]*d};a.prototype.scale=function(d,c){this.m[0]*=d;this.m[1]*=d;this.m[2]*=c;this.m[3]*=c};a.prototype.transformPoint=function(e,d){var c=e;var f=d;e=c*this.m[0]+f*this.m[2]+this.m[4];d=c*this.m[1]+f*this.m[3]+this.m[5];return{x:e,y:d}};b.internal.Transform=a}(cornerstone));(function(a){function b(d){var c=a.getEnabledElement(d);c.invalid=true;var e={element:d};$(c.element).trigger("CornerstoneInvalidated",e)}a.invalidate=b}(cornerstone));(function(b){function a(d){var c=b.getEnabledElementsByImageId(d);c.forEach(function(e){b.drawImage(e,true)})}b.invalidateImageId=a}(cornerstone));(function(a){function b(i,h,g){var k=a.getEnabledElement(i);if(k.image===undefined){throw"image has not been loaded yet"}var f=k.image;var j=i.getBoundingClientRect();var d=h-j.left-window.pageXOffset;var c=g-j.top-window.pageYOffset;var l={x:d,y:c};var e=a.internal.getTransform(k);e.invert();return e.transformPoint(l.x,l.y)}a.pageToPixel=b}(cornerstone));(function(a){function b(e,f){var d=a.getEnabledElement(e);var c=a.internal.getTransform(d);return c.transformPoint(f.x,f.y)}a.pixelToCanvas=b}(cornerstone));(function(c){var d=document.createElement("canvas");var h;var i;var k;var a={};function j(l){d.width=l.width;d.height=l.height;h=d.getContext("2d");h.fillStyle="white";h.fillRect(0,0,d.width,d.height);i=h.getImageData(0,0,l.width,l.height)}function e(m,l){if(m.lut!==undefined&&m.lut.windowCenter===l.voi.windowCenter&&m.lut.windowWidth===l.voi.windowWidth&&m.lut.invert===l.invert){return m.lut}c.generateLut(m,l.voi.windowWidth,l.voi.windowCenter,l.invert);m.lut.windowWidth=l.voi.windowWidth;m.lut.windowCenter=l.voi.windowCenter;m.lut.invert=l.invert;return m.lut}function b(l,m){if(m.imageId!==k||a.windowCenter!==l.viewport.voi.windowCenter||a.windowWidth!==l.viewport.voi.windowWidth||a.invert!==l.viewport.invert||a.rotation!==l.viewport.rotation||a.hflip!==l.viewport.hflip||a.vflip!==l.viewport.vflip){return true}return false}function g(l,n,m){if(l.viewport.voi.windowWidth===l.image.windowWidth&&l.viewport.voi.windowCenter===l.image.windowCenter&&l.viewport.invert===false){return n.getCanvas()}else{if(b(l,n)===false&&m!==true){return d}if(d.width!==n.width||d.height!=n.height){j(n)}var o=e(n,l.viewport);c.storedColorPixelDataToCanvasImageData(n,o,i.data);h.putImageData(i,0,0);return d}}function f(n,p){if(n===undefined){throw"drawImage: enabledElement parameter must not be undefined"}var o=n.image;if(o===undefined){throw"drawImage: image must be loaded before it can be drawn"}var m=n.canvas.getContext("2d");m.setTransform(1,0,0,1,0,0);m.fillStyle="black";m.fillRect(0,0,n.canvas.width,n.canvas.height);if(n.viewport.pixelReplication===true){m.imageSmoothingEnabled=false;m.mozImageSmoothingEnabled=false}else{m.imageSmoothingEnabled=true;m.mozImageSmoothingEnabled=true}m.save();c.setToPixelCoordinateSystem(n,m);var l=g(n,o,p);m.drawImage(l,0,0,o.width,o.height,0,0,o.width,o.height);m.restore();k=o.imageId;a.windowCenter=n.viewport.voi.windowCenter;a.windowWidth=n.viewport.voi.windowWidth;a.invert=n.viewport.invert;a.rotation=n.viewport.rotation;a.hflip=n.viewport.hflip;a.vflip=n.viewport.vflip}c.rendering.colorImage=f;c.renderColorImage=f}(cornerstone));(function(c){var k=document.createElement("canvas");var j;var d;var i;var a={};function f(l){k.width=l.width;k.height=l.height;j=k.getContext("2d");j.fillStyle="white";j.fillRect(0,0,k.width,k.height);d=j.getImageData(0,0,l.width,l.height)}function e(n,l,m){if(n.lut!==undefined&&n.lut.windowCenter===l.voi.windowCenter&&n.lut.windowWidth===l.voi.windowWidth&&n.lut.invert===l.invert&&m!==true){return n.lut}c.generateLut(n,l.voi.windowWidth,l.voi.windowCenter,l.invert);n.lut.windowWidth=l.voi.windowWidth;n.lut.windowCenter=l.voi.windowCenter;n.lut.invert=l.invert;return n.lut}function b(l,m){if(m.imageId!==i||a.windowCenter!==l.viewport.voi.windowCenter||a.windowWidth!==l.viewport.voi.windowWidth||a.invert!==l.viewport.invert||a.rotation!==l.viewport.rotation||a.hflip!==l.viewport.hflip||a.vflip!==l.viewport.vflip){return true}return false}function g(m,o,n){if(b(m,o)===false&&n!==true){return k}if(k.width!==o.width||k.height!=o.height){f(o)}var l=e(o,m.viewport,n);c.storedPixelDataToCanvasImageData(o,l,d.data);j.putImageData(d,0,0);return k}function h(n,p){if(n===undefined){throw"drawImage: enabledElement parameter must not be undefined"}var o=n.image;if(o===undefined){throw"drawImage: image must be loaded before it can be drawn"}var m=n.canvas.getContext("2d");m.setTransform(1,0,0,1,0,0);m.fillStyle="black";m.fillRect(0,0,n.canvas.width,n.canvas.height);if(n.viewport.pixelReplication===true){m.imageSmoothingEnabled=false;m.mozImageSmoothingEnabled=false}else{m.imageSmoothingEnabled=true;m.mozImageSmoothingEnabled=true}c.setToPixelCoordinateSystem(n,m);var l=g(n,o,p);m.drawImage(l,0,0,o.width,o.height,0,0,o.width,o.height);i=o.imageId;a.windowCenter=n.viewport.voi.windowCenter;a.windowWidth=n.viewport.voi.windowWidth;a.invert=n.viewport.invert;a.rotation=n.viewport.rotation;a.hflip=n.viewport.hflip;a.vflip=n.viewport.vflip}c.rendering.grayscaleImage=h;c.renderGrayscaleImage=h}(cornerstone));(function(b){function a(d,f){if(d===undefined){throw"drawImage: enabledElement parameter must not be undefined"}var e=d.image;if(e===undefined){throw"drawImage: image must be loaded before it can be drawn"}var c=d.canvas.getContext("2d");c.setTransform(1,0,0,1,0,0);c.fillStyle="black";c.fillRect(0,0,d.canvas.width,d.canvas.height);if(d.viewport.pixelReplication===true){c.imageSmoothingEnabled=false;c.mozImageSmoothingEnabled=false}else{c.imageSmoothingEnabled=true;c.mozImageSmoothingEnabled=true}b.setToPixelCoordinateSystem(d,c);if(d.viewport.voi.windowWidth===d.image.windowWidth&&d.viewport.voi.windowCenter===d.image.windowCenter&&d.viewport.invert===false){c.drawImage(e.getImage(),0,0,e.width,e.height,0,0,e.width,e.height)}else{b.renderColorImage(d,f)}}b.rendering.webImage=a;b.renderWebImage=a}(cornerstone));(function(b){function c(e,d){d.width=e.clientWidth;d.height=e.clientHeight;d.style.width=e.clientWidth+"px";d.style.height=e.clientHeight+"px"}function a(e,f){var d=b.getEnabledElement(e);c(e,d.canvas);if(d.image===undefined){return}if(f===true){b.fitToWindow(e)}else{b.updateImage(e)}}b.resize=a}(cornerstone));(function(b){function a(e,d,f){if(e===undefined){throw"setToPixelCoordinateSystem: parameter enabledElement must not be undefined"}if(d===undefined){throw"setToPixelCoordinateSystem: parameter context must not be undefined"}var c=b.internal.calculateTransform(e,f);d.setTransform(c.m[0],c.m[1],c.m[2],c.m[3],c.m[4],c.m[5],c.m[6])}b.setToPixelCoordinateSystem=a}(cornerstone));(function(b){function a(e,c){var d=b.getEnabledElement(e);d.viewport.scale=c.scale;d.viewport.translation.x=c.translation.x;d.viewport.translation.y=c.translation.y;d.viewport.voi.windowWidth=c.voi.windowWidth;d.viewport.voi.windowCenter=c.voi.windowCenter;d.viewport.invert=c.invert;d.viewport.pixelReplication=c.pixelReplication;d.viewport.rotation=c.rotation;d.viewport.hflip=c.hflip;d.viewport.vflip=c.vflip;if(d.viewport.voi.windowWidth<1){d.viewport.voi.windowWidth=1}if(d.viewport.scale<0.0001){d.viewport.scale=0.25}if(d.viewport.rotation===360||d.viewport.rotation===-360){d.viewport.rotation=0}b.updateImage(e)}b.setViewport=a}(cornerstone));(function(b){function a(d,e){var c=b.getEnabledElement(d);if(c.image===undefined){throw"updateImage: image has not been loaded yet"}b.drawImage(c,e)}b.updateImage=a}(cornerstone));/*! cornerstone-wado-image-loader - v0.7.0 - 2015-09-06 | (c) 2014 Chris Hafey | https://github.com/chafey/cornerstoneWADOImageLoader */
;if(typeof cornerstone==="undefined"){cornerstone={}}if(typeof cornerstoneWADOImageLoader==="undefined"){cornerstoneWADOImageLoader={internal:{options:{beforeSend:function(a){}},multiFrameCacheHack:{}}}}(function(a){function b(d,g,f){var e=d.uint16("x00280006");if(e===0){a.convertRGBColorByPixel(g,f)}else{a.convertRGBColorByPlane(g,f)}}function c(g,h,k){var l=h.uint16("x00280010");var e=h.uint16("x00280011");var i=h.string("x00280004");g.height=l;g.width=e;var f=g.getContext("2d");var d=f.createImageData(e,l);var m=$.Deferred();try{if(i==="RGB"){b(h,k,d.data)}else{if(i==="YBR_RCT"){b(h,k,d.data)}else{if(i==="YBR_ICT"){b(h,k,d.data)}else{if(i==="PALETTE COLOR"){a.convertPALETTECOLOR(k,d.data,h)}else{if(i==="YBR_FULL_422"){a.convertYBRFull(k,d.data)}else{if(i==="YBR_FULL"){a.convertYBRFull(k,d.data)}else{throw"no color space conversion for photometric interpretation "+i}}}}}}m.resolve(d);return m}catch(j){m.reject(j);return m}}a.convertColorSpace=c}(cornerstoneWADOImageLoader));(function(b){function a(m,r,k){var l=k.int16("x00281101",0);var d=k.int16("x00281101",1);var q=k.int16("x00281101",2);var f=(q===8?0:8);var h=k.byteArray.buffer;var p=new Uint16Array(h,k.elements.x00281201.dataOffset,l);var o=new Uint16Array(h,k.elements.x00281202.dataOffset,l);var g=new Uint16Array(h,k.elements.x00281203.dataOffset,l);var e=k.uint16("x00280010")*k.uint16("x00280011");var s=0;var c=0;for(var j=0;j<e;++j){var n=m[s++];if(n<d){n=0}else{if(n>d+l-1){n=l-1}else{n=n-d}}r[c++]=p[n]>>f;r[c++]=o[n]>>f;r[c++]=g[n]>>f;r[c++]=255}}b.convertPALETTECOLOR=a}(cornerstoneWADOImageLoader));(function(a){function b(e,d){if(e===undefined){throw"decodeRGB: rgbBuffer must not be undefined"}if(e.length%3!==0){throw"decodeRGB: rgbBuffer length must be divisible by 3"}var h=e.length/3;var f=0;var g=0;for(var c=0;c<h;c++){d[g++]=e[f++];d[g++]=e[f++];d[g++]=e[f++];d[g++]=255}}a.convertRGBColorByPixel=b}(cornerstoneWADOImageLoader));(function(a){function b(f,e){if(f===undefined){throw"decodeRGB: rgbBuffer must not be undefined"}if(f.length%3!==0){throw"decodeRGB: rgbBuffer length must be divisible by 3"}var k=f.length/3;var j=0;for(var d=0;d<k;d++){var h=0;var g=k;var c=k*2;for(var d=0;d<k;d++){e[j++]=f[h++];e[j++]=f[g++];e[j++]=f[c++];e[j++]=255}}}a.convertRGBColorByPlane=b}(cornerstoneWADOImageLoader));(function(a){function b(j,l){if(j===undefined){throw"decodeRGB: ybrBuffer must not be undefined"}if(j.length%3!==0){throw"decodeRGB: ybrBuffer length must be divisble by 3"}var d=j.length/3;var k=0;var c=0;for(var f=0;f<d;f++){var h=j[k++];var e=j[k++];var g=j[k++];l[c++]=h+1.402*(g-128);l[c++]=h-0.34414*(e-128)-0.71414*(g-128);l[c++]=h+1.772*(e-128);l[c++]=255}}a.convertYBRFull=b}(cornerstoneWADOImageLoader));(function(b){function a(c){b.internal.options=c}b.configure=a}(cornerstoneWADOImageLoader));(function(c,b,a){function d(h){var k=h.indexOf(":");var e=h.substring(k+1);var f=e.indexOf("frame=");var g;if(f!==-1){var i=e.substr(f+6);g=parseInt(i);e=e.substr(0,f-1)}if(g!==undefined&&a.internal.multiFrameCacheHack.hasOwnProperty(e)){var m=c.Deferred();var j=a.internal.multiFrameCacheHack[e];var l=a.createImageObject(j,h,g);l.then(function(n){m.resolve(n)},function(n){m.reject(n)});return m}return a.internal.xhrRequest(h,g,e)}b.loadImage=d;b.registerImageLoader("dicomweb",d);b.registerImageLoader("wadouri",d)}($,cornerstone,cornerstoneWADOImageLoader));(function(b){function a(f,e,g){if(g===undefined){g=0}var d=f.string("x00280004");var c=b.isColorImage(d);if(c===false){return b.makeGrayscaleImage(e,f,g)}else{return b.makeColorImage(e,f,g)}}b.createImageObject=a}(cornerstoneWADOImageLoader));(function(d,c,b){function a(i,g){var m=i.uint16("x00280010");var f=i.uint16("x00280011");var e=dicomParser.readEncapsulatedPixelData(i,i.elements.x7fe00010,g);var j=new JpxImage();j.parse(e);var l=j.width;var o=j.height;if(l!==f){throw"JPEG2000 decoder returned width of "+l+", when "+f+" is expected"}if(o!==m){throw"JPEG2000 decoder returned width of "+o+", when "+m+" is expected"}var h=j.tiles.length;if(h!==1){throw"JPEG2000 decoder returned a tileCount of "+h+", when 1 is expected"}var k=j.tiles[0];var n=k.items;return n}b.decodeJPEG2000=a}($,cornerstone,cornerstoneWADOImageLoader));(function(c,b,a){function d(h,l){var f=h.elements.x7fe00010;var e=h.uint16("x00280010");var j=h.uint16("x00280011");var k=h.uint16("x00280100");var i=dicomParser.readEncapsulatedPixelData(h,f,l);var g=new JpegImage();g.parse(i);if(k===8){return g.getData(j,e)}else{if(k===16){return g.getData16(j,e)}}}a.decodeJPEGBaseline=d}($,cornerstone,cornerstoneWADOImageLoader));(function(d){function c(f){return a(String.fromCharCode.apply(null,Array.prototype.slice.apply(new Uint8Array(f))))}function a(h){var f;try{return decodeURIComponent(escape(h))}catch(g){f=g;if(f instanceof URIError){return h}else{throw f}}}function b(i,j,h){var m=$.Deferred();var l=j.uint16("x00280010");var g=j.uint16("x00280011");i.height=l;i.width=g;var n=dicomParser.readEncapsulatedPixelData(j,j.elements.x7fe00010,h);var k=new Blob([n],{type:"image/jpeg"});var f=new FileReader();if(f.readAsBinaryString===undefined){f.readAsArrayBuffer(k)}else{f.readAsBinaryString(k)}f.onload=function(){var o=new Image();o.onload=function(){var p=i.getContext("2d");p.drawImage(this,0,0);var q=p.getImageData(0,0,g,l);m.resolve(q)};o.onerror=function(p){m.reject(p)};if(f.readAsBinaryString===undefined){o.src="data:image/jpeg;base64,"+window.btoa(c(f.result))}else{o.src="data:image/jpeg;base64,"+window.btoa(f.result)}};return m}function e(g){var f=g.string("x00020010");var h=g.uint16("x00280100");if((h===8)&&f==="1.2.840.10008.1.2.4.50"){return true}}d.decodeJPEGBaseline8Bit=b;d.isJPEGBaseline8Bit=e}(cornerstoneWADOImageLoader));"use strict";(function(a){function b(h,d){var i=h.elements.x7fe00010;var g=h.uint16("x00280100");var f=h.uint16("x00280103");var j=dicomParser.readEncapsulatedPixelData(h,i,d);var c=g<=8?1:2;var e=new jpeg.lossless.Decoder();var k=e.decode(j.buffer,j.byteOffset,j.length,c);if(f===0){if(c===2){return new Uint16Array(k.buffer)}else{return new Uint8Array(k.buffer)}}else{return new Int16Array(k.buffer)}}a.decodeJPEGLossless=b}(cornerstoneWADOImageLoader));(function(c){function d(j,f){var n=j.uint16("x00280010");var e=j.uint16("x00280011");var k=j.uint16("x00280002");var l=j.elements.x7fe00010;var m=dicomParser.readEncapsulatedPixelData(j,l,f);var g=c.getPixelFormat(j);var h=e*n;var i;if(g===1){i=new ArrayBuffer(h*k);b(m,i,h,k);return new Uint8Array(i)}else{if(g===2){i=new ArrayBuffer(h*k*2);a(m,i,h);return new Uint16Array(i)}else{if(g===3){i=new ArrayBuffer(h*k*2);a(m,i,h);return new Int16Array(i)}}}}function b(u,f,h,w){var p=new DataView(u.buffer,u.byteOffset);var o=new DataView(u.buffer,u.byteOffset);var l=new DataView(f);var q=0;var t=p.getInt32(0,true);for(var y=0;y<t;++y){q=y;var x=p.getInt32((y+1)*4,true);var g=p.getInt32((y+2)*4,true);if(g===0){g=u.length}var r=h*t;while(x<g){var e=o.getInt8(x++);if(e>=0&&e<=127){for(var m=0;m<e+1&&q<r;++m){l.setInt8(q,o.getInt8(x++));q+=w}}else{if(e<=-1&&e>=-127){var v=o.getInt8(x++);for(var k=0;k<-e+1&&q<r;++k){l.setInt8(q,v);q+=w}}else{if(e===-128){}}}}}}function a(u,f,k){var q=new DataView(u.buffer,u.byteOffset);var p=new DataView(u.buffer,u.byteOffset);var m=new DataView(f);var t=q.getInt32(0,true);for(var x=0;x<t;++x){var r=0;var g=(x===0?1:0);var w=q.getInt32((x+1)*4,true);var h=q.getInt32((x+2)*4,true);if(h===0){h=u.length}while(w<h){var e=p.getInt8(w++);if(e>=0&&e<=127){for(var o=0;o<e+1&&r<k;++o){m.setInt8((r*2)+g,p.getInt8(w++));r++}}else{if(e<=-1&&e>=-127){var v=p.getInt8(w++);for(var l=0;l<-e+1&&r<k;++l){m.setInt8((r*2)+g,v);r++}}else{if(e===-128){}}}}}}c.decodeRLE=d}(cornerstoneWADOImageLoader));(function(a){function b(d,e){var c=d.string("x00020010");if(c==="1.2.840.10008.1.2"){return a.extractUncompressedPixels(d,e)}else{if(c==="1.2.840.10008.1.2.1"){return a.extractUncompressedPixels(d,e)}else{if(c==="1.2.840.10008.1.2.4.90"){return a.decodeJPEG2000(d,e)}else{if(c==="1.2.840.10008.1.2.4.91"){return a.decodeJPEG2000(d,e)}else{if(c==="1.2.840.10008.1.2.5"){return a.decodeRLE(d,e)}else{if(c==="1.2.840.10008.1.2.4.50"){return a.decodeJPEGBaseline(d,e)}else{if(c==="1.2.840.10008.1.2.4.51"){return a.decodeJPEGBaseline(d,e)}else{if(c==="1.2.840.10008.1.2.4.57"){return a.decodeJPEGLossless(d,e)}else{if(c==="1.2.840.10008.1.2.4.70"){return a.decodeJPEGLossless(d,e)}else{throw"no decoder for transfer syntax "+c}}}}}}}}}}a.decodeTransferSyntax=b}(cornerstoneWADOImageLoader));var ColorSpace={Unkown:0,Grayscale:1,AdobeRGB:2,RGB:3,CYMK:4};var JpegImage=(function jpegImage(){var g=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]);var f=4017;var o=799;var d=3406;var n=2276;var b=1567;var l=3784;var i=5793;var e=2896;function t(){}function h(B,C){var y=0,w=[],A,z,x=16;while(x>0&&!B[x-1]){x--}w.push({children:[],index:0});var v=w[0],u;for(A=0;A<x;A++){for(z=0;z<B[A];z++){v=w.pop();v.children[v.index]=C[y];while(v.index>0){v=w.pop()}v.index++;w.push(v);while(w.length<=A){w.push(u={children:[],index:0});v.children[v.index]=u.children;v=u}y++}if(A+1<x){w.push(u={children:[],index:0});v.children[v.index]=u.children;v=u}}return w[0].children}function q(v,w,u){return 64*((v.blocksPerLine+1)*w+u)}function c(am,Y,w,R,S,F,J,O,ad){var ak=w.precision;var G=w.samplesPerLine;var E=w.scanLines;var I=w.mcusPerLine;var M=w.progressive;var T=w.maxH,Q=w.maxV;var A=Y,C=0,H=0;function aa(){if(H>0){H--;return(C>>H)&1}C=am[Y++];if(C==255){var v=am[Y++];if(v){throw"unexpected marker: "+((C<<8)|v).toString(16)}}H=7;return C>>>7}function N(v){var ao=v;var ap;while((ap=aa())!==null){ao=ao[ap];if(typeof ao==="number"){return ao}if(typeof ao!=="object"){throw"invalid huffman sequence"}}return null}function x(v){var ap=0;while(v>0){var ao=aa();if(ao===null){return}ap=(ap<<1)|ao;v--}return ap}function W(v){var ao=x(v);if(ao>=1<<(v-1)){return ao}return ao+(-1<<v)+1}function V(at,aq){var av=N(at.huffmanTableDC);var au=av===0?0:W(av);at.blockData[aq]=(at.pred+=au);var ao=1;while(ao<64){var ap=N(at.huffmanTableAC);var aw=ap&15,v=ap>>4;if(aw===0){if(v<15){break}ao+=16;continue}ao+=v;var ar=g[ao];at.blockData[aq+ar]=W(aw);ao++}}function y(v,aq){var ao=N(v.huffmanTableDC);var ap=ao===0?0:(W(ao)<<ad);v.blockData[aq]=(v.pred+=ap)}function K(v,ao){v.blockData[ao]|=aa()<<ad}var P=0;function u(ap,av){if(P>0){P--;return}var ao=F,at=J;while(ao<=at){var v=N(ap.huffmanTableAC);var aq=v&15,ar=v>>4;if(aq===0){if(ar<15){P=x(ar)+(1<<ar)-1;break}ao+=16;continue}ao+=ar;var au=g[ao];ap.blockData[av+au]=W(aq)*(1<<ad);ao++}}var L=0,B;function U(ap,av){var ao=F,at=J,ar=0;while(ao<=at){var au=g[ao];switch(L){case 0:var v=N(ap.huffmanTableAC);var aq=v&15;ar=v>>4;if(aq===0){if(ar<15){P=x(ar)+(1<<ar);L=4}else{ar=16;L=1}}else{if(aq!==1){throw"invalid ACn encoding"}B=W(aq);L=ar?2:3}continue;case 1:case 2:if(ap.blockData[av+au]){ap.blockData[av+au]+=(aa()<<ad)}else{ar--;if(ar===0){L=L==2?3:0}}break;case 3:if(ap.blockData[av+au]){ap.blockData[av+au]+=(aa()<<ad)}else{ap.blockData[av+au]=B<<ad;L=0}break;case 4:if(ap.blockData[av+au]){ap.blockData[av+au]+=(aa()<<ad)}break}ao++}if(L===4){P--;if(P===0){L=0}}}function X(aw,v,ao,ax,ap){var aq=(ao/I)|0;var au=ao%I;var at=aq*aw.v+ax;var av=au*aw.h+ap;var ar=q(aw,at,av);v(aw,ar)}function af(ao,ar,ap){var aq=(ap/ao.blocksPerLine)|0;var v=ap%ao.blocksPerLine;var at=q(ao,aq,v);ar(ao,at)}var al=R.length;var aj,ah,ag,ae,ac;var D;if(M){if(F===0){D=O===0?y:K}else{D=O===0?u:U}}else{D=V}var ab=0,an;var z;if(al==1){z=R[0].blocksPerLine*R[0].blocksPerColumn}else{z=I*w.mcusPerColumn}if(!S){S=z}var ai,Z;while(ab<z){for(ah=0;ah<al;ah++){R[ah].pred=0}P=0;if(al==1){aj=R[0];for(ac=0;ac<S;ac++){af(aj,D,ab);ab++}}else{for(ac=0;ac<S;ac++){for(ah=0;ah<al;ah++){aj=R[ah];ai=aj.h;Z=aj.v;for(ag=0;ag<Z;ag++){for(ae=0;ae<ai;ae++){X(aj,D,ab,ag,ae)}}}ab++}}H=0;an=(am[Y]<<8)|am[Y+1];if(an<=65280){throw"marker was not found"}if(an>=65488&&an<=65495){Y+=2}else{break}}return Y-A}function r(F,u,I){var K=F.quantizationTable;var B,A,z,y,x,w,v,L,G;var J;for(J=0;J<64;J++){I[J]=F.blockData[u+J]*K[J]}for(J=0;J<8;++J){var D=8*J;if(I[1+D]===0&&I[2+D]===0&&I[3+D]===0&&I[4+D]===0&&I[5+D]===0&&I[6+D]===0&&I[7+D]===0){G=(i*I[0+D]+512)>>10;I[0+D]=G;I[1+D]=G;I[2+D]=G;I[3+D]=G;I[4+D]=G;I[5+D]=G;I[6+D]=G;I[7+D]=G;continue}B=(i*I[0+D]+128)>>8;A=(i*I[4+D]+128)>>8;z=I[2+D];y=I[6+D];x=(e*(I[1+D]-I[7+D])+128)>>8;L=(e*(I[1+D]+I[7+D])+128)>>8;w=I[3+D]<<4;v=I[5+D]<<4;G=(B-A+1)>>1;B=(B+A+1)>>1;A=G;G=(z*l+y*b+128)>>8;z=(z*b-y*l+128)>>8;y=G;G=(x-v+1)>>1;x=(x+v+1)>>1;v=G;G=(L+w+1)>>1;w=(L-w+1)>>1;L=G;G=(B-y+1)>>1;B=(B+y+1)>>1;y=G;G=(A-z+1)>>1;A=(A+z+1)>>1;z=G;G=(x*n+L*d+2048)>>12;x=(x*d-L*n+2048)>>12;L=G;G=(w*o+v*f+2048)>>12;w=(w*f-v*o+2048)>>12;v=G;I[0+D]=B+L;I[7+D]=B-L;I[1+D]=A+v;I[6+D]=A-v;I[2+D]=z+w;I[5+D]=z-w;I[3+D]=y+x;I[4+D]=y-x}for(J=0;J<8;++J){var C=J;if(I[1*8+C]===0&&I[2*8+C]===0&&I[3*8+C]===0&&I[4*8+C]===0&&I[5*8+C]===0&&I[6*8+C]===0&&I[7*8+C]===0){G=(i*I[J+0]+8192)>>14;I[0*8+C]=G;I[1*8+C]=G;I[2*8+C]=G;I[3*8+C]=G;I[4*8+C]=G;I[5*8+C]=G;I[6*8+C]=G;I[7*8+C]=G;continue}B=(i*I[0*8+C]+2048)>>12;A=(i*I[4*8+C]+2048)>>12;z=I[2*8+C];y=I[6*8+C];x=(e*(I[1*8+C]-I[7*8+C])+2048)>>12;L=(e*(I[1*8+C]+I[7*8+C])+2048)>>12;w=I[3*8+C];v=I[5*8+C];G=(B-A+1)>>1;B=(B+A+1)>>1;A=G;G=(z*l+y*b+2048)>>12;z=(z*b-y*l+2048)>>12;y=G;G=(x-v+1)>>1;x=(x+v+1)>>1;v=G;G=(L+w+1)>>1;w=(L-w+1)>>1;L=G;G=(B-y+1)>>1;B=(B+y+1)>>1;y=G;G=(A-z+1)>>1;A=(A+z+1)>>1;z=G;G=(x*n+L*d+2048)>>12;x=(x*d-L*n+2048)>>12;L=G;G=(w*o+v*f+2048)>>12;w=(w*f-v*o+2048)>>12;v=G;I[0*8+C]=B+L;I[7*8+C]=B-L;I[1*8+C]=A+v;I[6*8+C]=A-v;I[2*8+C]=z+w;I[5*8+C]=z-w;I[3*8+C]=y+x;I[4*8+C]=y-x}for(J=0;J<64;++J){var E=u+J;var H=I[J];H=(H<=-2056/F.bitConversion)?0:(H>=2024/F.bitConversion)?255/F.bitConversion:(H+2056/F.bitConversion)>>4;F.blockData[E]=H}}function a(u,E){var G=[];var F=E.blocksPerLine;var A=E.blocksPerColumn;var v=F<<3;var B=new Int32Array(64);var y,x,D=0;for(var z=0;z<A;z++){for(var C=0;C<F;C++){var w=q(E,z,C);r(E,w,B)}}return E.blockData}function s(u){return u<=0?0:u>=255?255:u|0}t.prototype={load:function j(y){var w=(function(B){this.parse(B);if(this.onload){this.onload()}}).bind(this);if(y.indexOf("data:")>-1){var A=y.indexOf("base64,")+7;var x=atob(y.substring(A));var u=new Uint8Array(x.length);for(var v=x.length-1;v>=0;v--){u[v]=x.charCodeAt(v)}w(x)}else{var z=new XMLHttpRequest();z.open("GET",y,true);z.responseType="arraybuffer";z.onload=(function(){var B=new Uint8Array(z.response);w(B)}).bind(this);z.send(null)}},parse:function p(ap){function ah(){var v=(ap[ad]<<8)|ap[ad+1];ad+=2;return v}function L(){var v=ah();var z=ap.subarray(ad,ad+v-2);ad+=z.length;return z}function Z(ar){var v=Math.ceil(ar.samplesPerLine/8/ar.maxH);var at=Math.ceil(ar.scanLines/8/ar.maxV);for(var au=0;au<ar.components.length;au++){ao=ar.components[au];var ay=Math.ceil(Math.ceil(ar.samplesPerLine/8)*ao.h/ar.maxH);var av=Math.ceil(Math.ceil(ar.scanLines/8)*ao.v/ar.maxV);var ax=v*ao.h;var z=at*ao.v;var aw=64*z*(ax+1);ao.blockData=new Int16Array(aw);ao.blocksPerLine=ay;ao.blocksPerColumn=av}ar.mcusPerLine=v;ar.mcusPerColumn=at}var ad=0,O=ap.length;var N=null;var X=null;var E=null;var u,U;var Y=[];var y=[],B=[];var x=ah();if(x!=65496){throw"SOI not found"}x=ah();while(x!=65497){var al,ak,aj;switch(x){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var G=L();if(x===65504){if(G[0]===74&&G[1]===70&&G[2]===73&&G[3]===70&&G[4]===0){N={version:{major:G[5],minor:G[6]},densityUnits:G[7],xDensity:(G[8]<<8)|G[9],yDensity:(G[10]<<8)|G[11],thumbWidth:G[12],thumbHeight:G[13],thumbData:G.subarray(14,14+3*G[12]*G[13])}}}if(x===65518){if(G[0]===65&&G[1]===100&&G[2]===111&&G[3]===98&&G[4]===101&&G[5]===0){X={version:G[6],flags0:(G[7]<<8)|G[8],flags1:(G[9]<<8)|G[10],transformCode:G[11]}}}break;case 65499:var M=ah();var K=M+ad-2;while(ad<K){var A=ap[ad++];var F=new Int32Array(64);if((A>>4)===0){for(ak=0;ak<64;ak++){var ab=g[ak];F[ab]=ap[ad++]}}else{if((A>>4)===1){for(ak=0;ak<64;ak++){var am=g[ak];F[am]=ah()}}else{throw"DQT: invalid table spec"}}Y[A&15]=F}break;case 65472:case 65473:case 65474:if(u){throw"Only single frame JPEGs supported"}ah();u={};u.extended=(x===65473);u.progressive=(x===65474);u.precision=ap[ad++];u.scanLines=ah();u.samplesPerLine=ah();u.components=[];u.componentIds={};var Q=ap[ad++],ac;var W=0,R=0;for(al=0;al<Q;al++){ac=ap[ad];var an=ap[ad+1]>>4;var ae=ap[ad+1]&15;if(W<an){W=an}if(R<ae){R=ae}var w=ap[ad+2];aj=u.components.push({h:an,v:ae,quantizationTable:Y[w],quantizationTableId:w,bitConversion:255/((1<<u.precision)-1)});u.componentIds[ac]=aj-1;ad+=3}u.maxH=W;u.maxV=R;Z(u);break;case 65476:var ag=ah();for(al=2;al<ag;){var C=ap[ad++];var aa=new Uint8Array(16);var V=0;for(ak=0;ak<16;ak++,ad++){V+=(aa[ak]=ap[ad])}var P=new Uint8Array(V);for(ak=0;ak<V;ak++,ad++){P[ak]=ap[ad]}al+=17+V;((C>>4)===0?B:y)[C&15]=h(aa,P)}break;case 65501:ah();U=ah();break;case 65498:var af=ah();var ai=ap[ad++];var T=[],ao;for(al=0;al<ai;al++){var aq=u.componentIds[ap[ad++]];ao=u.components[aq];var S=ap[ad++];ao.huffmanTableDC=B[S>>4];ao.huffmanTableAC=y[S&15];T.push(ao)}var D=ap[ad++];var I=ap[ad++];var H=ap[ad++];var J=c(ap,ad,u,T,U,D,I,H>>4,H&15);ad+=J;break;default:if(ap[ad-3]==255&&ap[ad-2]>=192&&ap[ad-2]<=254){ad-=3;break}throw"unknown JPEG marker "+x.toString(16)}x=ah()}this.width=u.samplesPerLine;this.height=u.scanLines;this.jfif=N;this.adobe=X;this.components=[];switch(u.components.length){case 1:this.colorspace=ColorSpace.Grayscale;break;case 3:if(this.adobe){this.colorspace=ColorSpace.AdobeRGB}else{this.colorspace=ColorSpace.RGB}break;case 4:this.colorspace=ColorSpace.CYMK;break;default:this.colorspace=ColorSpace.Unknown}for(var al=0;al<u.components.length;al++){var ao=u.components[al];if(!ao.quantizationTable&&ao.quantizationTableId!==null){ao.quantizationTable=Y[ao.quantizationTableId]}this.components.push({output:a(u,ao),scaleX:ao.h/u.maxH,scaleY:ao.v/u.maxV,blocksPerLine:ao.blocksPerLine,blocksPerColumn:ao.blocksPerColumn,bitConversion:ao.bitConversion})}},getData16:function k(N,M){if(this.components.length!==1){throw"Unsupported color mode"}var V=this.width/N,U=this.height/M;var L,B,A;var J,I,R;var D=0;var W=this.components.length;var H=N*M*W;var aa=new Uint16Array(H);var Y;var O=new Uint16Array((this.components[0].blocksPerLine<<3)*this.components[0].blocksPerColumn*8);for(R=0;R<W;R++){L=this.components[R];var G=L.blocksPerLine;var X=L.blocksPerColumn;var u=G<<3;var Q,P,K=0;var T=0;for(var C=0;C<X;C++){var Z=C<<3;for(var z=0;z<G;z++){var F=q(L,C,z);var D=0,S=z<<3;for(Q=0;Q<8;Q++){var T=(Z+Q)*u;for(P=0;P<8;P++){O[T+S+P]=L.output[F+D++]}}}}B=L.scaleX*V;A=L.scaleY*U;D=R;var w,v;var E;for(I=0;I<M;I++){for(J=0;J<N;J++){v=0|(I*A);w=0|(J*B);E=v*u+w;aa[D]=O[E];D+=W}}}return aa},getData:function m(u,v){var ae=this.width/u,ac=this.height/v;var an,ad,ab;var ah,ag,al;var ai=0;var w,A,aq,H,Q,F,am,D,J,T;var P;var W=this.components.length;var N=u*v*W;var ar=new Uint8Array(N);var S;var aa=new Uint8Array((this.components[0].blocksPerLine<<3)*this.components[0].blocksPerColumn*8);for(al=0;al<W;al++){an=this.components[al];var af=an.blocksPerLine;var at=an.blocksPerColumn;var E=af<<3;var ak,aj,Z=0;var I=0;for(var z=0;z<at;z++){var O=z<<3;for(var ap=0;ap<af;ap++){var ao=q(an,z,ap);var ai=0,L=ap<<3;for(ak=0;ak<8;ak++){var I=(O+ak)*E;for(aj=0;aj<8;aj++){aa[I+L+aj]=an.output[ao+ai++]*an.bitConversion}}}}ad=an.scaleX*ae;ab=an.scaleY*ac;ai=al;var V,U;var X;for(ag=0;ag<v;ag++){for(ah=0;ah<u;ah++){U=0|(ag*ab);V=0|(ah*ad);X=U*E+V;ar[ai]=aa[X];ai+=W}}}switch(W){case 1:case 2:break;case 3:P=true;if(this.adobe&&this.adobe.transformCode){P=true}else{if(typeof this.colorTransform!=="undefined"){P=!!this.colorTransform}}if(P){for(al=0;al<N;al+=W){w=ar[al];A=ar[al+1];aq=ar[al+2];D=s(w-179.456+1.402*aq);J=s(w+135.459-0.344*A-0.714*aq);T=s(w-226.816+1.772*A);ar[al]=D;ar[al+1]=J;ar[al+2]=T}}break;case 4:if(!this.adobe){throw"Unsupported color mode (4 components)"}P=false;if(this.adobe&&this.adobe.transformCode){P=true}else{if(typeof this.colorTransform!=="undefined"){P=!!this.colorTransform}}if(P){for(al=0;al<N;al+=W){w=ar[al];A=ar[al+1];aq=ar[al+2];Q=s(434.456-w-1.402*aq);F=s(119.541-w+0.344*A+0.714*aq);w=s(481.816-w-1.772*A);ar[al]=Q;ar[al+1]=F;ar[al+2]=w}}break;default:throw"Unsupported color mode"}return ar}};return t})();(function(b){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=b()}else{if(typeof define==="function"&&define.amd){define([],b)}else{var a;if(typeof window!=="undefined"){a=window}else{if(typeof global!=="undefined"){a=global}else{if(typeof self!=="undefined"){a=self}else{a=this}}}a.jpeg=b()}}})(function(){var d,b,a;return(function c(f,k,h){function g(q,n){if(!k[q]){if(!f[q]){var m=typeof require=="function"&&require;if(!n&&m){return m(q,!0)}if(e){return e(q,!0)}var p=new Error("Cannot find module '"+q+"'");throw p.code="MODULE_NOT_FOUND",p}var i=k[q]={exports:{}};f[q][0].call(i.exports,function(l){var o=f[q][1][l];return g(o?o:l)},i,i.exports,c,f,k,h)}return k[q].exports}var e=typeof require=="function"&&require;for(var j=0;j<h.length;j++){g(h[j])}return g})({1:[function(g,h,e){var f=f||{};f.lossless=f.lossless||{};f.lossless.ComponentSpec=f.lossless.ComponentSpec||function(){this.hSamp=0;this.quantTableSel=0;this.vSamp=0};var i=typeof h;if((i!=="undefined")&&h.exports){h.exports=f.lossless.ComponentSpec}},{}],2:[function(g,h,e){var f=f||{};f.lossless=f.lossless||{};f.lossless.DataStream=f.lossless.DataStream||function(k,l,j){this.buffer=new DataView(k,l,j);this.index=0};f.lossless.DataStream.prototype.get16=function(){var j=this.buffer.getUint16(this.index,false);this.index+=2;return j};f.lossless.DataStream.prototype.get8=function(){var j=this.buffer.getUint8(this.index);this.index+=1;return j};var i=typeof h;if((i!=="undefined")&&h.exports){h.exports=f.lossless.DataStream}},{}],3:[function(g,h,e){var f=f||{};f.lossless=f.lossless||{};f.lossless.DataStream=f.lossless.DataStream||((typeof g!=="undefined")?g("./data-stream.js"):null);f.lossless.HuffmanTable=f.lossless.HuffmanTable||((typeof g!=="undefined")?g("./huffman-table.js"):null);f.lossless.QuantizationTable=f.lossless.QuantizationTable||((typeof g!=="undefined")?g("./quantization-table.js"):null);f.lossless.ScanHeader=f.lossless.ScanHeader||((typeof g!=="undefined")?g("./scan-header.js"):null);f.lossless.FrameHeader=f.lossless.FrameHeader||((typeof g!=="undefined")?g("./frame-header.js"):null);f.lossless.Utils=f.lossless.Utils||((typeof g!=="undefined")?g("./utils.js"):null);f.lossless.Decoder=f.lossless.Decoder||function(j,k){this.buffer=j;this.frame=new f.lossless.FrameHeader();this.huffTable=new f.lossless.HuffmanTable();this.quantTable=new f.lossless.QuantizationTable();this.scan=new f.lossless.ScanHeader();this.DU=f.lossless.Utils.createArray(10,4,64);this.HuffTab=f.lossless.Utils.createArray(4,2,50*256);this.IDCT_Source=[];this.nBlock=[];this.acTab=f.lossless.Utils.createArray(10,1);this.dcTab=f.lossless.Utils.createArray(10,1);this.qTab=f.lossless.Utils.createArray(10,1);this.marker=0;this.markerIndex=0;this.numComp=0;this.restartInterval=0;this.selection=0;this.xDim=0;this.yDim=0;this.xLoc=0;this.yLoc=0;this.outputData=null;if(typeof k==="undefined"){this.numBytes=2}else{this.numBytes=k}};f.lossless.Decoder.IDCT_P=[0,5,40,16,45,2,7,42,21,56,8,61,18,47,1,4,41,23,58,13,32,24,37,10,63,17,44,3,6,43,20,57,15,34,29,48,53,26,39,9,60,19,46,22,59,12,33,31,50,55,25,36,11,62,14,35,28,49,52,27,38,30,51,54];f.lossless.Decoder.TABLE=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63];f.lossless.Decoder.MAX_HUFFMAN_SUBTREE=50;f.lossless.Decoder.MSB=2147483648;f.lossless.Decoder.prototype.decode=function(o,n,m,k){var r,j=0,l=[],p,s,u=[],q=[],t;if(typeof o!=="undefined"){this.buffer=o}if(typeof k!=="undefined"){this.numBytes=k}if(this.numBytes===2){this.getter=this.getValue16;this.setter=this.setValue16}else{if(this.numBytes===1){this.getter=this.getValue8;this.setter=this.setValue8}}this.stream=new f.lossless.DataStream(this.buffer,n,m);this.buffer=null;this.xLoc=0;this.yLoc=0;r=this.stream.get16();if(r!==65496){throw new Error("Not a JPEG file")}r=this.stream.get16();while((((r>>4)!==4092)||(r===65476))){switch(r){case 65476:this.huffTable.read(this.stream,this.HuffTab);break;case 65484:throw new Error("Program doesn't support arithmetic coding. (format throw new IOException)");case 65499:this.quantTable.read(this.stream,f.lossless.Decoder.TABLE);break;case 65501:this.restartInterval=this.readNumber();break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:this.readApp();break;case 65534:this.readComment();break;default:if((r>>8)!==255){throw new Error("ERROR: format throw new IOException! (decode)")}}r=this.stream.get16()}if((r<65472)||(r>65479)){throw new Error("ERROR: could not handle arithmetic code!")}this.frame.read(this.stream);r=this.stream.get16();do{while(r!==65498){switch(r){case 65476:this.huffTable.read(this.stream,this.HuffTab);break;case 65484:throw new Error("Program doesn't support arithmetic coding. (format throw new IOException)");case 65499:this.quantTable.read(this.stream,f.lossless.Decoder.TABLE);break;case 65501:this.restartInterval=this.readNumber();break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:this.readApp();break;case 65534:this.readComment();break;default:if((r>>8)!==255){throw new Error("ERROR: format throw new IOException! (Parser.decode)")}}r=this.stream.get16()}this.precision=this.frame.precision;this.components=this.frame.components;this.scan.read(this.stream);this.numComp=this.scan.numComp;this.selection=this.scan.selection;this.scanComps=this.scan.components;this.quantTables=this.quantTable.quantTables;for(p=0;p<this.numComp;p+=1){s=this.scanComps[p].scanCompSel;this.qTab[p]=this.quantTables[this.components[s].quantTableSel];this.nBlock[p]=this.components[s].vSamp*this.components[s].hSamp;this.dcTab[p]=this.HuffTab[this.scanComps[p].dcTabSel][0];this.acTab[p]=this.HuffTab[this.scanComps[p].acTabSel][1]}this.xDim=this.frame.dimX;this.yDim=this.frame.dimY;this.outputData=new DataView(new ArrayBuffer(this.xDim*this.yDim*this.numBytes));j+=1;while(true){u[0]=0;q[0]=0;for(p=0;p<10;p+=1){l[p]=(1<<(this.precision-1))}if(this.restartInterval===0){r=this.decodeUnit(l,u,q);while((r===0)&&((this.xLoc<this.xDim)&&(this.yLoc<this.yDim))){this.output(l);r=this.decodeUnit(l,u,q)}break}for(t=0;t<this.restartInterval;t+=1){r=this.decodeUnit(l,u,q);this.output(l);if(r!==0){break}}if(r===0){if(this.markerIndex!==0){r=(65280|this.marker);this.markerIndex=0}else{r=this.stream.get16()}}if(!((r>=65488)&&(r<=65495))){break}}if((r===65500)&&(j===1)){this.readNumber();r=this.stream.get16()}}while((r!==65497)&&((this.xLoc<this.xDim)&&(this.yLoc<this.yDim))&&(j===0));return this.outputData};f.lossless.Decoder.prototype.decodeUnit=function(l,u,p){var s,v,q,r,t,o,m,n;switch(this.selection){case 2:l[0]=this.getPreviousY();break;case 3:l[0]=this.getPreviousXY();break;case 4:l[0]=(this.getPreviousX()+this.getPreviousY())-this.getPreviousXY();break;case 5:l[0]=this.getPreviousX()+((this.getPreviousY()-this.getPreviousXY())>>1);break;case 6:l[0]=this.getPreviousY()+((this.getPreviousX()-this.getPreviousXY())>>1);break;case 7:l[0]=((this.getPreviousX()+this.getPreviousY())/2);break;default:l[0]=this.getPreviousX();break}if(this.numComp>1){for(t=0;t<this.numComp;t+=1){r=this.qTab[t];v=this.acTab[t];q=this.dcTab[t];for(o=0;o<this.nBlock[t];o+=1){for(m=0;m<this.IDCT_Source.length;m+=1){this.IDCT_Source[m]=0}s=this.getHuffmanValue(q,u,p);if(s>=65280){return s}l[t]=this.IDCT_Source[0]=l[t]+this.getn(p,s,u,p);this.IDCT_Source[0]*=r[0];for(n=1;n<64;n+=1){s=this.getHuffmanValue(v,u,p);if(s>=65280){return s}n+=(s>>4);if((s&15)===0){if((s>>4)===0){break}}else{this.IDCT_Source[f.lossless.Decoder.IDCT_P[n]]=this.getn(p,s&15,u,p)*r[n]}}this.scaleIDCT(this.DU[t][o])}}return 0}else{for(o=0;o<this.nBlock[0];o+=1){s=this.getHuffmanValue(this.dcTab[0],u,p);if(s>=65280){return s}l[0]+=this.getn(l,s,u,p)}return 0}};f.lossless.Decoder.prototype.getHuffmanValue=function(o,l,m){var n,k,j;j=65535;if(m[0]<8){l[0]<<=8;k=this.stream.get8();if(k===255){this.marker=this.stream.get8();if(this.marker!==0){this.markerIndex=9}}l[0]|=k}else{m[0]-=8}n=o[l[0]>>m[0]];if((n&f.lossless.Decoder.MSB)!==0){if(this.markerIndex!==0){this.markerIndex=0;return 65280|this.marker}l[0]&=(j>>(16-m[0]));l[0]<<=8;k=this.stream.get8();if(k===255){this.marker=this.stream.get8();if(this.marker!==0){this.markerIndex=9}}l[0]|=k;n=o[((n&255)*256)+(l[0]>>m[0])];m[0]+=8}m[0]+=8-(n>>8);if(m[0]<0){throw new Error("index="+m[0]+" temp="+l[0]+" code="+n+" in HuffmanValue()")}if(m[0]<this.markerIndex){this.markerIndex=0;return 65280|this.marker}l[0]&=(j>>(16-m[0]));return n&255};f.lossless.Decoder.prototype.getn=function(q,k,p,m){var s,l,j,r,o;l=1;j=-1;r=65535;if(k===0){return 0}if(k===16){if(q[0]>=0){return -32768}else{return 32768}}m[0]-=k;if(m[0]>=0){if((m[0]<this.markerIndex)&&!this.isLastPixel()){this.markerIndex=0;return(65280|this.marker)<<8}s=p[0]>>m[0];p[0]&=(r>>(16-m[0]))}else{p[0]<<=8;o=this.stream.get8();if(o===255){this.marker=this.stream.get8();if(this.marker!==0){this.markerIndex=9}}p[0]|=o;m[0]+=8;if(m[0]<0){if(this.markerIndex!==0){this.markerIndex=0;return(65280|this.marker)<<8}p[0]<<=8;o=this.stream.get8();if(o===255){this.marker=this.stream.get8();if(this.marker!==0){this.markerIndex=9}}p[0]|=o;m[0]+=8}if(m[0]<0){throw new Error("index="+m[0]+" in getn()")}if(m[0]<this.markerIndex){this.markerIndex=0;return(65280|this.marker)<<8}s=p[0]>>m[0];p[0]&=(r>>(16-m[0]))}if(s<(l<<(k-1))){s+=(j<<k)+1}return s};f.lossless.Decoder.prototype.getPreviousX=function(){if(this.xLoc>0){return this.getter((((this.yLoc*this.xDim)+this.xLoc)-1))}else{if(this.yLoc>0){return this.getPreviousY()}else{return(1<<(this.frame.precision-1))}}};f.lossless.Decoder.prototype.getPreviousXY=function(){if((this.xLoc>0)&&(this.yLoc>0)){return this.getter(((((this.yLoc-1)*this.xDim)+this.xLoc)-1))}else{return this.getPreviousY()}};f.lossless.Decoder.prototype.getPreviousY=function(){if(this.yLoc>0){return this.getter((((this.yLoc-1)*this.xDim)+this.xLoc))}else{return this.getPreviousX()}};f.lossless.Decoder.prototype.isLastPixel=function(){return(this.xLoc===(this.xDim-1))&&(this.yLoc===(this.yDim-1))};f.lossless.Decoder.prototype.output=function(j){if((this.xLoc<this.xDim)&&(this.yLoc<this.yDim)){this.setter((((this.yLoc*this.xDim)+this.xLoc)),j[0]);this.xLoc+=1;if(this.xLoc>=this.xDim){this.yLoc+=1;this.xLoc=0}}};f.lossless.Decoder.prototype.setValue16=function(j,k){this.outputData.setInt16(j*2,k,true)};f.lossless.Decoder.prototype.getValue16=function(j){return this.outputData.getInt16(j*2,true)};f.lossless.Decoder.prototype.setValue8=function(j,k){this.outputData.setInt8(j,k)};f.lossless.Decoder.prototype.getValue8=function(j){return this.outputData.getInt8(j)};f.lossless.Decoder.prototype.readApp=function(){var k=0,j=this.stream.get16();k+=2;while(k<j){this.stream.get8();k+=1}return j};f.lossless.Decoder.prototype.readComment=function(){var l="",k=0,j;j=this.stream.get16();k+=2;while(k<j){l+=this.stream.get8();k+=1}return l};f.lossless.Decoder.prototype.readNumber=function(){var j=this.stream.get16();if(j!==4){throw new Error("ERROR: Define number format throw new IOException [Ld!=4]")}return this.stream.get16()};f.lossless.Decoder.prototype.scaleIDCT=function(A){var w=f.lossless.Utils.createArray(8,8),v,u,t,s,B,H,G,F,E,D,C,z,y,r,q,o,n,m,l,k,j,x=0;for(B=0;B<8;B+=1){H=this.IDCT_Source[(0)+B];G=this.IDCT_Source[(8)+B];F=this.IDCT_Source[(16)+B]-this.IDCT_Source[(24)+B];E=this.IDCT_Source[(24)+B]+this.IDCT_Source[(16)+B];D=this.IDCT_Source[(32)+B]-this.IDCT_Source[(56)+B];z=this.IDCT_Source[(40)+B]-this.IDCT_Source[(48)+B];v=this.IDCT_Source[(40)+B]+this.IDCT_Source[(48)+B];u=this.IDCT_Source[(32)+B]+this.IDCT_Source[(56)+B];C=v-u;y=v+u;m=(-D*480)-(z*192);l=C*384;k=(z*480)-(D*192);j=y*256;v=H*256;u=G*256;t=F*384;s=E*256;n=s;r=v+u;q=v-u;o=t-s;H=r+n;G=q+o;F=q-o;E=r-n;D=k-m-l-j;C=(l-k)+j;z=k-j;y=j;w[0][B]=(H+y+(1<<12))>>13;w[1][B]=(G+z+(1<<12))>>13;w[2][B]=(F+C+(1<<12))>>13;w[3][B]=(E+D+(1<<12))>>13;w[4][B]=((E-D)+(1<<12))>>13;w[5][B]=((F-C)+(1<<12))>>13;w[6][B]=((G-z)+(1<<12))>>13;w[7][B]=((H-y)+(1<<12))>>13}for(B=0;B<8;B+=1){H=w[B][0];G=w[B][1];F=w[B][2]-w[B][3];E=w[B][3]+w[B][2];D=w[B][4]-w[B][7];z=w[B][5]-w[B][6];v=w[B][5]+w[B][6];u=w[B][4]+w[B][7];C=v-u;y=v+u;m=(-D*480)-(z*192);l=C*384;k=(z*480)-(D*192);j=y*256;v=H*256;u=G*256;t=F*384;s=E*256;n=s;r=v+u;q=v-u;o=t-s;H=r+n;G=q+o;F=q-o;E=r-n;D=k-m-l-j;C=(l-k)+j;z=k-j;y=j;A[x+=1]=(H+y+(1<<12))>>13;A[x+=1]=(G+z+(1<<12))>>13;A[x+=1]=(F+C+(1<<12))>>13;A[x+=1]=(E+D+(1<<12))>>13;A[x+=1]=((E-D)+(1<<12))>>13;A[x+=1]=((F-C)+(1<<12))>>13;A[x+=1]=((G-z)+(1<<12))>>13;A[x+=1]=((H-y)+(1<<12))>>13}};var i=typeof h;if((i!=="undefined")&&h.exports){h.exports=f.lossless.Decoder}},{"./data-stream.js":2,"./frame-header.js":4,"./huffman-table.js":5,"./quantization-table.js":7,"./scan-header.js":9,"./utils.js":10}],4:[function(g,h,e){var f=f||{};f.lossless=f.lossless||{};f.lossless.ComponentSpec=f.lossless.ComponentSpec||((typeof g!=="undefined")?g("./component-spec.js"):null);f.lossless.DataStream=f.lossless.DataStream||((typeof g!=="undefined")?g("./data-stream.js"):null);f.lossless.FrameHeader=f.lossless.FrameHeader||function(){this.components=[];this.dimX=0;this.dimY=0;this.numComp=0;this.precision=0};f.lossless.FrameHeader.prototype.read=function(n){var m=0,l,k,o,j;l=n.get16();m+=2;this.precision=n.get8();m+=1;this.dimY=n.get16();m+=2;this.dimX=n.get16();m+=2;this.numComp=n.get8();m+=1;for(k=1;k<=this.numComp;k+=1){if(m>l){throw new Error("ERROR: frame format error")}o=n.get8();m+=1;if(m>=l){throw new Error("ERROR: frame format error [c>=Lf]")}j=n.get8();m+=1;if(!this.components[o]){this.components[o]=new f.lossless.ComponentSpec()}this.components[o].hSamp=j>>4;this.components[o].vSamp=j&15;this.components[o].quantTableSel=n.get8();m+=1}if(m!==l){throw new Error("ERROR: frame format error [Lf!=count]")}return 1};var i=typeof h;if((i!=="undefined")&&h.exports){h.exports=f.lossless.FrameHeader}},{"./component-spec.js":1,"./data-stream.js":2}],5:[function(g,h,e){var f=f||{};f.lossless=f.lossless||{};f.lossless.DataStream=f.lossless.DataStream||((typeof g!=="undefined")?g("./data-stream.js"):null);f.lossless.Utils=f.lossless.Utils||((typeof g!=="undefined")?g("./utils.js"):null);f.lossless.HuffmanTable=f.lossless.HuffmanTable||function(){this.l=f.lossless.Utils.createArray(4,2,16);this.th=[];this.v=f.lossless.Utils.createArray(4,2,16,200);this.tc=f.lossless.Utils.createArray(4,2);this.tc[0][0]=0;this.tc[1][0]=0;this.tc[2][0]=0;this.tc[3][0]=0;this.tc[0][1]=0;this.tc[1][1]=0;this.tc[2][1]=0;this.tc[3][1]=0;this.th[0]=0;this.th[1]=0;this.th[2]=0;this.th[3]=0};f.lossless.HuffmanTable.MSB=2147483648;f.lossless.HuffmanTable.prototype.read=function(m,q){var o=0,k,r,s,p,n,l;k=m.get16();o+=2;while(o<k){r=m.get8();o+=1;s=r&15;if(s>3){throw new Error("ERROR: Huffman table ID > 3")}p=r>>4;if(p>2){throw new Error("ERROR: Huffman table [Table class > 2 ]")}this.th[s]=1;this.tc[s][p]=1;for(n=0;n<16;n+=1){this.l[s][p][n]=m.get8();o+=1}for(n=0;n<16;n+=1){for(l=0;l<this.l[s][p][n];l+=1){if(o>k){throw new Error("ERROR: Huffman table format error [count>Lh]")}this.v[s][p][n][l]=m.get8();o+=1}}}if(o!==k){throw new Error("ERROR: Huffman table format error [count!=Lf]")}for(n=0;n<4;n+=1){for(l=0;l<2;l+=1){if(this.tc[n][l]!==0){this.buildHuffTable(q[n][l],this.l[n][l],this.v[n][l])}}}return 1};f.lossless.HuffmanTable.prototype.buildHuffTable=function(m,s,o){var u,t,p,r,q,l;t=256;p=0;for(r=0;r<8;r+=1){for(q=0;q<s[r];q+=1){for(l=0;l<(t>>(r+1));l+=1){m[p]=o[r][q]|((r+1)<<8);p+=1}}}for(r=1;p<256;r+=1,p+=1){m[p]=r|f.lossless.HuffmanTable.MSB}u=1;p=0;for(r=8;r<16;r+=1){for(q=0;q<s[r];q+=1){for(l=0;l<(t>>(r-7));l+=1){m[(u*256)+p]=o[r][q]|((r+1)<<8);p+=1}if(p>=256){if(p>256){throw new Error("ERROR: Huffman table error(1)!")}p=0;u+=1}}}};var i=typeof h;if((i!=="undefined")&&h.exports){h.exports=f.lossless.HuffmanTable}},{"./data-stream.js":2,"./utils.js":10}],6:[function(g,h,e){var f=f||{};f.lossless=f.lossless||{};f.lossless.ComponentSpec=f.lossless.ComponentSpec||((typeof g!=="undefined")?g("./component-spec.js"):null);f.lossless.DataStream=f.lossless.DataStream||((typeof g!=="undefined")?g("./data-stream.js"):null);f.lossless.Decoder=f.lossless.Decoder||((typeof g!=="undefined")?g("./decoder.js"):null);f.lossless.FrameHeader=f.lossless.FrameHeader||((typeof g!=="undefined")?g("./frame-header.js"):null);f.lossless.HuffmanTable=f.lossless.HuffmanTable||((typeof g!=="undefined")?g("./huffman-table.js"):null);f.lossless.QuantizationTable=f.lossless.QuantizationTable||((typeof g!=="undefined")?g("./quantization-table.js"):null);f.lossless.ScanComponent=f.lossless.ScanComponent||((typeof g!=="undefined")?g("./scan-component.js"):null);f.lossless.ScanHeader=f.lossless.ScanHeader||((typeof g!=="undefined")?g("./scan-header.js"):null);f.lossless.Utils=f.lossless.Utils||((typeof g!=="undefined")?g("./utils.js"):null);var i=typeof h;if((i!=="undefined")&&h.exports){h.exports=f}},{"./component-spec.js":1,"./data-stream.js":2,"./decoder.js":3,"./frame-header.js":4,"./huffman-table.js":5,"./quantization-table.js":7,"./scan-component.js":8,"./scan-header.js":9,"./utils.js":10}],7:[function(g,h,e){var f=f||{};f.lossless=f.lossless||{};f.lossless.DataStream=f.lossless.DataStream||((typeof g!=="undefined")?g("./data-stream.js"):null);f.lossless.Utils=f.lossless.Utils||((typeof g!=="undefined")?g("./utils.js"):null);f.lossless.QuantizationTable=f.lossless.QuantizationTable||function(){this.precision=[];this.tq=[];this.quantTables=f.lossless.Utils.createArray(4,64);this.tq[0]=0;this.tq[1]=0;this.tq[2]=0;this.tq[3]=0};f.lossless.QuantizationTable.enhanceQuantizationTable=function(l,k){var j;for(j=0;j<8;j+=1){l[k[(0*8)+j]]*=90;l[k[(4*8)+j]]*=90;l[k[(2*8)+j]]*=118;l[k[(6*8)+j]]*=49;l[k[(5*8)+j]]*=71;l[k[(1*8)+j]]*=126;l[k[(7*8)+j]]*=25;l[k[(3*8)+j]]*=106}for(j=0;j<8;j+=1){l[k[0+(8*j)]]*=90;l[k[4+(8*j)]]*=90;l[k[2+(8*j)]]*=118;l[k[6+(8*j)]]*=49;l[k[5+(8*j)]]*=71;l[k[1+(8*j)]]*=126;l[k[7+(8*j)]]*=25;l[k[3+(8*j)]]*=106}for(j=0;j<64;j+=1){l[j]>>=6}};f.lossless.QuantizationTable.prototype.read=function(p,o){var n=0,m,j,l,k;m=p.get16();n+=2;while(n<m){j=p.get8();n+=1;l=j&15;if(l>3){throw new Error("ERROR: Quantization table ID > 3")}this.precision[l]=j>>4;if(this.precision[l]===0){this.precision[l]=8}else{if(this.precision[l]===1){this.precision[l]=16}else{throw new Error("ERROR: Quantization table precision error")}}this.tq[l]=1;if(this.precision[l]===8){for(k=0;k<64;k+=1){if(n>m){throw new Error("ERROR: Quantization table format error")}this.quantTables[l][k]=p.get8();n+=1}f.lossless.QuantizationTable.enhanceQuantizationTable(this.quantTables[l],o)}else{for(k=0;k<64;k+=1){if(n>m){throw new Error("ERROR: Quantization table format error")}this.quantTables[l][k]=p.get16();n+=2}f.lossless.QuantizationTable.enhanceQuantizationTable(this.quantTables[l],o)}}if(n!==m){throw new Error("ERROR: Quantization table error [count!=Lq]")}return 1};var i=typeof h;if((i!=="undefined")&&h.exports){h.exports=f.lossless.QuantizationTable}},{"./data-stream.js":2,"./utils.js":10}],8:[function(g,h,e){var f=f||{};f.lossless=f.lossless||{};f.lossless.ScanComponent=f.lossless.ScanComponent||function(){this.acTabSel=0;this.dcTabSel=0;this.scanCompSel=0};var i=typeof h;if((i!=="undefined")&&h.exports){h.exports=f.lossless.ScanComponent}},{}],9:[function(g,h,e){var f=f||{};f.lossless=f.lossless||{};f.lossless.DataStream=f.lossless.DataStream||((typeof g!=="undefined")?g("./data-stream.js"):null);f.lossless.ScanComponent=f.lossless.ScanComponent||((typeof g!=="undefined")?g("./scan-component.js"):null);f.lossless.ScanHeader=f.lossless.ScanHeader||function(){this.ah=0;this.al=0;this.numComp=0;this.selection=0;this.spectralEnd=0;this.components=[]};f.lossless.ScanHeader.prototype.read=function(n){var m=0,l,k,j;l=n.get16();m+=2;this.numComp=n.get8();m+=1;for(k=0;k<this.numComp;k+=1){this.components[k]=new f.lossless.ScanComponent();if(m>l){throw new Error("ERROR: scan header format error")}this.components[k].scanCompSel=n.get8();m+=1;j=n.get8();m+=1;this.components[k].dcTabSel=(j>>4);this.components[k].acTabSel=(j&15)}this.selection=n.get8();m+=1;this.spectralEnd=n.get8();m+=1;j=n.get8();this.ah=(j>>4);this.al=(j&15);m+=1;if(m!==l){throw new Error("ERROR: scan header format error [count!=Ns]")}return 1};var i=typeof h;if((i!=="undefined")&&h.exports){h.exports=f.lossless.ScanHeader}},{"./data-stream.js":2,"./scan-component.js":8}],10:[function(g,h,e){var f=f||{};f.lossless=f.lossless||{};f.lossless.Utils=f.lossless.Utils||{};f.lossless.Utils.createArray=function(m){var j=new Array(m||0),l=m;if(arguments.length>1){var k=Array.prototype.slice.call(arguments,1);while(l--){j[m-1-l]=f.lossless.Utils.createArray.apply(this,k)}}return j};var i=typeof h;if((i!=="undefined")&&h.exports){h.exports=f.lossless.Utils}},{}]},{},[6])(6)});(function(c,b,a){function d(j,g){var i=a.getPixelFormat(j);var l=j.elements.x7fe00010;var n=j.uint16("x00280010");var e=j.uint16("x00280011");var k=j.uint16("x00280002");var h=l.dataOffset;var f=e*n*k;var m=0;if(i===1){m=h+g*f;return new Uint8Array(j.byteArray.buffer,m,f)}else{if(i===2){m=h+g*f*2;return new Uint16Array(j.byteArray.buffer,m,f)}else{if(i===3){m=h+g*f*2;return new Int16Array(j.byteArray.buffer,m,f)}}}}a.extractUncompressedPixels=d}($,cornerstone,cornerstoneWADOImageLoader));(function(b){function a(d){var c=d.uint16("x00280103");var e=d.uint16("x00280100");if(c===0&&e===8){return 1}else{if(c===0&&e===16){return 2}else{if(c===1&&e===16){return 3}}}}b.getPixelFormat=a}(cornerstoneWADOImageLoader));(function(b){function a(e){var c=e.string("x00280030");if(c&&c.length>0){var d=c.split("\\");return{row:parseFloat(d[0]),column:parseFloat(d[1])}}else{return{row:undefined,column:undefined}}}b.getPixelSpacing=a}(cornerstoneWADOImageLoader));(function(a){function b(d){var c={intercept:0,slope:1};var e=d.floatString("x00281052");var f=d.floatString("x00281053");if(e&&f){c.intercept=e;c.slope=f}return c}a.getRescaleSlopeAndIntercept=b}(cornerstoneWADOImageLoader));(function(a){function b(e){var c={windowCenter:undefined,windowWidth:undefined};var f=e.floatString("x00281050");var d=e.floatString("x00281051");if(f&&d){c.windowCenter=f;c.windowWidth=d}return c}a.getWindowWidthAndCenter=b}(cornerstoneWADOImageLoader));(function(d){var c={beforeSend:function(e){}};function b(e){c=e}function a(e){if(e==="RGB"||e==="PALETTE COLOR"||e==="YBR_FULL"||e==="YBR_FULL_422"||e==="YBR_PARTIAL_422"||e==="YBR_PARTIAL_420"||e==="YBR_RCT"||e==="YBR_ICT"){return true}else{return false}}d.isColorImage=a}(cornerstoneWADOImageLoader));(function(g,f,d){var c=document.createElement("canvas");var e="";function b(h,i){if(d.isJPEGBaseline8Bit(h)===true){return d.decodeJPEGBaseline8Bit(c,h,i)}var j=d.decodeTransferSyntax(h,i);return d.convertColorSpace(c,h,j)}function a(j,m,i){var o=d.getPixelSpacing(m);var u=m.uint16("x00280010");var k=m.uint16("x00280011");var n=d.getRescaleSlopeAndIntercept(m);var q=4;var h=u*k;var s=h*q;var r=d.getWindowWidthAndCenter(m);e=undefined;var t=g.Deferred();var p;try{p=b(m,i)}catch(l){t.reject(l);return t}p.then(function(z){function w(){return z.data}function x(){return z}function v(){if(e===j){return c}c.height=u;c.width=k;var A=c.getContext("2d");A.putImageData(z,0,0);e=j;return c}var y={imageId:j,minPixelValue:0,maxPixelValue:255,slope:n.slope,intercept:n.intercept,windowCenter:r.windowCenter,windowWidth:r.windowWidth,render:f.renderColorImage,getPixelData:w,getImageData:x,getCanvas:v,rows:u,columns:k,height:u,width:k,color:true,columnPixelSpacing:o.column,rowPixelSpacing:o.row,data:m,invert:false,sizeInBytes:s};if(y.windowCenter===undefined){y.windowWidth=255;y.windowCenter=128}t.resolve(y)},function(v){t.reject(v)});return t}d.makeColorImage=a}($,cornerstone,cornerstoneWADOImageLoader));(function(f,d,c){function b(h){var g=c.getPixelFormat(h);if(g===1){return 1}else{if(g===2||g===3){return 2}}throw"unknown pixel format"}function a(k){var i=65535;var g=-32768;var m=k.length;var j=k;for(var h=0;h<m;h++){var l=j[h];i=Math.min(i,l);g=Math.max(g,l)}return{min:i,max:g}}function e(A,w,q){var B=f.Deferred();var k=c.getPixelSpacing(w);var n=w.uint16("x00280010");var h=w.uint16("x00280011");var m=c.getRescaleSlopeAndIntercept(w);var y;try{y=b(w)}catch(v){B.reject(v);return B}var z=n*h;var u=z*y;var x=w.string("x00280004");var p=(x==="MONOCHROME1");var g=c.getWindowWidthAndCenter(w);var l;try{l=c.decodeTransferSyntax(w,q)}catch(j){B.reject(j);return B}var s=a(l);function o(){return l}var r={imageId:A,minPixelValue:s.min,maxPixelValue:s.max,slope:m.slope,intercept:m.intercept,windowCenter:g.windowCenter,windowWidth:g.windowWidth,render:d.renderGrayscaleImage,getPixelData:o,rows:n,columns:h,height:n,width:h,color:false,columnPixelSpacing:k.column,rowPixelSpacing:k.row,data:w,invert:p,sizeInBytes:u};if(r.windowCenter===undefined){var i=r.maxPixelValue*r.slope+r.intercept;var t=r.minPixelValue*r.slope+r.intercept;r.windowWidth=i-t;r.windowCenter=(i+t)/2}B.resolve(r);return B}c.makeGrayscaleImage=e}($,cornerstone,cornerstoneWADOImageLoader));(function(a){a.version="0.7.0"}(cornerstoneWADOImageLoader));(function(c,b,a){function d(g,i,f){var e=c.Deferred();var h=new XMLHttpRequest();h.responseType="arraybuffer";h.open("get",f,true);a.internal.options.beforeSend(h);h.onreadystatechange=function(k){if(h.readyState===4){if(h.status===200){var l=h.response;var j=new Uint8Array(l);var n=dicomParser.parseDicom(j);if(i!==undefined){a.internal.multiFrameCacheHack[f]=n}var m=a.createImageObject(n,g,i);m.then(function(o){e.resolve(o)},function(o){e.reject(o)})}else{e.reject(h.response)}}};h.onprogress=function(m){if(m.lengthComputable){var j=m.loaded;var l=m.total;var k=Math.round((j/l)*100);c(b).trigger("CornerstoneImageLoadProgress",{imageId:g,loaded:j,total:l,percentComplete:k})}};h.send();return e}a.internal.xhrRequest=d}($,cornerstone,cornerstoneWADOImageLoader));/*! cornerstoneWebImageLoader - v0.5.2 - 2015-09-06 | (c) 2015 Chris Hafey | https://github.com/chafey/cornerstoneWebImageLoader */
;cornerstoneWebImageLoader={};(function(h,g,a){var e=document.createElement("canvas");var d="";var i={beforeSend:function(j){}};function b(k,j){var r=k.naturalHeight;var l=k.naturalWidth;function m(){var y=n();var s=y.data;var x=k.naturalHeight*k.naturalWidth;var v=new Uint8Array(x*4);var u=0;var w=0;for(var t=0;t<x;t++){v[w++]=s[u++];v[w++]=s[u++];v[w++]=s[u++];v[w++]=255;u++}return v}function n(){var s;if(d!==j){e.height=k.naturalHeight;e.width=k.naturalWidth;s=e.getContext("2d");s.drawImage(k,0,0);d=j}else{s=e.getContext("2d")}var t=s.getImageData(0,0,k.naturalWidth,k.naturalHeight);return t}function o(){if(d===j){return e}e.height=k.naturalHeight;e.width=k.naturalWidth;var s=e.getContext("2d");s.drawImage(k,0,0);d=j;return e}function p(){return k}var q={imageId:j,minPixelValue:0,maxPixelValue:255,slope:1,intercept:0,windowCenter:127,windowWidth:256,render:g.renderColorImage,getPixelData:m,getImageData:n,getCanvas:o,getImage:p,rows:r,columns:l,height:r,width:l,color:true,columnPixelSpacing:1,rowPixelSpacing:1,invert:false,sizeInBytes:r*l*4};return q}function c(k){var j=h.Deferred();var l=new Image();var m=new XMLHttpRequest();m.responseType="arraybuffer";m.open("GET",k,true);i.beforeSend(m);m.onload=function(r){var q=new Uint8Array(this.response);var o=new Blob([q],{type:"image/jpeg"});var n=window.URL||window.webkitURL;var p=n.createObjectURL(o);l.src=p;l.onload=function(){var s=b(l,k);j.resolve(s);n.revokeObjectURL(p)};l.onerror=function(){n.revokeObjectURL(p);j.reject()}};m.onprogress=function(q){if(q.lengthComputable){var n=q.loaded;var p=q.total;var o=Math.round((n/p)*100);h(g).trigger("CornerstoneImageLoadProgress",{imageId:k,loaded:n,total:p,percentComplete:o})}};m.send();return j}function f(j){i=j}g.registerImageLoader("http",c);g.registerImageLoader("https",c);a.configure=f;return g}($,cornerstone,cornerstoneWebImageLoader));/*! dicom-parser - v1.2.1 - 2016-02-03 | (c) 2014 Chris Hafey | https://github.com/chafey/dicomParser */
!function(a,b){"undefined"!=typeof module&&module.exports?module.exports=b():"function"==typeof define&&define.amd?define([],b):("undefined"==typeof cornerstone&&(dicomParser={},"undefined"!=typeof Package&&(a.dicomParser=dicomParser)),dicomParser=b())}(this,function(){var a=function(a){return void 0===a&&(a={}),a.parseDicom=function(b,c){function d(c){if(void 0===c.elements.x00020010)throw"dicomParser.parseDicom: missing required meta header attribute 0002,0010";var d=c.elements.x00020010;return a.readFixedString(b,d.dataOffset,d.length)}function e(a){return"1.2.840.10008.1.2"===a?!1:!0}function f(c,d){if("1.2.840.10008.1.2.1.99"===c){if("undefined"==typeof pako)throw"dicomParser.parseDicom: deflated transfer syntax encountered but pako not loaded";var e=b.slice(d),f=pako.inflateRaw(e),g=new Uint8Array(f.length+d);return g.set(b.slice(0,d),0),g.set(f,d),new a.ByteStream(a.littleEndianByteArrayParser,g,0)}return"1.2.840.10008.1.2.2"===c?new a.ByteStream(a.bigEndianByteArrayParser,b,d):new a.ByteStream(a.littleEndianByteArrayParser,b,d)}function g(a,b){for(var c in a.elements)a.elements.hasOwnProperty(c)&&(b.elements[c]=a.elements[c]);return void 0!==a.warnings&&(b.warnings=a.warnings.concat(b.warnings)),b}function h(b){var g=d(b),h=e(g),i=f(g,b.position),j={},k=new a.DataSet(i.byteArrayParser,i.byteArray,j);k.warnings=i.warnings;try{h?a.parseDicomDataSetExplicit(k,i,i.byteArray.length,c):a.parseDicomDataSetImplicit(k,i,i.byteArray.length,c)}catch(l){var m={exception:l,dataSet:k};throw m}return k}function i(){var d=a.readPart10Header(b,c),e=h(d);return g(d,e)}if(void 0===b)throw"dicomParser.parseDicom: missing required parameter 'byteArray'";return i()},a}(a),a=function(a){"use strict";return void 0===a&&(a={}),a.explicitDataSetToJS=function(b,c){if(void 0===b)throw"dicomParser.explicitDataSetToJS: missing required parameter dataSet";c=c||{omitPrivateAttibutes:!0,maxElementLength:128};var d={};for(var e in b.elements){var f=b.elements[e];if(c.omitPrivateAttibutes!==!0||!a.isPrivateTag(e))if(f.items){for(var g=[],h=0;h<f.items.length;h++)g.push(a.explicitDataSetToJS(f.items[h].dataSet,c));d[e]=g}else{var i;i=void 0,f.length<c.maxElementLength&&(i=a.explicitElementToString(b,f)),void 0!==i?d[e]=i:d[e]={dataOffset:f.dataOffset,length:f.length}}}return d},a}(a),a=function(a){"use strict";return void 0===a&&(a={}),a.explicitElementToString=function(b,c){function d(a,c){for(var d="",e=0;a>e;e++)0!==e&&(d+="/"),d+=c.call(b,g,e).toString();return d}if(void 0===b||void 0===c)throw"dicomParser.explicitElementToString: missing required parameters";if(void 0===c.vr)throw"dicomParser.explicitElementToString: cannot convert implicit element to string";var e,f=c.vr,g=c.tag;if(a.isStringVr(f)===!0)e=b.string(g);else{if("AT"==f){var h=b.uint32(g);return void 0===h?void 0:(0>h&&(h=4294967295+h+1),"x"+h.toString(16).toUpperCase())}"US"==f?e=d(c.length/2,b.uint16):"SS"===f?e=d(c.length/2,b.int16):"UL"==f?e=d(c.length/4,b.uint32):"SL"===f?e=d(c.length/4,b.int32):"FD"==f?e=d(c.length/8,b["double"]):"FL"==f&&(e=d(c.length/4,b["float"]))}return e},a}(a),a=function(a){"use strict";function b(a,b){switch(a){case 2:return b%4==0&&b%100||b%400==0?29:28;case 9:case 4:case 6:case 11:return 30;default:return 31}}function c(a,c,d){return isNaN(d)?!1:c>0&&12>=c&&a>0&&a<=b(c,d)}return void 0===a&&(a={}),a.parseDA=function(a,b){if(a&&8===a.length){var d=parseInt(a.substring(0,4),10),e=parseInt(a.substring(4,6),10),f=parseInt(a.substring(6,8),10);if(b&&c(f,e,d)!==!0)throw"invalid DA '"+a+"'";return{year:d,month:e,day:f}}if(b)throw"invalid DA '"+a+"'";return void 0},a}(a),a=function(a){"use strict";return void 0===a&&(a={}),a.parseTM=function(a,b){if(a.length>=2){var c=parseInt(a.substring(0,2),10),d=a.length>=4?parseInt(a.substring(2,4),10):void 0,e=a.length>=6?parseInt(a.substring(4,6),10):void 0,f=a.length>=8?parseInt(a.substring(7,13),10):void 0;if(b&&(isNaN(c)||void 0!==d&&isNaN(d)||void 0!==e&&isNaN(e)||void 0!==f&&isNaN(f)||0>c||c>23||d&&(0>d||d>59)||e&&(0>e||e>59)||f&&(0>f||f>999999)))throw"invalid TM '"+a+"'";return{hours:c,minutes:d,seconds:e,fractionalSeconds:f}}if(b)throw"invalid TM '"+a+"'";return void 0},a}(a),a=function(a){"use strict";void 0===a&&(a={});var b={AE:!0,AS:!0,AT:!1,CS:!0,DA:!0,DS:!0,DT:!0,FL:!1,FD:!1,IS:!0,LO:!0,LT:!0,OB:!1,OD:!1,OF:!1,OW:!1,PN:!0,SH:!0,SL:!1,SQ:!1,SS:!1,ST:!0,TM:!0,UI:!0,UL:!1,UN:void 0,UR:!0,US:!1,UT:!0};return a.isStringVr=function(a){return b[a]},a.isPrivateTag=function(a){var b=parseInt(a[4]),c=b%2===1;return c},a.parsePN=function(a){if(void 0===a)return void 0;var b=a.split("^");return{familyName:b[0],givenName:b[1],middleName:b[2],prefix:b[3],suffix:b[4]}},a}(a),a=function(a){"use strict";function b(a,b,c){if(1===b.length)return new Uint8Array(a.byteArray.buffer,b[0].dataOffset,b[0].length);for(var d=new Uint8Array(c),e=0,f=0;f<b.length;f++)for(var g=b[f].dataOffset,h=0;h<b[f].length;h++)d[e++]=a.byteArray[g++];return d}function c(c,d){for(var e=[],f=0;c.position<d&&c.position<c.byteArray.length;){var g=a.readSequenceItem(c);if("xfffee0dd"===g.tag)break;e.push(g),c.seek(g.length),f+=g.length}var h=b(c,e,f);return h}function d(a,b,d){var e=a.basicOffsetTable.length;if(d>e)throw"dicomParser.readEncapsulatedPixelData: parameter frame exceeds number of frames in basic offset table";var f=a.basicOffsetTable[d],g=b.position;b.seek(f);var h=a.basicOffsetTable[d+1];void 0===h?h=b.position+a.length:h+=g;var i=c(b,h);return i}function e(a,b,d){if(0!==d)throw"dicomParser.readEncapsulatedPixelData: non zero frame specified for single frame encapsulated pixel data";var e=b.position+a.length,f=c(b,e);return f}return void 0===a&&(a={}),a.readEncapsulatedPixelData=function(b,c,f){if(void 0===b)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'dataSet'";if(void 0===c)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'element'";if(void 0===f)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'frame'";if("x7fe00010"!==c.tag)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to non pixel data tag (expected tag = x7fe00010'";if(c.encapsulatedPixelData!==!0)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(c.hadUndefinedLength!==!0)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===c.basicOffsetTable)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===c.fragments)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(0>f)throw"dicomParser.readEncapsulatedPixelData: parameter 'frame' must be >= 0";var g=new a.ByteStream(b.byteArrayParser,b.byteArray,c.dataOffset),h=a.readSequenceItem(g);if("xfffee000"!==h.tag)throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";return g.seek(h.length),0!==c.basicOffsetTable.length?d(c,g,f):e(c,g,f)},a}(a),a=function(a){"use strict";return void 0===a&&(a={}),a.bigEndianByteArrayParser={readUint16:function(a,b){if(0>b)throw"bigEndianByteArrayParser.readUint16: position cannot be less than 0";if(b+2>a.length)throw"bigEndianByteArrayParser.readUint16: attempt to read past end of buffer";return(a[b]<<8)+a[b+1]},readInt16:function(a,b){if(0>b)throw"bigEndianByteArrayParser.readInt16: position cannot be less than 0";if(b+2>a.length)throw"bigEndianByteArrayParser.readInt16: attempt to read past end of buffer";var c=(a[b]<<8)+a[b+1];return 32768&c&&(c=c-65535-1),c},readUint32:function(a,b){if(0>b)throw"bigEndianByteArrayParser.readUint32: position cannot be less than 0";if(b+4>a.length)throw"bigEndianByteArrayParser.readUint32: attempt to read past end of buffer";var c=256*(256*(256*a[b]+a[b+1])+a[b+2])+a[b+3];return c},readInt32:function(a,b){if(0>b)throw"bigEndianByteArrayParser.readInt32: position cannot be less than 0";if(b+4>a.length)throw"bigEndianByteArrayParser.readInt32: attempt to read past end of buffer";var c=(a[b]<<24)+(a[b+1]<<16)+(a[b+2]<<8)+a[b+3];return c},readFloat:function(a,b){if(0>b)throw"bigEndianByteArrayParser.readFloat: position cannot be less than 0";if(b+4>a.length)throw"bigEndianByteArrayParser.readFloat: attempt to read past end of buffer";var c=new Uint8Array(4);c[3]=a[b],c[2]=a[b+1],c[1]=a[b+2],c[0]=a[b+3];var d=new Float32Array(c.buffer);return d[0]},readDouble:function(a,b){if(0>b)throw"bigEndianByteArrayParser.readDouble: position cannot be less than 0";if(b+8>a.length)throw"bigEndianByteArrayParser.readDouble: attempt to read past end of buffer";var c=new Uint8Array(8);c[7]=a[b],c[6]=a[b+1],c[5]=a[b+2],c[4]=a[b+3],c[3]=a[b+4],c[2]=a[b+5],c[1]=a[b+6],c[0]=a[b+7];var d=new Float64Array(c.buffer);return d[0]}},a}(a),a=function(a){"use strict";return void 0===a&&(a={}),a.readFixedString=function(a,b,c){if(0>c)throw"readFixedString - length cannot be less than 0";if(b+c>a.length)throw"dicomParser.readFixedString: attempt to read past end of buffer";for(var d="",e=0;c>e;e++){var f=a[b+e];if(0===f)return b+=c,d;d+=String.fromCharCode(f)}return d},a}(a),a=function(a){"use strict";return void 0===a&&(a={}),a.ByteStream=function(a,b,c){if(void 0===a)throw"dicomParser.ByteStream: missing required parameter 'byteArrayParser'";if(void 0===b)throw"dicomParser.ByteStream: missing required parameter 'byteArray'";if(b instanceof Uint8Array==!1&&b instanceof Buffer==!1)throw"dicomParser.ByteStream: parameter byteArray is not of type Uint8Array or Buffer";if(0>c)throw"dicomParser.ByteStream: parameter 'position' cannot be less than 0";if(c>=b.length)throw"dicomParser.ByteStream: parameter 'position' cannot be greater than or equal to 'byteArray' length";this.byteArrayParser=a,this.byteArray=b,this.position=c?c:0,this.warnings=[]},a.ByteStream.prototype.seek=function(a){if(this.position+a<0)throw"cannot seek to position < 0";this.position+=a},a.ByteStream.prototype.readByteStream=function(b){if(this.position+b>this.byteArray.length)throw"readByteStream - buffer overread";var c=new Uint8Array(this.byteArray.buffer,this.position,b);return this.position+=b,new a.ByteStream(this.byteArrayParser,c)},a.ByteStream.prototype.readUint16=function(){var a=this.byteArrayParser.readUint16(this.byteArray,this.position);return this.position+=2,a},a.ByteStream.prototype.readUint32=function(){var a=this.byteArrayParser.readUint32(this.byteArray,this.position);return this.position+=4,a},a.ByteStream.prototype.readFixedString=function(b){var c=a.readFixedString(this.byteArray,this.position,b);return this.position+=b,c},a}(a),a=function(a){"use strict";function b(a,b){return void 0!==a.parser?a.parser:b}return void 0===a&&(a={}),a.DataSet=function(a,b,c){this.byteArrayParser=a,this.byteArray=b,this.elements=c},a.DataSet.prototype.uint16=function(a,c){var d=this.elements[a];return c=void 0!==c?c:0,d&&0!==d.length?b(d,this.byteArrayParser).readUint16(this.byteArray,d.dataOffset+2*c):void 0},a.DataSet.prototype.int16=function(a,c){var d=this.elements[a];return c=void 0!==c?c:0,d&&0!==d.length?b(d,this.byteArrayParser).readInt16(this.byteArray,d.dataOffset+2*c):void 0},a.DataSet.prototype.uint32=function(a,c){var d=this.elements[a];return c=void 0!==c?c:0,d&&0!==d.length?b(d,this.byteArrayParser).readUint32(this.byteArray,d.dataOffset+4*c):void 0},a.DataSet.prototype.int32=function(a,c){var d=this.elements[a];return c=void 0!==c?c:0,d&&0!==d.length?b(d,this.byteArrayParser).readInt32(this.byteArray,d.dataOffset+4*c):void 0},a.DataSet.prototype["float"]=function(a,c){var d=this.elements[a];return c=void 0!==c?c:0,d&&0!==d.length?b(d,this.byteArrayParser).readFloat(this.byteArray,d.dataOffset+4*c):void 0},a.DataSet.prototype["double"]=function(a,c){var d=this.elements[a];return c=void 0!==c?c:0,d&&0!==d.length?b(d,this.byteArrayParser).readDouble(this.byteArray,d.dataOffset+8*c):void 0},a.DataSet.prototype.numStringValues=function(b){var c=this.elements[b];if(c&&c.length>0){var d=a.readFixedString(this.byteArray,c.dataOffset,c.length),e=d.match(/\\/g);return null===e?1:e.length+1}return void 0},a.DataSet.prototype.string=function(b,c){var d=this.elements[b];if(d&&d.length>0){var e=a.readFixedString(this.byteArray,d.dataOffset,d.length);if(c>=0){var f=e.split("\\");return f[c].trim()}return e.trim()}return void 0},a.DataSet.prototype.text=function(b,c){var d=this.elements[b];if(d&&d.length>0){var e=a.readFixedString(this.byteArray,d.dataOffset,d.length);if(c>=0){var f=e.split("\\");return f[c].replace(/ +$/,"")}return e.replace(/ +$/,"")}return void 0},a.DataSet.prototype.floatString=function(a,b){var c=this.elements[a];if(c&&c.length>0){b=void 0!==b?b:0;var d=this.string(a,b);if(void 0!==d)return parseFloat(d)}return void 0},a.DataSet.prototype.intString=function(a,b){var c=this.elements[a];if(c&&c.length>0){b=void 0!==b?b:0;var d=this.string(a,b);if(void 0!==d)return parseInt(d)}return void 0},a}(a),a=function(a){"use strict";return void 0===a&&(a={}),a.findEndOfEncapsulatedElement=function(b,c,d){if(void 0===b)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'byteStream'";if(void 0===c)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'element'";c.encapsulatedPixelData=!0,c.basicOffsetTable=[],c.fragments=[];var e=a.readTag(b);if("xfffee000"!==e)throw"dicomParser.findEndOfEncapsulatedElement: basic offset table not found";for(var f=b.readUint32(),g=f/4,h=0;g>h;h++){var i=b.readUint32();c.basicOffsetTable.push(i)}for(var j=b.position;b.position<b.byteArray.length;){var k=a.readTag(b),l=b.readUint32();if("xfffee0dd"===k)return b.seek(l),void(c.length=b.position-c.dataOffset);if("xfffee000"!==k)return d&&d.push("unexpected tag "+k+" while searching for end of pixel data element with undefined length"),l>b.byteArray.length-b.position&&(l=b.byteArray.length-b.position),c.fragments.push({offset:b.position-j-8,position:b.position,length:l}),b.seek(l),void(c.length=b.position-c.dataOffset);c.fragments.push({offset:b.position-j-8,position:b.position,length:l}),b.seek(l)}d&&d.push("pixel data element "+c.tag+" missing sequence delimiter tag xfffee0dd")},a}(a),a=function(a){"use strict";return void 0===a&&(a={}),a.findItemDelimitationItemAndSetElementLength=function(a,b){if(void 0===a)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";for(var c=8,d=a.byteArray.length-c;a.position<=d;){var e=a.readUint16();if(65534===e){var f=a.readUint16();if(57357===f){var g=a.readUint32();return 0!==g&&a.warnings("encountered non zero length following item delimiter at position"+a.position-4+" while reading element of undefined length with tag ' + element.tag"),void(b.length=a.position-b.dataOffset)}}}b.length=a.byteArray.length-b.dataOffset,a.seek(a.byteArray.length-a.position)},a}(a),a=function(a){"use strict";return void 0===a&&(a={}),a.littleEndianByteArrayParser={readUint16:function(a,b){if(0>b)throw"littleEndianByteArrayParser.readUint16: position cannot be less than 0";if(b+2>a.length)throw"littleEndianByteArrayParser.readUint16: attempt to read past end of buffer";return a[b]+256*a[b+1]},readInt16:function(a,b){if(0>b)throw"littleEndianByteArrayParser.readInt16: position cannot be less than 0";if(b+2>a.length)throw"littleEndianByteArrayParser.readInt16: attempt to read past end of buffer";var c=a[b]+(a[b+1]<<8);return 32768&c&&(c=c-65535-1),c},readUint32:function(a,b){if(0>b)throw"littleEndianByteArrayParser.readUint32: position cannot be less than 0";if(b+4>a.length)throw"littleEndianByteArrayParser.readUint32: attempt to read past end of buffer";var c=a[b]+256*a[b+1]+256*a[b+2]*256+256*a[b+3]*256*256;return c},readInt32:function(a,b){if(0>b)throw"littleEndianByteArrayParser.readInt32: position cannot be less than 0";if(b+4>a.length)throw"littleEndianByteArrayParser.readInt32: attempt to read past end of buffer";var c=a[b]+(a[b+1]<<8)+(a[b+2]<<16)+(a[b+3]<<24);return c},readFloat:function(a,b){if(0>b)throw"littleEndianByteArrayParser.readFloat: position cannot be less than 0";if(b+4>a.length)throw"littleEndianByteArrayParser.readFloat: attempt to read past end of buffer";var c=new Uint8Array(4);c[0]=a[b],c[1]=a[b+1],c[2]=a[b+2],c[3]=a[b+3];var d=new Float32Array(c.buffer);return d[0]},readDouble:function(a,b){if(0>b)throw"littleEndianByteArrayParser.readDouble: position cannot be less than 0";if(b+8>a.length)throw"littleEndianByteArrayParser.readDouble: attempt to read past end of buffer";var c=new Uint8Array(8);c[0]=a[b],c[1]=a[b+1],c[2]=a[b+2],c[3]=a[b+3],c[4]=a[b+4],c[5]=a[b+5],c[6]=a[b+6],c[7]=a[b+7];var d=new Float64Array(c.buffer);return d[0]}},a}(a),a=function(a){"use strict";return void 0===a&&(a={}),a.parseDicomDataSetExplicit=function(b,c,d,e){if(d=void 0===d?c.byteArray.length:d,e=e||{},void 0===c)throw"dicomParser.parseDicomDataSetExplicit: missing required parameter 'byteStream'";if(d<c.position||d>c.byteArray.length)throw"dicomParser.parseDicomDataSetExplicit: invalid value for parameter 'maxPosition'";for(var f=b.elements;c.position<d;){var g=a.readDicomElementExplicit(c,b.warnings,e.untilTag);if(f[g.tag]=g,g.tag===e.untilTag)return}if(c.position>d)throw"dicomParser:parseDicomDataSetExplicit: buffer overrun"},a.parseDicomDataSetImplicit=function(b,c,d,e){if(d=void 0===d?b.byteArray.length:d,e=e||{},void 0===c)throw"dicomParser.parseDicomDataSetImplicit: missing required parameter 'byteStream'";if(d<c.position||d>c.byteArray.length)throw"dicomParser.parseDicomDataSetImplicit: invalid value for parameter 'maxPosition'";for(var f=b.elements;c.position<d;){var g=a.readDicomElementImplicit(c,e.untilTag);if(f[g.tag]=g,g.tag===e.untilTag)return}},a}(a),a=function(a){"use strict";function b(a){return"OB"===a||"OW"===a||"SQ"===a||"OF"===a||"UT"===a||"UN"===a?4:2}return void 0===a&&(a={}),a.readDicomElementExplicit=function(c,d,e){if(void 0===c)throw"dicomParser.readDicomElementExplicit: missing required parameter 'byteStream'";var f={tag:a.readTag(c),vr:c.readFixedString(2)},g=b(f.vr);return 2===g?(f.length=c.readUint16(),f.dataOffset=c.position):(c.seek(2),f.length=c.readUint32(),f.dataOffset=c.position),4294967295===f.length&&(f.hadUndefinedLength=!0),f.tag===e?f:"SQ"===f.vr?(a.readSequenceItemsExplicit(c,f,d),f):4294967295===f.length?"x7fe00010"===f.tag?(a.findEndOfEncapsulatedElement(c,f,d),f):(a.findItemDelimitationItemAndSetElementLength(c,f),f):(c.seek(f.length),f)},a}(a),a=function(a){"use strict";return void 0===a&&(a={}),a.readDicomElementImplicit=function(b,c){if(void 0===b)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";var d={tag:a.readTag(b),length:b.readUint32(),dataOffset:b.position};if(4294967295===d.length&&(d.hadUndefinedLength=!0),d.tag===c)return d;if(b.position+4<=b.byteArray.length){var e=a.readTag(b);if(b.seek(-4),d.hadUndefinedLength&&"xfffee0dd"===e)return d.length=0,b.seek(8),d;if("xfffee000"===e)return a.readSequenceItemsImplicit(b,d),d}return 4294967295===d.length?(a.findItemDelimitationItemAndSetElementLength(b,d),d):(b.seek(d.length),d)},a}(a),a=function(a){return void 0===a&&(a={}),a.readPart10Header=function(b,c){function d(){f.seek(128);var a=f.readFixedString(4);if("DICM"!==a)throw"dicomParser.readPart10Header: DICM prefix not found at location 132"}function e(){d();for(var b=[],c={};f.position<f.byteArray.length;){var e=f.position,g=a.readDicomElementExplicit(f,b);if(g.tag>"x0002ffff"){f.position=e;break}g.parser=a.littleEndianByteArrayParser,c[g.tag]=g}var h=new a.DataSet(f.byteArrayParser,f.byteArray,c);return h.warnings=f.warnings,h.position=f.position,h}if(void 0===b)throw"dicomParser.readPart10Header: missing required parameter 'byteArray'";var f=new a.ByteStream(a.littleEndianByteArrayParser,b);return e()},a}(a),a=function(a){"use strict";function b(b,c){for(var d={};b.position<b.byteArray.length;){var e=a.readDicomElementExplicit(b,c);if(d[e.tag]=e,"xfffee00d"===e.tag)return new a.DataSet(b.byteArrayParser,b.byteArray,d)}return b.warnings.push("eof encountered before finding sequence delimitation item while reading sequence item of undefined length"),new a.DataSet(b.byteArrayParser,b.byteArray,d)}function c(c,d){var e=a.readSequenceItem(c);return 4294967295===e.length?(e.hadUndefinedLength=!0,e.dataSet=b(c,d),e.length=c.position-e.dataOffset):(e.dataSet=new a.DataSet(c.byteArrayParser,c.byteArray,{}),a.parseDicomDataSetExplicit(e.dataSet,c,c.position+e.length)),e}function d(b,d,e){for(;b.position<b.byteArray.length;){var f=a.readTag(b);if(b.seek(-4),"xfffee0dd"===f)return d.length=b.position-d.dataOffset,b.seek(8),d;var g=c(b,e);d.items.push(g)}d.length=b.position-d.dataOffset}function e(a,b,d){for(var e=b.dataOffset+b.length;a.position<e;){var f=c(a,d);b.items.push(f)}}return void 0===a&&(a={}),a.readSequenceItemsExplicit=function(a,b,c){if(void 0===a)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'byteStream'";if(void 0===b)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'element'";b.items=[],4294967295===b.length?d(a,b):e(a,b,c)},a}(a),a=function(a){"use strict";function b(b){for(var c={};b.position<b.byteArray.length;){var d=a.readDicomElementImplicit(b);if(c[d.tag]=d,"xfffee00d"===d.tag)return new a.DataSet(b.byteArrayParser,b.byteArray,c)}return b.warnings.push("eof encountered before finding sequence item delimiter in sequence item of undefined length"),new a.DataSet(b.byteArrayParser,b.byteArray,c)}function c(c){var d=a.readSequenceItem(c);return 4294967295===d.length?(d.hadUndefinedLength=!0,d.dataSet=b(c),d.length=c.position-d.dataOffset):(d.dataSet=new a.DataSet(c.byteArrayParser,c.byteArray,{}),a.parseDicomDataSetImplicit(d.dataSet,c,c.position+d.length)),d}function d(b,d){for(;b.position<b.byteArray.length;){var e=a.readTag(b);if(b.seek(-4),"xfffee0dd"===e)return d.length=b.position-d.dataOffset,b.seek(8),d;var f=c(b);d.items.push(f)}d.length=b.byteArray.length-d.dataOffset}function e(a,b){for(var d=b.dataOffset+b.length;a.position<d;){var e=c(a);b.items.push(e)}}return void 0===a&&(a={}),a.readSequenceItemsImplicit=function(a,b){if(void 0===a)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'byteStream'";if(void 0===b)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'element'";b.items=[],4294967295===b.length?d(a,b):e(a,b)},a}(a),a=function(a){"use strict";return void 0===a&&(a={}),a.readSequenceItem=function(b){if(void 0===b)throw"dicomParser.readSequenceItem: missing required parameter 'byteStream'";var c={tag:a.readTag(b),length:b.readUint32(),dataOffset:b.position};return c},a}(a),a=function(a){"use strict";return void 0===a&&(a={}),a.readTag=function(a){if(void 0===a)throw"dicomParser.readTag: missing required parameter 'byteStream'";var b=256*a.readUint16()*256,c=a.readUint16(),d="x"+("00000000"+(b+c).toString(16)).substr(-8);return d},a}(a),a=function(a){"use strict";return void 0===a&&(a={}),a.version="1.2.1",a}(a);return a});/*! image-JPEG2000 - v0.3.1 - 2015-08-26 | https://github.com/OHIF/image-JPEG2000 */
"use strict";function info(a){PDFJS.verbosity>=PDFJS.VERBOSITY_LEVELS.infos&&console.log("Info: "+a)}function warn(a){PDFJS.verbosity>=PDFJS.VERBOSITY_LEVELS.warnings&&console.log("Warning: "+a)}function error(a){if(arguments.length>1){var b=["Error:"];b.push.apply(b,arguments),console.log.apply(console,b),a=[].join.call(arguments," ")}else console.log("Error: "+a);throw console.log(backtrace()),UnsupportedManager.notify(UNSUPPORTED_FEATURES.unknown),new Error(a)}function backtrace(){try{throw new Error}catch(a){return a.stack?a.stack.split("\n").slice(2).join("\n"):""}}function assert(a,b){a||error(b)}function combineUrl(a,b){if(!b)return a;if(/^[a-z][a-z0-9+\-.]*:/i.test(b))return b;var c;if("/"===b.charAt(0))return c=a.indexOf("://"),"/"===b.charAt(1)?++c:c=a.indexOf("/",c+3),a.substring(0,c)+b;var d=a.length;c=a.lastIndexOf("#"),d=c>=0?c:d,c=a.lastIndexOf("?",d),d=c>=0?c:d;var e=a.lastIndexOf("/",d);return a.substring(0,e+1)+b}function isValidUrl(a,b){if(!a)return!1;var c=/^[a-z][a-z0-9+\-.]*(?=:)/i.exec(a);if(!c)return b;switch(c=c[0].toLowerCase()){case"http":case"https":case"ftp":case"mailto":case"tel":return!0;default:return!1}}function shadow(a,b,c){return Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!1}),c}function bytesToString(a){assert(null!==a&&"object"==typeof a&&void 0!==a.length,"Invalid argument for bytesToString");var b=a.length,c=8192;if(c>b)return String.fromCharCode.apply(null,a);for(var d=[],e=0;b>e;e+=c){var f=Math.min(e+c,b),g=a.subarray(e,f);d.push(String.fromCharCode.apply(null,g))}return d.join("")}function stringToBytes(a){assert("string"==typeof a,"Invalid argument for stringToBytes");for(var b=a.length,c=new Uint8Array(b),d=0;b>d;++d)c[d]=255&a.charCodeAt(d);return c}function string32(a){return String.fromCharCode(a>>24&255,a>>16&255,a>>8&255,255&a)}function log2(a){for(var b=1,c=0;a>b;)b<<=1,c++;return c}function readInt8(a,b){return a[b]<<24>>24}function readUint16(a,b){return a[b]<<8|a[b+1]}function readUint32(a,b){return(a[b]<<24|a[b+1]<<16|a[b+2]<<8|a[b+3])>>>0}function isLittleEndian(){var a=new Uint8Array(2);a[0]=1;var b=new Uint16Array(a.buffer);return 1===b[0]}function hasCanvasTypedArrays(){var a=document.createElement("canvas");a.width=a.height=1;var b=a.getContext("2d"),c=b.createImageData(1,1);return"undefined"!=typeof c.data.buffer}function stringToPDFString(a){var b,c=a.length,d=[];if("þ"===a[0]&&"ÿ"===a[1])for(b=2;c>b;b+=2)d.push(String.fromCharCode(a.charCodeAt(b)<<8|a.charCodeAt(b+1)));else for(b=0;c>b;++b){var e=PDFStringTranslateTable[a.charCodeAt(b)];d.push(e?String.fromCharCode(e):a.charAt(b))}return d.join("")}function stringToUTF8String(a){return decodeURIComponent(escape(a))}function isEmptyObj(a){for(var b in a)return!1;return!0}function isBool(a){return"boolean"==typeof a}function isInt(a){return"number"==typeof a&&(0|a)===a}function isNum(a){return"number"==typeof a}function isString(a){return"string"==typeof a}function isNull(a){return null===a}function isName(a){return a instanceof Name}function isCmd(a,b){return a instanceof Cmd&&(void 0===b||a.cmd===b)}function isDict(a,b){if(!(a instanceof Dict))return!1;if(!b)return!0;var c=a.get("Type");return isName(c)&&c.name===b}function isArray(a){return a instanceof Array}function isStream(a){return"object"==typeof a&&null!==a&&void 0!==a.getBytes}function isArrayBuffer(a){return"object"==typeof a&&null!==a&&void 0!==a.byteLength}function isRef(a){return a instanceof Ref}function createPromiseCapability(){var a={};return a.promise=new Promise(function(b,c){a.resolve=b,a.reject=c}),a}function MessageHandler(a,b){this.name=a,this.comObj=b,this.callbackIndex=1,this.postMessageTransfers=!0;var c=this.callbacksCapabilities={},d=this.actionHandler={};d.console_log=[function(a){console.log.apply(console,a)}],d.console_error=[function(a){console.error.apply(console,a)}],d._unsupported_feature=[function(a){UnsupportedManager.notify(a)}],b.onmessage=function(a){var e=a.data;if(e.isReply){var f=e.callbackId;if(e.callbackId in c){var g=c[f];delete c[f],"error"in e?g.reject(e.error):g.resolve(e.data)}else error("Cannot resolve callback "+f)}else if(e.action in d){var h=d[e.action];e.callbackId?Promise.resolve().then(function(){return h[0].call(h[1],e.data)}).then(function(a){b.postMessage({isReply:!0,callbackId:e.callbackId,data:a})},function(a){b.postMessage({isReply:!0,callbackId:e.callbackId,error:a})}):h[0].call(h[1],e.data)}else error("Unknown action from worker: "+e.action)}}function loadJpegStream(a,b,c){var d=new Image;d.onload=function(){c.resolve(a,d)},d.onerror=function(){c.resolve(a,null),warn("Error during JPEG image loading")},d.src=b}var JpxImage=function(){function a(){this.failOnCorruptedImage=!1}function b(a,b){a.x0=Math.ceil(b.XOsiz/a.XRsiz),a.x1=Math.ceil(b.Xsiz/a.XRsiz),a.y0=Math.ceil(b.YOsiz/a.YRsiz),a.y1=Math.ceil(b.Ysiz/a.YRsiz),a.width=a.x1-a.x0,a.height=a.y1-a.y0}function c(a,b){for(var c,d=a.SIZ,e=[],f=Math.ceil((d.Xsiz-d.XTOsiz)/d.XTsiz),g=Math.ceil((d.Ysiz-d.YTOsiz)/d.YTsiz),h=0;g>h;h++)for(var i=0;f>i;i++)c={},c.tx0=Math.max(d.XTOsiz+i*d.XTsiz,d.XOsiz),c.ty0=Math.max(d.YTOsiz+h*d.YTsiz,d.YOsiz),c.tx1=Math.min(d.XTOsiz+(i+1)*d.XTsiz,d.Xsiz),c.ty1=Math.min(d.YTOsiz+(h+1)*d.YTsiz,d.Ysiz),c.width=c.tx1-c.tx0,c.height=c.ty1-c.ty0,c.components=[],e.push(c);a.tiles=e;for(var j=d.Csiz,k=0,l=j;l>k;k++)for(var m=b[k],n=0,o=e.length;o>n;n++){var p={};c=e[n],p.tcx0=Math.ceil(c.tx0/m.XRsiz),p.tcy0=Math.ceil(c.ty0/m.YRsiz),p.tcx1=Math.ceil(c.tx1/m.XRsiz),p.tcy1=Math.ceil(c.ty1/m.YRsiz),p.width=p.tcx1-p.tcx0,p.height=p.tcy1-p.tcy0,c.components[k]=p}}function d(a,b,c){var d=b.codingStyleParameters,e={};return d.entropyCoderWithCustomPrecincts?(e.PPx=d.precinctsSizes[c].PPx,e.PPy=d.precinctsSizes[c].PPy):(e.PPx=15,e.PPy=15),e.xcb_=c>0?Math.min(d.xcb,e.PPx-1):Math.min(d.xcb,e.PPx),e.ycb_=c>0?Math.min(d.ycb,e.PPy-1):Math.min(d.ycb,e.PPy),e}function e(a,b,c){var d=1<<c.PPx,e=1<<c.PPy,f=0===b.resLevel,g=1<<c.PPx+(f?0:-1),h=1<<c.PPy+(f?0:-1),i=b.trx1>b.trx0?Math.ceil(b.trx1/d)-Math.floor(b.trx0/d):0,j=b.try1>b.try0?Math.ceil(b.try1/e)-Math.floor(b.try0/e):0,k=i*j;b.precinctParameters={precinctWidth:d,precinctHeight:e,numprecinctswide:i,numprecinctshigh:j,numprecincts:k,precinctWidthInSubband:g,precinctHeightInSubband:h}}function f(a,b,c){var d,e,f,g,h=c.xcb_,i=c.ycb_,j=1<<h,k=1<<i,l=b.tbx0>>h,m=b.tby0>>i,n=b.tbx1+j-1>>h,o=b.tby1+k-1>>i,p=b.resolution.precinctParameters,q=[],r=[];for(e=m;o>e;e++)for(d=l;n>d;d++){f={cbx:d,cby:e,tbx0:j*d,tby0:k*e,tbx1:j*(d+1),tby1:k*(e+1)},f.tbx0_=Math.max(b.tbx0,f.tbx0),f.tby0_=Math.max(b.tby0,f.tby0),f.tbx1_=Math.min(b.tbx1,f.tbx1),f.tby1_=Math.min(b.tby1,f.tby1);var s=Math.floor((f.tbx0_-b.tbx0)/p.precinctWidthInSubband),t=Math.floor((f.tby0_-b.tby0)/p.precinctHeightInSubband);if(g=s+t*p.numprecinctswide,f.precinctNumber=g,f.subbandType=b.type,f.Lblock=3,!(f.tbx1_<=f.tbx0_||f.tby1_<=f.tby0_)){q.push(f);var u=r[g];void 0!==u?(d<u.cbxMin?u.cbxMin=d:d>u.cbxMax&&(u.cbxMax=d),e<u.cbyMin?u.cbxMin=e:e>u.cbyMax&&(u.cbyMax=e)):r[g]=u={cbxMin:d,cbyMin:e,cbxMax:d,cbyMax:e},f.precinct=u}}b.codeblockParameters={codeblockWidth:h,codeblockHeight:i,numcodeblockwide:n-l+1,numcodeblockhigh:o-m+1},b.codeblocks=q,b.precincts=r}function g(a,b,c){for(var d=[],e=a.subbands,f=0,g=e.length;g>f;f++)for(var h=e[f],i=h.codeblocks,j=0,k=i.length;k>j;j++){var l=i[j];l.precinctNumber===b&&d.push(l)}return{layerNumber:c,codeblocks:d}}function h(a){for(var b=a.SIZ,c=a.currentTile.index,d=a.tiles[c],e=d.codingStyleDefaultParameters.layersCount,f=b.Csiz,h=0,i=0;f>i;i++)h=Math.max(h,d.components[i].codingStyleParameters.decompositionLevelsCount);var j=0,k=0,l=0,m=0;this.nextPacket=function(){for(;e>j;j++){for(;h>=k;k++){for(;f>l;l++){var a=d.components[l];if(!(k>a.codingStyleParameters.decompositionLevelsCount)){for(var b=a.resolutions[k],c=b.precinctParameters.numprecincts;c>m;){var i=g(b,m,j);return m++,i}m=0}}l=0}k=0}}}function i(a){for(var b=a.SIZ,c=a.currentTile.index,d=a.tiles[c],e=d.codingStyleDefaultParameters.layersCount,f=b.Csiz,h=0,i=0;f>i;i++)h=Math.max(h,d.components[i].codingStyleParameters.decompositionLevelsCount);var j=0,k=0,l=0,m=0;this.nextPacket=function(){for(;h>=j;j++){for(;e>k;k++){for(;f>l;l++){var a=d.components[l];if(!(j>a.codingStyleParameters.decompositionLevelsCount)){for(var b=a.resolutions[j],c=b.precinctParameters.numprecincts;c>m;){var i=g(b,m,k);return m++,i}m=0}}l=0}k=0}}}function j(a){var b,c,d,e,f=a.SIZ,h=a.currentTile.index,i=a.tiles[h],j=i.codingStyleDefaultParameters.layersCount,k=f.Csiz,l=0;for(d=0;k>d;d++){var m=i.components[d];l=Math.max(l,m.codingStyleParameters.decompositionLevelsCount)}var n=new Int32Array(l+1);for(c=0;l>=c;++c){var o=0;for(d=0;k>d;++d){var p=i.components[d].resolutions;c<p.length&&(o=Math.max(o,p[c].precinctParameters.numprecincts))}n[c]=o}b=0,c=0,d=0,e=0,this.nextPacket=function(){for(;l>=c;c++){for(;e<n[c];e++){for(;k>d;d++){var a=i.components[d];if(!(c>a.codingStyleParameters.decompositionLevelsCount)){var f=a.resolutions[c],h=f.precinctParameters.numprecincts;if(!(e>=h)){for(;j>b;){var m=g(f,e,b);return b++,m}b=0}}}d=0}e=0}}}function k(a){var b=a.SIZ,c=a.currentTile.index,d=a.tiles[c],e=d.codingStyleDefaultParameters.layersCount,f=b.Csiz,h=n(d),i=h,j=0,k=0,l=0,o=0,p=0;this.nextPacket=function(){for(;p<i.maxNumHigh;p++){for(;o<i.maxNumWide;o++){for(;f>l;l++){for(var a=d.components[l],b=a.codingStyleParameters.decompositionLevelsCount;b>=k;k++){var c=a.resolutions[k],n=h.components[l].resolutions[k],q=m(o,p,n,i,c);if(null!==q){for(;e>j;){var r=g(c,q,j);return j++,r}j=0}}k=0}l=0}o=0}}}function l(a){var b=a.SIZ,c=a.currentTile.index,d=a.tiles[c],e=d.codingStyleDefaultParameters.layersCount,f=b.Csiz,h=n(d),i=0,j=0,k=0,l=0,o=0;this.nextPacket=function(){for(;f>k;++k){for(var a=d.components[k],b=h.components[k],c=a.codingStyleParameters.decompositionLevelsCount;o<b.maxNumHigh;o++){for(;l<b.maxNumWide;l++){for(;c>=j;j++){var n=a.resolutions[j],p=b.resolutions[j],q=m(l,o,p,b,n);if(null!==q){for(;e>i;){var r=g(n,q,i);return i++,r}i=0}}j=0}l=0}o=0}}}function m(a,b,c,d,e){var f=a*d.minWidth,g=b*d.minHeight;if(f%c.width!==0||g%c.height!==0)return null;var h=g/c.width*e.precinctParameters.numprecinctswide;return f/c.height+h}function n(a){for(var b=a.components.length,c=Number.MAX_VALUE,d=Number.MAX_VALUE,e=0,f=0,g=new Array(b),h=0;b>h;h++){for(var i=a.components[h],j=i.codingStyleParameters.decompositionLevelsCount,k=new Array(j+1),l=Number.MAX_VALUE,m=Number.MAX_VALUE,n=0,o=0,p=1,q=j;q>=0;--q){var r=i.resolutions[q],s=p*r.precinctParameters.precinctWidth,t=p*r.precinctParameters.precinctHeight;l=Math.min(l,s),m=Math.min(m,t),n=Math.max(n,r.precinctParameters.numprecinctswide),o=Math.max(o,r.precinctParameters.numprecinctshigh),k[q]={width:s,height:t},p<<=1}c=Math.min(c,l),d=Math.min(d,m),e=Math.max(e,n),f=Math.max(f,o),g[h]={resolutions:k,minWidth:l,minHeight:m,maxNumWide:n,maxNumHigh:o}}return{components:g,minWidth:c,minHeight:d,maxNumWide:e,maxNumHigh:f}}function o(a){for(var b=a.SIZ,c=a.currentTile.index,g=a.tiles[c],m=b.Csiz,n=0;m>n;n++){for(var o=g.components[n],p=o.codingStyleParameters.decompositionLevelsCount,q=[],r=[],s=0;p>=s;s++){var t=d(a,o,s),u={},v=1<<p-s;u.trx0=Math.ceil(o.tcx0/v),u.try0=Math.ceil(o.tcy0/v),u.trx1=Math.ceil(o.tcx1/v),u.try1=Math.ceil(o.tcy1/v),u.resLevel=s,e(a,u,t),q.push(u);var w;if(0===s)w={},w.type="LL",w.tbx0=Math.ceil(o.tcx0/v),w.tby0=Math.ceil(o.tcy0/v),w.tbx1=Math.ceil(o.tcx1/v),w.tby1=Math.ceil(o.tcy1/v),w.resolution=u,f(a,w,t),r.push(w),u.subbands=[w];else{var x=1<<p-s+1,y=[];w={},w.type="HL",w.tbx0=Math.ceil(o.tcx0/x-.5),w.tby0=Math.ceil(o.tcy0/x),w.tbx1=Math.ceil(o.tcx1/x-.5),w.tby1=Math.ceil(o.tcy1/x),w.resolution=u,f(a,w,t),r.push(w),y.push(w),w={},w.type="LH",w.tbx0=Math.ceil(o.tcx0/x),w.tby0=Math.ceil(o.tcy0/x-.5),w.tbx1=Math.ceil(o.tcx1/x),w.tby1=Math.ceil(o.tcy1/x-.5),w.resolution=u,f(a,w,t),r.push(w),y.push(w),w={},w.type="HH",w.tbx0=Math.ceil(o.tcx0/x-.5),w.tby0=Math.ceil(o.tcy0/x-.5),w.tbx1=Math.ceil(o.tcx1/x-.5),w.tby1=Math.ceil(o.tcy1/x-.5),w.resolution=u,f(a,w,t),r.push(w),y.push(w),u.subbands=y}}o.resolutions=q,o.subbands=r}var z=g.codingStyleDefaultParameters.progressionOrder;switch(z){case 0:g.packetsIterator=new h(a);break;case 1:g.packetsIterator=new i(a);break;case 2:g.packetsIterator=new j(a);break;case 3:g.packetsIterator=new k(a);break;case 4:g.packetsIterator=new l(a);break;default:throw new Error("JPX Error: Unsupported progression order "+z)}}function p(a,b,c,d){function e(a){for(;a>l;){if(c+k>=b.length)throw new Error("Unexpected EOF");var d=b[c+k];k++,m?(j=j<<7|d,l+=7,m=!1):(j=j<<8|d,l+=8),255===d&&(m=!0)}return l-=a,j>>>l&(1<<a)-1}function f(a){return 255===b[c+k-1]&&b[c+k]===a?(g(1),!0):255===b[c+k]&&b[c+k+1]===a?(g(2),!0):!1}function g(a){k+=a}function h(){l=0,m&&(k++,m=!1)}function i(){if(0===e(1))return 1;if(0===e(1))return 2;var a=e(2);return 3>a?a+3:(a=e(5),31>a?a+6:(a=e(7),a+37))}for(var j,k=0,l=0,m=!1,n=a.currentTile.index,o=a.tiles[n],p=a.COD.sopMarkerUsed,q=a.COD.ephMarkerUsed,r=o.packetsIterator;d>k;)try{h(),p&&f(145)&&g(4);var s=r.nextPacket();if(void 0===s)return;if(!e(1))continue;for(var t,u=s.layerNumber,x=[],y=0,z=s.codeblocks.length;z>y;y++){t=s.codeblocks[y];var A,B=t.precinct,C=t.cbx-B.cbxMin,D=t.cby-B.cbyMin,E=!1,F=!1;if(void 0!==t.included)E=!!e(1);else{B=t.precinct;var G,H;if(void 0!==B.inclusionTree)G=B.inclusionTree;else{var I=B.cbxMax-B.cbxMin+1,J=B.cbyMax-B.cbyMin+1;G=new w(I,J),H=new v(I,J),B.inclusionTree=G,B.zeroBitPlanesTree=H}for(G.reset(C,D,u);;){if(k>=b.length)return;if(G.isAboveThreshold())break;if(G.isKnown())G.nextLevel();else if(e(1)){if(G.setKnown(),G.isLeaf()){t.included=!0,E=F=!0;break}G.nextLevel()}else G.incrementValue()}}if(E){if(F){for(H=B.zeroBitPlanesTree,H.reset(C,D);;){if(k>=b.length)return;if(e(1)){if(A=!H.nextLevel())break}else H.incrementValue()}t.zeroBitPlanes=H.value}for(var K=i();e(1);)t.Lblock++;var L=log2(K),M=(1<<L>K?L-1:L)+t.Lblock,N=e(M);x.push({codeblock:t,codingpasses:K,dataLength:N})}}for(h(),q&&f(146);x.length>0;){var O=x.shift();t=O.codeblock,void 0===t.data&&(t.data=[]),t.data.push({data:b,start:c+k,end:c+k+O.dataLength,codingpasses:O.codingpasses}),k+=O.dataLength}}catch(P){return}return k}function q(a,b,c,d,e,f,g,h){for(var i=d.tbx0,j=d.tby0,k=d.tbx1-d.tbx0,l=d.codeblocks,m="H"===d.type.charAt(0)?1:0,n="H"===d.type.charAt(1)?b:0,o=0,p=l.length;p>o;++o){var q=l[o],r=q.tbx1_-q.tbx0_,s=q.tby1_-q.tby0_;if(0!==r&&0!==s&&void 0!==q.data){var t,u;t=new x(r,s,q.subbandType,q.zeroBitPlanes,f),u=2;var v,w,y,z=q.data,A=0,B=0;for(v=0,w=z.length;w>v;v++)y=z[v],A+=y.end-y.start,B+=y.codingpasses;var C=new Int16Array(A),D=0;for(v=0,w=z.length;w>v;v++){y=z[v];var E=y.data.subarray(y.start,y.end);C.set(E,D),D+=E.length}var F=new ArithmeticDecoder(C,0,A);for(t.setDecoder(F),v=0;B>v;v++){switch(u){case 0:t.runSignificancePropogationPass();break;case 1:t.runMagnitudeRefinementPass();break;case 2:t.runCleanupPass(),h&&t.checkSegmentationSymbol()}u=(u+1)%3}var G,H,I,J=q.tbx0_-i+(q.tby0_-j)*k,K=t.coefficentsSign,L=t.coefficentsMagnitude,M=t.bitsDecoded,N=g?0:.5;D=0;var O="LL"!==d.type;for(v=0;s>v;v++){var P=J/k|0,Q=2*P*(b-k)+m+n;for(G=0;r>G;G++){if(H=L[D],0!==H){H=(H+N)*e,0!==K[D]&&(H=-H),I=M[D];var R=O?Q+(J<<1):J;g&&I>=f?a[R]=H:a[R]=H*(1<<f-I)}J++,D++}J+=k-r}}}}function r(a,b,c){for(var d=b.components[c],e=d.codingStyleParameters,f=d.quantizationParameters,g=e.decompositionLevelsCount,h=f.SPqcds,i=f.scalarExpounded,j=f.guardBits,k=e.segmentationSymbolUsed,l=a.components[c].precision,m=e.reversibleTransformation,n=m?new A:new z,o=[],p=0,r=0;g>=r;r++){for(var s=d.resolutions[r],t=s.trx1-s.trx0,v=s.try1-s.try0,w=new Float32Array(t*v),x=0,y=s.subbands.length;y>x;x++){var B,C;i?(B=h[p].mu,C=h[p].epsilon,p++):(B=h[0].mu,C=h[0].epsilon+(r>0?1-r:0));var D=s.subbands[x],E=u[D.type],F=m?1:Math.pow(2,l+E-C)*(1+B/2048),G=j+C-1;q(w,t,v,D,F,G,m,k)}o.push({width:t,height:v,items:w})}var H=n.calculate(o,d.tcx0,d.tcy0);return{left:d.tcx0,top:d.tcy0,width:H.width,height:H.height,items:H.items}}function s(a){for(var b=a.SIZ,c=a.components,d=b.Csiz,e=[],f=0,g=a.tiles.length;g>f;f++){var h,i=a.tiles[f],j=[];for(h=0;d>h;h++)j[h]=r(a,i,h);var k=j[0],l=c[0].isSigned;if(l)var m=new Int16Array(k.items.length*d);else var m=new Uint16Array(k.items.length*d);var n,o,p,q,s,t,u,v,w,x,y,z,A,B,C,D={left:k.left,top:k.top,width:k.width,height:k.height,items:m},E=0;if(i.codingStyleDefaultParameters.multipleComponentTransform){var F=4===d,G=j[0].items,H=j[1].items,I=j[2].items,J=F?j[3].items:null;n=c[0].precision-8,o=(128<<n)+.5,p=255*(1<<n),s=.5*p,q=-s;var K=i.components[0],L=d-3;if(u=G.length,K.codingStyleParameters.reversibleTransformation)for(t=0;u>t;t++,E+=L)v=G[t]+o,w=H[t],x=I[t],z=v-(x+w>>2),y=z+x,A=z+w,m[E++]=0>=y?0:y>=p?255:y>>n,m[E++]=0>=z?0:z>=p?255:z>>n,m[E++]=0>=A?0:A>=p?255:A>>n;else for(t=0;u>t;t++,E+=L)v=G[t]+o,w=H[t],x=I[t],y=v+1.402*x,z=v-.34413*w-.71414*x,A=v+1.772*w,m[E++]=0>=y?0:y>=p?255:y>>n,m[E++]=0>=z?0:z>=p?255:z>>n,m[E++]=0>=A?0:A>=p?255:A>>n;if(F)for(t=0,E=3;u>t;t++,E+=4)B=J[t],m[E]=q>=B?0:B>=s?255:B+o>>n}else for(h=0;d>h;h++)if(8===c[h].precision){var M=j[h].items;for(n=c[h].precision-8,o=(128<<n)+.5,p=127.5*(1<<n),q=-p,E=h,t=0,u=M.length;u>t;t++)C=M[t],m[E]=q>=C?0:C>=p?255:C+o>>n,E+=d}else{var l=c[h].isSigned,M=j[h].items;if(l)for(E=h,t=0,u=M.length;u>t;t++)m[E]=M[t],E+=d;else{n=c[h].precision-8,o=(128<<n)+.5;var N=Math.pow(2,c[h].precision)-1;for(E=h,t=0,u=M.length;u>t;t++)C=M[t],m[E]=Math.max(Math.min(C+o,N),0),E+=d}}e.push(D)}return e}function t(a,b){for(var c=a.SIZ,d=c.Csiz,e=a.tiles[b],f=0;d>f;f++){var g=e.components[f],h=void 0!==a.currentTile.QCC[f]?a.currentTile.QCC[f]:a.currentTile.QCD;g.quantizationParameters=h;var i=void 0!==a.currentTile.COC[f]?a.currentTile.COC[f]:a.currentTile.COD;g.codingStyleParameters=i}e.codingStyleDefaultParameters=a.currentTile.COD}var u={LL:0,LH:1,HL:1,HH:2};a.prototype={parse:function(a){var b=readUint16(a,0);if(65359===b)return void this.parseCodestream(a,0,a.length);for(var c=0,d=a.length;d>c;){var e=8,f=readUint32(a,c),g=readUint32(a,c+4);if(c+=e,1===f&&(f=4294967296*readUint32(a,c)+readUint32(a,c+4),c+=8,e+=8),0===f&&(f=d-c+e),e>f)throw new Error("JPX Error: Invalid box field size");var h=f-e,i=!0;switch(g){case 1785737832:i=!1;break;case 1668246642:var j=a[c];a[c+1],a[c+2];if(1===j){var k=readUint32(a,c+3);switch(k){case 16:case 17:case 18:break;default:warn("Unknown colorspace "+k)}}else 2===j&&info("ICC profile not supported");break;case 1785737827:this.parseCodestream(a,c,c+h);break;case 1783636e3:218793738!==readUint32(a,c)&&warn("Invalid JP2 signature");break;case 1783634458:case 1718909296:case 1920099697:case 1919251232:case 1768449138:break;default:var l=String.fromCharCode(g>>24&255,g>>16&255,g>>8&255,255&g);warn("Unsupported header type "+g+" ("+l+")")}i&&(c+=h)}},parseImageProperties:function(a){for(var b=a.getByte();b>=0;){var c=b;b=a.getByte();var d=c<<8|b;if(65361===d){a.skip(4);var e=a.getInt32()>>>0,f=a.getInt32()>>>0,g=a.getInt32()>>>0,h=a.getInt32()>>>0;a.skip(16);var i=a.getUint16();return this.width=e-g,this.height=f-h,this.componentsCount=i,void(this.bitsPerComponent=8)}}throw new Error("JPX Error: No size marker found in JPX stream")},parseCodestream:function(a,d,e){var f={};try{for(var g=!1,h=d;e>h+1;){var i=readUint16(a,h);h+=2;var j,k,l,m,n,q,r=0;switch(i){case 65359:f.mainHeader=!0;break;case 65497:break;case 65361:r=readUint16(a,h);var u={};u.Xsiz=readUint32(a,h+4),u.Ysiz=readUint32(a,h+8),u.XOsiz=readUint32(a,h+12),u.YOsiz=readUint32(a,h+16),u.XTsiz=readUint32(a,h+20),u.YTsiz=readUint32(a,h+24),u.XTOsiz=readUint32(a,h+28),u.YTOsiz=readUint32(a,h+32);var v=readUint16(a,h+36);u.Csiz=v;var w=[];j=h+38;for(var x=0;v>x;x++){var y={precision:(127&a[j])+1,isSigned:!!(128&a[j]),XRsiz:a[j+1],YRsiz:a[j+1]};b(y,u),w.push(y)}f.SIZ=u,f.components=w,c(f,w),f.QCC=[],f.COC=[];break;case 65372:r=readUint16(a,h);var z={};switch(j=h+2,k=a[j++],31&k){case 0:m=8,n=!0;break;case 1:m=16,n=!1;break;case 2:m=16,n=!0;break;default:throw new Error("JPX Error: Invalid SQcd value "+k)}for(z.noQuantization=8===m,z.scalarExpounded=n,z.guardBits=k>>5,l=[];r+h>j;){var A={};8===m?(A.epsilon=a[j++]>>3,A.mu=0):(A.epsilon=a[j]>>3,A.mu=(7&a[j])<<8|a[j+1],j+=2),l.push(A)}z.SPqcds=l,f.mainHeader?f.QCD=z:(f.currentTile.QCD=z,f.currentTile.QCC=[]);break;case 65373:r=readUint16(a,h);var B={};j=h+2;var C;switch(f.SIZ.Csiz<257?C=a[j++]:(C=readUint16(a,j),j+=2),k=a[j++],31&k){case 0:m=8,n=!0;break;case 1:m=16,n=!1;break;case 2:m=16,n=!0;break;default:throw new Error("JPX Error: Invalid SQcd value "+k)}for(B.noQuantization=8===m,B.scalarExpounded=n,B.guardBits=k>>5,l=[];r+h>j;)A={},8===m?(A.epsilon=a[j++]>>3,A.mu=0):(A.epsilon=a[j]>>3,A.mu=(7&a[j])<<8|a[j+1],j+=2),l.push(A);B.SPqcds=l,f.mainHeader?f.QCC[C]=B:f.currentTile.QCC[C]=B;break;case 65362:r=readUint16(a,h);var D={};j=h+2;var E=a[j++];D.entropyCoderWithCustomPrecincts=!!(1&E),D.sopMarkerUsed=!!(2&E),D.ephMarkerUsed=!!(4&E),D.progressionOrder=a[j++],D.layersCount=readUint16(a,j),j+=2,D.multipleComponentTransform=a[j++],D.decompositionLevelsCount=a[j++],D.xcb=(15&a[j++])+2,D.ycb=(15&a[j++])+2;var F=a[j++];if(D.selectiveArithmeticCodingBypass=!!(1&F),D.resetContextProbabilities=!!(2&F),D.terminationOnEachCodingPass=!!(4&F),D.verticalyStripe=!!(8&F),D.predictableTermination=!!(16&F),D.segmentationSymbolUsed=!!(32&F),D.reversibleTransformation=a[j++],D.entropyCoderWithCustomPrecincts){for(var G=[];r+h>j;){var H=a[j++];G.push({PPx:15&H,PPy:H>>4})}D.precinctsSizes=G}var I=[];if(D.selectiveArithmeticCodingBypass&&I.push("selectiveArithmeticCodingBypass"),D.resetContextProbabilities&&I.push("resetContextProbabilities"),D.terminationOnEachCodingPass&&I.push("terminationOnEachCodingPass"),D.verticalyStripe&&I.push("verticalyStripe"),D.predictableTermination&&I.push("predictableTermination"),I.length>0)throw g=!0,new Error("JPX Error: Unsupported COD options ("+I.join(", ")+")");f.mainHeader?f.COD=D:(f.currentTile.COD=D,f.currentTile.COC=[]);break;case 65424:r=readUint16(a,h),q={},q.index=readUint16(a,h+2),q.length=readUint32(a,h+4),q.dataEnd=q.length+h-2,q.partIndex=a[h+8],q.partsCount=a[h+9],f.mainHeader=!1,0===q.partIndex&&(q.COD=f.COD,q.COC=f.COC.slice(0),q.QCD=f.QCD,q.QCC=f.QCC.slice(0)),f.currentTile=q;break;case 65427:q=f.currentTile,0===q.partIndex&&(t(f,q.index),o(f)),r=q.dataEnd-h,p(f,a,h,r);break;case 65365:case 65367:case 65368:case 65380:r=readUint16(a,h);break;case 65363:throw new Error("JPX Error: Codestream code 0xFF53 (COC) is not implemented");default:throw new Error("JPX Error: Unknown codestream code: "+i.toString(16))}h+=r}}catch(J){if(g||this.failOnCorruptedImage)throw J;warn("Trying to recover from "+J.message)}this.tiles=s(f),this.width=f.SIZ.Xsiz-f.SIZ.XOsiz,this.height=f.SIZ.Ysiz-f.SIZ.YOsiz,this.componentsCount=f.SIZ.Csiz}};var v=function(){function a(a,b){var c=log2(Math.max(a,b))+1;this.levels=[];for(var d=0;c>d;d++){var e={width:a,height:b,items:[]};this.levels.push(e),a=Math.ceil(a/2),b=Math.ceil(b/2)}}return a.prototype={reset:function(a,b){for(var c,d=0,e=0;d<this.levels.length;){c=this.levels[d];var f=a+b*c.width;if(void 0!==c.items[f]){e=c.items[f];break}c.index=f,a>>=1,b>>=1,d++}d--,c=this.levels[d],c.items[c.index]=e,this.currentLevel=d,delete this.value},incrementValue:function(){var a=this.levels[this.currentLevel];a.items[a.index]++},nextLevel:function(){var a=this.currentLevel,b=this.levels[a],c=b.items[b.index];return a--,0>a?(this.value=c,!1):(this.currentLevel=a,b=this.levels[a],b.items[b.index]=c,!0)}},a}(),w=function(){function a(a,b){var c=log2(Math.max(a,b))+1;this.levels=[];for(var d=0;c>d;d++){for(var e=new Uint8Array(a*b),f=new Uint8Array(a*b),g=0,h=e.length;h>g;g++)e[g]=0,f[g]=0;var i={width:a,height:b,items:e,status:f};this.levels.push(i),a=Math.ceil(a/2),b=Math.ceil(b/2)}}return a.prototype={reset:function(a,b,c){this.currentStopValue=c;for(var d=0;d<this.levels.length;){var e=this.levels[d],f=a+b*e.width;e.index=f,a>>=1,b>>=1,d++}this.currentLevel=this.levels.length-1,this.minValue=this.levels[this.currentLevel].items[0]},incrementValue:function(){var a=this.levels[this.currentLevel];a.items[a.index]=a.items[a.index]+1,a.items[a.index]>this.minValue&&(this.minValue=a.items[a.index])},nextLevel:function(){var a=this.currentLevel;if(a--,0>a)return!1;this.currentLevel=a;var b=this.levels[a];return b.items[b.index]<this.minValue?b.items[b.index]=this.minValue:b.items[b.index]>this.minValue&&(this.minValue=b.items[b.index]),!0},isLeaf:function(){return 0===this.currentLevel},isAboveThreshold:function(){var a=this.currentLevel,b=this.levels[a];return b.items[b.index]>this.currentStopValue},isKnown:function(){var a=this.currentLevel,b=this.levels[a];return b.status[b.index]>0},setKnown:function(){var a=this.currentLevel,b=this.levels[a];b.status[b.index]=1}},a}(),x=function(){function a(a,b,c,g,h){this.width=a,this.height=b,this.contextLabelTable="HH"===c?f:"HL"===c?e:d;var i=a*b;this.neighborsSignificance=new Uint8Array(i),this.coefficentsSign=new Uint8Array(i),this.coefficentsMagnitude=h>14?new Uint32Array(i):h>6?new Uint16Array(i):new Uint8Array(i),this.processingFlags=new Uint8Array(i);var j=new Uint8Array(i);if(0!==g)for(var k=0;i>k;k++)j[k]=g;this.bitsDecoded=j,this.reset()}var b=17,c=18,d=new Uint8Array([0,5,8,0,3,7,8,0,4,7,8,0,0,0,0,0,1,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8]),e=new Uint8Array([0,3,4,0,5,7,7,0,8,8,8,0,0,0,0,0,1,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8]),f=new Uint8Array([0,1,2,0,1,2,2,0,2,2,2,0,0,0,0,0,3,4,5,0,4,5,5,0,5,5,5,0,0,0,0,0,6,7,7,0,7,7,7,0,7,7,7,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8]);return a.prototype={setDecoder:function(a){this.decoder=a},reset:function(){this.contexts=new Int8Array(19),this.contexts[0]=8,this.contexts[b]=92,this.contexts[c]=6},setNeighborsSignificance:function(a,b,c){var d,e=this.neighborsSignificance,f=this.width,g=this.height,h=b>0,i=f>b+1;a>0&&(d=c-f,h&&(e[d-1]+=16),i&&(e[d+1]+=16),e[d]+=4),g>a+1&&(d=c+f,h&&(e[d-1]+=16),i&&(e[d+1]+=16),e[d]+=4),h&&(e[c-1]+=1),i&&(e[c+1]+=1),e[c]|=128},runSignificancePropogationPass:function(){for(var a=this.decoder,b=this.width,c=this.height,d=this.coefficentsMagnitude,e=this.coefficentsSign,f=this.neighborsSignificance,g=this.processingFlags,h=this.contexts,i=this.contextLabelTable,j=this.bitsDecoded,k=-2,l=1,m=2,n=0;c>n;n+=4)for(var o=0;b>o;o++)for(var p=n*b+o,q=0;4>q;q++,p+=b){var r=n+q;if(r>=c)break;if(g[p]&=k,!d[p]&&f[p]){var s=i[f[p]],t=a.readBit(h,s);if(t){var u=this.decodeSignBit(r,o,p);e[p]=u,d[p]=1,this.setNeighborsSignificance(r,o,p),g[p]|=m}j[p]++,g[p]|=l}}},decodeSignBit:function(a,b,c){var d,e,f,g,h,i,j=this.width,k=this.height,l=this.coefficentsMagnitude,m=this.coefficentsSign;g=b>0&&0!==l[c-1],j>b+1&&0!==l[c+1]?(f=m[c+1],g?(e=m[c-1],d=1-f-e):d=1-f-f):g?(e=m[c-1],d=1-e-e):d=0;var n=3*d;return g=a>0&&0!==l[c-j],k>a+1&&0!==l[c+j]?(f=m[c+j],g?(e=m[c-j],d=1-f-e+n):d=1-f-f+n):g?(e=m[c-j],d=1-e-e+n):d=n,d>=0?(h=9+d,i=this.decoder.readBit(this.contexts,h)):(h=9-d,i=1^this.decoder.readBit(this.contexts,h)),i},runMagnitudeRefinementPass:function(){for(var a,b=this.decoder,c=this.width,d=this.height,e=this.coefficentsMagnitude,f=this.neighborsSignificance,g=this.contexts,h=this.bitsDecoded,i=this.processingFlags,j=1,k=2,l=c*d,m=4*c,n=0;l>n;n=a){a=Math.min(l,n+m);for(var o=0;c>o;o++)for(var p=n+o;a>p;p+=c)if(e[p]&&0===(i[p]&j)){var q=16;if(0!==(i[p]&k)){i[p]^=k;var r=127&f[p];q=0===r?15:14}var s=b.readBit(g,q);e[p]=e[p]<<1|s,h[p]++,i[p]|=j}}},runCleanupPass:function(){for(var a,d=this.decoder,e=this.width,f=this.height,g=this.neighborsSignificance,h=this.coefficentsMagnitude,i=this.coefficentsSign,j=this.contexts,k=this.contextLabelTable,l=this.bitsDecoded,m=this.processingFlags,n=1,o=2,p=e,q=2*e,r=3*e,s=0;f>s;s=a){a=Math.min(s+4,f);for(var t=s*e,u=f>s+3,v=0;e>v;v++){var w,x=t+v,y=u&&0===m[x]&&0===m[x+p]&&0===m[x+q]&&0===m[x+r]&&0===g[x]&&0===g[x+p]&&0===g[x+q]&&0===g[x+r],z=0,A=x,B=s;if(y){var C=d.readBit(j,c);if(!C){l[x]++,l[x+p]++,l[x+q]++,l[x+r]++;continue}z=d.readBit(j,b)<<1|d.readBit(j,b),0!==z&&(B=s+z,A+=z*e),w=this.decodeSignBit(B,v,A),i[A]=w,h[A]=1,this.setNeighborsSignificance(B,v,A),m[A]|=o,A=x;for(var D=s;B>=D;D++,A+=e)l[A]++;z++}for(B=s+z;a>B;B++,A+=e)if(!h[A]&&0===(m[A]&n)){var E=k[g[A]],F=d.readBit(j,E);1===F&&(w=this.decodeSignBit(B,v,A),i[A]=w,h[A]=1,this.setNeighborsSignificance(B,v,A),m[A]|=o),l[A]++}}}},checkSegmentationSymbol:function(){var a=this.decoder,c=this.contexts,d=a.readBit(c,b)<<3|a.readBit(c,b)<<2|a.readBit(c,b)<<1|a.readBit(c,b);if(10!==d)throw new Error("JPX Error: Invalid segmentation symbol")}},a}(),y=function(){function a(){}return a.prototype.calculate=function(a,b,c){for(var d=a[0],e=1,f=a.length;f>e;e++)d=this.iterate(d,a[e],b,c);return d},a.prototype.extend=function(a,b,c){var d=b-1,e=b+1,f=b+c-2,g=b+c;a[d--]=a[e++],a[g++]=a[f--],a[d--]=a[e++],a[g++]=a[f--],a[d--]=a[e++],a[g++]=a[f--],a[d]=a[e],a[g]=a[f]},a.prototype.iterate=function(a,b,c,d){var e,f,g,h,i,j,k=a.width,l=a.height,m=a.items,n=b.width,o=b.height,p=b.items;for(g=0,e=0;l>e;e++)for(h=2*e*n,f=0;k>f;f++,g++,h+=2)p[h]=m[g];m=a.items=null;var q=4,r=new Float32Array(n+2*q);if(1===n){if(0!==(1&c))for(j=0,g=0;o>j;j++,g+=n)p[g]*=.5}else for(j=0,g=0;o>j;j++,g+=n)r.set(p.subarray(g,g+n),q),this.extend(r,q,n),this.filter(r,q,n),p.set(r.subarray(q,q+n),g);var s=16,t=[];for(e=0;s>e;e++)t.push(new Float32Array(o+2*q));var u,v=0;if(a=q+o,1===o){if(0!==(1&d))for(i=0;n>i;i++)p[i]*=.5}else for(i=0;n>i;i++){if(0===v){for(s=Math.min(n-i,s),g=i,h=q;a>h;g+=n,h++)for(u=0;s>u;u++)t[u][h]=p[g+u];v=s}v--;var w=t[v];if(this.extend(w,q,o),this.filter(w,q,o),0===v)for(g=i-s+1,h=q;a>h;g+=n,h++)for(u=0;s>u;u++)p[g+u]=t[u][h]}return{width:n,height:o,items:p}},a}(),z=function(){function a(){y.call(this)}return a.prototype=Object.create(y.prototype),a.prototype.filter=function(a,b,c){var d=c>>1;b=0|b;var e,f,g,h,i=-1.586134342059924,j=-.052980118572961,k=.882911075530934,l=.443506852043971,m=1.230174104914001,n=1/m;for(e=b-3,f=d+4;f--;e+=2)a[e]*=n;for(e=b-2,g=l*a[e-1],f=d+3;f--&&(h=l*a[e+1],a[e]=m*a[e]-g-h,f--);e+=2)e+=2,g=l*a[e+1],a[e]=m*a[e]-g-h;for(e=b-1,g=k*a[e-1],f=d+2;f--&&(h=k*a[e+1],a[e]-=g+h,f--);e+=2)e+=2,g=k*a[e+1],a[e]-=g+h;for(e=b,g=j*a[e-1],f=d+1;f--&&(h=j*a[e+1],a[e]-=g+h,f--);e+=2)e+=2,g=j*a[e+1],a[e]-=g+h;if(0!==d)for(e=b+1,g=i*a[e-1],f=d;f--&&(h=i*a[e+1],a[e]-=g+h,f--);e+=2)e+=2,g=i*a[e+1],a[e]-=g+h},a}(),A=function(){function a(){y.call(this)}return a.prototype=Object.create(y.prototype),a.prototype.filter=function(a,b,c){var d=c>>1;b=0|b;var e,f;for(e=b,f=d+1;f--;e+=2)a[e]-=a[e-1]+a[e+1]+2>>2;for(e=b+1,f=d;f--;e+=2)a[e]+=a[e-1]+a[e+1]>>1},a}();return a}(),ArithmeticDecoder=function(){function a(a,b,c){this.data=a,this.bp=b,this.dataEnd=c,this.chigh=a[b],this.clow=0,this.byteIn(),this.chigh=this.chigh<<7&65535|this.clow>>9&127,this.clow=this.clow<<7&65535,this.ct-=7,this.a=32768}var b=[{qe:22017,nmps:1,nlps:1,switchFlag:1},{qe:13313,nmps:2,nlps:6,switchFlag:0},{qe:6145,nmps:3,nlps:9,switchFlag:0},{qe:2753,nmps:4,nlps:12,switchFlag:0},{qe:1313,nmps:5,nlps:29,switchFlag:0},{qe:545,nmps:38,nlps:33,switchFlag:0},{qe:22017,nmps:7,nlps:6,switchFlag:1},{qe:21505,nmps:8,nlps:14,switchFlag:0},{qe:18433,nmps:9,nlps:14,switchFlag:0},{qe:14337,nmps:10,nlps:14,switchFlag:0},{qe:12289,nmps:11,nlps:17,switchFlag:0},{qe:9217,nmps:12,nlps:18,switchFlag:0},{qe:7169,nmps:13,nlps:20,switchFlag:0},{qe:5633,nmps:29,nlps:21,switchFlag:0},{qe:22017,nmps:15,nlps:14,switchFlag:1},{qe:21505,nmps:16,nlps:14,switchFlag:0},{qe:20737,nmps:17,nlps:15,switchFlag:0},{qe:18433,nmps:18,nlps:16,switchFlag:0},{qe:14337,nmps:19,nlps:17,switchFlag:0},{qe:13313,nmps:20,nlps:18,switchFlag:0},{qe:12289,nmps:21,nlps:19,switchFlag:0},{qe:10241,nmps:22,nlps:19,switchFlag:0},{qe:9217,nmps:23,nlps:20,switchFlag:0},{qe:8705,nmps:24,nlps:21,switchFlag:0},{qe:7169,nmps:25,nlps:22,switchFlag:0},{qe:6145,nmps:26,nlps:23,switchFlag:0},{qe:5633,nmps:27,nlps:24,switchFlag:0},{
qe:5121,nmps:28,nlps:25,switchFlag:0},{qe:4609,nmps:29,nlps:26,switchFlag:0},{qe:4353,nmps:30,nlps:27,switchFlag:0},{qe:2753,nmps:31,nlps:28,switchFlag:0},{qe:2497,nmps:32,nlps:29,switchFlag:0},{qe:2209,nmps:33,nlps:30,switchFlag:0},{qe:1313,nmps:34,nlps:31,switchFlag:0},{qe:1089,nmps:35,nlps:32,switchFlag:0},{qe:673,nmps:36,nlps:33,switchFlag:0},{qe:545,nmps:37,nlps:34,switchFlag:0},{qe:321,nmps:38,nlps:35,switchFlag:0},{qe:273,nmps:39,nlps:36,switchFlag:0},{qe:133,nmps:40,nlps:37,switchFlag:0},{qe:73,nmps:41,nlps:38,switchFlag:0},{qe:37,nmps:42,nlps:39,switchFlag:0},{qe:21,nmps:43,nlps:40,switchFlag:0},{qe:9,nmps:44,nlps:41,switchFlag:0},{qe:5,nmps:45,nlps:42,switchFlag:0},{qe:1,nmps:45,nlps:43,switchFlag:0},{qe:22017,nmps:46,nlps:46,switchFlag:0}];return a.prototype={byteIn:function(){var a=this.data,b=this.bp;if(255===a[b]){var c=a[b+1];c>143?(this.clow+=65280,this.ct=8):(b++,this.clow+=a[b]<<9,this.ct=7,this.bp=b)}else b++,this.clow+=b<this.dataEnd?a[b]<<8:65280,this.ct=8,this.bp=b;this.clow>65535&&(this.chigh+=this.clow>>16,this.clow&=65535)},readBit:function(a,c){var d,e=a[c]>>1,f=1&a[c],g=b[e],h=g.qe,i=this.a-h;if(this.chigh<h)h>i?(i=h,d=f,e=g.nmps):(i=h,d=1^f,1===g.switchFlag&&(f=d),e=g.nlps);else{if(this.chigh-=h,0!==(32768&i))return this.a=i,f;h>i?(d=1^f,1===g.switchFlag&&(f=d),e=g.nlps):(d=f,e=g.nmps)}do 0===this.ct&&this.byteIn(),i<<=1,this.chigh=this.chigh<<1&65535|this.clow>>15&1,this.clow=this.clow<<1&65535,this.ct--;while(0===(32768&i));return this.a=i,a[c]=e<<1|f,d}},a}(),globalScope="undefined"==typeof window?this:window,isWorker="undefined"==typeof window,FONT_IDENTITY_MATRIX=[.001,0,0,.001,0,0],TextRenderingMode={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},ImageKind={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},AnnotationType={WIDGET:1,TEXT:2,LINK:3},StreamType={UNKNOWN:0,FLATE:1,LZW:2,DCT:3,JPX:4,JBIG:5,A85:6,AHX:7,CCF:8,RL:9},FontType={UNKNOWN:0,TYPE1:1,TYPE1C:2,CIDFONTTYPE0:3,CIDFONTTYPE0C:4,TRUETYPE:5,CIDFONTTYPE2:6,TYPE3:7,OPENTYPE:8,TYPE0:9,MMTYPE1:10};globalScope.PDFJS||(globalScope.PDFJS={}),globalScope.PDFJS.pdfBug=!1,PDFJS.VERBOSITY_LEVELS={errors:0,warnings:1,infos:5};var OPS=PDFJS.OPS={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotations:78,endAnnotations:79,beginAnnotation:80,endAnnotation:81,paintJpegXObject:82,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91},UNSUPPORTED_FEATURES=PDFJS.UNSUPPORTED_FEATURES={unknown:"unknown",forms:"forms",javaScript:"javaScript",smask:"smask",shadingPattern:"shadingPattern",font:"font"},UnsupportedManager=PDFJS.UnsupportedManager=function(){var a=[];return{listen:function(b){a.push(b)},notify:function(b){warn('Unsupported feature "'+b+'"');for(var c=0,d=a.length;d>c;c++)a[c](b)}}}();PDFJS.isValidUrl=isValidUrl,PDFJS.shadow=shadow;var PasswordResponses=PDFJS.PasswordResponses={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},PasswordException=function(){function a(a,b){this.name="PasswordException",this.message=a,this.code=b}return a.prototype=new Error,a.constructor=a,a}();PDFJS.PasswordException=PasswordException;var UnknownErrorException=function(){function a(a,b){this.name="UnknownErrorException",this.message=a,this.details=b}return a.prototype=new Error,a.constructor=a,a}();PDFJS.UnknownErrorException=UnknownErrorException;var InvalidPDFException=function(){function a(a){this.name="InvalidPDFException",this.message=a}return a.prototype=new Error,a.constructor=a,a}();PDFJS.InvalidPDFException=InvalidPDFException;var MissingPDFException=function(){function a(a){this.name="MissingPDFException",this.message=a}return a.prototype=new Error,a.constructor=a,a}();PDFJS.MissingPDFException=MissingPDFException;var UnexpectedResponseException=function(){function a(a,b){this.name="UnexpectedResponseException",this.message=a,this.status=b}return a.prototype=new Error,a.constructor=a,a}();PDFJS.UnexpectedResponseException=UnexpectedResponseException;var NotImplementedException=function(){function a(a){this.message=a}return a.prototype=new Error,a.prototype.name="NotImplementedException",a.constructor=a,a}(),MissingDataException=function(){function a(a,b){this.begin=a,this.end=b,this.message="Missing data ["+a+", "+b+")"}return a.prototype=new Error,a.prototype.name="MissingDataException",a.constructor=a,a}(),XRefParseException=function(){function a(a){this.message=a}return a.prototype=new Error,a.prototype.name="XRefParseException",a.constructor=a,a}();Object.defineProperty(PDFJS,"isLittleEndian",{configurable:!0,get:function(){return shadow(PDFJS,"isLittleEndian",isLittleEndian())}}),Object.defineProperty(PDFJS,"hasCanvasTypedArrays",{configurable:!0,get:function(){return shadow(PDFJS,"hasCanvasTypedArrays",hasCanvasTypedArrays())}});var Uint32ArrayView=function(){function a(a,b){this.buffer=a,this.byteLength=a.length,this.length=void 0===b?this.byteLength>>2:b,c(this.length)}function b(a){return{get:function(){var b=this.buffer,c=a<<2;return(b[c]|b[c+1]<<8|b[c+2]<<16|b[c+3]<<24)>>>0},set:function(b){var c=this.buffer,d=a<<2;c[d]=255&b,c[d+1]=b>>8&255,c[d+2]=b>>16&255,c[d+3]=b>>>24&255}}}function c(c){for(;c>d;)Object.defineProperty(a.prototype,d,b(d)),d++}a.prototype=Object.create(null);var d=0;return a}(),IDENTITY_MATRIX=[1,0,0,1,0,0],Util=PDFJS.Util=function(){function a(){}var b=["rgb(",0,",",0,",",0,")"];return a.makeCssRgb=function(a,c,d){return b[1]=a,b[3]=c,b[5]=d,b.join("")},a.transform=function(a,b){return[a[0]*b[0]+a[2]*b[1],a[1]*b[0]+a[3]*b[1],a[0]*b[2]+a[2]*b[3],a[1]*b[2]+a[3]*b[3],a[0]*b[4]+a[2]*b[5]+a[4],a[1]*b[4]+a[3]*b[5]+a[5]]},a.applyTransform=function(a,b){var c=a[0]*b[0]+a[1]*b[2]+b[4],d=a[0]*b[1]+a[1]*b[3]+b[5];return[c,d]},a.applyInverseTransform=function(a,b){var c=b[0]*b[3]-b[1]*b[2],d=(a[0]*b[3]-a[1]*b[2]+b[2]*b[5]-b[4]*b[3])/c,e=(-a[0]*b[1]+a[1]*b[0]+b[4]*b[1]-b[5]*b[0])/c;return[d,e]},a.getAxialAlignedBoundingBox=function(b,c){var d=a.applyTransform(b,c),e=a.applyTransform(b.slice(2,4),c),f=a.applyTransform([b[0],b[3]],c),g=a.applyTransform([b[2],b[1]],c);return[Math.min(d[0],e[0],f[0],g[0]),Math.min(d[1],e[1],f[1],g[1]),Math.max(d[0],e[0],f[0],g[0]),Math.max(d[1],e[1],f[1],g[1])]},a.inverseTransform=function(a){var b=a[0]*a[3]-a[1]*a[2];return[a[3]/b,-a[1]/b,-a[2]/b,a[0]/b,(a[2]*a[5]-a[4]*a[3])/b,(a[4]*a[1]-a[5]*a[0])/b]},a.apply3dTransform=function(a,b){return[a[0]*b[0]+a[1]*b[1]+a[2]*b[2],a[3]*b[0]+a[4]*b[1]+a[5]*b[2],a[6]*b[0]+a[7]*b[1]+a[8]*b[2]]},a.singularValueDecompose2dScale=function(a){var b=[a[0],a[2],a[1],a[3]],c=a[0]*b[0]+a[1]*b[2],d=a[0]*b[1]+a[1]*b[3],e=a[2]*b[0]+a[3]*b[2],f=a[2]*b[1]+a[3]*b[3],g=(c+f)/2,h=Math.sqrt((c+f)*(c+f)-4*(c*f-e*d))/2,i=g+h||1,j=g-h||1;return[Math.sqrt(i),Math.sqrt(j)]},a.normalizeRect=function(a){var b=a.slice(0);return a[0]>a[2]&&(b[0]=a[2],b[2]=a[0]),a[1]>a[3]&&(b[1]=a[3],b[3]=a[1]),b},a.intersect=function(b,c){function d(a,b){return a-b}var e=[b[0],b[2],c[0],c[2]].sort(d),f=[b[1],b[3],c[1],c[3]].sort(d),g=[];return b=a.normalizeRect(b),c=a.normalizeRect(c),e[0]===b[0]&&e[1]===c[0]||e[0]===c[0]&&e[1]===b[0]?(g[0]=e[1],g[2]=e[2],f[0]===b[1]&&f[1]===c[1]||f[0]===c[1]&&f[1]===b[1]?(g[1]=f[1],g[3]=f[2],g):!1):!1},a.sign=function(a){return 0>a?-1:1},a.appendToArray=function(a,b){Array.prototype.push.apply(a,b)},a.prependToArray=function(a,b){Array.prototype.unshift.apply(a,b)},a.extendObj=function(a,b){for(var c in b)a[c]=b[c]},a.getInheritableProperty=function(a,b){for(;a&&!a.has(b);)a=a.get("Parent");return a?a.get(b):null},a.inherit=function(a,b,c){a.prototype=Object.create(b.prototype),a.prototype.constructor=a;for(var d in c)a.prototype[d]=c[d]},a.loadScript=function(a,b){var c=document.createElement("script"),d=!1;c.setAttribute("src",a),b&&(c.onload=function(){d||b(),d=!0}),document.getElementsByTagName("head")[0].appendChild(c)},a}(),PageViewport=PDFJS.PageViewport=function(){function a(a,b,c,d,e,f){this.viewBox=a,this.scale=b,this.rotation=c,this.offsetX=d,this.offsetY=e;var g,h,i,j,k=(a[2]+a[0])/2,l=(a[3]+a[1])/2;switch(c%=360,c=0>c?c+360:c){case 180:g=-1,h=0,i=0,j=1;break;case 90:g=0,h=1,i=1,j=0;break;case 270:g=0,h=-1,i=-1,j=0;break;default:g=1,h=0,i=0,j=-1}f&&(i=-i,j=-j);var m,n,o,p;0===g?(m=Math.abs(l-a[1])*b+d,n=Math.abs(k-a[0])*b+e,o=Math.abs(a[3]-a[1])*b,p=Math.abs(a[2]-a[0])*b):(m=Math.abs(k-a[0])*b+d,n=Math.abs(l-a[1])*b+e,o=Math.abs(a[2]-a[0])*b,p=Math.abs(a[3]-a[1])*b),this.transform=[g*b,h*b,i*b,j*b,m-g*b*k-i*b*l,n-h*b*k-j*b*l],this.width=o,this.height=p,this.fontScale=b}return a.prototype={clone:function(b){b=b||{};var c="scale"in b?b.scale:this.scale,d="rotation"in b?b.rotation:this.rotation;return new a(this.viewBox.slice(),c,d,this.offsetX,this.offsetY,b.dontFlip)},convertToViewportPoint:function(a,b){return Util.applyTransform([a,b],this.transform)},convertToViewportRectangle:function(a){var b=Util.applyTransform([a[0],a[1]],this.transform),c=Util.applyTransform([a[2],a[3]],this.transform);return[b[0],b[1],c[0],c[1]]},convertToPdfPoint:function(a,b){return Util.applyInverseTransform([a,b],this.transform)}},a}(),PDFStringTranslateTable=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];PDFJS.createPromiseCapability=createPromiseCapability,function(){function a(a){this._status=b,this._handlers=[];try{a.call(this,this._resolve.bind(this),this._reject.bind(this))}catch(c){this._reject(c)}}if(globalScope.Promise)return"function"!=typeof globalScope.Promise.all&&(globalScope.Promise.all=function(a){var b,c,d=0,e=[],f=new globalScope.Promise(function(a,d){b=a,c=d});return a.forEach(function(a,f){d++,a.then(function(a){e[f]=a,d--,0===d&&b(e)},c)}),0===d&&b(e),f}),"function"!=typeof globalScope.Promise.resolve&&(globalScope.Promise.resolve=function(a){return new globalScope.Promise(function(b){b(a)})}),"function"!=typeof globalScope.Promise.reject&&(globalScope.Promise.reject=function(a){return new globalScope.Promise(function(b,c){c(a)})}),void("function"!=typeof globalScope.Promise.prototype["catch"]&&(globalScope.Promise.prototype["catch"]=function(a){return globalScope.Promise.prototype.then(void 0,a)}));var b=0,c=1,d=2,e=500,f={handlers:[],running:!1,unhandledRejections:[],pendingRejectionCheck:!1,scheduleHandlers:function(a){a._status!==b&&(this.handlers=this.handlers.concat(a._handlers),a._handlers=[],this.running||(this.running=!0,setTimeout(this.runHandlers.bind(this),0)))},runHandlers:function(){for(var a=1,b=Date.now()+a;this.handlers.length>0;){var e=this.handlers.shift(),f=e.thisPromise._status,g=e.thisPromise._value;try{f===c?"function"==typeof e.onResolve&&(g=e.onResolve(g)):"function"==typeof e.onReject&&(g=e.onReject(g),f=c,e.thisPromise._unhandledRejection&&this.removeUnhandeledRejection(e.thisPromise))}catch(h){f=d,g=h}if(e.nextPromise._updateStatus(f,g),Date.now()>=b)break}return this.handlers.length>0?void setTimeout(this.runHandlers.bind(this),0):void(this.running=!1)},addUnhandledRejection:function(a){this.unhandledRejections.push({promise:a,time:Date.now()}),this.scheduleRejectionCheck()},removeUnhandeledRejection:function(a){a._unhandledRejection=!1;for(var b=0;b<this.unhandledRejections.length;b++)this.unhandledRejections[b].promise===a&&(this.unhandledRejections.splice(b),b--)},scheduleRejectionCheck:function(){this.pendingRejectionCheck||(this.pendingRejectionCheck=!0,setTimeout(function(){this.pendingRejectionCheck=!1;for(var a=Date.now(),b=0;b<this.unhandledRejections.length;b++)if(a-this.unhandledRejections[b].time>e){var c=this.unhandledRejections[b].promise._value,d="Unhandled rejection: "+c;c.stack&&(d+="\n"+c.stack),warn(d),this.unhandledRejections.splice(b),b--}this.unhandledRejections.length&&this.scheduleRejectionCheck()}.bind(this),e))}};a.all=function(b){function c(a){g._status!==d&&(i=[],f(a))}var e,f,g=new a(function(a,b){e=a,f=b}),h=b.length,i=[];if(0===h)return e(i),g;for(var j=0,k=b.length;k>j;++j){var l=b[j],m=function(a){return function(b){g._status!==d&&(i[a]=b,h--,0===h&&e(i))}}(j);a.isPromise(l)?l.then(m,c):m(l)}return g},a.isPromise=function(a){return a&&"function"==typeof a.then},a.resolve=function(b){return new a(function(a){a(b)})},a.reject=function(b){return new a(function(a,c){c(b)})},a.prototype={_status:null,_value:null,_handlers:null,_unhandledRejection:null,_updateStatus:function(b,e){if(this._status!==c&&this._status!==d){if(b===c&&a.isPromise(e))return void e.then(this._updateStatus.bind(this,c),this._updateStatus.bind(this,d));this._status=b,this._value=e,b===d&&0===this._handlers.length&&(this._unhandledRejection=!0,f.addUnhandledRejection(this)),f.scheduleHandlers(this)}},_resolve:function(a){this._updateStatus(c,a)},_reject:function(a){this._updateStatus(d,a)},then:function(b,c){var d=new a(function(a,b){this.resolve=a,this.reject=b});return this._handlers.push({thisPromise:this,onResolve:b,onReject:c,nextPromise:d}),f.scheduleHandlers(this),d},"catch":function(a){return this.then(void 0,a)}},globalScope.Promise=a}();var StatTimer=function(){function a(a,b,c){for(;a.length<c;)a+=b;return a}function b(){this.started={},this.times=[],this.enabled=!0}return b.prototype={time:function(a){this.enabled&&(a in this.started&&warn("Timer is already running for "+a),this.started[a]=Date.now())},timeEnd:function(a){this.enabled&&(a in this.started||warn("Timer has not been started for "+a),this.times.push({name:a,start:this.started[a],end:Date.now()}),delete this.started[a])},toString:function(){var b,c,d=this.times,e="",f=0;for(b=0,c=d.length;c>b;++b){var g=d[b].name;g.length>f&&(f=g.length)}for(b=0,c=d.length;c>b;++b){var h=d[b],i=h.end-h.start;e+=a(h.name," ",f)+" "+i+"ms\n"}return e}},b}();PDFJS.createBlob=function(a,b){if("undefined"!=typeof Blob)return new Blob([a],{type:b});var c=new MozBlobBuilder;return c.append(a),c.getBlob(b)},PDFJS.createObjectURL=function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return function(b,c){if(!PDFJS.disableCreateObjectURL&&"undefined"!=typeof URL&&URL.createObjectURL){var d=PDFJS.createBlob(b,c);return URL.createObjectURL(d)}for(var e="data:"+c+";base64,",f=0,g=b.length;g>f;f+=3){var h=255&b[f],i=255&b[f+1],j=255&b[f+2],k=h>>2,l=(3&h)<<4|i>>4,m=g>f+1?(15&i)<<2|j>>6:64,n=g>f+2?63&j:64;e+=a[k]+a[l]+a[m]+a[n]}return e}}(),MessageHandler.prototype={on:function(a,b,c){var d=this.actionHandler;d[a]&&error('There is already an actionName called "'+a+'"'),d[a]=[b,c]},send:function(a,b,c){var d={action:a,data:b};this.postMessage(d,c)},sendWithPromise:function(a,b,c){var d=this.callbackIndex++,e={action:a,data:b,callbackId:d},f=createPromiseCapability();this.callbacksCapabilities[d]=f;try{this.postMessage(e,c)}catch(g){f.reject(g)}return f.promise},postMessage:function(a,b){b&&this.postMessageTransfers?this.comObj.postMessage(a,b):this.comObj.postMessage(a)}};