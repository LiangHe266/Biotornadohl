function scaleto(a,c,b,e){if(a/c>b/e){rw=b;rh=parseInt(e*b/a)}else{rw=parseInt(b*e/c);rh=e}return{w:rw,h:rh}}function getScale(a,c,b,e){if(a/c>b/e){return b/a}else{return e/c}}function deleteItem(e,b){if(!e||b<0||b>e.length){return}var a=e[b];for(var c=b;c<e.length-1;c++){e[c]=e[c+1]}e.length=e.length-1;return a}function calcScale(l,f){var k=l.width;var g=l.height;var a=f.width;var i=f.height;var m=getScale(k,g,a,i);var e=parseInt(m*k);var j=parseInt(m*g);var c,b;c=(a-e)/2;b=(i-j)/2;return{ox:c,oy:b,sw:k,sh:g,dw:a,dh:i,scale:m}}function calcScale2(j,f,a,g){var k=getScale(j,f,a,g);var c=parseInt(k*j);var i=parseInt(k*f);var e,b;e=parseInt((a-c)/2);b=parseInt((g-i)/2);return{ox:e,oy:b,scale:k}}function initCanvas(b){var e=$(b);var a=$(b).width();var c=$(b).height();b.width=a;b.height=c}function clearContext(b,a,c){b.fillStyle="#000";b.fillRect(0,0,a,c)}function setCanvasSize(c,a,b){var c=$(canvas);var a=$(canvas).width();var b=$(canvas).height()}function removeByIdx(c,a){if(a>=c.length){return}for(var b=a;b<c.length;b++){c[b]=c[b+1]}c.length=c.length-1}function removeObject(f,c){for(var e=0;e<f.length;e++){var a=f[e];if(a==c){for(var b=e;b<f.length;b++){f[b]=f[b+1]}this.length=this.length-1}}}function scaleImageData(b,a,h){var i=b.createImageData(a.width*h,a.height*h);var f=b.createImageData(h,1).data;for(var m=0;m<a.height;m++){for(var g=0;g<a.width;g++){var c=a.data.subarray((m*a.width+g)*4,(m*a.width+g)*4+4);for(var k=0;k<h;k++){f.set(c,k*4)}for(var j=0;j<h;j++){var l=m*h+j;var e=g*h;i.data.set(f,(l*i.width+e)*4)}}}return i}function getSplit(e,b,a){var c=e.split(b);if(a>=0&&a<c.length){return c[a]}return""}function getSplitR(e,b,a){var c=e.split(b);if(a>=0&&a<c.length){return c[c.length-1-a]}return""}function getProperSpan(a){var b;var f=a;var e=0;var c=0;if(f<=0){return 0}while(f<0){f=f*10;e--;if(e<-5){return 0}}while(f>0){b=f/10;if(parseInt(b)==0){b=parseInt(f%10);switch(b){case 9:case 8:case 7:case 6:case 5:c=5;break;case 4:case 3:case 2:c=2;break;case 1:c=1;break;case 0:default:c=0;break}break}else{f=b;e++}}if(!c){return 0}while(0!=e){if(e>0){e--;c*=10}else{e++;c/=10}}return c}var _pacsTempCanvas=null;function getTempCanvas(){if(!_pacsTempCanvas){_pacsTempCanvas=document.createElement("canvas")}return _pacsTempCanvas}function getDefaultWL(){return{window:400,level:40}}function distance(e,g,c,f){var b=(e-c);var a=(g-f);return Math.sqrt(b*b+a*a)}function drawEllipse(h,e,l,g,c){var j=0.5522848,i=g*j,f=c*j;h.moveTo(e-g,l);h.bezierCurveTo(e-g,l-f,e-i,l-c,e,l-c);h.bezierCurveTo(e+i,l-c,e+g,l-f,e+g,l);h.bezierCurveTo(e+g,l+f,e+i,l+c,e,l+c);h.bezierCurveTo(e-i,l+c,e-g,l+f,e-g,l)}function calcAngle(f,h,e,g){var c=e-f;var a=h-g;var b=a/Math.sqrt(c*c+a*a);var i=Math.abs(Math.asin(b));i=i/Math.PI*180;if(c>=0){if(a<0){i=360-i}}else{if(a<0){i=180+i}else{i=180-i}}return i}function centerDrawInfo(g,a,e,b,f){var c=g.scale;g.ox=a/2-b*c/2;g.oy=e/2-f*c/2}function adjustDrawInfo(o,c,q,k,b,h){try{var p=k/c;var j=b/q;var g=h.width;var r=h.height;var n=k/g;var m=k/r;var a=o.scale;var t=t;var i=o.ox+g*t/2;var f=o.oy+r*t/2;i*=p;f*=j;p*=t;j*=t;if(p>n){d("too width");if(k>=c){p=Math.Max(n,t)}}if(j>m){d("too height");if(b>=q){j=Math.Max(m,t)}}t=Math.min(p,j);if(t<0.01){t=0.01}else{if(t>100){t=100}}i-=g*t/2;f-=r*t/2;d("scale :"+t+" cx:"+i+" cy:"+f);o.scale=t;o.ox=i;o.oy=f}catch(l){}finally{}}function createDrawInfo(c,a){if(!c||!a){return null}var b=calcScale(c,a);b.rotate=0;b.flipX=1;b.flipY=1;return b}function rotatePoint(a,c,b){if(b.flipX){a=-a}if(b.flipY){c=-c}switch(b.rotate){case 0:break;case 90:a=c;c=-a;break;case 180:a=-c;c=-a;break;case 270:a=-c;c=a;break}return[a,c]}function createLinearData(c){var g=c.length;var e,b;var l,k;var m;var a;var h;var f;var o;var n=new Array(c[g-1].stop);for(e=0;e<g-1;e++){l=c[e];k=c[e+1];m=k.stop-l.stop;a=k.value-l.value;h=l.stop;o=l.value;f=k.stop;for(b=h;b<=f;b++){n[b]=o+a*(b-h)/m}}return n}function getLinearValue(c,f){var g=c.length;var e;var m;var a;var k;var o;var l,h;var b=f;var n;if(!g){return 0}for(e=0;e<g-1;e++){l=c[e];h=c[e+1];if(b>=l.stop&&b<=h.stop){m=h.stop-l.stop;a=h.value-l.value;k=l.stop;o=l.value;n=o+a*(b-k)/m;return n}}if(b<c[0].stop){n=c[0].value;d("use first index:"+b+" value:"+n);return n}if(b>c[g-1].stop){n=c[g-1].value;d("use last index:"+b+" value:"+n);return c[g-1].value}d("getLinearValue ==> why ?");return 0}var __JSON_PROTECTION_PREFIX=/^\)\]\}',?\n/;var __JSON_START=/^\s*(\[|\{[^\{])/;var __JSON_END=/[\}\]]\s*$/;function obj2Json(a){return JSON.stringify(a)}function json2Obj(b){var a=b;if(typeof b==="string"){b=b.replace(__JSON_PROTECTION_PREFIX,"");if(__JSON_START.test(b)&&__JSON_END.test(b)){a=JSON.parse(b)}}return a}function httpGetArrayBuffer(b,f){var a=this;b=window.baseUrl+b;var c=new XMLHttpRequest();c.open("GET",b,true);c.responseType="arraybuffer";c.setRequestHeader("Authorization",getAuthToken());var e=new Date().getTime(this);c.onload=function(k){if(this.status==200){var h=new Date().getTime();var j=h-e;var g=this.response.byteLength;f(this.response);var i=g*8/(j*1000)}else{d("get stream failed")}};c.onerror=function(g){d("Error loading");f(null)};c.onprogress=function(h){if(h.lengthComputable){var g=Math.floor(100*h.loaded/h.total)}};c.send(null)}function httpGetJsonObj(b,f){var a=this;b=window.baseUrl+b;var c=new XMLHttpRequest();c.open("GET",b,true);c.setRequestHeader("Authorization",getAuthToken());var e=new Date().getTime(this);c.onload=function(g){if(this.status==200){f(json2Obj(this.response))}else{d("get string failed")}};c.onerror=function(g){d("Error loading");f(null)};c.onprogress=function(g){if(g.lengthComputable){}};c.send(null)}function dd(a){console.log(a)}function transXY(f,j,g,e,i,h){return[g*f+i*j,e*f+h*j]}function msgBox(b,c){if(!c){c="center"}var a=new $.zui.Messager(b,{placement:c});a.show()};